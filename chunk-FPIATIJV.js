import{f as i3}from"./chunk-GU3ICRQD.js";import{A as WN,B as zN,Ea as ii,Fa as Vf,I as HN,Na as Nd,O as KN,Q as qN,Qb as o3,S as Iv,Sa as Av,Sb as s3,T as jN,W as XN,Yb as a3,Za as Sa,_a as e3,a as Ta,ab as oc,b as nc,bb as Iu,cb as _d,d as Mn,db as t3,e as $t,eb as r3,f as ks,fb as Gf,g as ne,ha as YN,hb as Wf,ia as ZN,ib as zf,ja as QN,jb as Hf,kb as sc,m as GN,mb as kv,nb as n3,oa as JN,t as Ed}from"./chunk-ZLMIVOC7.js";var u3=Mn((ic,Kf)=>{"use strict";(function(){var e,t="4.17.21",r=200,n="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",o="Expected a function",s="Invalid `variable` option passed into `_.template`",i="__lodash_hash_undefined__",a=500,u="__lodash_placeholder__",c=1,p=2,m=4,h=1,x=2,y=1,v=2,w=4,C=8,I=16,D=32,P=64,G=128,q=256,Z=512,Y=30,te="...",J=800,ae=16,ge=1,ke=2,We=3,Re=1/0,ct=9007199254740991,oe=17976931348623157e292,fe=NaN,se=4294967295,we=se-1,xe=se>>>1,Ne=[["ary",G],["bind",y],["bindKey",v],["curry",C],["curryRight",I],["flip",Z],["partial",D],["partialRight",P],["rearg",q]],Te="[object Arguments]",Ze="[object Array]",ye="[object AsyncFunction]",Qe="[object Boolean]",et="[object Date]",cr="[object DOMException]",Kt="[object Error]",Nt="[object Function]",Ut="[object GeneratorFunction]",Ft="[object Map]",nt="[object Number]",At="[object Null]",Pt="[object Object]",un="[object Promise]",bn="[object Proxy]",vn="[object RegExp]",hr="[object Set]",Jr="[object String]",Lr="[object Symbol]",ln="[object Undefined]",cn="[object WeakMap]",Vr="[object WeakSet]",pn="[object ArrayBuffer]",wn="[object DataView]",Xo="[object Float32Array]",Ts="[object Float64Array]",Ss="[object Int8Array]",Tn="[object Int16Array]",la="[object Int32Array]",js="[object Uint8Array]",Cs="[object Uint8ClampedArray]",lu="[object Uint16Array]",Al="[object Uint32Array]",gb=/\b__p \+= '';/g,Th=/\b(__p \+=) '' \+/g,qp=/(__e\(.*?\)|\b__t\)) \+\n'';/g,Xs=/&(?:amp|lt|gt|quot|#39);/g,ca=/[&<>"']/g,Sh=RegExp(Xs.source),Ch=RegExp(ca.source),jp=/<%-([\s\S]+?)%>/g,Eh=/<%([\s\S]+?)%>/g,Ys=/<%=([\s\S]+?)%>/g,Xp=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Nh=/^\w*$/,kl=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,pa=/[\\^$.*+?()[\]{}|]/g,xb=RegExp(pa.source),Zs=/^\s+/,yb=/\s/,Es=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,Ii=/\{\n\/\* \[wrapped with (.+)\] \*/,_h=/,? & /,dr=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,Yo=/[()=,{}\[\]\/\s]/,Yp=/\\(\\)?/g,bb=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,cu=/\w*$/,Zp=/^[-+]0x[0-9a-f]+$/i,$l=/^0b[01]+$/i,pu=/^\[object .+?Constructor\]$/,Ih=/^0o[0-7]+$/i,Qp=/^(?:0|[1-9]\d*)$/,Jp=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,fu=/($^)/,_o=/['\n\r\u2028\u2029\\]/g,On="\\ud800-\\udfff",mu="\\u0300-\\u036f",ef="\\ufe20-\\ufe2f",tf="\\u20d0-\\u20ff",rf=mu+ef+tf,hu="\\u2700-\\u27bf",Io="a-z\\xdf-\\xf6\\xf8-\\xff",Ah="\\xac\\xb1\\xd7\\xf7",Rl="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",Zo="\\u2000-\\u206f",Ol=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",kh="A-Z\\xc0-\\xd6\\xd8-\\xde",nf="\\ufe0e\\ufe0f",Dl=Ah+Rl+Zo+Ol,of="['\u2019]",vb="["+On+"]",sf="["+Dl+"]",du="["+rf+"]",af="\\d+",$h="["+hu+"]",fn="["+Io+"]",uf="[^"+On+Dl+af+hu+Io+kh+"]",Fl="\\ud83c[\\udffb-\\udfff]",Pl="(?:"+du+"|"+Fl+")",lf="[^"+On+"]",Ll="(?:\\ud83c[\\udde6-\\uddff]){2}",cf="[\\ud800-\\udbff][\\udc00-\\udfff]",fa="["+kh+"]",pf="\\u200d",ff="(?:"+fn+"|"+uf+")",Bl="(?:"+fa+"|"+uf+")",mf="(?:"+of+"(?:d|ll|m|re|s|t|ve))?",hf="(?:"+of+"(?:D|LL|M|RE|S|T|VE))?",ma=Pl+"?",Rh="["+nf+"]?",wb="(?:"+pf+"(?:"+[lf,Ll,cf].join("|")+")"+Rh+ma+")*",Tb="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",Sb="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",Ml=Rh+ma+wb,gu="(?:"+[$h,Ll,cf].join("|")+")"+Ml,Cb="(?:"+[lf+du+"?",du,Ll,cf,vb].join("|")+")",Eb=RegExp(of,"g"),Nb=RegExp(du,"g"),df=RegExp(Fl+"(?="+Fl+")|"+Cb+Ml,"g"),gf=RegExp([fa+"?"+fn+"+"+mf+"(?="+[sf,fa,"$"].join("|")+")",Bl+"+"+hf+"(?="+[sf,fa+ff,"$"].join("|")+")",fa+"?"+ff+"+"+mf,fa+"+"+hf,Sb,Tb,af,gu].join("|"),"g"),Oh=RegExp("["+pf+On+rf+nf+"]"),Dh=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,xu=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],Ao=-1,qt={};qt[Xo]=qt[Ts]=qt[Ss]=qt[Tn]=qt[la]=qt[js]=qt[Cs]=qt[lu]=qt[Al]=!0,qt[Te]=qt[Ze]=qt[pn]=qt[Qe]=qt[wn]=qt[et]=qt[Kt]=qt[Nt]=qt[Ft]=qt[nt]=qt[Pt]=qt[vn]=qt[hr]=qt[Jr]=qt[cn]=!1;var Vt={};Vt[Te]=Vt[Ze]=Vt[pn]=Vt[wn]=Vt[Qe]=Vt[et]=Vt[Xo]=Vt[Ts]=Vt[Ss]=Vt[Tn]=Vt[la]=Vt[Ft]=Vt[nt]=Vt[Pt]=Vt[vn]=Vt[hr]=Vt[Jr]=Vt[Lr]=Vt[js]=Vt[Cs]=Vt[lu]=Vt[Al]=!0,Vt[Kt]=Vt[Nt]=Vt[cn]=!1;var Fh={\u00C0:"A",\u00C1:"A",\u00C2:"A",\u00C3:"A",\u00C4:"A",\u00C5:"A",\u00E0:"a",\u00E1:"a",\u00E2:"a",\u00E3:"a",\u00E4:"a",\u00E5:"a",\u00C7:"C",\u00E7:"c",\u00D0:"D",\u00F0:"d",\u00C8:"E",\u00C9:"E",\u00CA:"E",\u00CB:"E",\u00E8:"e",\u00E9:"e",\u00EA:"e",\u00EB:"e",\u00CC:"I",\u00CD:"I",\u00CE:"I",\u00CF:"I",\u00EC:"i",\u00ED:"i",\u00EE:"i",\u00EF:"i",\u00D1:"N",\u00F1:"n",\u00D2:"O",\u00D3:"O",\u00D4:"O",\u00D5:"O",\u00D6:"O",\u00D8:"O",\u00F2:"o",\u00F3:"o",\u00F4:"o",\u00F5:"o",\u00F6:"o",\u00F8:"o",\u00D9:"U",\u00DA:"U",\u00DB:"U",\u00DC:"U",\u00F9:"u",\u00FA:"u",\u00FB:"u",\u00FC:"u",\u00DD:"Y",\u00FD:"y",\u00FF:"y",\u00C6:"Ae",\u00E6:"ae",\u00DE:"Th",\u00FE:"th",\u00DF:"ss",\u0100:"A",\u0102:"A",\u0104:"A",\u0101:"a",\u0103:"a",\u0105:"a",\u0106:"C",\u0108:"C",\u010A:"C",\u010C:"C",\u0107:"c",\u0109:"c",\u010B:"c",\u010D:"c",\u010E:"D",\u0110:"D",\u010F:"d",\u0111:"d",\u0112:"E",\u0114:"E",\u0116:"E",\u0118:"E",\u011A:"E",\u0113:"e",\u0115:"e",\u0117:"e",\u0119:"e",\u011B:"e",\u011C:"G",\u011E:"G",\u0120:"G",\u0122:"G",\u011D:"g",\u011F:"g",\u0121:"g",\u0123:"g",\u0124:"H",\u0126:"H",\u0125:"h",\u0127:"h",\u0128:"I",\u012A:"I",\u012C:"I",\u012E:"I",\u0130:"I",\u0129:"i",\u012B:"i",\u012D:"i",\u012F:"i",\u0131:"i",\u0134:"J",\u0135:"j",\u0136:"K",\u0137:"k",\u0138:"k",\u0139:"L",\u013B:"L",\u013D:"L",\u013F:"L",\u0141:"L",\u013A:"l",\u013C:"l",\u013E:"l",\u0140:"l",\u0142:"l",\u0143:"N",\u0145:"N",\u0147:"N",\u014A:"N",\u0144:"n",\u0146:"n",\u0148:"n",\u014B:"n",\u014C:"O",\u014E:"O",\u0150:"O",\u014D:"o",\u014F:"o",\u0151:"o",\u0154:"R",\u0156:"R",\u0158:"R",\u0155:"r",\u0157:"r",\u0159:"r",\u015A:"S",\u015C:"S",\u015E:"S",\u0160:"S",\u015B:"s",\u015D:"s",\u015F:"s",\u0161:"s",\u0162:"T",\u0164:"T",\u0166:"T",\u0163:"t",\u0165:"t",\u0167:"t",\u0168:"U",\u016A:"U",\u016C:"U",\u016E:"U",\u0170:"U",\u0172:"U",\u0169:"u",\u016B:"u",\u016D:"u",\u016F:"u",\u0171:"u",\u0173:"u",\u0174:"W",\u0175:"w",\u0176:"Y",\u0177:"y",\u0178:"Y",\u0179:"Z",\u017B:"Z",\u017D:"Z",\u017A:"z",\u017C:"z",\u017E:"z",\u0132:"IJ",\u0133:"ij",\u0152:"Oe",\u0153:"oe",\u0149:"'n",\u017F:"s"},Ph={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},xf={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},yf={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},ha=parseFloat,Lh=parseInt,Ul=typeof global=="object"&&global&&global.Object===Object&&global,_b=typeof self=="object"&&self&&self.Object===Object&&self,Ar=Ul||_b||Function("return this")(),Qs=typeof ic=="object"&&ic&&!ic.nodeType&&ic,Js=Qs&&typeof Kf=="object"&&Kf&&!Kf.nodeType&&Kf,bf=Js&&Js.exports===Qs,vf=bf&&Ul.process,Dn=function(){try{var j=Js&&Js.require&&Js.require("util").types;return j||vf&&vf.binding&&vf.binding("util")}catch{}}(),yu=Dn&&Dn.isArrayBuffer,wf=Dn&&Dn.isDate,Bh=Dn&&Dn.isMap,Tf=Dn&&Dn.isRegExp,Sf=Dn&&Dn.isSet,Cf=Dn&&Dn.isTypedArray;function Sn(j,ie,re){switch(re.length){case 0:return j.call(ie);case 1:return j.call(ie,re[0]);case 2:return j.call(ie,re[0],re[1]);case 3:return j.call(ie,re[0],re[1],re[2])}return j.apply(ie,re)}function Ef(j,ie,re,Ie){for(var tt=-1,kt=j==null?0:j.length;++tt<kt;){var zr=j[tt];ie(Ie,zr,re(zr),j)}return Ie}function Fn(j,ie){for(var re=-1,Ie=j==null?0:j.length;++re<Ie&&ie(j[re],re,j)!==!1;);return j}function Ib(j,ie){for(var re=j==null?0:j.length;re--&&ie(j[re],re,j)!==!1;);return j}function Mh(j,ie){for(var re=-1,Ie=j==null?0:j.length;++re<Ie;)if(!ie(j[re],re,j))return!1;return!0}function ei(j,ie){for(var re=-1,Ie=j==null?0:j.length,tt=0,kt=[];++re<Ie;){var zr=j[re];ie(zr,re,j)&&(kt[tt++]=zr)}return kt}function Vl(j,ie){var re=j==null?0:j.length;return!!re&&Ai(j,ie,0)>-1}function Gl(j,ie,re){for(var Ie=-1,tt=j==null?0:j.length;++Ie<tt;)if(re(ie,j[Ie]))return!0;return!1}function er(j,ie){for(var re=-1,Ie=j==null?0:j.length,tt=Array(Ie);++re<Ie;)tt[re]=ie(j[re],re,j);return tt}function ti(j,ie){for(var re=-1,Ie=ie.length,tt=j.length;++re<Ie;)j[tt+re]=ie[re];return j}function bu(j,ie,re,Ie){var tt=-1,kt=j==null?0:j.length;for(Ie&&kt&&(re=j[++tt]);++tt<kt;)re=ie(re,j[tt],tt,j);return re}function Ab(j,ie,re,Ie){var tt=j==null?0:j.length;for(Ie&&tt&&(re=j[--tt]);tt--;)re=ie(re,j[tt],tt,j);return re}function Nf(j,ie){for(var re=-1,Ie=j==null?0:j.length;++re<Ie;)if(ie(j[re],re,j))return!0;return!1}var kb=N("length");function Wl(j){return j.split("")}function $b(j){return j.match(dr)||[]}function Uh(j,ie,re){var Ie;return re(j,function(tt,kt,zr){if(ie(tt,kt,zr))return Ie=kt,!1}),Ie}function zl(j,ie,re,Ie){for(var tt=j.length,kt=re+(Ie?1:-1);Ie?kt--:++kt<tt;)if(ie(j[kt],kt,j))return kt;return-1}function Ai(j,ie,re){return ie===ie?Ob(j,ie,re):zl(j,d,re)}function Vh(j,ie,re,Ie){for(var tt=re-1,kt=j.length;++tt<kt;)if(Ie(j[tt],ie))return tt;return-1}function d(j){return j!==j}function b(j,ie){var re=j==null?0:j.length;return re?M(j,ie)/re:fe}function N(j){return function(ie){return ie==null?e:ie[j]}}function $(j){return function(ie){return j==null?e:j[ie]}}function B(j,ie,re,Ie,tt){return tt(j,function(kt,zr,Xt){re=Ie?(Ie=!1,kt):ie(re,kt,zr,Xt)}),re}function V(j,ie){var re=j.length;for(j.sort(ie);re--;)j[re]=j[re].value;return j}function M(j,ie){for(var re,Ie=-1,tt=j.length;++Ie<tt;){var kt=ie(j[Ie]);kt!==e&&(re=re===e?kt:re+kt)}return re}function K(j,ie){for(var re=-1,Ie=Array(j);++re<j;)Ie[re]=ie(re);return Ie}function ee(j,ie){return er(ie,function(re){return[re,j[re]]})}function he(j){return j&&j.slice(0,QC(j)+1).replace(Zs,"")}function de(j){return function(ie){return j(ie)}}function He(j,ie){return er(ie,function(re){return j[re]})}function Oe(j,ie){return j.has(ie)}function Ce(j,ie){for(var re=-1,Ie=j.length;++re<Ie&&Ai(ie,j[re],0)>-1;);return re}function qe(j,ie){for(var re=j.length;re--&&Ai(ie,j[re],0)>-1;);return re}function at(j,ie){for(var re=j.length,Ie=0;re--;)j[re]===ie&&++Ie;return Ie}var jt=$(Fh),Gt=$(Ph);function Gr(j){return"\\"+yf[j]}function ro(j,ie){return j==null?e:j[ie]}function kr(j){return Oh.test(j)}function Tt(j){return Dh.test(j)}function Wr(j){for(var ie,re=[];!(ie=j.next()).done;)re.push(ie.value);return re}function Qo(j){var ie=-1,re=Array(j.size);return j.forEach(function(Ie,tt){re[++ie]=[tt,Ie]}),re}function Gh(j,ie){return function(re){return j(ie(re))}}function ri(j,ie){for(var re=-1,Ie=j.length,tt=0,kt=[];++re<Ie;){var zr=j[re];(zr===ie||zr===u)&&(j[re]=u,kt[tt++]=re)}return kt}function Hl(j){var ie=-1,re=Array(j.size);return j.forEach(function(Ie){re[++ie]=Ie}),re}function Rb(j){var ie=-1,re=Array(j.size);return j.forEach(function(Ie){re[++ie]=[Ie,Ie]}),re}function Ob(j,ie,re){for(var Ie=re-1,tt=j.length;++Ie<tt;)if(j[Ie]===ie)return Ie;return-1}function Kl(j,ie,re){for(var Ie=re+1;Ie--;)if(j[Ie]===ie)return Ie;return Ie}function ql(j){return kr(j)?MM(j):kb(j)}function Ns(j){return kr(j)?UM(j):Wl(j)}function QC(j){for(var ie=j.length;ie--&&yb.test(j.charAt(ie)););return ie}var BM=$(xf);function MM(j){for(var ie=df.lastIndex=0;df.test(j);)++ie;return ie}function UM(j){return j.match(df)||[]}function VM(j){return j.match(gf)||[]}var GM=function j(ie){ie=ie==null?Ar:da.defaults(Ar.Object(),ie,da.pick(Ar,xu));var re=ie.Array,Ie=ie.Date,tt=ie.Error,kt=ie.Function,zr=ie.Math,Xt=ie.Object,Db=ie.RegExp,WM=ie.String,Jo=ie.TypeError,Wh=re.prototype,zM=kt.prototype,jl=Xt.prototype,zh=ie["__core-js_shared__"],Hh=zM.toString,Lt=jl.hasOwnProperty,HM=0,JC=function(){var l=/[^.]+$/.exec(zh&&zh.keys&&zh.keys.IE_PROTO||"");return l?"Symbol(src)_1."+l:""}(),Kh=jl.toString,KM=Hh.call(Xt),qM=Ar._,jM=Db("^"+Hh.call(Lt).replace(pa,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),qh=bf?ie.Buffer:e,ga=ie.Symbol,jh=ie.Uint8Array,eE=qh?qh.allocUnsafe:e,Xh=Gh(Xt.getPrototypeOf,Xt),tE=Xt.create,rE=jl.propertyIsEnumerable,Yh=Wh.splice,nE=ga?ga.isConcatSpreadable:e,_f=ga?ga.iterator:e,vu=ga?ga.toStringTag:e,Zh=function(){try{var l=Eu(Xt,"defineProperty");return l({},"",{}),l}catch{}}(),XM=ie.clearTimeout!==Ar.clearTimeout&&ie.clearTimeout,YM=Ie&&Ie.now!==Ar.Date.now&&Ie.now,ZM=ie.setTimeout!==Ar.setTimeout&&ie.setTimeout,Qh=zr.ceil,Jh=zr.floor,Fb=Xt.getOwnPropertySymbols,QM=qh?qh.isBuffer:e,oE=ie.isFinite,JM=Wh.join,e5=Gh(Xt.keys,Xt),Hr=zr.max,Cn=zr.min,t5=Ie.now,r5=ie.parseInt,sE=zr.random,n5=Wh.reverse,Pb=Eu(ie,"DataView"),If=Eu(ie,"Map"),Lb=Eu(ie,"Promise"),Xl=Eu(ie,"Set"),Af=Eu(ie,"WeakMap"),kf=Eu(Xt,"create"),ed=Af&&new Af,Yl={},o5=Nu(Pb),s5=Nu(If),i5=Nu(Lb),a5=Nu(Xl),u5=Nu(Af),td=ga?ga.prototype:e,$f=td?td.valueOf:e,iE=td?td.toString:e;function F(l){if(Sr(l)&&!ot(l)&&!(l instanceof dt)){if(l instanceof es)return l;if(Lt.call(l,"__wrapped__"))return aN(l)}return new es(l)}var Zl=function(){function l(){}return function(f){if(!gr(f))return{};if(tE)return tE(f);l.prototype=f;var g=new l;return l.prototype=e,g}}();function rd(){}function es(l,f){this.__wrapped__=l,this.__actions__=[],this.__chain__=!!f,this.__index__=0,this.__values__=e}F.templateSettings={escape:jp,evaluate:Eh,interpolate:Ys,variable:"",imports:{_:F}},F.prototype=rd.prototype,F.prototype.constructor=F,es.prototype=Zl(rd.prototype),es.prototype.constructor=es;function dt(l){this.__wrapped__=l,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=se,this.__views__=[]}function l5(){var l=new dt(this.__wrapped__);return l.__actions__=no(this.__actions__),l.__dir__=this.__dir__,l.__filtered__=this.__filtered__,l.__iteratees__=no(this.__iteratees__),l.__takeCount__=this.__takeCount__,l.__views__=no(this.__views__),l}function c5(){if(this.__filtered__){var l=new dt(this);l.__dir__=-1,l.__filtered__=!0}else l=this.clone(),l.__dir__*=-1;return l}function p5(){var l=this.__wrapped__.value(),f=this.__dir__,g=ot(l),T=f<0,k=g?l.length:0,L=SU(0,k,this.__views__),W=L.start,H=L.end,X=H-W,ue=T?H:W-1,le=this.__iteratees__,me=le.length,Ee=0,Pe=Cn(X,this.__takeCount__);if(!g||!T&&k==X&&Pe==X)return kE(l,this.__actions__);var Xe=[];e:for(;X--&&Ee<Pe;){ue+=f;for(var lt=-1,Ye=l[ue];++lt<me;){var mt=le[lt],vt=mt.iteratee,Ro=mt.type,Bn=vt(Ye);if(Ro==ke)Ye=Bn;else if(!Bn){if(Ro==ge)continue e;break e}}Xe[Ee++]=Ye}return Xe}dt.prototype=Zl(rd.prototype),dt.prototype.constructor=dt;function wu(l){var f=-1,g=l==null?0:l.length;for(this.clear();++f<g;){var T=l[f];this.set(T[0],T[1])}}function f5(){this.__data__=kf?kf(null):{},this.size=0}function m5(l){var f=this.has(l)&&delete this.__data__[l];return this.size-=f?1:0,f}function h5(l){var f=this.__data__;if(kf){var g=f[l];return g===i?e:g}return Lt.call(f,l)?f[l]:e}function d5(l){var f=this.__data__;return kf?f[l]!==e:Lt.call(f,l)}function g5(l,f){var g=this.__data__;return this.size+=this.has(l)?0:1,g[l]=kf&&f===e?i:f,this}wu.prototype.clear=f5,wu.prototype.delete=m5,wu.prototype.get=h5,wu.prototype.has=d5,wu.prototype.set=g5;function ki(l){var f=-1,g=l==null?0:l.length;for(this.clear();++f<g;){var T=l[f];this.set(T[0],T[1])}}function x5(){this.__data__=[],this.size=0}function y5(l){var f=this.__data__,g=nd(f,l);if(g<0)return!1;var T=f.length-1;return g==T?f.pop():Yh.call(f,g,1),--this.size,!0}function b5(l){var f=this.__data__,g=nd(f,l);return g<0?e:f[g][1]}function v5(l){return nd(this.__data__,l)>-1}function w5(l,f){var g=this.__data__,T=nd(g,l);return T<0?(++this.size,g.push([l,f])):g[T][1]=f,this}ki.prototype.clear=x5,ki.prototype.delete=y5,ki.prototype.get=b5,ki.prototype.has=v5,ki.prototype.set=w5;function $i(l){var f=-1,g=l==null?0:l.length;for(this.clear();++f<g;){var T=l[f];this.set(T[0],T[1])}}function T5(){this.size=0,this.__data__={hash:new wu,map:new(If||ki),string:new wu}}function S5(l){var f=dd(this,l).delete(l);return this.size-=f?1:0,f}function C5(l){return dd(this,l).get(l)}function E5(l){return dd(this,l).has(l)}function N5(l,f){var g=dd(this,l),T=g.size;return g.set(l,f),this.size+=g.size==T?0:1,this}$i.prototype.clear=T5,$i.prototype.delete=S5,$i.prototype.get=C5,$i.prototype.has=E5,$i.prototype.set=N5;function Tu(l){var f=-1,g=l==null?0:l.length;for(this.__data__=new $i;++f<g;)this.add(l[f])}function _5(l){return this.__data__.set(l,i),this}function I5(l){return this.__data__.has(l)}Tu.prototype.add=Tu.prototype.push=_5,Tu.prototype.has=I5;function _s(l){var f=this.__data__=new ki(l);this.size=f.size}function A5(){this.__data__=new ki,this.size=0}function k5(l){var f=this.__data__,g=f.delete(l);return this.size=f.size,g}function $5(l){return this.__data__.get(l)}function R5(l){return this.__data__.has(l)}function O5(l,f){var g=this.__data__;if(g instanceof ki){var T=g.__data__;if(!If||T.length<r-1)return T.push([l,f]),this.size=++g.size,this;g=this.__data__=new $i(T)}return g.set(l,f),this.size=g.size,this}_s.prototype.clear=A5,_s.prototype.delete=k5,_s.prototype.get=$5,_s.prototype.has=R5,_s.prototype.set=O5;function aE(l,f){var g=ot(l),T=!g&&_u(l),k=!g&&!T&&wa(l),L=!g&&!T&&!k&&tc(l),W=g||T||k||L,H=W?K(l.length,WM):[],X=H.length;for(var ue in l)(f||Lt.call(l,ue))&&!(W&&(ue=="length"||k&&(ue=="offset"||ue=="parent")||L&&(ue=="buffer"||ue=="byteLength"||ue=="byteOffset")||Fi(ue,X)))&&H.push(ue);return H}function uE(l){var f=l.length;return f?l[jb(0,f-1)]:e}function D5(l,f){return gd(no(l),Su(f,0,l.length))}function F5(l){return gd(no(l))}function Bb(l,f,g){(g!==e&&!Is(l[f],g)||g===e&&!(f in l))&&Ri(l,f,g)}function Rf(l,f,g){var T=l[f];(!(Lt.call(l,f)&&Is(T,g))||g===e&&!(f in l))&&Ri(l,f,g)}function nd(l,f){for(var g=l.length;g--;)if(Is(l[g][0],f))return g;return-1}function P5(l,f,g,T){return xa(l,function(k,L,W){f(T,k,g(k),W)}),T}function lE(l,f){return l&&oi(f,en(f),l)}function L5(l,f){return l&&oi(f,so(f),l)}function Ri(l,f,g){f=="__proto__"&&Zh?Zh(l,f,{configurable:!0,enumerable:!0,value:g,writable:!0}):l[f]=g}function Mb(l,f){for(var g=-1,T=f.length,k=re(T),L=l==null;++g<T;)k[g]=L?e:bv(l,f[g]);return k}function Su(l,f,g){return l===l&&(g!==e&&(l=l<=g?l:g),f!==e&&(l=l>=f?l:f)),l}function ts(l,f,g,T,k,L){var W,H=f&c,X=f&p,ue=f&m;if(g&&(W=k?g(l,T,k,L):g(l)),W!==e)return W;if(!gr(l))return l;var le=ot(l);if(le){if(W=EU(l),!H)return no(l,W)}else{var me=En(l),Ee=me==Nt||me==Ut;if(wa(l))return OE(l,H);if(me==Pt||me==Te||Ee&&!k){if(W=X||Ee?{}:QE(l),!H)return X?hU(l,L5(W,l)):mU(l,lE(W,l))}else{if(!Vt[me])return k?l:{};W=NU(l,me,H)}}L||(L=new _s);var Pe=L.get(l);if(Pe)return Pe;L.set(l,W),_N(l)?l.forEach(function(Ye){W.add(ts(Ye,f,g,Ye,l,L))}):EN(l)&&l.forEach(function(Ye,mt){W.set(mt,ts(Ye,f,g,mt,l,L))});var Xe=ue?X?sv:ov:X?so:en,lt=le?e:Xe(l);return Fn(lt||l,function(Ye,mt){lt&&(mt=Ye,Ye=l[mt]),Rf(W,mt,ts(Ye,f,g,mt,l,L))}),W}function B5(l){var f=en(l);return function(g){return cE(g,l,f)}}function cE(l,f,g){var T=g.length;if(l==null)return!T;for(l=Xt(l);T--;){var k=g[T],L=f[k],W=l[k];if(W===e&&!(k in l)||!L(W))return!1}return!0}function pE(l,f,g){if(typeof l!="function")throw new Jo(o);return Mf(function(){l.apply(e,g)},f)}function Of(l,f,g,T){var k=-1,L=Vl,W=!0,H=l.length,X=[],ue=f.length;if(!H)return X;g&&(f=er(f,de(g))),T?(L=Gl,W=!1):f.length>=r&&(L=Oe,W=!1,f=new Tu(f));e:for(;++k<H;){var le=l[k],me=g==null?le:g(le);if(le=T||le!==0?le:0,W&&me===me){for(var Ee=ue;Ee--;)if(f[Ee]===me)continue e;X.push(le)}else L(f,me,T)||X.push(le)}return X}var xa=BE(ni),fE=BE(Vb,!0);function M5(l,f){var g=!0;return xa(l,function(T,k,L){return g=!!f(T,k,L),g}),g}function od(l,f,g){for(var T=-1,k=l.length;++T<k;){var L=l[T],W=f(L);if(W!=null&&(H===e?W===W&&!$o(W):g(W,H)))var H=W,X=L}return X}function U5(l,f,g,T){var k=l.length;for(g=ut(g),g<0&&(g=-g>k?0:k+g),T=T===e||T>k?k:ut(T),T<0&&(T+=k),T=g>T?0:AN(T);g<T;)l[g++]=f;return l}function mE(l,f){var g=[];return xa(l,function(T,k,L){f(T,k,L)&&g.push(T)}),g}function mn(l,f,g,T,k){var L=-1,W=l.length;for(g||(g=IU),k||(k=[]);++L<W;){var H=l[L];f>0&&g(H)?f>1?mn(H,f-1,g,T,k):ti(k,H):T||(k[k.length]=H)}return k}var Ub=ME(),hE=ME(!0);function ni(l,f){return l&&Ub(l,f,en)}function Vb(l,f){return l&&hE(l,f,en)}function sd(l,f){return ei(f,function(g){return Pi(l[g])})}function Cu(l,f){f=ba(f,l);for(var g=0,T=f.length;l!=null&&g<T;)l=l[si(f[g++])];return g&&g==T?l:e}function dE(l,f,g){var T=f(l);return ot(l)?T:ti(T,g(l))}function Pn(l){return l==null?l===e?ln:At:vu&&vu in Xt(l)?TU(l):FU(l)}function Gb(l,f){return l>f}function V5(l,f){return l!=null&&Lt.call(l,f)}function G5(l,f){return l!=null&&f in Xt(l)}function W5(l,f,g){return l>=Cn(f,g)&&l<Hr(f,g)}function Wb(l,f,g){for(var T=g?Gl:Vl,k=l[0].length,L=l.length,W=L,H=re(L),X=1/0,ue=[];W--;){var le=l[W];W&&f&&(le=er(le,de(f))),X=Cn(le.length,X),H[W]=!g&&(f||k>=120&&le.length>=120)?new Tu(W&&le):e}le=l[0];var me=-1,Ee=H[0];e:for(;++me<k&&ue.length<X;){var Pe=le[me],Xe=f?f(Pe):Pe;if(Pe=g||Pe!==0?Pe:0,!(Ee?Oe(Ee,Xe):T(ue,Xe,g))){for(W=L;--W;){var lt=H[W];if(!(lt?Oe(lt,Xe):T(l[W],Xe,g)))continue e}Ee&&Ee.push(Xe),ue.push(Pe)}}return ue}function z5(l,f,g,T){return ni(l,function(k,L,W){f(T,g(k),L,W)}),T}function Df(l,f,g){f=ba(f,l),l=rN(l,f);var T=l==null?l:l[si(ns(f))];return T==null?e:Sn(T,l,g)}function gE(l){return Sr(l)&&Pn(l)==Te}function H5(l){return Sr(l)&&Pn(l)==pn}function K5(l){return Sr(l)&&Pn(l)==et}function Ff(l,f,g,T,k){return l===f?!0:l==null||f==null||!Sr(l)&&!Sr(f)?l!==l&&f!==f:q5(l,f,g,T,Ff,k)}function q5(l,f,g,T,k,L){var W=ot(l),H=ot(f),X=W?Ze:En(l),ue=H?Ze:En(f);X=X==Te?Pt:X,ue=ue==Te?Pt:ue;var le=X==Pt,me=ue==Pt,Ee=X==ue;if(Ee&&wa(l)){if(!wa(f))return!1;W=!0,le=!1}if(Ee&&!le)return L||(L=new _s),W||tc(l)?XE(l,f,g,T,k,L):vU(l,f,X,g,T,k,L);if(!(g&h)){var Pe=le&&Lt.call(l,"__wrapped__"),Xe=me&&Lt.call(f,"__wrapped__");if(Pe||Xe){var lt=Pe?l.value():l,Ye=Xe?f.value():f;return L||(L=new _s),k(lt,Ye,g,T,L)}}return Ee?(L||(L=new _s),wU(l,f,g,T,k,L)):!1}function j5(l){return Sr(l)&&En(l)==Ft}function zb(l,f,g,T){var k=g.length,L=k,W=!T;if(l==null)return!L;for(l=Xt(l);k--;){var H=g[k];if(W&&H[2]?H[1]!==l[H[0]]:!(H[0]in l))return!1}for(;++k<L;){H=g[k];var X=H[0],ue=l[X],le=H[1];if(W&&H[2]){if(ue===e&&!(X in l))return!1}else{var me=new _s;if(T)var Ee=T(ue,le,X,l,f,me);if(!(Ee===e?Ff(le,ue,h|x,T,me):Ee))return!1}}return!0}function xE(l){if(!gr(l)||kU(l))return!1;var f=Pi(l)?jM:pu;return f.test(Nu(l))}function X5(l){return Sr(l)&&Pn(l)==vn}function Y5(l){return Sr(l)&&En(l)==hr}function Z5(l){return Sr(l)&&Td(l.length)&&!!qt[Pn(l)]}function yE(l){return typeof l=="function"?l:l==null?io:typeof l=="object"?ot(l)?wE(l[0],l[1]):vE(l):UN(l)}function Hb(l){if(!Bf(l))return e5(l);var f=[];for(var g in Xt(l))Lt.call(l,g)&&g!="constructor"&&f.push(g);return f}function Q5(l){if(!gr(l))return DU(l);var f=Bf(l),g=[];for(var T in l)T=="constructor"&&(f||!Lt.call(l,T))||g.push(T);return g}function Kb(l,f){return l<f}function bE(l,f){var g=-1,T=oo(l)?re(l.length):[];return xa(l,function(k,L,W){T[++g]=f(k,L,W)}),T}function vE(l){var f=av(l);return f.length==1&&f[0][2]?eN(f[0][0],f[0][1]):function(g){return g===l||zb(g,l,f)}}function wE(l,f){return lv(l)&&JE(f)?eN(si(l),f):function(g){var T=bv(g,l);return T===e&&T===f?vv(g,l):Ff(f,T,h|x)}}function id(l,f,g,T,k){l!==f&&Ub(f,function(L,W){if(k||(k=new _s),gr(L))J5(l,f,W,g,id,T,k);else{var H=T?T(pv(l,W),L,W+"",l,f,k):e;H===e&&(H=L),Bb(l,W,H)}},so)}function J5(l,f,g,T,k,L,W){var H=pv(l,g),X=pv(f,g),ue=W.get(X);if(ue){Bb(l,g,ue);return}var le=L?L(H,X,g+"",l,f,W):e,me=le===e;if(me){var Ee=ot(X),Pe=!Ee&&wa(X),Xe=!Ee&&!Pe&&tc(X);le=X,Ee||Pe||Xe?ot(H)?le=H:$r(H)?le=no(H):Pe?(me=!1,le=OE(X,!0)):Xe?(me=!1,le=DE(X,!0)):le=[]:Uf(X)||_u(X)?(le=H,_u(H)?le=kN(H):(!gr(H)||Pi(H))&&(le=QE(X))):me=!1}me&&(W.set(X,le),k(le,X,T,L,W),W.delete(X)),Bb(l,g,le)}function TE(l,f){var g=l.length;if(g)return f+=f<0?g:0,Fi(f,g)?l[f]:e}function SE(l,f,g){f.length?f=er(f,function(L){return ot(L)?function(W){return Cu(W,L.length===1?L[0]:L)}:L}):f=[io];var T=-1;f=er(f,de(je()));var k=bE(l,function(L,W,H){var X=er(f,function(ue){return ue(L)});return{criteria:X,index:++T,value:L}});return V(k,function(L,W){return fU(L,W,g)})}function eU(l,f){return CE(l,f,function(g,T){return vv(l,T)})}function CE(l,f,g){for(var T=-1,k=f.length,L={};++T<k;){var W=f[T],H=Cu(l,W);g(H,W)&&Pf(L,ba(W,l),H)}return L}function tU(l){return function(f){return Cu(f,l)}}function qb(l,f,g,T){var k=T?Vh:Ai,L=-1,W=f.length,H=l;for(l===f&&(f=no(f)),g&&(H=er(l,de(g)));++L<W;)for(var X=0,ue=f[L],le=g?g(ue):ue;(X=k(H,le,X,T))>-1;)H!==l&&Yh.call(H,X,1),Yh.call(l,X,1);return l}function EE(l,f){for(var g=l?f.length:0,T=g-1;g--;){var k=f[g];if(g==T||k!==L){var L=k;Fi(k)?Yh.call(l,k,1):Zb(l,k)}}return l}function jb(l,f){return l+Jh(sE()*(f-l+1))}function rU(l,f,g,T){for(var k=-1,L=Hr(Qh((f-l)/(g||1)),0),W=re(L);L--;)W[T?L:++k]=l,l+=g;return W}function Xb(l,f){var g="";if(!l||f<1||f>ct)return g;do f%2&&(g+=l),f=Jh(f/2),f&&(l+=l);while(f);return g}function pt(l,f){return fv(tN(l,f,io),l+"")}function nU(l){return uE(rc(l))}function oU(l,f){var g=rc(l);return gd(g,Su(f,0,g.length))}function Pf(l,f,g,T){if(!gr(l))return l;f=ba(f,l);for(var k=-1,L=f.length,W=L-1,H=l;H!=null&&++k<L;){var X=si(f[k]),ue=g;if(X==="__proto__"||X==="constructor"||X==="prototype")return l;if(k!=W){var le=H[X];ue=T?T(le,X,H):e,ue===e&&(ue=gr(le)?le:Fi(f[k+1])?[]:{})}Rf(H,X,ue),H=H[X]}return l}var NE=ed?function(l,f){return ed.set(l,f),l}:io,sU=Zh?function(l,f){return Zh(l,"toString",{configurable:!0,enumerable:!1,value:Tv(f),writable:!0})}:io;function iU(l){return gd(rc(l))}function rs(l,f,g){var T=-1,k=l.length;f<0&&(f=-f>k?0:k+f),g=g>k?k:g,g<0&&(g+=k),k=f>g?0:g-f>>>0,f>>>=0;for(var L=re(k);++T<k;)L[T]=l[T+f];return L}function aU(l,f){var g;return xa(l,function(T,k,L){return g=f(T,k,L),!g}),!!g}function ad(l,f,g){var T=0,k=l==null?T:l.length;if(typeof f=="number"&&f===f&&k<=xe){for(;T<k;){var L=T+k>>>1,W=l[L];W!==null&&!$o(W)&&(g?W<=f:W<f)?T=L+1:k=L}return k}return Yb(l,f,io,g)}function Yb(l,f,g,T){var k=0,L=l==null?0:l.length;if(L===0)return 0;f=g(f);for(var W=f!==f,H=f===null,X=$o(f),ue=f===e;k<L;){var le=Jh((k+L)/2),me=g(l[le]),Ee=me!==e,Pe=me===null,Xe=me===me,lt=$o(me);if(W)var Ye=T||Xe;else ue?Ye=Xe&&(T||Ee):H?Ye=Xe&&Ee&&(T||!Pe):X?Ye=Xe&&Ee&&!Pe&&(T||!lt):Pe||lt?Ye=!1:Ye=T?me<=f:me<f;Ye?k=le+1:L=le}return Cn(L,we)}function _E(l,f){for(var g=-1,T=l.length,k=0,L=[];++g<T;){var W=l[g],H=f?f(W):W;if(!g||!Is(H,X)){var X=H;L[k++]=W===0?0:W}}return L}function IE(l){return typeof l=="number"?l:$o(l)?fe:+l}function ko(l){if(typeof l=="string")return l;if(ot(l))return er(l,ko)+"";if($o(l))return iE?iE.call(l):"";var f=l+"";return f=="0"&&1/l==-Re?"-0":f}function ya(l,f,g){var T=-1,k=Vl,L=l.length,W=!0,H=[],X=H;if(g)W=!1,k=Gl;else if(L>=r){var ue=f?null:yU(l);if(ue)return Hl(ue);W=!1,k=Oe,X=new Tu}else X=f?[]:H;e:for(;++T<L;){var le=l[T],me=f?f(le):le;if(le=g||le!==0?le:0,W&&me===me){for(var Ee=X.length;Ee--;)if(X[Ee]===me)continue e;f&&X.push(me),H.push(le)}else k(X,me,g)||(X!==H&&X.push(me),H.push(le))}return H}function Zb(l,f){return f=ba(f,l),l=rN(l,f),l==null||delete l[si(ns(f))]}function AE(l,f,g,T){return Pf(l,f,g(Cu(l,f)),T)}function ud(l,f,g,T){for(var k=l.length,L=T?k:-1;(T?L--:++L<k)&&f(l[L],L,l););return g?rs(l,T?0:L,T?L+1:k):rs(l,T?L+1:0,T?k:L)}function kE(l,f){var g=l;return g instanceof dt&&(g=g.value()),bu(f,function(T,k){return k.func.apply(k.thisArg,ti([T],k.args))},g)}function Qb(l,f,g){var T=l.length;if(T<2)return T?ya(l[0]):[];for(var k=-1,L=re(T);++k<T;)for(var W=l[k],H=-1;++H<T;)H!=k&&(L[k]=Of(L[k]||W,l[H],f,g));return ya(mn(L,1),f,g)}function $E(l,f,g){for(var T=-1,k=l.length,L=f.length,W={};++T<k;){var H=T<L?f[T]:e;g(W,l[T],H)}return W}function Jb(l){return $r(l)?l:[]}function ev(l){return typeof l=="function"?l:io}function ba(l,f){return ot(l)?l:lv(l,f)?[l]:iN(Ot(l))}var uU=pt;function va(l,f,g){var T=l.length;return g=g===e?T:g,!f&&g>=T?l:rs(l,f,g)}var RE=XM||function(l){return Ar.clearTimeout(l)};function OE(l,f){if(f)return l.slice();var g=l.length,T=eE?eE(g):new l.constructor(g);return l.copy(T),T}function tv(l){var f=new l.constructor(l.byteLength);return new jh(f).set(new jh(l)),f}function lU(l,f){var g=f?tv(l.buffer):l.buffer;return new l.constructor(g,l.byteOffset,l.byteLength)}function cU(l){var f=new l.constructor(l.source,cu.exec(l));return f.lastIndex=l.lastIndex,f}function pU(l){return $f?Xt($f.call(l)):{}}function DE(l,f){var g=f?tv(l.buffer):l.buffer;return new l.constructor(g,l.byteOffset,l.length)}function FE(l,f){if(l!==f){var g=l!==e,T=l===null,k=l===l,L=$o(l),W=f!==e,H=f===null,X=f===f,ue=$o(f);if(!H&&!ue&&!L&&l>f||L&&W&&X&&!H&&!ue||T&&W&&X||!g&&X||!k)return 1;if(!T&&!L&&!ue&&l<f||ue&&g&&k&&!T&&!L||H&&g&&k||!W&&k||!X)return-1}return 0}function fU(l,f,g){for(var T=-1,k=l.criteria,L=f.criteria,W=k.length,H=g.length;++T<W;){var X=FE(k[T],L[T]);if(X){if(T>=H)return X;var ue=g[T];return X*(ue=="desc"?-1:1)}}return l.index-f.index}function PE(l,f,g,T){for(var k=-1,L=l.length,W=g.length,H=-1,X=f.length,ue=Hr(L-W,0),le=re(X+ue),me=!T;++H<X;)le[H]=f[H];for(;++k<W;)(me||k<L)&&(le[g[k]]=l[k]);for(;ue--;)le[H++]=l[k++];return le}function LE(l,f,g,T){for(var k=-1,L=l.length,W=-1,H=g.length,X=-1,ue=f.length,le=Hr(L-H,0),me=re(le+ue),Ee=!T;++k<le;)me[k]=l[k];for(var Pe=k;++X<ue;)me[Pe+X]=f[X];for(;++W<H;)(Ee||k<L)&&(me[Pe+g[W]]=l[k++]);return me}function no(l,f){var g=-1,T=l.length;for(f||(f=re(T));++g<T;)f[g]=l[g];return f}function oi(l,f,g,T){var k=!g;g||(g={});for(var L=-1,W=f.length;++L<W;){var H=f[L],X=T?T(g[H],l[H],H,g,l):e;X===e&&(X=l[H]),k?Ri(g,H,X):Rf(g,H,X)}return g}function mU(l,f){return oi(l,uv(l),f)}function hU(l,f){return oi(l,YE(l),f)}function ld(l,f){return function(g,T){var k=ot(g)?Ef:P5,L=f?f():{};return k(g,l,je(T,2),L)}}function Ql(l){return pt(function(f,g){var T=-1,k=g.length,L=k>1?g[k-1]:e,W=k>2?g[2]:e;for(L=l.length>3&&typeof L=="function"?(k--,L):e,W&&Ln(g[0],g[1],W)&&(L=k<3?e:L,k=1),f=Xt(f);++T<k;){var H=g[T];H&&l(f,H,T,L)}return f})}function BE(l,f){return function(g,T){if(g==null)return g;if(!oo(g))return l(g,T);for(var k=g.length,L=f?k:-1,W=Xt(g);(f?L--:++L<k)&&T(W[L],L,W)!==!1;);return g}}function ME(l){return function(f,g,T){for(var k=-1,L=Xt(f),W=T(f),H=W.length;H--;){var X=W[l?H:++k];if(g(L[X],X,L)===!1)break}return f}}function dU(l,f,g){var T=f&y,k=Lf(l);function L(){var W=this&&this!==Ar&&this instanceof L?k:l;return W.apply(T?g:this,arguments)}return L}function UE(l){return function(f){f=Ot(f);var g=kr(f)?Ns(f):e,T=g?g[0]:f.charAt(0),k=g?va(g,1).join(""):f.slice(1);return T[l]()+k}}function Jl(l){return function(f){return bu(BN(LN(f).replace(Eb,"")),l,"")}}function Lf(l){return function(){var f=arguments;switch(f.length){case 0:return new l;case 1:return new l(f[0]);case 2:return new l(f[0],f[1]);case 3:return new l(f[0],f[1],f[2]);case 4:return new l(f[0],f[1],f[2],f[3]);case 5:return new l(f[0],f[1],f[2],f[3],f[4]);case 6:return new l(f[0],f[1],f[2],f[3],f[4],f[5]);case 7:return new l(f[0],f[1],f[2],f[3],f[4],f[5],f[6])}var g=Zl(l.prototype),T=l.apply(g,f);return gr(T)?T:g}}function gU(l,f,g){var T=Lf(l);function k(){for(var L=arguments.length,W=re(L),H=L,X=ec(k);H--;)W[H]=arguments[H];var ue=L<3&&W[0]!==X&&W[L-1]!==X?[]:ri(W,X);if(L-=ue.length,L<g)return HE(l,f,cd,k.placeholder,e,W,ue,e,e,g-L);var le=this&&this!==Ar&&this instanceof k?T:l;return Sn(le,this,W)}return k}function VE(l){return function(f,g,T){var k=Xt(f);if(!oo(f)){var L=je(g,3);f=en(f),g=function(H){return L(k[H],H,k)}}var W=l(f,g,T);return W>-1?k[L?f[W]:W]:e}}function GE(l){return Di(function(f){var g=f.length,T=g,k=es.prototype.thru;for(l&&f.reverse();T--;){var L=f[T];if(typeof L!="function")throw new Jo(o);if(k&&!W&&hd(L)=="wrapper")var W=new es([],!0)}for(T=W?T:g;++T<g;){L=f[T];var H=hd(L),X=H=="wrapper"?iv(L):e;X&&cv(X[0])&&X[1]==(G|C|D|q)&&!X[4].length&&X[9]==1?W=W[hd(X[0])].apply(W,X[3]):W=L.length==1&&cv(L)?W[H]():W.thru(L)}return function(){var ue=arguments,le=ue[0];if(W&&ue.length==1&&ot(le))return W.plant(le).value();for(var me=0,Ee=g?f[me].apply(this,ue):le;++me<g;)Ee=f[me].call(this,Ee);return Ee}})}function cd(l,f,g,T,k,L,W,H,X,ue){var le=f&G,me=f&y,Ee=f&v,Pe=f&(C|I),Xe=f&Z,lt=Ee?e:Lf(l);function Ye(){for(var mt=arguments.length,vt=re(mt),Ro=mt;Ro--;)vt[Ro]=arguments[Ro];if(Pe)var Bn=ec(Ye),Oo=at(vt,Bn);if(T&&(vt=PE(vt,T,k,Pe)),L&&(vt=LE(vt,L,W,Pe)),mt-=Oo,Pe&&mt<ue){var Rr=ri(vt,Bn);return HE(l,f,cd,Ye.placeholder,g,vt,Rr,H,X,ue-mt)}var As=me?g:this,Bi=Ee?As[l]:l;return mt=vt.length,H?vt=PU(vt,H):Xe&&mt>1&&vt.reverse(),le&&X<mt&&(vt.length=X),this&&this!==Ar&&this instanceof Ye&&(Bi=lt||Lf(Bi)),Bi.apply(As,vt)}return Ye}function WE(l,f){return function(g,T){return z5(g,l,f(T),{})}}function pd(l,f){return function(g,T){var k;if(g===e&&T===e)return f;if(g!==e&&(k=g),T!==e){if(k===e)return T;typeof g=="string"||typeof T=="string"?(g=ko(g),T=ko(T)):(g=IE(g),T=IE(T)),k=l(g,T)}return k}}function rv(l){return Di(function(f){return f=er(f,de(je())),pt(function(g){var T=this;return l(f,function(k){return Sn(k,T,g)})})})}function fd(l,f){f=f===e?" ":ko(f);var g=f.length;if(g<2)return g?Xb(f,l):f;var T=Xb(f,Qh(l/ql(f)));return kr(f)?va(Ns(T),0,l).join(""):T.slice(0,l)}function xU(l,f,g,T){var k=f&y,L=Lf(l);function W(){for(var H=-1,X=arguments.length,ue=-1,le=T.length,me=re(le+X),Ee=this&&this!==Ar&&this instanceof W?L:l;++ue<le;)me[ue]=T[ue];for(;X--;)me[ue++]=arguments[++H];return Sn(Ee,k?g:this,me)}return W}function zE(l){return function(f,g,T){return T&&typeof T!="number"&&Ln(f,g,T)&&(g=T=e),f=Li(f),g===e?(g=f,f=0):g=Li(g),T=T===e?f<g?1:-1:Li(T),rU(f,g,T,l)}}function md(l){return function(f,g){return typeof f=="string"&&typeof g=="string"||(f=os(f),g=os(g)),l(f,g)}}function HE(l,f,g,T,k,L,W,H,X,ue){var le=f&C,me=le?W:e,Ee=le?e:W,Pe=le?L:e,Xe=le?e:L;f|=le?D:P,f&=~(le?P:D),f&w||(f&=~(y|v));var lt=[l,f,k,Pe,me,Xe,Ee,H,X,ue],Ye=g.apply(e,lt);return cv(l)&&nN(Ye,lt),Ye.placeholder=T,oN(Ye,l,f)}function nv(l){var f=zr[l];return function(g,T){if(g=os(g),T=T==null?0:Cn(ut(T),292),T&&oE(g)){var k=(Ot(g)+"e").split("e"),L=f(k[0]+"e"+(+k[1]+T));return k=(Ot(L)+"e").split("e"),+(k[0]+"e"+(+k[1]-T))}return f(g)}}var yU=Xl&&1/Hl(new Xl([,-0]))[1]==Re?function(l){return new Xl(l)}:Ev;function KE(l){return function(f){var g=En(f);return g==Ft?Qo(f):g==hr?Rb(f):ee(f,l(f))}}function Oi(l,f,g,T,k,L,W,H){var X=f&v;if(!X&&typeof l!="function")throw new Jo(o);var ue=T?T.length:0;if(ue||(f&=~(D|P),T=k=e),W=W===e?W:Hr(ut(W),0),H=H===e?H:ut(H),ue-=k?k.length:0,f&P){var le=T,me=k;T=k=e}var Ee=X?e:iv(l),Pe=[l,f,g,T,k,le,me,L,W,H];if(Ee&&OU(Pe,Ee),l=Pe[0],f=Pe[1],g=Pe[2],T=Pe[3],k=Pe[4],H=Pe[9]=Pe[9]===e?X?0:l.length:Hr(Pe[9]-ue,0),!H&&f&(C|I)&&(f&=~(C|I)),!f||f==y)var Xe=dU(l,f,g);else f==C||f==I?Xe=gU(l,f,H):(f==D||f==(y|D))&&!k.length?Xe=xU(l,f,g,T):Xe=cd.apply(e,Pe);var lt=Ee?NE:nN;return oN(lt(Xe,Pe),l,f)}function qE(l,f,g,T){return l===e||Is(l,jl[g])&&!Lt.call(T,g)?f:l}function jE(l,f,g,T,k,L){return gr(l)&&gr(f)&&(L.set(f,l),id(l,f,e,jE,L),L.delete(f)),l}function bU(l){return Uf(l)?e:l}function XE(l,f,g,T,k,L){var W=g&h,H=l.length,X=f.length;if(H!=X&&!(W&&X>H))return!1;var ue=L.get(l),le=L.get(f);if(ue&&le)return ue==f&&le==l;var me=-1,Ee=!0,Pe=g&x?new Tu:e;for(L.set(l,f),L.set(f,l);++me<H;){var Xe=l[me],lt=f[me];if(T)var Ye=W?T(lt,Xe,me,f,l,L):T(Xe,lt,me,l,f,L);if(Ye!==e){if(Ye)continue;Ee=!1;break}if(Pe){if(!Nf(f,function(mt,vt){if(!Oe(Pe,vt)&&(Xe===mt||k(Xe,mt,g,T,L)))return Pe.push(vt)})){Ee=!1;break}}else if(!(Xe===lt||k(Xe,lt,g,T,L))){Ee=!1;break}}return L.delete(l),L.delete(f),Ee}function vU(l,f,g,T,k,L,W){switch(g){case wn:if(l.byteLength!=f.byteLength||l.byteOffset!=f.byteOffset)return!1;l=l.buffer,f=f.buffer;case pn:return!(l.byteLength!=f.byteLength||!L(new jh(l),new jh(f)));case Qe:case et:case nt:return Is(+l,+f);case Kt:return l.name==f.name&&l.message==f.message;case vn:case Jr:return l==f+"";case Ft:var H=Qo;case hr:var X=T&h;if(H||(H=Hl),l.size!=f.size&&!X)return!1;var ue=W.get(l);if(ue)return ue==f;T|=x,W.set(l,f);var le=XE(H(l),H(f),T,k,L,W);return W.delete(l),le;case Lr:if($f)return $f.call(l)==$f.call(f)}return!1}function wU(l,f,g,T,k,L){var W=g&h,H=ov(l),X=H.length,ue=ov(f),le=ue.length;if(X!=le&&!W)return!1;for(var me=X;me--;){var Ee=H[me];if(!(W?Ee in f:Lt.call(f,Ee)))return!1}var Pe=L.get(l),Xe=L.get(f);if(Pe&&Xe)return Pe==f&&Xe==l;var lt=!0;L.set(l,f),L.set(f,l);for(var Ye=W;++me<X;){Ee=H[me];var mt=l[Ee],vt=f[Ee];if(T)var Ro=W?T(vt,mt,Ee,f,l,L):T(mt,vt,Ee,l,f,L);if(!(Ro===e?mt===vt||k(mt,vt,g,T,L):Ro)){lt=!1;break}Ye||(Ye=Ee=="constructor")}if(lt&&!Ye){var Bn=l.constructor,Oo=f.constructor;Bn!=Oo&&"constructor"in l&&"constructor"in f&&!(typeof Bn=="function"&&Bn instanceof Bn&&typeof Oo=="function"&&Oo instanceof Oo)&&(lt=!1)}return L.delete(l),L.delete(f),lt}function Di(l){return fv(tN(l,e,cN),l+"")}function ov(l){return dE(l,en,uv)}function sv(l){return dE(l,so,YE)}var iv=ed?function(l){return ed.get(l)}:Ev;function hd(l){for(var f=l.name+"",g=Yl[f],T=Lt.call(Yl,f)?g.length:0;T--;){var k=g[T],L=k.func;if(L==null||L==l)return k.name}return f}function ec(l){var f=Lt.call(F,"placeholder")?F:l;return f.placeholder}function je(){var l=F.iteratee||Sv;return l=l===Sv?yE:l,arguments.length?l(arguments[0],arguments[1]):l}function dd(l,f){var g=l.__data__;return AU(f)?g[typeof f=="string"?"string":"hash"]:g.map}function av(l){for(var f=en(l),g=f.length;g--;){var T=f[g],k=l[T];f[g]=[T,k,JE(k)]}return f}function Eu(l,f){var g=ro(l,f);return xE(g)?g:e}function TU(l){var f=Lt.call(l,vu),g=l[vu];try{l[vu]=e;var T=!0}catch{}var k=Kh.call(l);return T&&(f?l[vu]=g:delete l[vu]),k}var uv=Fb?function(l){return l==null?[]:(l=Xt(l),ei(Fb(l),function(f){return rE.call(l,f)}))}:Nv,YE=Fb?function(l){for(var f=[];l;)ti(f,uv(l)),l=Xh(l);return f}:Nv,En=Pn;(Pb&&En(new Pb(new ArrayBuffer(1)))!=wn||If&&En(new If)!=Ft||Lb&&En(Lb.resolve())!=un||Xl&&En(new Xl)!=hr||Af&&En(new Af)!=cn)&&(En=function(l){var f=Pn(l),g=f==Pt?l.constructor:e,T=g?Nu(g):"";if(T)switch(T){case o5:return wn;case s5:return Ft;case i5:return un;case a5:return hr;case u5:return cn}return f});function SU(l,f,g){for(var T=-1,k=g.length;++T<k;){var L=g[T],W=L.size;switch(L.type){case"drop":l+=W;break;case"dropRight":f-=W;break;case"take":f=Cn(f,l+W);break;case"takeRight":l=Hr(l,f-W);break}}return{start:l,end:f}}function CU(l){var f=l.match(Ii);return f?f[1].split(_h):[]}function ZE(l,f,g){f=ba(f,l);for(var T=-1,k=f.length,L=!1;++T<k;){var W=si(f[T]);if(!(L=l!=null&&g(l,W)))break;l=l[W]}return L||++T!=k?L:(k=l==null?0:l.length,!!k&&Td(k)&&Fi(W,k)&&(ot(l)||_u(l)))}function EU(l){var f=l.length,g=new l.constructor(f);return f&&typeof l[0]=="string"&&Lt.call(l,"index")&&(g.index=l.index,g.input=l.input),g}function QE(l){return typeof l.constructor=="function"&&!Bf(l)?Zl(Xh(l)):{}}function NU(l,f,g){var T=l.constructor;switch(f){case pn:return tv(l);case Qe:case et:return new T(+l);case wn:return lU(l,g);case Xo:case Ts:case Ss:case Tn:case la:case js:case Cs:case lu:case Al:return DE(l,g);case Ft:return new T;case nt:case Jr:return new T(l);case vn:return cU(l);case hr:return new T;case Lr:return pU(l)}}function _U(l,f){var g=f.length;if(!g)return l;var T=g-1;return f[T]=(g>1?"& ":"")+f[T],f=f.join(g>2?", ":" "),l.replace(Es,`{
/* [wrapped with `+f+`] */
`)}function IU(l){return ot(l)||_u(l)||!!(nE&&l&&l[nE])}function Fi(l,f){var g=typeof l;return f=f??ct,!!f&&(g=="number"||g!="symbol"&&Qp.test(l))&&l>-1&&l%1==0&&l<f}function Ln(l,f,g){if(!gr(g))return!1;var T=typeof f;return(T=="number"?oo(g)&&Fi(f,g.length):T=="string"&&f in g)?Is(g[f],l):!1}function lv(l,f){if(ot(l))return!1;var g=typeof l;return g=="number"||g=="symbol"||g=="boolean"||l==null||$o(l)?!0:Nh.test(l)||!Xp.test(l)||f!=null&&l in Xt(f)}function AU(l){var f=typeof l;return f=="string"||f=="number"||f=="symbol"||f=="boolean"?l!=="__proto__":l===null}function cv(l){var f=hd(l),g=F[f];if(typeof g!="function"||!(f in dt.prototype))return!1;if(l===g)return!0;var T=iv(g);return!!T&&l===T[0]}function kU(l){return!!JC&&JC in l}var $U=zh?Pi:_v;function Bf(l){var f=l&&l.constructor,g=typeof f=="function"&&f.prototype||jl;return l===g}function JE(l){return l===l&&!gr(l)}function eN(l,f){return function(g){return g==null?!1:g[l]===f&&(f!==e||l in Xt(g))}}function RU(l){var f=vd(l,function(T){return g.size===a&&g.clear(),T}),g=f.cache;return f}function OU(l,f){var g=l[1],T=f[1],k=g|T,L=k<(y|v|G),W=T==G&&g==C||T==G&&g==q&&l[7].length<=f[8]||T==(G|q)&&f[7].length<=f[8]&&g==C;if(!(L||W))return l;T&y&&(l[2]=f[2],k|=g&y?0:w);var H=f[3];if(H){var X=l[3];l[3]=X?PE(X,H,f[4]):H,l[4]=X?ri(l[3],u):f[4]}return H=f[5],H&&(X=l[5],l[5]=X?LE(X,H,f[6]):H,l[6]=X?ri(l[5],u):f[6]),H=f[7],H&&(l[7]=H),T&G&&(l[8]=l[8]==null?f[8]:Cn(l[8],f[8])),l[9]==null&&(l[9]=f[9]),l[0]=f[0],l[1]=k,l}function DU(l){var f=[];if(l!=null)for(var g in Xt(l))f.push(g);return f}function FU(l){return Kh.call(l)}function tN(l,f,g){return f=Hr(f===e?l.length-1:f,0),function(){for(var T=arguments,k=-1,L=Hr(T.length-f,0),W=re(L);++k<L;)W[k]=T[f+k];k=-1;for(var H=re(f+1);++k<f;)H[k]=T[k];return H[f]=g(W),Sn(l,this,H)}}function rN(l,f){return f.length<2?l:Cu(l,rs(f,0,-1))}function PU(l,f){for(var g=l.length,T=Cn(f.length,g),k=no(l);T--;){var L=f[T];l[T]=Fi(L,g)?k[L]:e}return l}function pv(l,f){if(!(f==="constructor"&&typeof l[f]=="function")&&f!="__proto__")return l[f]}var nN=sN(NE),Mf=ZM||function(l,f){return Ar.setTimeout(l,f)},fv=sN(sU);function oN(l,f,g){var T=f+"";return fv(l,_U(T,LU(CU(T),g)))}function sN(l){var f=0,g=0;return function(){var T=t5(),k=ae-(T-g);if(g=T,k>0){if(++f>=J)return arguments[0]}else f=0;return l.apply(e,arguments)}}function gd(l,f){var g=-1,T=l.length,k=T-1;for(f=f===e?T:f;++g<f;){var L=jb(g,k),W=l[L];l[L]=l[g],l[g]=W}return l.length=f,l}var iN=RU(function(l){var f=[];return l.charCodeAt(0)===46&&f.push(""),l.replace(kl,function(g,T,k,L){f.push(k?L.replace(Yp,"$1"):T||g)}),f});function si(l){if(typeof l=="string"||$o(l))return l;var f=l+"";return f=="0"&&1/l==-Re?"-0":f}function Nu(l){if(l!=null){try{return Hh.call(l)}catch{}try{return l+""}catch{}}return""}function LU(l,f){return Fn(Ne,function(g){var T="_."+g[0];f&g[1]&&!Vl(l,T)&&l.push(T)}),l.sort()}function aN(l){if(l instanceof dt)return l.clone();var f=new es(l.__wrapped__,l.__chain__);return f.__actions__=no(l.__actions__),f.__index__=l.__index__,f.__values__=l.__values__,f}function BU(l,f,g){(g?Ln(l,f,g):f===e)?f=1:f=Hr(ut(f),0);var T=l==null?0:l.length;if(!T||f<1)return[];for(var k=0,L=0,W=re(Qh(T/f));k<T;)W[L++]=rs(l,k,k+=f);return W}function MU(l){for(var f=-1,g=l==null?0:l.length,T=0,k=[];++f<g;){var L=l[f];L&&(k[T++]=L)}return k}function UU(){var l=arguments.length;if(!l)return[];for(var f=re(l-1),g=arguments[0],T=l;T--;)f[T-1]=arguments[T];return ti(ot(g)?no(g):[g],mn(f,1))}var VU=pt(function(l,f){return $r(l)?Of(l,mn(f,1,$r,!0)):[]}),GU=pt(function(l,f){var g=ns(f);return $r(g)&&(g=e),$r(l)?Of(l,mn(f,1,$r,!0),je(g,2)):[]}),WU=pt(function(l,f){var g=ns(f);return $r(g)&&(g=e),$r(l)?Of(l,mn(f,1,$r,!0),e,g):[]});function zU(l,f,g){var T=l==null?0:l.length;return T?(f=g||f===e?1:ut(f),rs(l,f<0?0:f,T)):[]}function HU(l,f,g){var T=l==null?0:l.length;return T?(f=g||f===e?1:ut(f),f=T-f,rs(l,0,f<0?0:f)):[]}function KU(l,f){return l&&l.length?ud(l,je(f,3),!0,!0):[]}function qU(l,f){return l&&l.length?ud(l,je(f,3),!0):[]}function jU(l,f,g,T){var k=l==null?0:l.length;return k?(g&&typeof g!="number"&&Ln(l,f,g)&&(g=0,T=k),U5(l,f,g,T)):[]}function uN(l,f,g){var T=l==null?0:l.length;if(!T)return-1;var k=g==null?0:ut(g);return k<0&&(k=Hr(T+k,0)),zl(l,je(f,3),k)}function lN(l,f,g){var T=l==null?0:l.length;if(!T)return-1;var k=T-1;return g!==e&&(k=ut(g),k=g<0?Hr(T+k,0):Cn(k,T-1)),zl(l,je(f,3),k,!0)}function cN(l){var f=l==null?0:l.length;return f?mn(l,1):[]}function XU(l){var f=l==null?0:l.length;return f?mn(l,Re):[]}function YU(l,f){var g=l==null?0:l.length;return g?(f=f===e?1:ut(f),mn(l,f)):[]}function ZU(l){for(var f=-1,g=l==null?0:l.length,T={};++f<g;){var k=l[f];T[k[0]]=k[1]}return T}function pN(l){return l&&l.length?l[0]:e}function QU(l,f,g){var T=l==null?0:l.length;if(!T)return-1;var k=g==null?0:ut(g);return k<0&&(k=Hr(T+k,0)),Ai(l,f,k)}function JU(l){var f=l==null?0:l.length;return f?rs(l,0,-1):[]}var e8=pt(function(l){var f=er(l,Jb);return f.length&&f[0]===l[0]?Wb(f):[]}),t8=pt(function(l){var f=ns(l),g=er(l,Jb);return f===ns(g)?f=e:g.pop(),g.length&&g[0]===l[0]?Wb(g,je(f,2)):[]}),r8=pt(function(l){var f=ns(l),g=er(l,Jb);return f=typeof f=="function"?f:e,f&&g.pop(),g.length&&g[0]===l[0]?Wb(g,e,f):[]});function n8(l,f){return l==null?"":JM.call(l,f)}function ns(l){var f=l==null?0:l.length;return f?l[f-1]:e}function o8(l,f,g){var T=l==null?0:l.length;if(!T)return-1;var k=T;return g!==e&&(k=ut(g),k=k<0?Hr(T+k,0):Cn(k,T-1)),f===f?Kl(l,f,k):zl(l,d,k,!0)}function s8(l,f){return l&&l.length?TE(l,ut(f)):e}var i8=pt(fN);function fN(l,f){return l&&l.length&&f&&f.length?qb(l,f):l}function a8(l,f,g){return l&&l.length&&f&&f.length?qb(l,f,je(g,2)):l}function u8(l,f,g){return l&&l.length&&f&&f.length?qb(l,f,e,g):l}var l8=Di(function(l,f){var g=l==null?0:l.length,T=Mb(l,f);return EE(l,er(f,function(k){return Fi(k,g)?+k:k}).sort(FE)),T});function c8(l,f){var g=[];if(!(l&&l.length))return g;var T=-1,k=[],L=l.length;for(f=je(f,3);++T<L;){var W=l[T];f(W,T,l)&&(g.push(W),k.push(T))}return EE(l,k),g}function mv(l){return l==null?l:n5.call(l)}function p8(l,f,g){var T=l==null?0:l.length;return T?(g&&typeof g!="number"&&Ln(l,f,g)?(f=0,g=T):(f=f==null?0:ut(f),g=g===e?T:ut(g)),rs(l,f,g)):[]}function f8(l,f){return ad(l,f)}function m8(l,f,g){return Yb(l,f,je(g,2))}function h8(l,f){var g=l==null?0:l.length;if(g){var T=ad(l,f);if(T<g&&Is(l[T],f))return T}return-1}function d8(l,f){return ad(l,f,!0)}function g8(l,f,g){return Yb(l,f,je(g,2),!0)}function x8(l,f){var g=l==null?0:l.length;if(g){var T=ad(l,f,!0)-1;if(Is(l[T],f))return T}return-1}function y8(l){return l&&l.length?_E(l):[]}function b8(l,f){return l&&l.length?_E(l,je(f,2)):[]}function v8(l){var f=l==null?0:l.length;return f?rs(l,1,f):[]}function w8(l,f,g){return l&&l.length?(f=g||f===e?1:ut(f),rs(l,0,f<0?0:f)):[]}function T8(l,f,g){var T=l==null?0:l.length;return T?(f=g||f===e?1:ut(f),f=T-f,rs(l,f<0?0:f,T)):[]}function S8(l,f){return l&&l.length?ud(l,je(f,3),!1,!0):[]}function C8(l,f){return l&&l.length?ud(l,je(f,3)):[]}var E8=pt(function(l){return ya(mn(l,1,$r,!0))}),N8=pt(function(l){var f=ns(l);return $r(f)&&(f=e),ya(mn(l,1,$r,!0),je(f,2))}),_8=pt(function(l){var f=ns(l);return f=typeof f=="function"?f:e,ya(mn(l,1,$r,!0),e,f)});function I8(l){return l&&l.length?ya(l):[]}function A8(l,f){return l&&l.length?ya(l,je(f,2)):[]}function k8(l,f){return f=typeof f=="function"?f:e,l&&l.length?ya(l,e,f):[]}function hv(l){if(!(l&&l.length))return[];var f=0;return l=ei(l,function(g){if($r(g))return f=Hr(g.length,f),!0}),K(f,function(g){return er(l,N(g))})}function mN(l,f){if(!(l&&l.length))return[];var g=hv(l);return f==null?g:er(g,function(T){return Sn(f,e,T)})}var $8=pt(function(l,f){return $r(l)?Of(l,f):[]}),R8=pt(function(l){return Qb(ei(l,$r))}),O8=pt(function(l){var f=ns(l);return $r(f)&&(f=e),Qb(ei(l,$r),je(f,2))}),D8=pt(function(l){var f=ns(l);return f=typeof f=="function"?f:e,Qb(ei(l,$r),e,f)}),F8=pt(hv);function P8(l,f){return $E(l||[],f||[],Rf)}function L8(l,f){return $E(l||[],f||[],Pf)}var B8=pt(function(l){var f=l.length,g=f>1?l[f-1]:e;return g=typeof g=="function"?(l.pop(),g):e,mN(l,g)});function hN(l){var f=F(l);return f.__chain__=!0,f}function M8(l,f){return f(l),l}function xd(l,f){return f(l)}var U8=Di(function(l){var f=l.length,g=f?l[0]:0,T=this.__wrapped__,k=function(L){return Mb(L,l)};return f>1||this.__actions__.length||!(T instanceof dt)||!Fi(g)?this.thru(k):(T=T.slice(g,+g+(f?1:0)),T.__actions__.push({func:xd,args:[k],thisArg:e}),new es(T,this.__chain__).thru(function(L){return f&&!L.length&&L.push(e),L}))});function V8(){return hN(this)}function G8(){return new es(this.value(),this.__chain__)}function W8(){this.__values__===e&&(this.__values__=IN(this.value()));var l=this.__index__>=this.__values__.length,f=l?e:this.__values__[this.__index__++];return{done:l,value:f}}function z8(){return this}function H8(l){for(var f,g=this;g instanceof rd;){var T=aN(g);T.__index__=0,T.__values__=e,f?k.__wrapped__=T:f=T;var k=T;g=g.__wrapped__}return k.__wrapped__=l,f}function K8(){var l=this.__wrapped__;if(l instanceof dt){var f=l;return this.__actions__.length&&(f=new dt(this)),f=f.reverse(),f.__actions__.push({func:xd,args:[mv],thisArg:e}),new es(f,this.__chain__)}return this.thru(mv)}function q8(){return kE(this.__wrapped__,this.__actions__)}var j8=ld(function(l,f,g){Lt.call(l,g)?++l[g]:Ri(l,g,1)});function X8(l,f,g){var T=ot(l)?Mh:M5;return g&&Ln(l,f,g)&&(f=e),T(l,je(f,3))}function Y8(l,f){var g=ot(l)?ei:mE;return g(l,je(f,3))}var Z8=VE(uN),Q8=VE(lN);function J8(l,f){return mn(yd(l,f),1)}function eV(l,f){return mn(yd(l,f),Re)}function tV(l,f,g){return g=g===e?1:ut(g),mn(yd(l,f),g)}function dN(l,f){var g=ot(l)?Fn:xa;return g(l,je(f,3))}function gN(l,f){var g=ot(l)?Ib:fE;return g(l,je(f,3))}var rV=ld(function(l,f,g){Lt.call(l,g)?l[g].push(f):Ri(l,g,[f])});function nV(l,f,g,T){l=oo(l)?l:rc(l),g=g&&!T?ut(g):0;var k=l.length;return g<0&&(g=Hr(k+g,0)),Sd(l)?g<=k&&l.indexOf(f,g)>-1:!!k&&Ai(l,f,g)>-1}var oV=pt(function(l,f,g){var T=-1,k=typeof f=="function",L=oo(l)?re(l.length):[];return xa(l,function(W){L[++T]=k?Sn(f,W,g):Df(W,f,g)}),L}),sV=ld(function(l,f,g){Ri(l,g,f)});function yd(l,f){var g=ot(l)?er:bE;return g(l,je(f,3))}function iV(l,f,g,T){return l==null?[]:(ot(f)||(f=f==null?[]:[f]),g=T?e:g,ot(g)||(g=g==null?[]:[g]),SE(l,f,g))}var aV=ld(function(l,f,g){l[g?0:1].push(f)},function(){return[[],[]]});function uV(l,f,g){var T=ot(l)?bu:B,k=arguments.length<3;return T(l,je(f,4),g,k,xa)}function lV(l,f,g){var T=ot(l)?Ab:B,k=arguments.length<3;return T(l,je(f,4),g,k,fE)}function cV(l,f){var g=ot(l)?ei:mE;return g(l,wd(je(f,3)))}function pV(l){var f=ot(l)?uE:nU;return f(l)}function fV(l,f,g){(g?Ln(l,f,g):f===e)?f=1:f=ut(f);var T=ot(l)?D5:oU;return T(l,f)}function mV(l){var f=ot(l)?F5:iU;return f(l)}function hV(l){if(l==null)return 0;if(oo(l))return Sd(l)?ql(l):l.length;var f=En(l);return f==Ft||f==hr?l.size:Hb(l).length}function dV(l,f,g){var T=ot(l)?Nf:aU;return g&&Ln(l,f,g)&&(f=e),T(l,je(f,3))}var gV=pt(function(l,f){if(l==null)return[];var g=f.length;return g>1&&Ln(l,f[0],f[1])?f=[]:g>2&&Ln(f[0],f[1],f[2])&&(f=[f[0]]),SE(l,mn(f,1),[])}),bd=YM||function(){return Ar.Date.now()};function xV(l,f){if(typeof f!="function")throw new Jo(o);return l=ut(l),function(){if(--l<1)return f.apply(this,arguments)}}function xN(l,f,g){return f=g?e:f,f=l&&f==null?l.length:f,Oi(l,G,e,e,e,e,f)}function yN(l,f){var g;if(typeof f!="function")throw new Jo(o);return l=ut(l),function(){return--l>0&&(g=f.apply(this,arguments)),l<=1&&(f=e),g}}var dv=pt(function(l,f,g){var T=y;if(g.length){var k=ri(g,ec(dv));T|=D}return Oi(l,T,f,g,k)}),bN=pt(function(l,f,g){var T=y|v;if(g.length){var k=ri(g,ec(bN));T|=D}return Oi(f,T,l,g,k)});function vN(l,f,g){f=g?e:f;var T=Oi(l,C,e,e,e,e,e,f);return T.placeholder=vN.placeholder,T}function wN(l,f,g){f=g?e:f;var T=Oi(l,I,e,e,e,e,e,f);return T.placeholder=wN.placeholder,T}function TN(l,f,g){var T,k,L,W,H,X,ue=0,le=!1,me=!1,Ee=!0;if(typeof l!="function")throw new Jo(o);f=os(f)||0,gr(g)&&(le=!!g.leading,me="maxWait"in g,L=me?Hr(os(g.maxWait)||0,f):L,Ee="trailing"in g?!!g.trailing:Ee);function Pe(Rr){var As=T,Bi=k;return T=k=e,ue=Rr,W=l.apply(Bi,As),W}function Xe(Rr){return ue=Rr,H=Mf(mt,f),le?Pe(Rr):W}function lt(Rr){var As=Rr-X,Bi=Rr-ue,VN=f-As;return me?Cn(VN,L-Bi):VN}function Ye(Rr){var As=Rr-X,Bi=Rr-ue;return X===e||As>=f||As<0||me&&Bi>=L}function mt(){var Rr=bd();if(Ye(Rr))return vt(Rr);H=Mf(mt,lt(Rr))}function vt(Rr){return H=e,Ee&&T?Pe(Rr):(T=k=e,W)}function Ro(){H!==e&&RE(H),ue=0,T=X=k=H=e}function Bn(){return H===e?W:vt(bd())}function Oo(){var Rr=bd(),As=Ye(Rr);if(T=arguments,k=this,X=Rr,As){if(H===e)return Xe(X);if(me)return RE(H),H=Mf(mt,f),Pe(X)}return H===e&&(H=Mf(mt,f)),W}return Oo.cancel=Ro,Oo.flush=Bn,Oo}var yV=pt(function(l,f){return pE(l,1,f)}),bV=pt(function(l,f,g){return pE(l,os(f)||0,g)});function vV(l){return Oi(l,Z)}function vd(l,f){if(typeof l!="function"||f!=null&&typeof f!="function")throw new Jo(o);var g=function(){var T=arguments,k=f?f.apply(this,T):T[0],L=g.cache;if(L.has(k))return L.get(k);var W=l.apply(this,T);return g.cache=L.set(k,W)||L,W};return g.cache=new(vd.Cache||$i),g}vd.Cache=$i;function wd(l){if(typeof l!="function")throw new Jo(o);return function(){var f=arguments;switch(f.length){case 0:return!l.call(this);case 1:return!l.call(this,f[0]);case 2:return!l.call(this,f[0],f[1]);case 3:return!l.call(this,f[0],f[1],f[2])}return!l.apply(this,f)}}function wV(l){return yN(2,l)}var TV=uU(function(l,f){f=f.length==1&&ot(f[0])?er(f[0],de(je())):er(mn(f,1),de(je()));var g=f.length;return pt(function(T){for(var k=-1,L=Cn(T.length,g);++k<L;)T[k]=f[k].call(this,T[k]);return Sn(l,this,T)})}),gv=pt(function(l,f){var g=ri(f,ec(gv));return Oi(l,D,e,f,g)}),SN=pt(function(l,f){var g=ri(f,ec(SN));return Oi(l,P,e,f,g)}),SV=Di(function(l,f){return Oi(l,q,e,e,e,f)});function CV(l,f){if(typeof l!="function")throw new Jo(o);return f=f===e?f:ut(f),pt(l,f)}function EV(l,f){if(typeof l!="function")throw new Jo(o);return f=f==null?0:Hr(ut(f),0),pt(function(g){var T=g[f],k=va(g,0,f);return T&&ti(k,T),Sn(l,this,k)})}function NV(l,f,g){var T=!0,k=!0;if(typeof l!="function")throw new Jo(o);return gr(g)&&(T="leading"in g?!!g.leading:T,k="trailing"in g?!!g.trailing:k),TN(l,f,{leading:T,maxWait:f,trailing:k})}function _V(l){return xN(l,1)}function IV(l,f){return gv(ev(f),l)}function AV(){if(!arguments.length)return[];var l=arguments[0];return ot(l)?l:[l]}function kV(l){return ts(l,m)}function $V(l,f){return f=typeof f=="function"?f:e,ts(l,m,f)}function RV(l){return ts(l,c|m)}function OV(l,f){return f=typeof f=="function"?f:e,ts(l,c|m,f)}function DV(l,f){return f==null||cE(l,f,en(f))}function Is(l,f){return l===f||l!==l&&f!==f}var FV=md(Gb),PV=md(function(l,f){return l>=f}),_u=gE(function(){return arguments}())?gE:function(l){return Sr(l)&&Lt.call(l,"callee")&&!rE.call(l,"callee")},ot=re.isArray,LV=yu?de(yu):H5;function oo(l){return l!=null&&Td(l.length)&&!Pi(l)}function $r(l){return Sr(l)&&oo(l)}function BV(l){return l===!0||l===!1||Sr(l)&&Pn(l)==Qe}var wa=QM||_v,MV=wf?de(wf):K5;function UV(l){return Sr(l)&&l.nodeType===1&&!Uf(l)}function VV(l){if(l==null)return!0;if(oo(l)&&(ot(l)||typeof l=="string"||typeof l.splice=="function"||wa(l)||tc(l)||_u(l)))return!l.length;var f=En(l);if(f==Ft||f==hr)return!l.size;if(Bf(l))return!Hb(l).length;for(var g in l)if(Lt.call(l,g))return!1;return!0}function GV(l,f){return Ff(l,f)}function WV(l,f,g){g=typeof g=="function"?g:e;var T=g?g(l,f):e;return T===e?Ff(l,f,e,g):!!T}function xv(l){if(!Sr(l))return!1;var f=Pn(l);return f==Kt||f==cr||typeof l.message=="string"&&typeof l.name=="string"&&!Uf(l)}function zV(l){return typeof l=="number"&&oE(l)}function Pi(l){if(!gr(l))return!1;var f=Pn(l);return f==Nt||f==Ut||f==ye||f==bn}function CN(l){return typeof l=="number"&&l==ut(l)}function Td(l){return typeof l=="number"&&l>-1&&l%1==0&&l<=ct}function gr(l){var f=typeof l;return l!=null&&(f=="object"||f=="function")}function Sr(l){return l!=null&&typeof l=="object"}var EN=Bh?de(Bh):j5;function HV(l,f){return l===f||zb(l,f,av(f))}function KV(l,f,g){return g=typeof g=="function"?g:e,zb(l,f,av(f),g)}function qV(l){return NN(l)&&l!=+l}function jV(l){if($U(l))throw new tt(n);return xE(l)}function XV(l){return l===null}function YV(l){return l==null}function NN(l){return typeof l=="number"||Sr(l)&&Pn(l)==nt}function Uf(l){if(!Sr(l)||Pn(l)!=Pt)return!1;var f=Xh(l);if(f===null)return!0;var g=Lt.call(f,"constructor")&&f.constructor;return typeof g=="function"&&g instanceof g&&Hh.call(g)==KM}var yv=Tf?de(Tf):X5;function ZV(l){return CN(l)&&l>=-ct&&l<=ct}var _N=Sf?de(Sf):Y5;function Sd(l){return typeof l=="string"||!ot(l)&&Sr(l)&&Pn(l)==Jr}function $o(l){return typeof l=="symbol"||Sr(l)&&Pn(l)==Lr}var tc=Cf?de(Cf):Z5;function QV(l){return l===e}function JV(l){return Sr(l)&&En(l)==cn}function eG(l){return Sr(l)&&Pn(l)==Vr}var tG=md(Kb),rG=md(function(l,f){return l<=f});function IN(l){if(!l)return[];if(oo(l))return Sd(l)?Ns(l):no(l);if(_f&&l[_f])return Wr(l[_f]());var f=En(l),g=f==Ft?Qo:f==hr?Hl:rc;return g(l)}function Li(l){if(!l)return l===0?l:0;if(l=os(l),l===Re||l===-Re){var f=l<0?-1:1;return f*oe}return l===l?l:0}function ut(l){var f=Li(l),g=f%1;return f===f?g?f-g:f:0}function AN(l){return l?Su(ut(l),0,se):0}function os(l){if(typeof l=="number")return l;if($o(l))return fe;if(gr(l)){var f=typeof l.valueOf=="function"?l.valueOf():l;l=gr(f)?f+"":f}if(typeof l!="string")return l===0?l:+l;l=he(l);var g=$l.test(l);return g||Ih.test(l)?Lh(l.slice(2),g?2:8):Zp.test(l)?fe:+l}function kN(l){return oi(l,so(l))}function nG(l){return l?Su(ut(l),-ct,ct):l===0?l:0}function Ot(l){return l==null?"":ko(l)}var oG=Ql(function(l,f){if(Bf(f)||oo(f)){oi(f,en(f),l);return}for(var g in f)Lt.call(f,g)&&Rf(l,g,f[g])}),$N=Ql(function(l,f){oi(f,so(f),l)}),Cd=Ql(function(l,f,g,T){oi(f,so(f),l,T)}),sG=Ql(function(l,f,g,T){oi(f,en(f),l,T)}),iG=Di(Mb);function aG(l,f){var g=Zl(l);return f==null?g:lE(g,f)}var uG=pt(function(l,f){l=Xt(l);var g=-1,T=f.length,k=T>2?f[2]:e;for(k&&Ln(f[0],f[1],k)&&(T=1);++g<T;)for(var L=f[g],W=so(L),H=-1,X=W.length;++H<X;){var ue=W[H],le=l[ue];(le===e||Is(le,jl[ue])&&!Lt.call(l,ue))&&(l[ue]=L[ue])}return l}),lG=pt(function(l){return l.push(e,jE),Sn(RN,e,l)});function cG(l,f){return Uh(l,je(f,3),ni)}function pG(l,f){return Uh(l,je(f,3),Vb)}function fG(l,f){return l==null?l:Ub(l,je(f,3),so)}function mG(l,f){return l==null?l:hE(l,je(f,3),so)}function hG(l,f){return l&&ni(l,je(f,3))}function dG(l,f){return l&&Vb(l,je(f,3))}function gG(l){return l==null?[]:sd(l,en(l))}function xG(l){return l==null?[]:sd(l,so(l))}function bv(l,f,g){var T=l==null?e:Cu(l,f);return T===e?g:T}function yG(l,f){return l!=null&&ZE(l,f,V5)}function vv(l,f){return l!=null&&ZE(l,f,G5)}var bG=WE(function(l,f,g){f!=null&&typeof f.toString!="function"&&(f=Kh.call(f)),l[f]=g},Tv(io)),vG=WE(function(l,f,g){f!=null&&typeof f.toString!="function"&&(f=Kh.call(f)),Lt.call(l,f)?l[f].push(g):l[f]=[g]},je),wG=pt(Df);function en(l){return oo(l)?aE(l):Hb(l)}function so(l){return oo(l)?aE(l,!0):Q5(l)}function TG(l,f){var g={};return f=je(f,3),ni(l,function(T,k,L){Ri(g,f(T,k,L),T)}),g}function SG(l,f){var g={};return f=je(f,3),ni(l,function(T,k,L){Ri(g,k,f(T,k,L))}),g}var CG=Ql(function(l,f,g){id(l,f,g)}),RN=Ql(function(l,f,g,T){id(l,f,g,T)}),EG=Di(function(l,f){var g={};if(l==null)return g;var T=!1;f=er(f,function(L){return L=ba(L,l),T||(T=L.length>1),L}),oi(l,sv(l),g),T&&(g=ts(g,c|p|m,bU));for(var k=f.length;k--;)Zb(g,f[k]);return g});function NG(l,f){return ON(l,wd(je(f)))}var _G=Di(function(l,f){return l==null?{}:eU(l,f)});function ON(l,f){if(l==null)return{};var g=er(sv(l),function(T){return[T]});return f=je(f),CE(l,g,function(T,k){return f(T,k[0])})}function IG(l,f,g){f=ba(f,l);var T=-1,k=f.length;for(k||(k=1,l=e);++T<k;){var L=l==null?e:l[si(f[T])];L===e&&(T=k,L=g),l=Pi(L)?L.call(l):L}return l}function AG(l,f,g){return l==null?l:Pf(l,f,g)}function kG(l,f,g,T){return T=typeof T=="function"?T:e,l==null?l:Pf(l,f,g,T)}var DN=KE(en),FN=KE(so);function $G(l,f,g){var T=ot(l),k=T||wa(l)||tc(l);if(f=je(f,4),g==null){var L=l&&l.constructor;k?g=T?new L:[]:gr(l)?g=Pi(L)?Zl(Xh(l)):{}:g={}}return(k?Fn:ni)(l,function(W,H,X){return f(g,W,H,X)}),g}function RG(l,f){return l==null?!0:Zb(l,f)}function OG(l,f,g){return l==null?l:AE(l,f,ev(g))}function DG(l,f,g,T){return T=typeof T=="function"?T:e,l==null?l:AE(l,f,ev(g),T)}function rc(l){return l==null?[]:He(l,en(l))}function FG(l){return l==null?[]:He(l,so(l))}function PG(l,f,g){return g===e&&(g=f,f=e),g!==e&&(g=os(g),g=g===g?g:0),f!==e&&(f=os(f),f=f===f?f:0),Su(os(l),f,g)}function LG(l,f,g){return f=Li(f),g===e?(g=f,f=0):g=Li(g),l=os(l),W5(l,f,g)}function BG(l,f,g){if(g&&typeof g!="boolean"&&Ln(l,f,g)&&(f=g=e),g===e&&(typeof f=="boolean"?(g=f,f=e):typeof l=="boolean"&&(g=l,l=e)),l===e&&f===e?(l=0,f=1):(l=Li(l),f===e?(f=l,l=0):f=Li(f)),l>f){var T=l;l=f,f=T}if(g||l%1||f%1){var k=sE();return Cn(l+k*(f-l+ha("1e-"+((k+"").length-1))),f)}return jb(l,f)}var MG=Jl(function(l,f,g){return f=f.toLowerCase(),l+(g?PN(f):f)});function PN(l){return wv(Ot(l).toLowerCase())}function LN(l){return l=Ot(l),l&&l.replace(Jp,jt).replace(Nb,"")}function UG(l,f,g){l=Ot(l),f=ko(f);var T=l.length;g=g===e?T:Su(ut(g),0,T);var k=g;return g-=f.length,g>=0&&l.slice(g,k)==f}function VG(l){return l=Ot(l),l&&Ch.test(l)?l.replace(ca,Gt):l}function GG(l){return l=Ot(l),l&&xb.test(l)?l.replace(pa,"\\$&"):l}var WG=Jl(function(l,f,g){return l+(g?"-":"")+f.toLowerCase()}),zG=Jl(function(l,f,g){return l+(g?" ":"")+f.toLowerCase()}),HG=UE("toLowerCase");function KG(l,f,g){l=Ot(l),f=ut(f);var T=f?ql(l):0;if(!f||T>=f)return l;var k=(f-T)/2;return fd(Jh(k),g)+l+fd(Qh(k),g)}function qG(l,f,g){l=Ot(l),f=ut(f);var T=f?ql(l):0;return f&&T<f?l+fd(f-T,g):l}function jG(l,f,g){l=Ot(l),f=ut(f);var T=f?ql(l):0;return f&&T<f?fd(f-T,g)+l:l}function XG(l,f,g){return g||f==null?f=0:f&&(f=+f),r5(Ot(l).replace(Zs,""),f||0)}function YG(l,f,g){return(g?Ln(l,f,g):f===e)?f=1:f=ut(f),Xb(Ot(l),f)}function ZG(){var l=arguments,f=Ot(l[0]);return l.length<3?f:f.replace(l[1],l[2])}var QG=Jl(function(l,f,g){return l+(g?"_":"")+f.toLowerCase()});function JG(l,f,g){return g&&typeof g!="number"&&Ln(l,f,g)&&(f=g=e),g=g===e?se:g>>>0,g?(l=Ot(l),l&&(typeof f=="string"||f!=null&&!yv(f))&&(f=ko(f),!f&&kr(l))?va(Ns(l),0,g):l.split(f,g)):[]}var e7=Jl(function(l,f,g){return l+(g?" ":"")+wv(f)});function t7(l,f,g){return l=Ot(l),g=g==null?0:Su(ut(g),0,l.length),f=ko(f),l.slice(g,g+f.length)==f}function r7(l,f,g){var T=F.templateSettings;g&&Ln(l,f,g)&&(f=e),l=Ot(l),f=Cd({},f,T,qE);var k=Cd({},f.imports,T.imports,qE),L=en(k),W=He(k,L),H,X,ue=0,le=f.interpolate||fu,me="__p += '",Ee=Db((f.escape||fu).source+"|"+le.source+"|"+(le===Ys?bb:fu).source+"|"+(f.evaluate||fu).source+"|$","g"),Pe="//# sourceURL="+(Lt.call(f,"sourceURL")?(f.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++Ao+"]")+`
`;l.replace(Ee,function(Ye,mt,vt,Ro,Bn,Oo){return vt||(vt=Ro),me+=l.slice(ue,Oo).replace(_o,Gr),mt&&(H=!0,me+=`' +
__e(`+mt+`) +
'`),Bn&&(X=!0,me+=`';
`+Bn+`;
__p += '`),vt&&(me+=`' +
((__t = (`+vt+`)) == null ? '' : __t) +
'`),ue=Oo+Ye.length,Ye}),me+=`';
`;var Xe=Lt.call(f,"variable")&&f.variable;if(!Xe)me=`with (obj) {
`+me+`
}
`;else if(Yo.test(Xe))throw new tt(s);me=(X?me.replace(gb,""):me).replace(Th,"$1").replace(qp,"$1;"),me="function("+(Xe||"obj")+`) {
`+(Xe?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(H?", __e = _.escape":"")+(X?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+me+`return __p
}`;var lt=MN(function(){return kt(L,Pe+"return "+me).apply(e,W)});if(lt.source=me,xv(lt))throw lt;return lt}function n7(l){return Ot(l).toLowerCase()}function o7(l){return Ot(l).toUpperCase()}function s7(l,f,g){if(l=Ot(l),l&&(g||f===e))return he(l);if(!l||!(f=ko(f)))return l;var T=Ns(l),k=Ns(f),L=Ce(T,k),W=qe(T,k)+1;return va(T,L,W).join("")}function i7(l,f,g){if(l=Ot(l),l&&(g||f===e))return l.slice(0,QC(l)+1);if(!l||!(f=ko(f)))return l;var T=Ns(l),k=qe(T,Ns(f))+1;return va(T,0,k).join("")}function a7(l,f,g){if(l=Ot(l),l&&(g||f===e))return l.replace(Zs,"");if(!l||!(f=ko(f)))return l;var T=Ns(l),k=Ce(T,Ns(f));return va(T,k).join("")}function u7(l,f){var g=Y,T=te;if(gr(f)){var k="separator"in f?f.separator:k;g="length"in f?ut(f.length):g,T="omission"in f?ko(f.omission):T}l=Ot(l);var L=l.length;if(kr(l)){var W=Ns(l);L=W.length}if(g>=L)return l;var H=g-ql(T);if(H<1)return T;var X=W?va(W,0,H).join(""):l.slice(0,H);if(k===e)return X+T;if(W&&(H+=X.length-H),yv(k)){if(l.slice(H).search(k)){var ue,le=X;for(k.global||(k=Db(k.source,Ot(cu.exec(k))+"g")),k.lastIndex=0;ue=k.exec(le);)var me=ue.index;X=X.slice(0,me===e?H:me)}}else if(l.indexOf(ko(k),H)!=H){var Ee=X.lastIndexOf(k);Ee>-1&&(X=X.slice(0,Ee))}return X+T}function l7(l){return l=Ot(l),l&&Sh.test(l)?l.replace(Xs,BM):l}var c7=Jl(function(l,f,g){return l+(g?" ":"")+f.toUpperCase()}),wv=UE("toUpperCase");function BN(l,f,g){return l=Ot(l),f=g?e:f,f===e?Tt(l)?VM(l):$b(l):l.match(f)||[]}var MN=pt(function(l,f){try{return Sn(l,e,f)}catch(g){return xv(g)?g:new tt(g)}}),p7=Di(function(l,f){return Fn(f,function(g){g=si(g),Ri(l,g,dv(l[g],l))}),l});function f7(l){var f=l==null?0:l.length,g=je();return l=f?er(l,function(T){if(typeof T[1]!="function")throw new Jo(o);return[g(T[0]),T[1]]}):[],pt(function(T){for(var k=-1;++k<f;){var L=l[k];if(Sn(L[0],this,T))return Sn(L[1],this,T)}})}function m7(l){return B5(ts(l,c))}function Tv(l){return function(){return l}}function h7(l,f){return l==null||l!==l?f:l}var d7=GE(),g7=GE(!0);function io(l){return l}function Sv(l){return yE(typeof l=="function"?l:ts(l,c))}function x7(l){return vE(ts(l,c))}function y7(l,f){return wE(l,ts(f,c))}var b7=pt(function(l,f){return function(g){return Df(g,l,f)}}),v7=pt(function(l,f){return function(g){return Df(l,g,f)}});function Cv(l,f,g){var T=en(f),k=sd(f,T);g==null&&!(gr(f)&&(k.length||!T.length))&&(g=f,f=l,l=this,k=sd(f,en(f)));var L=!(gr(g)&&"chain"in g)||!!g.chain,W=Pi(l);return Fn(k,function(H){var X=f[H];l[H]=X,W&&(l.prototype[H]=function(){var ue=this.__chain__;if(L||ue){var le=l(this.__wrapped__),me=le.__actions__=no(this.__actions__);return me.push({func:X,args:arguments,thisArg:l}),le.__chain__=ue,le}return X.apply(l,ti([this.value()],arguments))})}),l}function w7(){return Ar._===this&&(Ar._=qM),this}function Ev(){}function T7(l){return l=ut(l),pt(function(f){return TE(f,l)})}var S7=rv(er),C7=rv(Mh),E7=rv(Nf);function UN(l){return lv(l)?N(si(l)):tU(l)}function N7(l){return function(f){return l==null?e:Cu(l,f)}}var _7=zE(),I7=zE(!0);function Nv(){return[]}function _v(){return!1}function A7(){return{}}function k7(){return""}function $7(){return!0}function R7(l,f){if(l=ut(l),l<1||l>ct)return[];var g=se,T=Cn(l,se);f=je(f),l-=se;for(var k=K(T,f);++g<l;)f(g);return k}function O7(l){return ot(l)?er(l,si):$o(l)?[l]:no(iN(Ot(l)))}function D7(l){var f=++HM;return Ot(l)+f}var F7=pd(function(l,f){return l+f},0),P7=nv("ceil"),L7=pd(function(l,f){return l/f},1),B7=nv("floor");function M7(l){return l&&l.length?od(l,io,Gb):e}function U7(l,f){return l&&l.length?od(l,je(f,2),Gb):e}function V7(l){return b(l,io)}function G7(l,f){return b(l,je(f,2))}function W7(l){return l&&l.length?od(l,io,Kb):e}function z7(l,f){return l&&l.length?od(l,je(f,2),Kb):e}var H7=pd(function(l,f){return l*f},1),K7=nv("round"),q7=pd(function(l,f){return l-f},0);function j7(l){return l&&l.length?M(l,io):0}function X7(l,f){return l&&l.length?M(l,je(f,2)):0}return F.after=xV,F.ary=xN,F.assign=oG,F.assignIn=$N,F.assignInWith=Cd,F.assignWith=sG,F.at=iG,F.before=yN,F.bind=dv,F.bindAll=p7,F.bindKey=bN,F.castArray=AV,F.chain=hN,F.chunk=BU,F.compact=MU,F.concat=UU,F.cond=f7,F.conforms=m7,F.constant=Tv,F.countBy=j8,F.create=aG,F.curry=vN,F.curryRight=wN,F.debounce=TN,F.defaults=uG,F.defaultsDeep=lG,F.defer=yV,F.delay=bV,F.difference=VU,F.differenceBy=GU,F.differenceWith=WU,F.drop=zU,F.dropRight=HU,F.dropRightWhile=KU,F.dropWhile=qU,F.fill=jU,F.filter=Y8,F.flatMap=J8,F.flatMapDeep=eV,F.flatMapDepth=tV,F.flatten=cN,F.flattenDeep=XU,F.flattenDepth=YU,F.flip=vV,F.flow=d7,F.flowRight=g7,F.fromPairs=ZU,F.functions=gG,F.functionsIn=xG,F.groupBy=rV,F.initial=JU,F.intersection=e8,F.intersectionBy=t8,F.intersectionWith=r8,F.invert=bG,F.invertBy=vG,F.invokeMap=oV,F.iteratee=Sv,F.keyBy=sV,F.keys=en,F.keysIn=so,F.map=yd,F.mapKeys=TG,F.mapValues=SG,F.matches=x7,F.matchesProperty=y7,F.memoize=vd,F.merge=CG,F.mergeWith=RN,F.method=b7,F.methodOf=v7,F.mixin=Cv,F.negate=wd,F.nthArg=T7,F.omit=EG,F.omitBy=NG,F.once=wV,F.orderBy=iV,F.over=S7,F.overArgs=TV,F.overEvery=C7,F.overSome=E7,F.partial=gv,F.partialRight=SN,F.partition=aV,F.pick=_G,F.pickBy=ON,F.property=UN,F.propertyOf=N7,F.pull=i8,F.pullAll=fN,F.pullAllBy=a8,F.pullAllWith=u8,F.pullAt=l8,F.range=_7,F.rangeRight=I7,F.rearg=SV,F.reject=cV,F.remove=c8,F.rest=CV,F.reverse=mv,F.sampleSize=fV,F.set=AG,F.setWith=kG,F.shuffle=mV,F.slice=p8,F.sortBy=gV,F.sortedUniq=y8,F.sortedUniqBy=b8,F.split=JG,F.spread=EV,F.tail=v8,F.take=w8,F.takeRight=T8,F.takeRightWhile=S8,F.takeWhile=C8,F.tap=M8,F.throttle=NV,F.thru=xd,F.toArray=IN,F.toPairs=DN,F.toPairsIn=FN,F.toPath=O7,F.toPlainObject=kN,F.transform=$G,F.unary=_V,F.union=E8,F.unionBy=N8,F.unionWith=_8,F.uniq=I8,F.uniqBy=A8,F.uniqWith=k8,F.unset=RG,F.unzip=hv,F.unzipWith=mN,F.update=OG,F.updateWith=DG,F.values=rc,F.valuesIn=FG,F.without=$8,F.words=BN,F.wrap=IV,F.xor=R8,F.xorBy=O8,F.xorWith=D8,F.zip=F8,F.zipObject=P8,F.zipObjectDeep=L8,F.zipWith=B8,F.entries=DN,F.entriesIn=FN,F.extend=$N,F.extendWith=Cd,Cv(F,F),F.add=F7,F.attempt=MN,F.camelCase=MG,F.capitalize=PN,F.ceil=P7,F.clamp=PG,F.clone=kV,F.cloneDeep=RV,F.cloneDeepWith=OV,F.cloneWith=$V,F.conformsTo=DV,F.deburr=LN,F.defaultTo=h7,F.divide=L7,F.endsWith=UG,F.eq=Is,F.escape=VG,F.escapeRegExp=GG,F.every=X8,F.find=Z8,F.findIndex=uN,F.findKey=cG,F.findLast=Q8,F.findLastIndex=lN,F.findLastKey=pG,F.floor=B7,F.forEach=dN,F.forEachRight=gN,F.forIn=fG,F.forInRight=mG,F.forOwn=hG,F.forOwnRight=dG,F.get=bv,F.gt=FV,F.gte=PV,F.has=yG,F.hasIn=vv,F.head=pN,F.identity=io,F.includes=nV,F.indexOf=QU,F.inRange=LG,F.invoke=wG,F.isArguments=_u,F.isArray=ot,F.isArrayBuffer=LV,F.isArrayLike=oo,F.isArrayLikeObject=$r,F.isBoolean=BV,F.isBuffer=wa,F.isDate=MV,F.isElement=UV,F.isEmpty=VV,F.isEqual=GV,F.isEqualWith=WV,F.isError=xv,F.isFinite=zV,F.isFunction=Pi,F.isInteger=CN,F.isLength=Td,F.isMap=EN,F.isMatch=HV,F.isMatchWith=KV,F.isNaN=qV,F.isNative=jV,F.isNil=YV,F.isNull=XV,F.isNumber=NN,F.isObject=gr,F.isObjectLike=Sr,F.isPlainObject=Uf,F.isRegExp=yv,F.isSafeInteger=ZV,F.isSet=_N,F.isString=Sd,F.isSymbol=$o,F.isTypedArray=tc,F.isUndefined=QV,F.isWeakMap=JV,F.isWeakSet=eG,F.join=n8,F.kebabCase=WG,F.last=ns,F.lastIndexOf=o8,F.lowerCase=zG,F.lowerFirst=HG,F.lt=tG,F.lte=rG,F.max=M7,F.maxBy=U7,F.mean=V7,F.meanBy=G7,F.min=W7,F.minBy=z7,F.stubArray=Nv,F.stubFalse=_v,F.stubObject=A7,F.stubString=k7,F.stubTrue=$7,F.multiply=H7,F.nth=s8,F.noConflict=w7,F.noop=Ev,F.now=bd,F.pad=KG,F.padEnd=qG,F.padStart=jG,F.parseInt=XG,F.random=BG,F.reduce=uV,F.reduceRight=lV,F.repeat=YG,F.replace=ZG,F.result=IG,F.round=K7,F.runInContext=j,F.sample=pV,F.size=hV,F.snakeCase=QG,F.some=dV,F.sortedIndex=f8,F.sortedIndexBy=m8,F.sortedIndexOf=h8,F.sortedLastIndex=d8,F.sortedLastIndexBy=g8,F.sortedLastIndexOf=x8,F.startCase=e7,F.startsWith=t7,F.subtract=q7,F.sum=j7,F.sumBy=X7,F.template=r7,F.times=R7,F.toFinite=Li,F.toInteger=ut,F.toLength=AN,F.toLower=n7,F.toNumber=os,F.toSafeInteger=nG,F.toString=Ot,F.toUpper=o7,F.trim=s7,F.trimEnd=i7,F.trimStart=a7,F.truncate=u7,F.unescape=l7,F.uniqueId=D7,F.upperCase=c7,F.upperFirst=wv,F.each=dN,F.eachRight=gN,F.first=pN,Cv(F,function(){var l={};return ni(F,function(f,g){Lt.call(F.prototype,g)||(l[g]=f)}),l}(),{chain:!1}),F.VERSION=t,Fn(["bind","bindKey","curry","curryRight","partial","partialRight"],function(l){F[l].placeholder=F}),Fn(["drop","take"],function(l,f){dt.prototype[l]=function(g){g=g===e?1:Hr(ut(g),0);var T=this.__filtered__&&!f?new dt(this):this.clone();return T.__filtered__?T.__takeCount__=Cn(g,T.__takeCount__):T.__views__.push({size:Cn(g,se),type:l+(T.__dir__<0?"Right":"")}),T},dt.prototype[l+"Right"]=function(g){return this.reverse()[l](g).reverse()}}),Fn(["filter","map","takeWhile"],function(l,f){var g=f+1,T=g==ge||g==We;dt.prototype[l]=function(k){var L=this.clone();return L.__iteratees__.push({iteratee:je(k,3),type:g}),L.__filtered__=L.__filtered__||T,L}}),Fn(["head","last"],function(l,f){var g="take"+(f?"Right":"");dt.prototype[l]=function(){return this[g](1).value()[0]}}),Fn(["initial","tail"],function(l,f){var g="drop"+(f?"":"Right");dt.prototype[l]=function(){return this.__filtered__?new dt(this):this[g](1)}}),dt.prototype.compact=function(){return this.filter(io)},dt.prototype.find=function(l){return this.filter(l).head()},dt.prototype.findLast=function(l){return this.reverse().find(l)},dt.prototype.invokeMap=pt(function(l,f){return typeof l=="function"?new dt(this):this.map(function(g){return Df(g,l,f)})}),dt.prototype.reject=function(l){return this.filter(wd(je(l)))},dt.prototype.slice=function(l,f){l=ut(l);var g=this;return g.__filtered__&&(l>0||f<0)?new dt(g):(l<0?g=g.takeRight(-l):l&&(g=g.drop(l)),f!==e&&(f=ut(f),g=f<0?g.dropRight(-f):g.take(f-l)),g)},dt.prototype.takeRightWhile=function(l){return this.reverse().takeWhile(l).reverse()},dt.prototype.toArray=function(){return this.take(se)},ni(dt.prototype,function(l,f){var g=/^(?:filter|find|map|reject)|While$/.test(f),T=/^(?:head|last)$/.test(f),k=F[T?"take"+(f=="last"?"Right":""):f],L=T||/^find/.test(f);k&&(F.prototype[f]=function(){var W=this.__wrapped__,H=T?[1]:arguments,X=W instanceof dt,ue=H[0],le=X||ot(W),me=function(mt){var vt=k.apply(F,ti([mt],H));return T&&Ee?vt[0]:vt};le&&g&&typeof ue=="function"&&ue.length!=1&&(X=le=!1);var Ee=this.__chain__,Pe=!!this.__actions__.length,Xe=L&&!Ee,lt=X&&!Pe;if(!L&&le){W=lt?W:new dt(this);var Ye=l.apply(W,H);return Ye.__actions__.push({func:xd,args:[me],thisArg:e}),new es(Ye,Ee)}return Xe&&lt?l.apply(this,H):(Ye=this.thru(me),Xe?T?Ye.value()[0]:Ye.value():Ye)})}),Fn(["pop","push","shift","sort","splice","unshift"],function(l){var f=Wh[l],g=/^(?:push|sort|unshift)$/.test(l)?"tap":"thru",T=/^(?:pop|shift)$/.test(l);F.prototype[l]=function(){var k=arguments;if(T&&!this.__chain__){var L=this.value();return f.apply(ot(L)?L:[],k)}return this[g](function(W){return f.apply(ot(W)?W:[],k)})}}),ni(dt.prototype,function(l,f){var g=F[f];if(g){var T=g.name+"";Lt.call(Yl,T)||(Yl[T]=[]),Yl[T].push({name:f,func:g})}}),Yl[cd(e,v).name]=[{name:"wrapper",func:e}],dt.prototype.clone=l5,dt.prototype.reverse=c5,dt.prototype.value=p5,F.prototype.at=U8,F.prototype.chain=V8,F.prototype.commit=G8,F.prototype.next=W8,F.prototype.plant=H8,F.prototype.reverse=K8,F.prototype.toJSON=F.prototype.valueOf=F.prototype.value=q8,F.prototype.first=F.prototype.head,_f&&(F.prototype[_f]=z8),F},da=GM();typeof define=="function"&&typeof define.amd=="object"&&define.amd?(Ar._=da,define(function(){return da})):Js?((Js.exports=da)._=da,Qs._=da):Ar._=da}).call(ic)});var Ca=Mn((qf,$v)=>{"use strict";(function(e,t){typeof qf=="object"&&typeof $v=="object"?$v.exports=t():typeof define=="function"&&define.amd?define([],t):typeof qf=="object"?qf.fp=t():e.fp=t()})(typeof self<"u"?self:qf,function(){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=e,r.c=t,r.d=function(n,o,s){r.o(n,o)||Object.defineProperty(n,o,{enumerable:!0,get:s})},r.r=function(n){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n,"__esModule",{value:!0})},r.t=function(n,o){if(1&o&&(n=r(n)),8&o||4&o&&typeof n=="object"&&n&&n.__esModule)return n;var s=Object.create(null);if(r.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:n}),2&o&&typeof n!="string")for(var i in n)r.d(s,i,function(a){return n[a]}.bind(null,i));return s},r.n=function(n){var o=n&&n.__esModule?function(){return n.default}:function(){return n};return r.d(o,"a",o),o},r.o=function(n,o){return Object.prototype.hasOwnProperty.call(n,o)},r.p="",r(r.s=0)}([function(e,t,r){"use strict";r.r(t);var n={};function o(oe){return(o=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(fe){return typeof fe}:function(fe){return fe&&typeof Symbol=="function"&&fe.constructor===Symbol&&fe!==Symbol.prototype?"symbol":typeof fe})(oe)}r.r(n),r.d(n,"VictoryGesture",function(){return ae}),r.d(n,"ThumbsUpGesture",function(){return ct});var s={Thumb:0,Index:1,Middle:2,Ring:3,Pinky:4,all:[0,1,2,3,4],nameMapping:{0:"Thumb",1:"Index",2:"Middle",3:"Ring",4:"Pinky"},pointsMapping:{0:[[0,1],[1,2],[2,3],[3,4]],1:[[0,5],[5,6],[6,7],[7,8]],2:[[0,9],[9,10],[10,11],[11,12]],3:[[0,13],[13,14],[14,15],[15,16]],4:[[0,17],[17,18],[18,19],[19,20]]},getName:function(oe){return o(this.nameMapping[oe])!==void 0&&this.nameMapping[oe]},getPoints:function(oe){return o(this.pointsMapping[oe])!==void 0&&this.pointsMapping[oe]}},i={NoCurl:0,HalfCurl:1,FullCurl:2,nameMapping:{0:"No Curl",1:"Half Curl",2:"Full Curl"},getName:function(oe){return o(this.nameMapping[oe])!==void 0&&this.nameMapping[oe]}},a={VerticalUp:0,VerticalDown:1,HorizontalLeft:2,HorizontalRight:3,DiagonalUpRight:4,DiagonalUpLeft:5,DiagonalDownRight:6,DiagonalDownLeft:7,nameMapping:{0:"Vertical Up",1:"Vertical Down",2:"Horizontal Left",3:"Horizontal Right",4:"Diagonal Up Right",5:"Diagonal Up Left",6:"Diagonal Down Right",7:"Diagonal Down Left"},getName:function(oe){return o(this.nameMapping[oe])!==void 0&&this.nameMapping[oe]}};function u(oe,fe){var se=typeof Symbol<"u"&&oe[Symbol.iterator]||oe["@@iterator"];if(!se){if(Array.isArray(oe)||(se=function(ye,Qe){if(ye){if(typeof ye=="string")return c(ye,Qe);var et=Object.prototype.toString.call(ye).slice(8,-1);if(et==="Object"&&ye.constructor&&(et=ye.constructor.name),et==="Map"||et==="Set")return Array.from(ye);if(et==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(et))return c(ye,Qe)}}(oe))||fe&&oe&&typeof oe.length=="number"){se&&(oe=se);var we=0,xe=function(){};return{s:xe,n:function(){return we>=oe.length?{done:!0}:{done:!1,value:oe[we++]}},e:function(ye){throw ye},f:xe}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var Ne,Te=!0,Ze=!1;return{s:function(){se=se.call(oe)},n:function(){var ye=se.next();return Te=ye.done,ye},e:function(ye){Ze=!0,Ne=ye},f:function(){try{Te||se.return==null||se.return()}finally{if(Ze)throw Ne}}}}function c(oe,fe){(fe==null||fe>oe.length)&&(fe=oe.length);for(var se=0,we=new Array(fe);se<fe;se++)we[se]=oe[se];return we}function p(oe,fe){var se=Object.keys(oe);if(Object.getOwnPropertySymbols){var we=Object.getOwnPropertySymbols(oe);fe&&(we=we.filter(function(xe){return Object.getOwnPropertyDescriptor(oe,xe).enumerable})),se.push.apply(se,we)}return se}function m(oe){for(var fe=1;fe<arguments.length;fe++){var se=arguments[fe]!=null?arguments[fe]:{};fe%2?p(Object(se),!0).forEach(function(we){h(oe,we,se[we])}):Object.getOwnPropertyDescriptors?Object.defineProperties(oe,Object.getOwnPropertyDescriptors(se)):p(Object(se)).forEach(function(we){Object.defineProperty(oe,we,Object.getOwnPropertyDescriptor(se,we))})}return oe}function h(oe,fe,se){return fe in oe?Object.defineProperty(oe,fe,{value:se,enumerable:!0,configurable:!0,writable:!0}):oe[fe]=se,oe}function x(oe,fe){for(var se=0;se<fe.length;se++){var we=fe[se];we.enumerable=we.enumerable||!1,we.configurable=!0,"value"in we&&(we.writable=!0),Object.defineProperty(oe,we.key,we)}}var y=function(){function oe(xe){(function(Ne,Te){if(!(Ne instanceof Te))throw new TypeError("Cannot call a class as a function")})(this,oe),this.options=m(m({},{HALF_CURL_START_LIMIT:60,NO_CURL_START_LIMIT:130,DISTANCE_VOTE_POWER:1.1,SINGLE_ANGLE_VOTE_POWER:.9,TOTAL_ANGLE_VOTE_POWER:1.6}),xe)}var fe,se,we;return fe=oe,(se=[{key:"estimate",value:function(xe){var Ne,Te=[],Ze=[],ye=u(s.all);try{for(ye.s();!(Ne=ye.n()).done;){var Qe,et=Ne.value,cr=s.getPoints(et),Kt=[],Nt=[],Ut=u(cr);try{for(Ut.s();!(Qe=Ut.n()).done;){var Ft=Qe.value,nt=xe[Ft[0]],At=xe[Ft[1]],Pt=this.getSlopes(nt,At),un=Pt[0],bn=Pt[1];Kt.push(un),Nt.push(bn)}}catch(Tn){Ut.e(Tn)}finally{Ut.f()}Te.push(Kt),Ze.push(Nt)}}catch(Tn){ye.e(Tn)}finally{ye.f()}var vn,hr=[],Jr=[],Lr=u(s.all);try{for(Lr.s();!(vn=Lr.n()).done;){var ln=vn.value,cn=ln==s.Thumb?1:0,Vr=s.getPoints(ln),pn=xe[Vr[cn][0]],wn=xe[Vr[cn+1][1]],Xo=xe[Vr[3][1]],Ts=this.estimateFingerCurl(pn,wn,Xo),Ss=this.calculateFingerDirection(pn,wn,Xo,Te[ln].slice(cn));hr[ln]=Ts,Jr[ln]=Ss}}catch(Tn){Lr.e(Tn)}finally{Lr.f()}return{curls:hr,directions:Jr}}},{key:"getSlopes",value:function(xe,Ne){var Te=this.calculateSlope(xe[0],xe[1],Ne[0],Ne[1]);return xe.length==2?Te:[Te,this.calculateSlope(xe[1],xe[2],Ne[1],Ne[2])]}},{key:"angleOrientationAt",value:function(xe){var Ne=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,Te=0,Ze=0,ye=0;return xe>=75&&xe<=105?Te=1*Ne:xe>=25&&xe<=155?Ze=1*Ne:ye=1*Ne,[Te,Ze,ye]}},{key:"estimateFingerCurl",value:function(xe,Ne,Te){var Ze=xe[0]-Ne[0],ye=xe[0]-Te[0],Qe=Ne[0]-Te[0],et=xe[1]-Ne[1],cr=xe[1]-Te[1],Kt=Ne[1]-Te[1],Nt=xe[2]-Ne[2],Ut=xe[2]-Te[2],Ft=Ne[2]-Te[2],nt=Math.sqrt(Ze*Ze+et*et+Nt*Nt),At=Math.sqrt(ye*ye+cr*cr+Ut*Ut),Pt=Math.sqrt(Qe*Qe+Kt*Kt+Ft*Ft),un=(Pt*Pt+nt*nt-At*At)/(2*Pt*nt);un>1?un=1:un<-1&&(un=-1);var bn=Math.acos(un);return(bn=57.2958*bn%180)>this.options.NO_CURL_START_LIMIT?i.NoCurl:bn>this.options.HALF_CURL_START_LIMIT?i.HalfCurl:i.FullCurl}},{key:"estimateHorizontalDirection",value:function(xe,Ne,Te,Ze){return Ze==Math.abs(xe)?xe>0?a.HorizontalLeft:a.HorizontalRight:Ze==Math.abs(Ne)?Ne>0?a.HorizontalLeft:a.HorizontalRight:Te>0?a.HorizontalLeft:a.HorizontalRight}},{key:"estimateVerticalDirection",value:function(xe,Ne,Te,Ze){return Ze==Math.abs(xe)?xe<0?a.VerticalDown:a.VerticalUp:Ze==Math.abs(Ne)?Ne<0?a.VerticalDown:a.VerticalUp:Te<0?a.VerticalDown:a.VerticalUp}},{key:"estimateDiagonalDirection",value:function(xe,Ne,Te,Ze,ye,Qe,et,cr){var Kt=this.estimateVerticalDirection(xe,Ne,Te,Ze),Nt=this.estimateHorizontalDirection(ye,Qe,et,cr);return Kt==a.VerticalUp?Nt==a.HorizontalLeft?a.DiagonalUpLeft:a.DiagonalUpRight:Nt==a.HorizontalLeft?a.DiagonalDownLeft:a.DiagonalDownRight}},{key:"calculateFingerDirection",value:function(xe,Ne,Te,Ze){var ye=xe[0]-Ne[0],Qe=xe[0]-Te[0],et=Ne[0]-Te[0],cr=xe[1]-Ne[1],Kt=xe[1]-Te[1],Nt=Ne[1]-Te[1],Ut=Math.max(Math.abs(ye),Math.abs(Qe),Math.abs(et)),Ft=Math.max(Math.abs(cr),Math.abs(Kt),Math.abs(Nt)),nt=0,At=0,Pt=0,un=Ft/(Ut+1e-5);un>1.5?nt+=this.options.DISTANCE_VOTE_POWER:un>.66?At+=this.options.DISTANCE_VOTE_POWER:Pt+=this.options.DISTANCE_VOTE_POWER;var bn=Math.sqrt(ye*ye+cr*cr),vn=Math.sqrt(Qe*Qe+Kt*Kt),hr=Math.sqrt(et*et+Nt*Nt),Jr=Math.max(bn,vn,hr),Lr=xe[0],ln=xe[1],cn=Te[0],Vr=Te[1];Jr==bn?(cn=Te[0],Vr=Te[1]):Jr==hr&&(Lr=Ne[0],ln=Ne[1]);var pn=[Lr,ln],wn=[cn,Vr],Xo=this.getSlopes(pn,wn),Ts=this.angleOrientationAt(Xo,this.options.TOTAL_ANGLE_VOTE_POWER);nt+=Ts[0],At+=Ts[1],Pt+=Ts[2];var Ss,Tn=u(Ze);try{for(Tn.s();!(Ss=Tn.n()).done;){var la=Ss.value,js=this.angleOrientationAt(la,this.options.SINGLE_ANGLE_VOTE_POWER);nt+=js[0],At+=js[1],Pt+=js[2]}}catch(Cs){Tn.e(Cs)}finally{Tn.f()}return nt==Math.max(nt,At,Pt)?this.estimateVerticalDirection(Kt,cr,Nt,Ft):Pt==Math.max(At,Pt)?this.estimateHorizontalDirection(Qe,ye,et,Ut):this.estimateDiagonalDirection(Kt,cr,Nt,Ft,Qe,ye,et,Ut)}},{key:"calculateSlope",value:function(xe,Ne,Te,Ze){var ye=(Ne-Ze)/(xe-Te),Qe=180*Math.atan(ye)/Math.PI;return Qe<=0?Qe=-Qe:Qe>0&&(Qe=180-Qe),Qe}}])&&x(fe.prototype,se),we&&x(fe,we),oe}();function v(oe,fe){var se=typeof Symbol<"u"&&oe[Symbol.iterator]||oe["@@iterator"];if(!se){if(Array.isArray(oe)||(se=function(ye,Qe){if(ye){if(typeof ye=="string")return w(ye,Qe);var et=Object.prototype.toString.call(ye).slice(8,-1);if(et==="Object"&&ye.constructor&&(et=ye.constructor.name),et==="Map"||et==="Set")return Array.from(ye);if(et==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(et))return w(ye,Qe)}}(oe))||fe&&oe&&typeof oe.length=="number"){se&&(oe=se);var we=0,xe=function(){};return{s:xe,n:function(){return we>=oe.length?{done:!0}:{done:!1,value:oe[we++]}},e:function(ye){throw ye},f:xe}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var Ne,Te=!0,Ze=!1;return{s:function(){se=se.call(oe)},n:function(){var ye=se.next();return Te=ye.done,ye},e:function(ye){Ze=!0,Ne=ye},f:function(){try{Te||se.return==null||se.return()}finally{if(Ze)throw Ne}}}}function w(oe,fe){(fe==null||fe>oe.length)&&(fe=oe.length);for(var se=0,we=new Array(fe);se<fe;se++)we[se]=oe[se];return we}function C(oe,fe){if(!(oe instanceof fe))throw new TypeError("Cannot call a class as a function")}function I(oe,fe){for(var se=0;se<fe.length;se++){var we=fe[se];we.enumerable=we.enumerable||!1,we.configurable=!0,"value"in we&&(we.writable=!0),Object.defineProperty(oe,we.key,we)}}var D=function(){function oe(xe){var Ne=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};C(this,oe),this.estimator=new y(Ne),this.gestures=xe}var fe,se,we;return fe=oe,(se=[{key:"estimate",value:function(xe,Ne){var Te,Ze=[],ye=this.estimator.estimate(xe),Qe=[],et=v(s.all);try{for(et.s();!(Te=et.n()).done;){var cr=Te.value;Qe.push([s.getName(cr),i.getName(ye.curls[cr]),a.getName(ye.directions[cr])])}}catch(nt){et.e(nt)}finally{et.f()}var Kt,Nt=v(this.gestures);try{for(Nt.s();!(Kt=Nt.n()).done;){var Ut=Kt.value,Ft=Ut.matchAgainst(ye.curls,ye.directions);Ft>=Ne&&Ze.push({name:Ut.name,score:Ft})}}catch(nt){Nt.e(nt)}finally{Nt.f()}return{poseData:Qe,gestures:Ze}}}])&&I(fe.prototype,se),we&&I(fe,we),oe}();function P(oe,fe){return function(se){if(Array.isArray(se))return se}(oe)||function(se,we){var xe=se==null?null:typeof Symbol<"u"&&se[Symbol.iterator]||se["@@iterator"];if(xe!=null){var Ne,Te,Ze=[],ye=!0,Qe=!1;try{for(xe=xe.call(se);!(ye=(Ne=xe.next()).done)&&(Ze.push(Ne.value),!we||Ze.length!==we);ye=!0);}catch(et){Qe=!0,Te=et}finally{try{ye||xe.return==null||xe.return()}finally{if(Qe)throw Te}}return Ze}}(oe,fe)||q(oe,fe)||function(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function G(oe,fe){var se=typeof Symbol<"u"&&oe[Symbol.iterator]||oe["@@iterator"];if(!se){if(Array.isArray(oe)||(se=q(oe))||fe&&oe&&typeof oe.length=="number"){se&&(oe=se);var we=0,xe=function(){};return{s:xe,n:function(){return we>=oe.length?{done:!0}:{done:!1,value:oe[we++]}},e:function(ye){throw ye},f:xe}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var Ne,Te=!0,Ze=!1;return{s:function(){se=se.call(oe)},n:function(){var ye=se.next();return Te=ye.done,ye},e:function(ye){Ze=!0,Ne=ye},f:function(){try{Te||se.return==null||se.return()}finally{if(Ze)throw Ne}}}}function q(oe,fe){if(oe){if(typeof oe=="string")return Z(oe,fe);var se=Object.prototype.toString.call(oe).slice(8,-1);return se==="Object"&&oe.constructor&&(se=oe.constructor.name),se==="Map"||se==="Set"?Array.from(oe):se==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(se)?Z(oe,fe):void 0}}function Z(oe,fe){(fe==null||fe>oe.length)&&(fe=oe.length);for(var se=0,we=new Array(fe);se<fe;se++)we[se]=oe[se];return we}function Y(oe,fe){for(var se=0;se<fe.length;se++){var we=fe[se];we.enumerable=we.enumerable||!1,we.configurable=!0,"value"in we&&(we.writable=!0),Object.defineProperty(oe,we.key,we)}}var te=function(){function oe(xe){(function(Ne,Te){if(!(Ne instanceof Te))throw new TypeError("Cannot call a class as a function")})(this,oe),this.name=xe,this.curls={},this.directions={}}var fe,se,we;return fe=oe,(se=[{key:"addCurl",value:function(xe,Ne){var Te=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;this.curls[xe]===void 0&&(this.curls[xe]=[]),this.curls[xe].push([Ne,Te])}},{key:"addDirection",value:function(xe,Ne){var Te=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;this.directions[xe]===void 0&&(this.directions[xe]=[]),this.directions[xe].push([Ne,Te])}},{key:"matchAgainst",value:function(xe,Ne){var Te=0,Ze=0;for(var ye in xe){var Qe=xe[ye],et=this.curls[ye];if(et!==void 0){Ze++;var cr,Kt=!1,Nt=0,Ut=G(et);try{for(Ut.s();!(cr=Ut.n()).done;){var Ft=P(cr.value,2),nt=Ft[0],At=Ft[1];if(Qe==nt){Te+=At,Nt=Math.max(Nt,At),Kt=!0;break}}}catch(pn){Ut.e(pn)}finally{Ut.f()}Kt||(Te-=Nt)}}for(var Pt in Ne){var un=Ne[Pt],bn=this.directions[Pt];if(bn!==void 0){Ze++;var vn,hr=!1,Jr=0,Lr=G(bn);try{for(Lr.s();!(vn=Lr.n()).done;){var ln=P(vn.value,2),cn=ln[0],Vr=ln[1];if(un==cn){Te+=Vr,Jr=Math.max(Jr,Vr),hr=!0;break}}}catch(pn){Lr.e(pn)}finally{Lr.f()}hr||(Te-=Jr)}}return Te/Ze*10}}])&&Y(fe.prototype,se),we&&Y(fe,we),oe}(),J=new te("victory");J.addDirection(s.Thumb,a.VerticalUp,1),J.addDirection(s.Thumb,a.DiagonalUpLeft,1),J.addDirection(s.Thumb,a.DiagonalUpRight,1),J.addCurl(s.Index,i.NoCurl,1),J.addDirection(s.Index,a.VerticalUp,1),J.addDirection(s.Index,a.DiagonalUpLeft,1),J.addDirection(s.Index,a.DiagonalUpRight,1),J.addDirection(s.Index,a.HorizontalLeft,1),J.addDirection(s.Index,a.HorizontalRight,1),J.addCurl(s.Middle,i.NoCurl,1),J.addDirection(s.Middle,a.VerticalUp,1),J.addDirection(s.Middle,a.DiagonalUpLeft,1),J.addDirection(s.Middle,a.DiagonalUpRight,1),J.addDirection(s.Middle,a.HorizontalLeft,1),J.addDirection(s.Middle,a.HorizontalRight,1),J.addCurl(s.Ring,i.FullCurl,1),J.addCurl(s.Ring,i.HalfCurl,.9),J.addCurl(s.Pinky,i.FullCurl,1),J.addCurl(s.Pinky,i.HalfCurl,.9);var ae=J,ge=new te("thumbs_up");ge.addCurl(s.Thumb,i.NoCurl,1),ge.addDirection(s.Thumb,a.VerticalUp,1),ge.addDirection(s.Thumb,a.DiagonalUpLeft,.9),ge.addDirection(s.Thumb,a.DiagonalUpRight,.9);for(var ke=0,We=[s.Index,s.Middle,s.Ring,s.Pinky];ke<We.length;ke++){var Re=We[ke];ge.addCurl(Re,i.FullCurl,1),ge.addCurl(Re,i.HalfCurl,.9)}ge.addDirection(s.Index,a.DiagonalUpLeft,1),ge.addDirection(s.Index,a.HorizontalLeft,1),ge.addDirection(s.Index,a.HorizontalRight,1),ge.addDirection(s.Index,a.DiagonalUpRight,1);var ct=ge;t.default={GestureEstimator:D,GestureDescription:te,Finger:s,FingerCurl:i,FingerDirection:a,Gestures:n}}]).default})});var v4=Mn(b4=>{"use strict";(function(){"use strict";var e;function t(d){var b=0;return function(){return b<d.length?{done:!1,value:d[b++]}:{done:!0}}}var r=typeof Object.defineProperties=="function"?Object.defineProperty:function(d,b,N){return d==Array.prototype||d==Object.prototype||(d[b]=N.value),d};function n(d){d=[typeof globalThis=="object"&&globalThis,d,typeof window=="object"&&window,typeof self=="object"&&self,typeof global=="object"&&global];for(var b=0;b<d.length;++b){var N=d[b];if(N&&N.Math==Math)return N}throw Error("Cannot find global object")}var o=n(this);function s(d,b){if(b)e:{var N=o;d=d.split(".");for(var $=0;$<d.length-1;$++){var B=d[$];if(!(B in N))break e;N=N[B]}d=d[d.length-1],$=N[d],b=b($),b!=$&&b!=null&&r(N,d,{configurable:!0,writable:!0,value:b})}}s("Symbol",function(d){function b(V){if(this instanceof b)throw new TypeError("Symbol is not a constructor");return new N($+(V||"")+"_"+B++,V)}function N(V,M){this.h=V,r(this,"description",{configurable:!0,writable:!0,value:M})}if(d)return d;N.prototype.toString=function(){return this.h};var $="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",B=0;return b}),s("Symbol.iterator",function(d){if(d)return d;d=Symbol("Symbol.iterator");for(var b="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),N=0;N<b.length;N++){var $=o[b[N]];typeof $=="function"&&typeof $.prototype[d]!="function"&&r($.prototype,d,{configurable:!0,writable:!0,value:function(){return i(t(this))}})}return d});function i(d){return d={next:d},d[Symbol.iterator]=function(){return this},d}function a(d){var b=typeof Symbol<"u"&&Symbol.iterator&&d[Symbol.iterator];return b?b.call(d):{next:t(d)}}function u(d){if(!(d instanceof Array)){d=a(d);for(var b,N=[];!(b=d.next()).done;)N.push(b.value);d=N}return d}var c=typeof Object.assign=="function"?Object.assign:function(d,b){for(var N=1;N<arguments.length;N++){var $=arguments[N];if($)for(var B in $)Object.prototype.hasOwnProperty.call($,B)&&(d[B]=$[B])}return d};s("Object.assign",function(d){return d||c});var p=typeof Object.create=="function"?Object.create:function(d){function b(){}return b.prototype=d,new b},m;if(typeof Object.setPrototypeOf=="function")m=Object.setPrototypeOf;else{var h;e:{var x={a:!0},y={};try{y.__proto__=x,h=y.a;break e}catch{}h=!1}m=h?function(d,b){if(d.__proto__=b,d.__proto__!==b)throw new TypeError(d+" is not extensible");return d}:null}var v=m;function w(d,b){if(d.prototype=p(b.prototype),d.prototype.constructor=d,v)v(d,b);else for(var N in b)if(N!="prototype")if(Object.defineProperties){var $=Object.getOwnPropertyDescriptor(b,N);$&&Object.defineProperty(d,N,$)}else d[N]=b[N];d.ya=b.prototype}function C(){this.m=!1,this.j=null,this.i=void 0,this.h=1,this.v=this.s=0,this.l=null}function I(d){if(d.m)throw new TypeError("Generator is already running");d.m=!0}C.prototype.u=function(d){this.i=d};function D(d,b){d.l={ma:b,na:!0},d.h=d.s||d.v}C.prototype.return=function(d){this.l={return:d},this.h=this.v};function P(d,b,N){return d.h=N,{value:b}}function G(d){this.h=new C,this.i=d}function q(d,b){I(d.h);var N=d.h.j;return N?Z(d,"return"in N?N.return:function($){return{value:$,done:!0}},b,d.h.return):(d.h.return(b),Y(d))}function Z(d,b,N,$){try{var B=b.call(d.h.j,N);if(!(B instanceof Object))throw new TypeError("Iterator result "+B+" is not an object");if(!B.done)return d.h.m=!1,B;var V=B.value}catch(M){return d.h.j=null,D(d.h,M),Y(d)}return d.h.j=null,$.call(d.h,V),Y(d)}function Y(d){for(;d.h.h;)try{var b=d.i(d.h);if(b)return d.h.m=!1,{value:b.value,done:!1}}catch(N){d.h.i=void 0,D(d.h,N)}if(d.h.m=!1,d.h.l){if(b=d.h.l,d.h.l=null,b.na)throw b.ma;return{value:b.return,done:!0}}return{value:void 0,done:!0}}function te(d){this.next=function(b){return I(d.h),d.h.j?b=Z(d,d.h.j.next,b,d.h.u):(d.h.u(b),b=Y(d)),b},this.throw=function(b){return I(d.h),d.h.j?b=Z(d,d.h.j.throw,b,d.h.u):(D(d.h,b),b=Y(d)),b},this.return=function(b){return q(d,b)},this[Symbol.iterator]=function(){return this}}function J(d){function b($){return d.next($)}function N($){return d.throw($)}return new Promise(function($,B){function V(M){M.done?$(M.value):Promise.resolve(M.value).then(b,N).then(V,B)}V(d.next())})}function ae(d){return J(new te(new G(d)))}s("Promise",function(d){function b(M){this.i=0,this.j=void 0,this.h=[],this.u=!1;var K=this.l();try{M(K.resolve,K.reject)}catch(ee){K.reject(ee)}}function N(){this.h=null}function $(M){return M instanceof b?M:new b(function(K){K(M)})}if(d)return d;N.prototype.i=function(M){if(this.h==null){this.h=[];var K=this;this.j(function(){K.m()})}this.h.push(M)};var B=o.setTimeout;N.prototype.j=function(M){B(M,0)},N.prototype.m=function(){for(;this.h&&this.h.length;){var M=this.h;this.h=[];for(var K=0;K<M.length;++K){var ee=M[K];M[K]=null;try{ee()}catch(he){this.l(he)}}}this.h=null},N.prototype.l=function(M){this.j(function(){throw M})},b.prototype.l=function(){function M(he){return function(de){ee||(ee=!0,he.call(K,de))}}var K=this,ee=!1;return{resolve:M(this.I),reject:M(this.m)}},b.prototype.I=function(M){if(M===this)this.m(new TypeError("A Promise cannot resolve to itself"));else if(M instanceof b)this.L(M);else{e:switch(typeof M){case"object":var K=M!=null;break e;case"function":K=!0;break e;default:K=!1}K?this.F(M):this.s(M)}},b.prototype.F=function(M){var K=void 0;try{K=M.then}catch(ee){this.m(ee);return}typeof K=="function"?this.M(K,M):this.s(M)},b.prototype.m=function(M){this.v(2,M)},b.prototype.s=function(M){this.v(1,M)},b.prototype.v=function(M,K){if(this.i!=0)throw Error("Cannot settle("+M+", "+K+"): Promise already settled in state"+this.i);this.i=M,this.j=K,this.i===2&&this.K(),this.H()},b.prototype.K=function(){var M=this;B(function(){if(M.D()){var K=o.console;typeof K<"u"&&K.error(M.j)}},1)},b.prototype.D=function(){if(this.u)return!1;var M=o.CustomEvent,K=o.Event,ee=o.dispatchEvent;return typeof ee>"u"?!0:(typeof M=="function"?M=new M("unhandledrejection",{cancelable:!0}):typeof K=="function"?M=new K("unhandledrejection",{cancelable:!0}):(M=o.document.createEvent("CustomEvent"),M.initCustomEvent("unhandledrejection",!1,!0,M)),M.promise=this,M.reason=this.j,ee(M))},b.prototype.H=function(){if(this.h!=null){for(var M=0;M<this.h.length;++M)V.i(this.h[M]);this.h=null}};var V=new N;return b.prototype.L=function(M){var K=this.l();M.T(K.resolve,K.reject)},b.prototype.M=function(M,K){var ee=this.l();try{M.call(K,ee.resolve,ee.reject)}catch(he){ee.reject(he)}},b.prototype.then=function(M,K){function ee(Oe,Ce){return typeof Oe=="function"?function(qe){try{he(Oe(qe))}catch(at){de(at)}}:Ce}var he,de,He=new b(function(Oe,Ce){he=Oe,de=Ce});return this.T(ee(M,he),ee(K,de)),He},b.prototype.catch=function(M){return this.then(void 0,M)},b.prototype.T=function(M,K){function ee(){switch(he.i){case 1:M(he.j);break;case 2:K(he.j);break;default:throw Error("Unexpected state: "+he.i)}}var he=this;this.h==null?V.i(ee):this.h.push(ee),this.u=!0},b.resolve=$,b.reject=function(M){return new b(function(K,ee){ee(M)})},b.race=function(M){return new b(function(K,ee){for(var he=a(M),de=he.next();!de.done;de=he.next())$(de.value).T(K,ee)})},b.all=function(M){var K=a(M),ee=K.next();return ee.done?$([]):new b(function(he,de){function He(qe){return function(at){Oe[qe]=at,Ce--,Ce==0&&he(Oe)}}var Oe=[],Ce=0;do Oe.push(void 0),Ce++,$(ee.value).T(He(Oe.length-1),de),ee=K.next();while(!ee.done)})},b});function ge(d,b){d instanceof String&&(d+="");var N=0,$=!1,B={next:function(){if(!$&&N<d.length){var V=N++;return{value:b(V,d[V]),done:!1}}return $=!0,{done:!0,value:void 0}}};return B[Symbol.iterator]=function(){return B},B}s("Array.prototype.keys",function(d){return d||function(){return ge(this,function(b){return b})}}),s("Array.prototype.fill",function(d){return d||function(b,N,$){var B=this.length||0;for(0>N&&(N=Math.max(0,B+N)),($==null||$>B)&&($=B),$=Number($),0>$&&($=Math.max(0,B+$)),N=Number(N||0);N<$;N++)this[N]=b;return this}});function ke(d){return d||Array.prototype.fill}s("Int8Array.prototype.fill",ke),s("Uint8Array.prototype.fill",ke),s("Uint8ClampedArray.prototype.fill",ke),s("Int16Array.prototype.fill",ke),s("Uint16Array.prototype.fill",ke),s("Int32Array.prototype.fill",ke),s("Uint32Array.prototype.fill",ke),s("Float32Array.prototype.fill",ke),s("Float64Array.prototype.fill",ke),s("Object.is",function(d){return d||function(b,N){return b===N?b!==0||1/b===1/N:b!==b&&N!==N}}),s("Array.prototype.includes",function(d){return d||function(b,N){var $=this;$ instanceof String&&($=String($));var B=$.length;for(N=N||0,0>N&&(N=Math.max(N+B,0));N<B;N++){var V=$[N];if(V===b||Object.is(V,b))return!0}return!1}}),s("String.prototype.includes",function(d){return d||function(b,N){if(this==null)throw new TypeError("The 'this' value for String.prototype.includes must not be null or undefined");if(b instanceof RegExp)throw new TypeError("First argument to String.prototype.includes must not be a regular expression");return this.indexOf(b,N||0)!==-1}});var We=this||self;function Re(d,b){d=d.split(".");var N=We;d[0]in N||typeof N.execScript>"u"||N.execScript("var "+d[0]);for(var $;d.length&&($=d.shift());)d.length||b===void 0?N[$]&&N[$]!==Object.prototype[$]?N=N[$]:N=N[$]={}:N[$]=b}function ct(d){var b;e:{if((b=We.navigator)&&(b=b.userAgent))break e;b=""}return b.indexOf(d)!=-1}var oe=Array.prototype.map?function(d,b){return Array.prototype.map.call(d,b,void 0)}:function(d,b){for(var N=d.length,$=Array(N),B=typeof d=="string"?d.split(""):d,V=0;V<N;V++)V in B&&($[V]=b.call(void 0,B[V],V,d));return $},fe={},se=null;function we(d){var b=d.length,N=3*b/4;N%3?N=Math.floor(N):"=.".indexOf(d[b-1])!=-1&&(N="=.".indexOf(d[b-2])!=-1?N-2:N-1);var $=new Uint8Array(N),B=0;return xe(d,function(V){$[B++]=V}),B!==N?$.subarray(0,B):$}function xe(d,b){function N(ee){for(;$<d.length;){var he=d.charAt($++),de=se[he];if(de!=null)return de;if(!/^[\s\xa0]*$/.test(he))throw Error("Unknown base64 encoding at char: "+he)}return ee}Ne();for(var $=0;;){var B=N(-1),V=N(0),M=N(64),K=N(64);if(K===64&&B===-1)break;b(B<<2|V>>4),M!=64&&(b(V<<4&240|M>>2),K!=64&&b(M<<6&192|K))}}function Ne(){if(!se){se={};for(var d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".split(""),b=["+/=","+/","-_=","-_.","-_"],N=0;5>N;N++){var $=d.concat(b[N].split(""));fe[N]=$;for(var B=0;B<$.length;B++){var V=$[B];se[V]===void 0&&(se[V]=B)}}}}var Te=typeof Uint8Array<"u",Ze=!(ct("Trident")||ct("MSIE"))&&typeof We.btoa=="function";function ye(d){if(!Ze){var b;b===void 0&&(b=0),Ne(),b=fe[b];for(var N=Array(Math.floor(d.length/3)),$=b[64]||"",B=0,V=0;B<d.length-2;B+=3){var M=d[B],K=d[B+1],ee=d[B+2],he=b[M>>2];M=b[(M&3)<<4|K>>4],K=b[(K&15)<<2|ee>>6],ee=b[ee&63],N[V++]=he+M+K+ee}switch(he=0,ee=$,d.length-B){case 2:he=d[B+1],ee=b[(he&15)<<2]||$;case 1:d=d[B],N[V]=b[d>>2]+b[(d&3)<<4|he>>4]+ee+$}return N.join("")}for(b="";10240<d.length;)b+=String.fromCharCode.apply(null,d.subarray(0,10240)),d=d.subarray(10240);return b+=String.fromCharCode.apply(null,d),btoa(b)}var Qe=RegExp("[-_.]","g");function et(d){switch(d){case"-":return"+";case"_":return"/";case".":return"=";default:return""}}function cr(d){if(!Ze)return we(d);Qe.test(d)&&(d=d.replace(Qe,et)),d=atob(d);for(var b=new Uint8Array(d.length),N=0;N<d.length;N++)b[N]=d.charCodeAt(N);return b}var Kt;function Nt(){return Kt||(Kt=new Uint8Array(0))}var Ut={},Ft=typeof Uint8Array.prototype.slice=="function",nt=0,At=0;function Pt(d){var b=0>d;d=Math.abs(d);var N=d>>>0;d=Math.floor((d-N)/4294967296),b&&(N=a(bn(N,d)),b=N.next().value,d=N.next().value,N=b),nt=N>>>0,At=d>>>0}var un=typeof BigInt=="function";function bn(d,b){return b=~b,d?d=~d+1:b+=1,[d,b]}function vn(d,b){this.i=d>>>0,this.h=b>>>0}function hr(d){if(!d)return Jr||(Jr=new vn(0,0));if(!/^-?\d+$/.test(d))return null;if(16>d.length)Pt(Number(d));else if(un)d=BigInt(d),nt=Number(d&BigInt(4294967295))>>>0,At=Number(d>>BigInt(32)&BigInt(4294967295));else{var b=+(d[0]==="-");At=nt=0;for(var N=d.length,$=b,B=(N-b)%6+b;B<=N;$=B,B+=6)$=Number(d.slice($,B)),At*=1e6,nt=1e6*nt+$,4294967296<=nt&&(At+=nt/4294967296|0,nt%=4294967296);b&&(b=a(bn(nt,At)),d=b.next().value,b=b.next().value,nt=d,At=b)}return new vn(nt,At)}var Jr;function Lr(d,b){return Error("Invalid wire type: "+d+" (at position "+b+")")}function ln(){return Error("Failed to read varint, encoding is invalid.")}function cn(d,b){return Error("Tried to read past the end of the data "+b+" > "+d)}function Vr(){throw Error("Invalid UTF8")}function pn(d,b){return b=String.fromCharCode.apply(null,b),d==null?b:d+b}var wn=void 0,Xo,Ts=typeof TextDecoder<"u",Ss,Tn=typeof TextEncoder<"u",la;function js(d){if(d!==Ut)throw Error("illegal external caller")}function Cs(d,b){if(js(b),this.V=d,d!=null&&d.length===0)throw Error("ByteString should be constructed with non-empty values")}function lu(){return la||(la=new Cs(null,Ut))}function Al(d){js(Ut);var b=d.V;return b=b==null||Te&&b!=null&&b instanceof Uint8Array?b:typeof b=="string"?cr(b):null,b==null?b:d.V=b}function gb(d){if(typeof d=="string")return{buffer:cr(d),C:!1};if(Array.isArray(d))return{buffer:new Uint8Array(d),C:!1};if(d.constructor===Uint8Array)return{buffer:d,C:!1};if(d.constructor===ArrayBuffer)return{buffer:new Uint8Array(d),C:!1};if(d.constructor===Cs)return{buffer:Al(d)||Nt(),C:!0};if(d instanceof Uint8Array)return{buffer:new Uint8Array(d.buffer,d.byteOffset,d.byteLength),C:!1};throw Error("Type not convertible to a Uint8Array, expected a Uint8Array, an ArrayBuffer, a base64 encoded string, a ByteString or an Array of numbers")}function Th(d,b){this.i=null,this.m=!1,this.h=this.j=this.l=0,qp(this,d,b)}function qp(d,b,N){N=N===void 0?{}:N,d.S=N.S===void 0?!1:N.S,b&&(b=gb(b),d.i=b.buffer,d.m=b.C,d.l=0,d.j=d.i.length,d.h=d.l)}Th.prototype.reset=function(){this.h=this.l};function Xs(d,b){if(d.h=b,b>d.j)throw cn(d.j,b)}function ca(d){var b=d.i,N=d.h,$=b[N++],B=$&127;if($&128&&($=b[N++],B|=($&127)<<7,$&128&&($=b[N++],B|=($&127)<<14,$&128&&($=b[N++],B|=($&127)<<21,$&128&&($=b[N++],B|=$<<28,$&128&&b[N++]&128&&b[N++]&128&&b[N++]&128&&b[N++]&128&&b[N++]&128)))))throw ln();return Xs(d,N),B}function Sh(d,b){if(0>b)throw Error("Tried to read a negative byte length: "+b);var N=d.h,$=N+b;if($>d.j)throw cn(b,d.j-N);return d.h=$,N}var Ch=[];function jp(){this.h=[]}jp.prototype.length=function(){return this.h.length},jp.prototype.end=function(){var d=this.h;return this.h=[],d};function Eh(d,b,N){for(;0<N||127<b;)d.h.push(b&127|128),b=(b>>>7|N<<25)>>>0,N>>>=7;d.h.push(b)}function Ys(d,b){for(;127<b;)d.h.push(b&127|128),b>>>=7;d.h.push(b)}function Xp(d,b){if(Ch.length){var N=Ch.pop();qp(N,d,b),d=N}else d=new Th(d,b);this.h=d,this.j=this.h.h,this.i=this.l=-1,this.setOptions(b)}Xp.prototype.setOptions=function(d){d=d===void 0?{}:d,this.ca=d.ca===void 0?!1:d.ca},Xp.prototype.reset=function(){this.h.reset(),this.j=this.h.h,this.i=this.l=-1};function Nh(d){var b=d.h;if(b.h==b.j)return!1;d.j=d.h.h;var N=ca(d.h)>>>0;if(b=N>>>3,N&=7,!(0<=N&&5>=N))throw Lr(N,d.j);if(1>b)throw Error("Invalid field number: "+b+" (at position "+d.j+")");return d.l=b,d.i=N,!0}function kl(d){switch(d.i){case 0:if(d.i!=0)kl(d);else e:{d=d.h;for(var b=d.h,N=b+10,$=d.i;b<N;)if(!($[b++]&128)){Xs(d,b);break e}throw ln()}break;case 1:d=d.h,Xs(d,d.h+8);break;case 2:d.i!=2?kl(d):(b=ca(d.h)>>>0,d=d.h,Xs(d,d.h+b));break;case 5:d=d.h,Xs(d,d.h+4);break;case 3:b=d.l;do{if(!Nh(d))throw Error("Unmatched start-group tag: stream EOF");if(d.i==4){if(d.l!=b)throw Error("Unmatched end-group tag");break}kl(d)}while(!0);break;default:throw Lr(d.i,d.j)}}var pa=[];function xb(){this.j=[],this.i=0,this.h=new jp}function Zs(d,b){b.length!==0&&(d.j.push(b),d.i+=b.length)}function yb(d,b){if(b=b.R){Zs(d,d.h.end());for(var N=0;N<b.length;N++)Zs(d,Al(b[N])||Nt())}}var Es=typeof Symbol=="function"&&typeof Symbol()=="symbol"?Symbol():void 0;function Ii(d,b){return Es?d[Es]|=b:d.A!==void 0?d.A|=b:(Object.defineProperties(d,{A:{value:b,configurable:!0,writable:!0,enumerable:!1}}),b)}function _h(d,b){Es?d[Es]&&(d[Es]&=~b):d.A!==void 0&&(d.A&=~b)}function dr(d){var b;return Es?b=d[Es]:b=d.A,b??0}function Yo(d,b){Es?d[Es]=b:d.A!==void 0?d.A=b:Object.defineProperties(d,{A:{value:b,configurable:!0,writable:!0,enumerable:!1}})}function Yp(d){return Ii(d,1),d}function bb(d,b){Yo(b,(d|0)&-51)}function cu(d,b){Yo(b,(d|18)&-41)}var Zp={};function $l(d){return d!==null&&typeof d=="object"&&!Array.isArray(d)&&d.constructor===Object}var pu,Ih=[];Yo(Ih,23),pu=Object.freeze(Ih);function Qp(d){if(dr(d.o)&2)throw Error("Cannot mutate an immutable Message")}function Jp(d){var b=d.length;(b=b?d[b-1]:void 0)&&$l(b)?b.g=1:(b={},d.push((b.g=1,b)))}function fu(d){var b=d.i+d.G;return d.B||(d.B=d.o[b]={})}function _o(d,b){return b===-1?null:b>=d.i?d.B?d.B[b]:void 0:d.o[b+d.G]}function On(d,b,N,$){Qp(d),mu(d,b,N,$)}function mu(d,b,N,$){d.j&&(d.j=void 0),b>=d.i||$?fu(d)[b]=N:(d.o[b+d.G]=N,(d=d.B)&&b in d&&delete d[b])}function ef(d,b,N,$){var B=_o(d,b);Array.isArray(B)||(B=pu);var V=dr(B);if(V&1||Yp(B),$)V&2||Ii(B,2),N&1||Object.freeze(B);else{$=!(N&2);var M=V&2;N&1||!M?$&&V&16&&!M&&_h(B,16):(B=Yp(Array.prototype.slice.call(B)),mu(d,b,B))}return B}function tf(d,b){var N=_o(d,b),$=N==null?N:typeof N=="number"||N==="NaN"||N==="Infinity"||N==="-Infinity"?Number(N):void 0;return $!=null&&$!==N&&mu(d,b,$),$}function rf(d,b,N,$,B){d.h||(d.h={});var V=d.h[N],M=ef(d,N,3,B);if(!V){var K=M;V=[];var ee=!!(dr(d.o)&16);M=!!(dr(K)&2);var he=K;!B&&M&&(K=Array.prototype.slice.call(K));for(var de=M,He=0;He<K.length;He++){var Oe=K[He],Ce=b,qe=!1;if(qe=qe===void 0?!1:qe,Oe=Array.isArray(Oe)?new Ce(Oe):qe?new Ce:void 0,Oe!==void 0){Ce=Oe.o;var at=qe=dr(Ce);M&&(at|=2),ee&&(at|=16),at!=qe&&Yo(Ce,at),Ce=at,de=de||!!(2&Ce),V.push(Oe)}}return d.h[N]=V,ee=dr(K),b=ee|33,b=de?b&-9:b|8,ee!=b&&(de=K,Object.isFrozen(de)&&(de=Array.prototype.slice.call(de)),Yo(de,b),K=de),he!==K&&mu(d,N,K),(B||$&&M)&&Ii(V,2),$&&Object.freeze(V),V}return B||(B=Object.isFrozen(V),$&&!B?Object.freeze(V):!$&&B&&(V=Array.prototype.slice.call(V),d.h[N]=V)),V}function hu(d,b,N){var $=!!(dr(d.o)&2);if(b=rf(d,b,N,$,$),d=ef(d,N,3,$),!($||dr(d)&8)){for($=0;$<b.length;$++){if(N=b[$],dr(N.o)&2){var B=$h(N,!1);B.j=N}else B=N;N!==B&&(b[$]=B,d[$]=B.o)}Ii(d,8)}return b}function Io(d,b,N){if(N!=null&&typeof N!="number")throw Error("Value of float/double field must be a number|null|undefined, found "+typeof N+": "+N);On(d,b,N)}function Ah(d,b,N,$,B){Qp(d);var V=rf(d,N,b,!1,!1);return N=$??new N,d=ef(d,b,2,!1),B!=null?(V.splice(B,0,N),d.splice(B,0,N.o)):(V.push(N),d.push(N.o)),N.C()&&_h(d,8),N}function Rl(d,b){return d??b}function Zo(d,b,N){return N=N===void 0?0:N,Rl(tf(d,b),N)}var Ol;function kh(d){switch(typeof d){case"number":return isFinite(d)?d:String(d);case"object":if(d)if(Array.isArray(d)){if(dr(d)&128)return d=Array.prototype.slice.call(d),Jp(d),d}else{if(Te&&d!=null&&d instanceof Uint8Array)return ye(d);if(d instanceof Cs){var b=d.V;return b==null?"":typeof b=="string"?b:d.V=ye(b)}}}return d}function nf(d,b,N,$){if(d!=null){if(Array.isArray(d))d=Dl(d,b,N,$!==void 0);else if($l(d)){var B={},V;for(V in d)B[V]=nf(d[V],b,N,$);d=B}else d=b(d,$);return d}}function Dl(d,b,N,$){var B=dr(d);$=$?!!(B&16):void 0,d=Array.prototype.slice.call(d);for(var V=0;V<d.length;V++)d[V]=nf(d[V],b,N,$);return N(B,d),d}function of(d){return d.ja===Zp?d.toJSON():kh(d)}function vb(d,b){d&128&&Jp(b)}function sf(d,b,N){if(N=N===void 0?cu:N,d!=null){if(Te&&d instanceof Uint8Array)return d.length?new Cs(new Uint8Array(d),Ut):lu();if(Array.isArray(d)){var $=dr(d);return $&2?d:b&&!($&32)&&($&16||$===0)?(Yo(d,$|2),d):(d=Dl(d,sf,$&4?cu:N,!0),b=dr(d),b&4&&b&2&&Object.freeze(d),d)}return d.ja===Zp?af(d):d}}function du(d,b,N,$,B,V,M){if(d=d.h&&d.h[N]){if($=dr(d),$&2?$=d:(V=oe(d,af),cu($,V),Object.freeze(V),$=V),Qp(b),M=$==null?pu:Yp([]),$!=null){for(V=!!$.length,d=0;d<$.length;d++){var K=$[d];V=V&&!(dr(K.o)&2),M[d]=K.o}V=(V?8:0)|1,d=dr(M),(d&V)!==V&&(Object.isFrozen(M)&&(M=Array.prototype.slice.call(M)),Yo(M,d|V)),b.h||(b.h={}),b.h[N]=$}else b.h&&(b.h[N]=void 0);mu(b,N,M,B)}else On(b,N,sf($,V,M),B)}function af(d){return dr(d.o)&2||(d=$h(d,!0),Ii(d.o,2)),d}function $h(d,b){var N=d.o,$=[];Ii($,16);var B=d.constructor.h;if(B&&$.push(B),B=d.B,B){$.length=N.length,$.fill(void 0,$.length,N.length);var V={};$[$.length-1]=V}dr(N)&128&&Jp($),b=b||d.C()?cu:bb,V=d.constructor,Ol=$,$=new V($),Ol=void 0,d.R&&($.R=d.R.slice()),V=!!(dr(N)&16);for(var M=B?N.length-1:N.length,K=0;K<M;K++)du(d,$,K-d.G,N[K],!1,V,b);if(B)for(var ee in B)du(d,$,+ee,B[ee],!0,V,b);return $}function fn(d,b,N){d==null&&(d=Ol),Ol=void 0;var $=this.constructor.i||0,B=0<$,V=this.constructor.h,M=!1;if(d==null){d=V?[V]:[];var K=48,ee=!0;B&&($=0,K|=128),Yo(d,K)}else{if(!Array.isArray(d)||V&&V!==d[0])throw Error();var he=K=Ii(d,0);if((ee=(16&he)!==0)&&((M=(32&he)!==0)||(he|=32)),B){if(128&he)$=0;else if(0<d.length){var de=d[d.length-1];if($l(de)&&"g"in de){$=0,he|=128,delete de.g;var He=!0,Oe;for(Oe in de){He=!1;break}He&&d.pop()}}}else if(128&he)throw Error();K!==he&&Yo(d,he)}this.G=(V?0:-1)-$,this.h=void 0,this.o=d;e:{if(V=this.o.length,$=V-1,V&&(V=this.o[$],$l(V))){this.B=V,this.i=$-this.G;break e}b!==void 0&&-1<b?(this.i=Math.max(b,$+1-this.G),this.B=void 0):this.i=Number.MAX_VALUE}if(!B&&this.B&&"g"in this.B)throw Error('Unexpected "g" flag in sparse object of message that is not a group type.');if(N){b=ee&&!M&&!0,B=this.i;var Ce;for(ee=0;ee<N.length;ee++)M=N[ee],M<B?(M+=this.G,($=d[M])?uf($,b):d[M]=pu):(Ce||(Ce=fu(this)),($=Ce[M])?uf($,b):Ce[M]=pu)}}fn.prototype.toJSON=function(){return Dl(this.o,of,vb)},fn.prototype.C=function(){return!!(dr(this.o)&2)};function uf(d,b){if(Array.isArray(d)){var N=dr(d),$=1;!b||N&2||($|=16),(N&$)!==$&&Yo(d,N|$)}}fn.prototype.ja=Zp,fn.prototype.toString=function(){return this.o.toString()};function Fl(d,b,N){if(N){var $={},B;for(B in N){var V=N[B],M=V.qa;M||($.J=V.wa||V.oa.W,V.ia?($.aa=mf(V.ia),M=function(K){return function(ee,he,de){return K.J(ee,he,de,K.aa)}}($)):V.ka?($.Z=hf(V.da.P,V.ka),M=function(K){return function(ee,he,de){return K.J(ee,he,de,K.Z)}}($)):M=$.J,V.qa=M),M(b,d,V.da),$={J:$.J,aa:$.aa,Z:$.Z}}}yb(b,d)}var Pl=Symbol();function lf(d,b,N){return d[Pl]||(d[Pl]=function($,B){return b($,B,N)})}function Ll(d){var b=d[Pl];if(!b){var N=gf(d);b=function($,B){return Oh($,B,N)},d[Pl]=b}return b}function cf(d){var b=d.ia;if(b)return Ll(b);if(b=d.va)return lf(d.da.P,b,d.ka)}function fa(d){var b=cf(d),N=d.da,$=d.oa.U;return b?function(B,V){return $(B,V,N,b)}:function(B,V){return $(B,V,N)}}function pf(d,b){var N=d[b];return typeof N=="function"&&N.length===0&&(N=N(),d[b]=N),Array.isArray(N)&&(gu in N||ma in N||0<N.length&&typeof N[0]=="function")?N:void 0}function ff(d,b,N,$,B,V){b.P=d[0];var M=1;if(d.length>M&&typeof d[M]!="number"){var K=d[M++];N(b,K)}for(;M<d.length;){N=d[M++];for(var ee=M+1;ee<d.length&&typeof d[ee]!="number";)ee++;switch(K=d[M++],ee-=M,ee){case 0:$(b,N,K);break;case 1:(ee=pf(d,M))?(M++,B(b,N,K,ee)):$(b,N,K,d[M++]);break;case 2:ee=M++,ee=pf(d,ee),B(b,N,K,ee,d[M++]);break;case 3:V(b,N,K,d[M++],d[M++],d[M++]);break;case 4:V(b,N,K,d[M++],d[M++],d[M++],d[M++]);break;default:throw Error("unexpected number of binary field arguments: "+ee)}}return b}var Bl=Symbol();function mf(d){var b=d[Bl];if(!b){var N=Ml(d);b=function($,B){return Dh($,B,N)},d[Bl]=b}return b}function hf(d,b){var N=d[Bl];return N||(N=function($,B){return Fl($,B,b)},d[Bl]=N),N}var ma=Symbol();function Rh(d,b){d.push(b)}function wb(d,b,N){d.push(b,N.W)}function Tb(d,b,N,$){var B=mf($),V=Ml($).P,M=N.W;d.push(b,function(K,ee,he){return M(K,ee,he,V,B)})}function Sb(d,b,N,$,B,V){var M=hf($,V),K=N.W;d.push(b,function(ee,he,de){return K(ee,he,de,$,M)})}function Ml(d){var b=d[ma];return b||(b=ff(d,d[ma]=[],Rh,wb,Tb,Sb),gu in d&&ma in d&&(d.length=0),b)}var gu=Symbol();function Cb(d,b){d[0]=b}function Eb(d,b,N,$){var B=N.U;d[b]=$?function(V,M,K){return B(V,M,K,$)}:B}function Nb(d,b,N,$,B){var V=N.U,M=Ll($),K=gf($).P;d[b]=function(ee,he,de){return V(ee,he,de,K,M,B)}}function df(d,b,N,$,B,V,M){var K=N.U,ee=lf($,B,V);d[b]=function(he,de,He){return K(he,de,He,$,ee,M)}}function gf(d){var b=d[gu];return b||(b=ff(d,d[gu]={},Cb,Eb,Nb,df),gu in d&&ma in d&&(d.length=0),b)}function Oh(d,b,N){for(;Nh(b)&&b.i!=4;){var $=b.l,B=N[$];if(!B){var V=N[0];V&&(V=V[$])&&(B=N[$]=fa(V))}if(!B||!B(b,d,$)){B=b,$=d,V=B.j,kl(B);var M=B;if(!M.ca){if(B=M.h.h-V,M.h.h=V,M=M.h,B==0)B=lu();else{if(V=Sh(M,B),M.S&&M.m)B=M.i.subarray(V,V+B);else{M=M.i;var K=V;B=V+B,B=K===B?Nt():Ft?M.slice(K,B):new Uint8Array(M.subarray(K,B))}B=B.length==0?lu():new Cs(B,Ut)}(V=$.R)?V.push(B):$.R=[B]}}}return d}function Dh(d,b,N){for(var $=N.length,B=$%2==1,V=B?1:0;V<$;V+=2)(0,N[V+1])(b,d,N[V]);Fl(d,b,B?N[0]:void 0)}function xu(d,b){return{U:d,W:b}}var Ao=xu(function(d,b,N){if(d.i!==5)return!1;d=d.h;var $=d.i,B=d.h,V=$[B],M=$[B+1],K=$[B+2];return $=$[B+3],Xs(d,d.h+4),M=(V<<0|M<<8|K<<16|$<<24)>>>0,d=2*(M>>31)+1,V=M>>>23&255,M&=8388607,On(b,N,V==255?M?NaN:1/0*d:V==0?d*Math.pow(2,-149)*M:d*Math.pow(2,V-150)*(M+Math.pow(2,23))),!0},function(d,b,N){if(b=tf(b,N),b!=null){Ys(d.h,8*N+5),d=d.h;var $=+b;$===0?0<1/$?nt=At=0:(At=0,nt=2147483648):isNaN($)?(At=0,nt=2147483647):($=(N=0>$?-2147483648:0)?-$:$,34028234663852886e22<$?(At=0,nt=(N|2139095040)>>>0):11754943508222875e-54>$?($=Math.round($/Math.pow(2,-149)),At=0,nt=(N|$)>>>0):(b=Math.floor(Math.log($)/Math.LN2),$*=Math.pow(2,-b),$=Math.round(8388608*$),16777216<=$&&++b,At=0,nt=(N|b+127<<23|$&8388607)>>>0)),N=nt,d.h.push(N>>>0&255),d.h.push(N>>>8&255),d.h.push(N>>>16&255),d.h.push(N>>>24&255)}}),qt=xu(function(d,b,N){if(d.i!==0)return!1;var $=d.h,B=0,V=d=0,M=$.i,K=$.h;do{var ee=M[K++];B|=(ee&127)<<V,V+=7}while(32>V&&ee&128);for(32<V&&(d|=(ee&127)>>4),V=3;32>V&&ee&128;V+=7)ee=M[K++],d|=(ee&127)<<V;if(Xs($,K),128>ee)$=B>>>0,ee=d>>>0,(d=ee&2147483648)&&($=~$+1>>>0,ee=~ee>>>0,$==0&&(ee=ee+1>>>0)),$=4294967296*ee+($>>>0);else throw ln();return On(b,N,d?-$:$),!0},function(d,b,N){b=_o(b,N),b!=null&&(typeof b=="string"&&hr(b),b!=null&&(Ys(d.h,8*N),typeof b=="number"?(d=d.h,Pt(b),Eh(d,nt,At)):(N=hr(b),Eh(d.h,N.i,N.h))))}),Vt=xu(function(d,b,N){return d.i!==0?!1:(On(b,N,ca(d.h)),!0)},function(d,b,N){if(b=_o(b,N),b!=null&&b!=null)if(Ys(d.h,8*N),d=d.h,N=b,0<=N)Ys(d,N);else{for(b=0;9>b;b++)d.h.push(N&127|128),N>>=7;d.h.push(1)}}),Fh=xu(function(d,b,N){if(d.i!==2)return!1;var $=ca(d.h)>>>0;d=d.h;var B=Sh(d,$);if(d=d.i,Ts){var V=d,M;(M=Xo)||(M=Xo=new TextDecoder("utf-8",{fatal:!0})),d=B+$,V=B===0&&d===V.length?V:V.subarray(B,d);try{var K=M.decode(V)}catch(He){if(wn===void 0){try{M.decode(new Uint8Array([128]))}catch{}try{M.decode(new Uint8Array([97])),wn=!0}catch{wn=!1}}throw!wn&&(Xo=void 0),He}}else{K=B,$=K+$,B=[];for(var ee=null,he,de;K<$;)he=d[K++],128>he?B.push(he):224>he?K>=$?Vr():(de=d[K++],194>he||(de&192)!==128?(K--,Vr()):B.push((he&31)<<6|de&63)):240>he?K>=$-1?Vr():(de=d[K++],(de&192)!==128||he===224&&160>de||he===237&&160<=de||((V=d[K++])&192)!==128?(K--,Vr()):B.push((he&15)<<12|(de&63)<<6|V&63)):244>=he?K>=$-2?Vr():(de=d[K++],(de&192)!==128||(he<<28)+(de-144)>>30||((V=d[K++])&192)!==128||((M=d[K++])&192)!==128?(K--,Vr()):(he=(he&7)<<18|(de&63)<<12|(V&63)<<6|M&63,he-=65536,B.push((he>>10&1023)+55296,(he&1023)+56320))):Vr(),8192<=B.length&&(ee=pn(ee,B),B.length=0);K=pn(ee,B)}return On(b,N,K),!0},function(d,b,N){if(b=_o(b,N),b!=null){var $=!1;if($=$===void 0?!1:$,Tn){if($&&/(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])/.test(b))throw Error("Found an unpaired surrogate");b=(Ss||(Ss=new TextEncoder)).encode(b)}else{for(var B=0,V=new Uint8Array(3*b.length),M=0;M<b.length;M++){var K=b.charCodeAt(M);if(128>K)V[B++]=K;else{if(2048>K)V[B++]=K>>6|192;else{if(55296<=K&&57343>=K){if(56319>=K&&M<b.length){var ee=b.charCodeAt(++M);if(56320<=ee&&57343>=ee){K=1024*(K-55296)+ee-56320+65536,V[B++]=K>>18|240,V[B++]=K>>12&63|128,V[B++]=K>>6&63|128,V[B++]=K&63|128;continue}else M--}if($)throw Error("Found an unpaired surrogate");K=65533}V[B++]=K>>12|224,V[B++]=K>>6&63|128}V[B++]=K&63|128}}b=B===V.length?V:V.subarray(0,B)}Ys(d.h,8*N+2),Ys(d.h,b.length),Zs(d,d.h.end()),Zs(d,b)}}),Ph=xu(function(d,b,N,$,B){if(d.i!==2)return!1;b=Ah(b,N,$),N=d.h.j,$=ca(d.h)>>>0;var V=d.h.h+$,M=V-N;if(0>=M&&(d.h.j=V,B(b,d,void 0,void 0,void 0),M=V-d.h.h),M)throw Error("Message parsing ended unexpectedly. Expected to read "+($+" bytes, instead read "+($-M)+" bytes, either the data ended unexpectedly or the message misreported its own length"));return d.h.h=V,d.h.j=N,!0},function(d,b,N,$,B){if(b=hu(b,$,N),b!=null)for($=0;$<b.length;$++){var V=d;Ys(V.h,8*N+2);var M=V.h.end();Zs(V,M),M.push(V.i),V=M,B(b[$],d),M=d;var K=V.pop();for(K=M.i+M.h.length()-K;127<K;)V.push(K&127|128),K>>>=7,M.i++;V.push(K),M.i++}});function xf(d){return function(b,N){e:{if(pa.length){var $=pa.pop();$.setOptions(N),qp($.h,b,N),b=$}else b=new Xp(b,N);try{var B=gf(d),V=Oh(new B.P,b,B);break e}finally{B=b.h,B.i=null,B.m=!1,B.l=0,B.j=0,B.h=0,B.S=!1,b.l=-1,b.i=-1,100>pa.length&&pa.push(b)}V=void 0}return V}}function yf(d){return function(){var b=new xb;Dh(this,b,Ml(d)),Zs(b,b.h.end());for(var N=new Uint8Array(b.i),$=b.j,B=$.length,V=0,M=0;M<B;M++){var K=$[M];N.set(K,V),V+=K.length}return b.j=[N],N}}function ha(d){fn.call(this,d)}w(ha,fn);var Lh=[ha,1,Vt,2,Ao,3,Fh,4,Fh];ha.prototype.l=yf(Lh);function Ul(d){fn.call(this,d,-1,_b)}w(Ul,fn),Ul.prototype.addClassification=function(d,b){return Ah(this,1,ha,d,b),this};var _b=[1],Ar=xf([Ul,1,Ph,Lh]);function Qs(d){fn.call(this,d)}w(Qs,fn);var Js=[Qs,1,Ao,2,Ao,3,Ao,4,Ao,5,Ao];Qs.prototype.l=yf(Js);function bf(d){fn.call(this,d,-1,vf)}w(bf,fn);var vf=[1],Dn=xf([bf,1,Ph,Js]);function yu(d){fn.call(this,d)}w(yu,fn);var wf=[yu,1,Ao,2,Ao,3,Ao,4,Ao,5,Ao,6,qt],Bh=xf(wf);yu.prototype.l=yf(wf);function Tf(d,b,N){if(N=d.createShader(N===0?d.VERTEX_SHADER:d.FRAGMENT_SHADER),d.shaderSource(N,b),d.compileShader(N),!d.getShaderParameter(N,d.COMPILE_STATUS))throw Error(`Could not compile WebGL shader.

`+d.getShaderInfoLog(N));return N}function Sf(d){return hu(d,ha,1).map(function(b){var N=_o(b,1);return{index:N??0,score:Zo(b,2),label:_o(b,3)!=null?Rl(_o(b,3),""):void 0,displayName:_o(b,4)!=null?Rl(_o(b,4),""):void 0}})}function Cf(d){return{x:Zo(d,1),y:Zo(d,2),z:Zo(d,3),visibility:tf(d,4)!=null?Zo(d,4):void 0}}function Sn(d){return d.map(function(b){return hu(Dn(b),Qs,1).map(Cf)})}function Ef(d,b){this.i=d,this.h=b,this.m=0}function Fn(d,b,N){return Ib(d,b),typeof d.h.canvas.transferToImageBitmap=="function"?Promise.resolve(d.h.canvas.transferToImageBitmap()):N?Promise.resolve(d.h.canvas):typeof createImageBitmap=="function"?createImageBitmap(d.h.canvas):(d.j===void 0&&(d.j=document.createElement("canvas")),new Promise(function($){d.j.height=d.h.canvas.height,d.j.width=d.h.canvas.width,d.j.getContext("2d",{}).drawImage(d.h.canvas,0,0,d.h.canvas.width,d.h.canvas.height),$(d.j)}))}function Ib(d,b){var N=d.h;if(d.s===void 0){var $=Tf(N,`
  attribute vec2 aVertex;
  attribute vec2 aTex;
  varying vec2 vTex;
  void main(void) {
    gl_Position = vec4(aVertex, 0.0, 1.0);
    vTex = aTex;
  }`,0),B=Tf(N,`
  precision mediump float;
  varying vec2 vTex;
  uniform sampler2D sampler0;
  void main(){
    gl_FragColor = texture2D(sampler0, vTex);
  }`,1),V=N.createProgram();if(N.attachShader(V,$),N.attachShader(V,B),N.linkProgram(V),!N.getProgramParameter(V,N.LINK_STATUS))throw Error(`Could not compile WebGL program.

`+N.getProgramInfoLog(V));$=d.s=V,N.useProgram($),B=N.getUniformLocation($,"sampler0"),d.l={O:N.getAttribLocation($,"aVertex"),N:N.getAttribLocation($,"aTex"),xa:B},d.v=N.createBuffer(),N.bindBuffer(N.ARRAY_BUFFER,d.v),N.enableVertexAttribArray(d.l.O),N.vertexAttribPointer(d.l.O,2,N.FLOAT,!1,0,0),N.bufferData(N.ARRAY_BUFFER,new Float32Array([-1,-1,-1,1,1,1,1,-1]),N.STATIC_DRAW),N.bindBuffer(N.ARRAY_BUFFER,null),d.u=N.createBuffer(),N.bindBuffer(N.ARRAY_BUFFER,d.u),N.enableVertexAttribArray(d.l.N),N.vertexAttribPointer(d.l.N,2,N.FLOAT,!1,0,0),N.bufferData(N.ARRAY_BUFFER,new Float32Array([0,1,0,0,1,0,1,1]),N.STATIC_DRAW),N.bindBuffer(N.ARRAY_BUFFER,null),N.uniform1i(B,0)}$=d.l,N.useProgram(d.s),N.canvas.width=b.width,N.canvas.height=b.height,N.viewport(0,0,b.width,b.height),N.activeTexture(N.TEXTURE0),d.i.bindTexture2d(b.glName),N.enableVertexAttribArray($.O),N.bindBuffer(N.ARRAY_BUFFER,d.v),N.vertexAttribPointer($.O,2,N.FLOAT,!1,0,0),N.enableVertexAttribArray($.N),N.bindBuffer(N.ARRAY_BUFFER,d.u),N.vertexAttribPointer($.N,2,N.FLOAT,!1,0,0),N.bindFramebuffer(N.DRAW_FRAMEBUFFER?N.DRAW_FRAMEBUFFER:N.FRAMEBUFFER,null),N.clearColor(0,0,0,0),N.clear(N.COLOR_BUFFER_BIT),N.colorMask(!0,!0,!0,!0),N.drawArrays(N.TRIANGLE_FAN,0,4),N.disableVertexAttribArray($.O),N.disableVertexAttribArray($.N),N.bindBuffer(N.ARRAY_BUFFER,null),d.i.bindTexture2d(0)}function Mh(d){this.h=d}var ei=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,9,1,7,0,65,0,253,15,26,11]);function Vl(d,b){return b+d}function Gl(d,b){window[d]=b}function er(d){var b=document.createElement("script");return b.setAttribute("src",d),b.setAttribute("crossorigin","anonymous"),new Promise(function(N){b.addEventListener("load",function(){N()},!1),b.addEventListener("error",function(){N()},!1),document.body.appendChild(b)})}function ti(){return ae(function(d){switch(d.h){case 1:return d.s=2,P(d,WebAssembly.instantiate(ei),4);case 4:d.h=3,d.s=0;break;case 2:return d.s=0,d.l=null,d.return(!1);case 3:return d.return(!0)}})}function bu(d){if(this.h=d,this.listeners={},this.l={},this.L={},this.s={},this.v={},this.M=this.u=this.ga=!0,this.I=Promise.resolve(),this.fa="",this.D={},this.locateFile=d&&d.locateFile||Vl,typeof window=="object")var b=window.location.pathname.toString().substring(0,window.location.pathname.toString().lastIndexOf("/"))+"/";else if(typeof location<"u")b=location.pathname.toString().substring(0,location.pathname.toString().lastIndexOf("/"))+"/";else throw Error("solutions can only be loaded on a web page or in a web worker");if(this.ha=b,d.options){b=a(Object.keys(d.options));for(var N=b.next();!N.done;N=b.next()){N=N.value;var $=d.options[N].default;$!==void 0&&(this.l[N]=typeof $=="function"?$():$)}}}e=bu.prototype,e.close=function(){return this.j&&this.j.delete(),Promise.resolve()};function Ab(d){var b,N,$,B,V,M,K,ee,he,de,He;return ae(function(Oe){switch(Oe.h){case 1:return d.ga?(b=d.h.files===void 0?[]:typeof d.h.files=="function"?d.h.files(d.l):d.h.files,P(Oe,ti(),2)):Oe.return();case 2:if(N=Oe.i,typeof window=="object")return Gl("createMediapipeSolutionsWasm",{locateFile:d.locateFile}),Gl("createMediapipeSolutionsPackedAssets",{locateFile:d.locateFile}),M=b.filter(function(Ce){return Ce.data!==void 0}),K=b.filter(function(Ce){return Ce.data===void 0}),ee=Promise.all(M.map(function(Ce){var qe=Wl(d,Ce.url);if(Ce.path!==void 0){var at=Ce.path;qe=qe.then(function(jt){return d.overrideFile(at,jt),Promise.resolve(jt)})}return qe})),he=Promise.all(K.map(function(Ce){return Ce.simd===void 0||Ce.simd&&N||!Ce.simd&&!N?er(d.locateFile(Ce.url,d.ha)):Promise.resolve()})).then(function(){var Ce,qe,at;return ae(function(jt){if(jt.h==1)return Ce=window.createMediapipeSolutionsWasm,qe=window.createMediapipeSolutionsPackedAssets,at=d,P(jt,Ce(qe),2);at.i=jt.i,jt.h=0})}),de=function(){return ae(function(Ce){return d.h.graph&&d.h.graph.url?Ce=P(Ce,Wl(d,d.h.graph.url),0):(Ce.h=0,Ce=void 0),Ce})}(),P(Oe,Promise.all([he,ee,de]),7);if(typeof importScripts!="function")throw Error("solutions can only be loaded on a web page or in a web worker");return $=b.filter(function(Ce){return Ce.simd===void 0||Ce.simd&&N||!Ce.simd&&!N}).map(function(Ce){return d.locateFile(Ce.url,d.ha)}),importScripts.apply(null,u($)),B=d,P(Oe,createMediapipeSolutionsWasm(Module),6);case 6:B.i=Oe.i,d.m=new OffscreenCanvas(1,1),d.i.canvas=d.m,V=d.i.GL.createContext(d.m,{antialias:!1,alpha:!1,ua:typeof WebGL2RenderingContext<"u"?2:1}),d.i.GL.makeContextCurrent(V),Oe.h=4;break;case 7:if(d.m=document.createElement("canvas"),He=d.m.getContext("webgl2",{}),!He&&(He=d.m.getContext("webgl",{}),!He))return alert("Failed to create WebGL canvas context when passing video frame."),Oe.return();d.K=He,d.i.canvas=d.m,d.i.createContext(d.m,!0,!0,{});case 4:d.j=new d.i.SolutionWasm,d.ga=!1,Oe.h=0}})}function Nf(d){var b,N,$,B,V,M,K,ee;return ae(function(he){if(he.h==1){if(d.h.graph&&d.h.graph.url&&d.fa===d.h.graph.url)return he.return();if(d.u=!0,!d.h.graph||!d.h.graph.url){he.h=2;return}return d.fa=d.h.graph.url,P(he,Wl(d,d.h.graph.url),3)}for(he.h!=2&&(b=he.i,d.j.loadGraph(b)),N=a(Object.keys(d.D)),$=N.next();!$.done;$=N.next())B=$.value,d.j.overrideFile(B,d.D[B]);if(d.D={},d.h.listeners)for(V=a(d.h.listeners),M=V.next();!M.done;M=V.next())K=M.value,zl(d,K);ee=d.l,d.l={},d.setOptions(ee),he.h=0})}e.reset=function(){var d=this;return ae(function(b){d.j&&(d.j.reset(),d.s={},d.v={}),b.h=0})},e.setOptions=function(d,b){var N=this;if(b=b||this.h.options){for(var $=[],B=[],V={},M=a(Object.keys(d)),K=M.next();!K.done;V={X:V.X,Y:V.Y},K=M.next())if(K=K.value,!(K in this.l&&this.l[K]===d[K])){this.l[K]=d[K];var ee=b[K];ee!==void 0&&(ee.onChange&&(V.X=ee.onChange,V.Y=d[K],$.push(function(he){return function(){var de;return ae(function(He){if(He.h==1)return P(He,he.X(he.Y),2);de=He.i,de===!0&&(N.u=!0),He.h=0})}}(V))),ee.graphOptionXref&&(K=Object.assign({},{calculatorName:"",calculatorIndex:0},ee.graphOptionXref,{valueNumber:ee.type===1?d[K]:0,valueBoolean:ee.type===0?d[K]:!1,valueString:ee.type===2?d[K]:""}),B.push(K)))}($.length!==0||B.length!==0)&&(this.u=!0,this.H=(this.H===void 0?[]:this.H).concat(B),this.F=(this.F===void 0?[]:this.F).concat($))}};function kb(d){var b,N,$,B,V,M,K;return ae(function(ee){switch(ee.h){case 1:if(!d.u)return ee.return();if(!d.F){ee.h=2;break}b=a(d.F),N=b.next();case 3:if(N.done){ee.h=5;break}return $=N.value,P(ee,$(),4);case 4:N=b.next(),ee.h=3;break;case 5:d.F=void 0;case 2:if(d.H){for(B=new d.i.GraphOptionChangeRequestList,V=a(d.H),M=V.next();!M.done;M=V.next())K=M.value,B.push_back(K);d.j.changeOptions(B),B.delete(),d.H=void 0}d.u=!1,ee.h=0}})}e.initialize=function(){var d=this;return ae(function(b){return b.h==1?P(b,Ab(d),2):b.h!=3?P(b,Nf(d),3):P(b,kb(d),0)})};function Wl(d,b){var N,$;return ae(function(B){return b in d.L?B.return(d.L[b]):(N=d.locateFile(b,""),$=fetch(N).then(function(V){return V.arrayBuffer()}),d.L[b]=$,B.return($))})}e.overrideFile=function(d,b){this.j?this.j.overrideFile(d,b):this.D[d]=b},e.clearOverriddenFiles=function(){this.D={},this.j&&this.j.clearOverriddenFiles()},e.send=function(d,b){var N=this,$,B,V,M,K,ee,he,de,He;return ae(function(Oe){switch(Oe.h){case 1:return N.h.inputs?($=1e3*(b??performance.now()),P(Oe,N.I,2)):Oe.return();case 2:return P(Oe,N.initialize(),3);case 3:for(B=new N.i.PacketDataList,V=a(Object.keys(d)),M=V.next();!M.done;M=V.next())if(K=M.value,ee=N.h.inputs[K]){e:{var Ce=d[K];switch(ee.type){case"video":var qe=N.s[ee.stream];if(qe||(qe=new Ef(N.i,N.K),N.s[ee.stream]=qe),qe.m===0&&(qe.m=qe.i.createTexture()),typeof HTMLVideoElement<"u"&&Ce instanceof HTMLVideoElement)var at=Ce.videoWidth,jt=Ce.videoHeight;else typeof HTMLImageElement<"u"&&Ce instanceof HTMLImageElement?(at=Ce.naturalWidth,jt=Ce.naturalHeight):(at=Ce.width,jt=Ce.height);jt={glName:qe.m,width:at,height:jt},at=qe.h,at.canvas.width=jt.width,at.canvas.height=jt.height,at.activeTexture(at.TEXTURE0),qe.i.bindTexture2d(qe.m),at.texImage2D(at.TEXTURE_2D,0,at.RGBA,at.RGBA,at.UNSIGNED_BYTE,Ce),qe.i.bindTexture2d(0),qe=jt;break e;case"detections":for(qe=N.s[ee.stream],qe||(qe=new Mh(N.i),N.s[ee.stream]=qe),qe.data||(qe.data=new qe.h.DetectionListData),qe.data.reset(Ce.length),jt=0;jt<Ce.length;++jt){at=Ce[jt];var Gt=qe.data,Gr=Gt.setBoundingBox,ro=jt,kr=at.la,Tt=new yu;if(Io(Tt,1,kr.ra),Io(Tt,2,kr.sa),Io(Tt,3,kr.height),Io(Tt,4,kr.width),Io(Tt,5,kr.rotation),On(Tt,6,kr.pa),kr=Tt.l(),Gr.call(Gt,ro,kr),at.ea)for(Gt=0;Gt<at.ea.length;++Gt){Tt=at.ea[Gt],Gr=qe.data,ro=Gr.addNormalizedLandmark,kr=jt,Tt=Object.assign({},Tt,{visibility:Tt.visibility?Tt.visibility:0});var Wr=new Qs;Io(Wr,1,Tt.x),Io(Wr,2,Tt.y),Io(Wr,3,Tt.z),Tt.visibility&&Io(Wr,4,Tt.visibility),Tt=Wr.l(),ro.call(Gr,kr,Tt)}if(at.ba)for(Gt=0;Gt<at.ba.length;++Gt)Gr=qe.data,ro=Gr.addClassification,kr=jt,Tt=at.ba[Gt],Wr=new ha,Io(Wr,2,Tt.score),Tt.index&&On(Wr,1,Tt.index),Tt.label&&On(Wr,3,Tt.label),Tt.displayName&&On(Wr,4,Tt.displayName),Tt=Wr.l(),ro.call(Gr,kr,Tt)}qe=qe.data;break e;default:qe={}}}switch(he=qe,de=ee.stream,ee.type){case"video":B.pushTexture2d(Object.assign({},he,{stream:de,timestamp:$}));break;case"detections":He=he,He.stream=de,He.timestamp=$,B.pushDetectionList(He);break;default:throw Error("Unknown input config type: '"+ee.type+"'")}}return N.j.send(B),P(Oe,N.I,4);case 4:B.delete(),Oe.h=0}})};function $b(d,b,N){var $,B,V,M,K,ee,he,de,He,Oe,Ce,qe,at,jt;return ae(function(Gt){switch(Gt.h){case 1:if(!N)return Gt.return(b);for($={},B=0,V=a(Object.keys(N)),M=V.next();!M.done;M=V.next())K=M.value,ee=N[K],typeof ee!="string"&&ee.type==="texture"&&b[ee.stream]!==void 0&&++B;1<B&&(d.M=!1),he=a(Object.keys(N)),M=he.next();case 2:if(M.done){Gt.h=4;break}if(de=M.value,He=N[de],typeof He=="string")return at=$,jt=de,P(Gt,Uh(d,de,b[He]),14);if(Oe=b[He.stream],He.type==="detection_list"){if(Oe){for(var Gr=Oe.getRectList(),ro=Oe.getLandmarksList(),kr=Oe.getClassificationsList(),Tt=[],Wr=0;Wr<Gr.size();++Wr){var Qo=Bh(Gr.get(Wr)),Gh=Zo(Qo,1),ri=Zo(Qo,2),Hl=Zo(Qo,3),Rb=Zo(Qo,4),Ob=Zo(Qo,5,0),Kl=void 0;Kl=Kl===void 0?0:Kl,Qo={la:{ra:Gh,sa:ri,height:Hl,width:Rb,rotation:Ob,pa:Rl(_o(Qo,6),Kl)},ea:hu(Dn(ro.get(Wr)),Qs,1).map(Cf),ba:Sf(Ar(kr.get(Wr)))},Tt.push(Qo)}Gr=Tt}else Gr=[];$[de]=Gr,Gt.h=7;break}if(He.type==="proto_list"){if(Oe){for(Gr=Array(Oe.size()),ro=0;ro<Oe.size();ro++)Gr[ro]=Oe.get(ro);Oe.delete()}else Gr=[];$[de]=Gr,Gt.h=7;break}if(Oe===void 0){Gt.h=3;break}if(He.type==="float_list"){$[de]=Oe,Gt.h=7;break}if(He.type==="proto"){$[de]=Oe,Gt.h=7;break}if(He.type!=="texture")throw Error("Unknown output config type: '"+He.type+"'");return Ce=d.v[de],Ce||(Ce=new Ef(d.i,d.K),d.v[de]=Ce),P(Gt,Fn(Ce,Oe,d.M),13);case 13:qe=Gt.i,$[de]=qe;case 7:He.transform&&$[de]&&($[de]=He.transform($[de])),Gt.h=3;break;case 14:at[jt]=Gt.i;case 3:M=he.next(),Gt.h=2;break;case 4:return Gt.return($)}})}function Uh(d,b,N){var $;return ae(function(B){return typeof N=="number"||N instanceof Uint8Array||N instanceof d.i.Uint8BlobList?B.return(N):N instanceof d.i.Texture2dDataOut?($=d.v[b],$||($=new Ef(d.i,d.K),d.v[b]=$),B.return(Fn($,N,d.M))):B.return(void 0)})}function zl(d,b){for(var N=b.name||"$",$=[].concat(u(b.wants)),B=new d.i.StringList,V=a(b.wants),M=V.next();!M.done;M=V.next())B.push_back(M.value);V=d.i.PacketListener.implement({onResults:function(K){for(var ee={},he=0;he<b.wants.length;++he)ee[$[he]]=K.get(he);var de=d.listeners[N];de&&(d.I=$b(d,ee,b.outs).then(function(He){He=de(He);for(var Oe=0;Oe<b.wants.length;++Oe){var Ce=ee[$[Oe]];typeof Ce=="object"&&Ce.hasOwnProperty&&Ce.hasOwnProperty("delete")&&Ce.delete()}He&&(d.I=He)}))}}),d.j.attachMultiListener(B,V),B.delete()}e.onResults=function(d,b){this.listeners[b||"$"]=d},Re("Solution",bu),Re("OptionType",{BOOL:0,NUMBER:1,ta:2,0:"BOOL",1:"NUMBER",2:"STRING"});function Ai(d){return d===void 0&&(d=0),d===1?"hand_landmark_full.tflite":"hand_landmark_lite.tflite"}function Vh(d){var b=this;d=d||{},this.h=new bu({locateFile:d.locateFile,files:function(N){return[{url:"hands_solution_packed_assets_loader.js"},{simd:!1,url:"hands_solution_wasm_bin.js"},{simd:!0,url:"hands_solution_simd_wasm_bin.js"},{data:!0,url:Ai(N.modelComplexity)}]},graph:{url:"hands.binarypb"},inputs:{image:{type:"video",stream:"input_frames_gpu"}},listeners:[{wants:["multi_hand_landmarks","multi_hand_world_landmarks","image_transformed","multi_handedness"],outs:{image:"image_transformed",multiHandLandmarks:{type:"proto_list",stream:"multi_hand_landmarks",transform:Sn},multiHandWorldLandmarks:{type:"proto_list",stream:"multi_hand_world_landmarks",transform:Sn},multiHandedness:{type:"proto_list",stream:"multi_handedness",transform:function(N){return N.map(function($){return Sf(Ar($))[0]})}}}}],options:{useCpuInference:{type:0,graphOptionXref:{calculatorType:"InferenceCalculator",fieldName:"use_cpu_inference"},default:typeof window!="object"||window.navigator===void 0?!1:"iPad Simulator;iPhone Simulator;iPod Simulator;iPad;iPhone;iPod".split(";").includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document},selfieMode:{type:0,graphOptionXref:{calculatorType:"GlScalerCalculator",calculatorIndex:1,fieldName:"flip_horizontal"}},maxNumHands:{type:1,graphOptionXref:{calculatorType:"ConstantSidePacketCalculator",calculatorName:"ConstantSidePacketCalculator",fieldName:"int_value"}},modelComplexity:{type:1,graphOptionXref:{calculatorType:"ConstantSidePacketCalculator",calculatorName:"ConstantSidePacketCalculatorModelComplexity",fieldName:"int_value"},onChange:function(N){var $,B,V;return ae(function(M){return M.h==1?($=Ai(N),B="third_party/mediapipe/modules/hand_landmark/"+$,P(M,Wl(b.h,$),2)):(V=M.i,b.h.overrideFile(B,V),M.return(!0))})}},minDetectionConfidence:{type:1,graphOptionXref:{calculatorType:"TensorsToDetectionsCalculator",calculatorName:"handlandmarktrackinggpu__palmdetectiongpu__TensorsToDetectionsCalculator",fieldName:"min_score_thresh"}},minTrackingConfidence:{type:1,graphOptionXref:{calculatorType:"ThresholdingCalculator",calculatorName:"handlandmarktrackinggpu__handlandmarkgpu__ThresholdingCalculator",fieldName:"threshold"}}}})}e=Vh.prototype,e.close=function(){return this.h.close(),Promise.resolve()},e.onResults=function(d){this.h.onResults(d)},e.initialize=function(){var d=this;return ae(function(b){return P(b,d.h.initialize(),0)})},e.reset=function(){this.h.reset()},e.send=function(d){var b=this;return ae(function(N){return P(N,b.h.send(d),0)})},e.setOptions=function(d){this.h.setOptions(d)},Re("Hands",Vh),Re("HAND_CONNECTIONS",[[0,1],[1,2],[2,3],[3,4],[0,5],[5,6],[6,7],[7,8],[5,9],[9,10],[10,11],[11,12],[9,13],[13,14],[14,15],[15,16],[13,17],[0,17],[17,18],[18,19],[19,20]]),Re("VERSION","0.4.1675469240")}).call(b4)});var Y4=Mn((Wie,X4)=>{"use strict";X4.exports=nr;var hs=null;try{hs=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function nr(e,t,r){this.low=e|0,this.high=t|0,this.unsigned=!!r}nr.prototype.__isLong__;Object.defineProperty(nr.prototype,"__isLong__",{value:!0});function yo(e){return(e&&e.__isLong__)===!0}nr.isLong=yo;var U4={},V4={};function qu(e,t){var r,n,o;return t?(e>>>=0,(o=0<=e&&e<256)&&(n=V4[e],n)?n:(r=or(e,(e|0)<0?-1:0,!0),o&&(V4[e]=r),r)):(e|=0,(o=-128<=e&&e<128)&&(n=U4[e],n)?n:(r=or(e,e<0?-1:0,!1),o&&(U4[e]=r),r))}nr.fromInt=qu;function ds(e,t){if(isNaN(e))return t?Ku:gs;if(t){if(e<0)return Ku;if(e>=H4)return j4}else{if(e<=-W4)return xo;if(e+1>=W4)return q4}return e<0?ds(-e,t).neg():or(e%up|0,e/up|0,t)}nr.fromNumber=ds;function or(e,t,r){return new nr(e,t,r)}nr.fromBits=or;var W1=Math.pow;function ET(e,t,r){if(e.length===0)throw Error("empty string");if(e==="NaN"||e==="Infinity"||e==="+Infinity"||e==="-Infinity")return gs;if(typeof t=="number"?(r=t,t=!1):t=!!t,r=r||10,r<2||36<r)throw RangeError("radix");var n;if((n=e.indexOf("-"))>0)throw Error("interior hyphen");if(n===0)return ET(e.substring(1),t,r).neg();for(var o=ds(W1(r,8)),s=gs,i=0;i<e.length;i+=8){var a=Math.min(8,e.length-i),u=parseInt(e.substring(i,i+a),r);if(a<8){var c=ds(W1(r,a));s=s.mul(c).add(ds(u))}else s=s.mul(o),s=s.add(ds(u))}return s.unsigned=t,s}nr.fromString=ET;function Ls(e,t){return typeof e=="number"?ds(e,t):typeof e=="string"?ET(e,t):or(e.low,e.high,typeof t=="boolean"?t:e.unsigned)}nr.fromValue=Ls;var G4=65536,WW=1<<24,up=G4*G4,H4=up*up,W4=H4/2,z4=qu(WW),gs=qu(0);nr.ZERO=gs;var Ku=qu(0,!0);nr.UZERO=Ku;var ap=qu(1);nr.ONE=ap;var K4=qu(1,!0);nr.UONE=K4;var CT=qu(-1);nr.NEG_ONE=CT;var q4=or(-1,2147483647,!1);nr.MAX_VALUE=q4;var j4=or(-1,-1,!0);nr.MAX_UNSIGNED_VALUE=j4;var xo=or(0,-2147483648,!1);nr.MIN_VALUE=xo;var be=nr.prototype;be.toInt=function(){return this.unsigned?this.low>>>0:this.low};be.toNumber=function(){return this.unsigned?(this.high>>>0)*up+(this.low>>>0):this.high*up+(this.low>>>0)};be.toString=function(t){if(t=t||10,t<2||36<t)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(xo)){var r=ds(t),n=this.div(r),o=n.mul(r).sub(this);return n.toString(t)+o.toInt().toString(t)}else return"-"+this.neg().toString(t);for(var s=ds(W1(t,6),this.unsigned),i=this,a="";;){var u=i.div(s),c=i.sub(u.mul(s)).toInt()>>>0,p=c.toString(t);if(i=u,i.isZero())return p+a;for(;p.length<6;)p="0"+p;a=""+p+a}};be.getHighBits=function(){return this.high};be.getHighBitsUnsigned=function(){return this.high>>>0};be.getLowBits=function(){return this.low};be.getLowBitsUnsigned=function(){return this.low>>>0};be.getNumBitsAbs=function(){if(this.isNegative())return this.eq(xo)?64:this.neg().getNumBitsAbs();for(var t=this.high!=0?this.high:this.low,r=31;r>0&&!(t&1<<r);r--);return this.high!=0?r+33:r+1};be.isZero=function(){return this.high===0&&this.low===0};be.eqz=be.isZero;be.isNegative=function(){return!this.unsigned&&this.high<0};be.isPositive=function(){return this.unsigned||this.high>=0};be.isOdd=function(){return(this.low&1)===1};be.isEven=function(){return(this.low&1)===0};be.equals=function(t){return yo(t)||(t=Ls(t)),this.unsigned!==t.unsigned&&this.high>>>31===1&&t.high>>>31===1?!1:this.high===t.high&&this.low===t.low};be.eq=be.equals;be.notEquals=function(t){return!this.eq(t)};be.neq=be.notEquals;be.ne=be.notEquals;be.lessThan=function(t){return this.comp(t)<0};be.lt=be.lessThan;be.lessThanOrEqual=function(t){return this.comp(t)<=0};be.lte=be.lessThanOrEqual;be.le=be.lessThanOrEqual;be.greaterThan=function(t){return this.comp(t)>0};be.gt=be.greaterThan;be.greaterThanOrEqual=function(t){return this.comp(t)>=0};be.gte=be.greaterThanOrEqual;be.ge=be.greaterThanOrEqual;be.compare=function(t){if(yo(t)||(t=Ls(t)),this.eq(t))return 0;var r=this.isNegative(),n=t.isNegative();return r&&!n?-1:!r&&n?1:this.unsigned?t.high>>>0>this.high>>>0||t.high===this.high&&t.low>>>0>this.low>>>0?-1:1:this.sub(t).isNegative()?-1:1};be.comp=be.compare;be.negate=function(){return!this.unsigned&&this.eq(xo)?xo:this.not().add(ap)};be.neg=be.negate;be.add=function(t){yo(t)||(t=Ls(t));var r=this.high>>>16,n=this.high&65535,o=this.low>>>16,s=this.low&65535,i=t.high>>>16,a=t.high&65535,u=t.low>>>16,c=t.low&65535,p=0,m=0,h=0,x=0;return x+=s+c,h+=x>>>16,x&=65535,h+=o+u,m+=h>>>16,h&=65535,m+=n+a,p+=m>>>16,m&=65535,p+=r+i,p&=65535,or(h<<16|x,p<<16|m,this.unsigned)};be.subtract=function(t){return yo(t)||(t=Ls(t)),this.add(t.neg())};be.sub=be.subtract;be.multiply=function(t){if(this.isZero())return gs;if(yo(t)||(t=Ls(t)),hs){var r=hs.mul(this.low,this.high,t.low,t.high);return or(r,hs.get_high(),this.unsigned)}if(t.isZero())return gs;if(this.eq(xo))return t.isOdd()?xo:gs;if(t.eq(xo))return this.isOdd()?xo:gs;if(this.isNegative())return t.isNegative()?this.neg().mul(t.neg()):this.neg().mul(t).neg();if(t.isNegative())return this.mul(t.neg()).neg();if(this.lt(z4)&&t.lt(z4))return ds(this.toNumber()*t.toNumber(),this.unsigned);var n=this.high>>>16,o=this.high&65535,s=this.low>>>16,i=this.low&65535,a=t.high>>>16,u=t.high&65535,c=t.low>>>16,p=t.low&65535,m=0,h=0,x=0,y=0;return y+=i*p,x+=y>>>16,y&=65535,x+=s*p,h+=x>>>16,x&=65535,x+=i*c,h+=x>>>16,x&=65535,h+=o*p,m+=h>>>16,h&=65535,h+=s*c,m+=h>>>16,h&=65535,h+=i*u,m+=h>>>16,h&=65535,m+=n*p+o*c+s*u+i*a,m&=65535,or(x<<16|y,m<<16|h,this.unsigned)};be.mul=be.multiply;be.divide=function(t){if(yo(t)||(t=Ls(t)),t.isZero())throw Error("division by zero");if(hs){if(!this.unsigned&&this.high===-2147483648&&t.low===-1&&t.high===-1)return this;var r=(this.unsigned?hs.div_u:hs.div_s)(this.low,this.high,t.low,t.high);return or(r,hs.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?Ku:gs;var n,o,s;if(this.unsigned){if(t.unsigned||(t=t.toUnsigned()),t.gt(this))return Ku;if(t.gt(this.shru(1)))return K4;s=Ku}else{if(this.eq(xo)){if(t.eq(ap)||t.eq(CT))return xo;if(t.eq(xo))return ap;var i=this.shr(1);return n=i.div(t).shl(1),n.eq(gs)?t.isNegative()?ap:CT:(o=this.sub(t.mul(n)),s=n.add(o.div(t)),s)}else if(t.eq(xo))return this.unsigned?Ku:gs;if(this.isNegative())return t.isNegative()?this.neg().div(t.neg()):this.neg().div(t).neg();if(t.isNegative())return this.div(t.neg()).neg();s=gs}for(o=this;o.gte(t);){n=Math.max(1,Math.floor(o.toNumber()/t.toNumber()));for(var a=Math.ceil(Math.log(n)/Math.LN2),u=a<=48?1:W1(2,a-48),c=ds(n),p=c.mul(t);p.isNegative()||p.gt(o);)n-=u,c=ds(n,this.unsigned),p=c.mul(t);c.isZero()&&(c=ap),s=s.add(c),o=o.sub(p)}return s};be.div=be.divide;be.modulo=function(t){if(yo(t)||(t=Ls(t)),hs){var r=(this.unsigned?hs.rem_u:hs.rem_s)(this.low,this.high,t.low,t.high);return or(r,hs.get_high(),this.unsigned)}return this.sub(this.div(t).mul(t))};be.mod=be.modulo;be.rem=be.modulo;be.not=function(){return or(~this.low,~this.high,this.unsigned)};be.and=function(t){return yo(t)||(t=Ls(t)),or(this.low&t.low,this.high&t.high,this.unsigned)};be.or=function(t){return yo(t)||(t=Ls(t)),or(this.low|t.low,this.high|t.high,this.unsigned)};be.xor=function(t){return yo(t)||(t=Ls(t)),or(this.low^t.low,this.high^t.high,this.unsigned)};be.shiftLeft=function(t){return yo(t)&&(t=t.toInt()),(t&=63)===0?this:t<32?or(this.low<<t,this.high<<t|this.low>>>32-t,this.unsigned):or(0,this.low<<t-32,this.unsigned)};be.shl=be.shiftLeft;be.shiftRight=function(t){return yo(t)&&(t=t.toInt()),(t&=63)===0?this:t<32?or(this.low>>>t|this.high<<32-t,this.high>>t,this.unsigned):or(this.high>>t-32,this.high>=0?0:-1,this.unsigned)};be.shr=be.shiftRight;be.shiftRightUnsigned=function(t){if(yo(t)&&(t=t.toInt()),t&=63,t===0)return this;var r=this.high;if(t<32){var n=this.low;return or(n>>>t|r<<32-t,r>>>t,this.unsigned)}else return t===32?or(r,0,this.unsigned):or(r>>>t-32,0,this.unsigned)};be.shru=be.shiftRightUnsigned;be.shr_u=be.shiftRightUnsigned;be.toSigned=function(){return this.unsigned?or(this.low,this.high,!1):this};be.toUnsigned=function(){return this.unsigned?this:or(this.low,this.high,!0)};be.toBytes=function(t){return t?this.toBytesLE():this.toBytesBE()};be.toBytesLE=function(){var t=this.high,r=this.low;return[r&255,r>>>8&255,r>>>16&255,r>>>24,t&255,t>>>8&255,t>>>16&255,t>>>24]};be.toBytesBE=function(){var t=this.high,r=this.low;return[t>>>24,t>>>16&255,t>>>8&255,t&255,r>>>24,r>>>16&255,r>>>8&255,r&255]};nr.fromBytes=function(t,r,n){return n?nr.fromBytesLE(t,r):nr.fromBytesBE(t,r)};nr.fromBytesLE=function(t,r){return new nr(t[0]|t[1]<<8|t[2]<<16|t[3]<<24,t[4]|t[5]<<8|t[6]<<16|t[7]<<24,r)};nr.fromBytesBE=function(t,r){return new nr(t[4]<<24|t[5]<<16|t[6]<<8|t[7],t[0]<<24|t[1]<<16|t[2]<<8|t[3],r)}});var GA=Mn((gp,VA)=>{"use strict";var Iz=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},rl=Iz();VA.exports=gp=rl.fetch;rl.fetch&&(gp.default=rl.fetch.bind(rl));gp.Headers=rl.Headers;gp.Request=rl.Request;gp.Response=rl.Response});var WA=Mn(()=>{"use strict"});var x$=Mn((g$,XT)=>{"use strict";(function(e,t,r){function n(a){var u=this,c=i();u.next=function(){var p=2091639*u.s0+u.c*23283064365386963e-26;return u.s0=u.s1,u.s1=u.s2,u.s2=p-(u.c=p|0)},u.c=1,u.s0=c(" "),u.s1=c(" "),u.s2=c(" "),u.s0-=c(a),u.s0<0&&(u.s0+=1),u.s1-=c(a),u.s1<0&&(u.s1+=1),u.s2-=c(a),u.s2<0&&(u.s2+=1),c=null}function o(a,u){return u.c=a.c,u.s0=a.s0,u.s1=a.s1,u.s2=a.s2,u}function s(a,u){var c=new n(a),p=u&&u.state,m=c.next;return m.int32=function(){return c.next()*4294967296|0},m.double=function(){return m()+(m()*2097152|0)*11102230246251565e-32},m.quick=m,p&&(typeof p=="object"&&o(p,c),m.state=function(){return o(c,{})}),m}function i(){var a=4022871197,u=function(c){c=String(c);for(var p=0;p<c.length;p++){a+=c.charCodeAt(p);var m=.02519603282416938*a;a=m>>>0,m-=a,m*=a,a=m>>>0,m-=a,a+=m*4294967296}return(a>>>0)*23283064365386963e-26};return u}t&&t.exports?t.exports=s:r&&r.amd?r(function(){return s}):this.alea=s})(g$,typeof XT=="object"&&XT,typeof define=="function"&&define)});var b$=Mn((y$,YT)=>{"use strict";(function(e,t,r){function n(i){var a=this,u="";a.x=0,a.y=0,a.z=0,a.w=0,a.next=function(){var p=a.x^a.x<<11;return a.x=a.y,a.y=a.z,a.z=a.w,a.w^=a.w>>>19^p^p>>>8},i===(i|0)?a.x=i:u+=i;for(var c=0;c<u.length+64;c++)a.x^=u.charCodeAt(c)|0,a.next()}function o(i,a){return a.x=i.x,a.y=i.y,a.z=i.z,a.w=i.w,a}function s(i,a){var u=new n(i),c=a&&a.state,p=function(){return(u.next()>>>0)/4294967296};return p.double=function(){do var m=u.next()>>>11,h=(u.next()>>>0)/4294967296,x=(m+h)/(1<<21);while(x===0);return x},p.int32=u.next,p.quick=p,c&&(typeof c=="object"&&o(c,u),p.state=function(){return o(u,{})}),p}t&&t.exports?t.exports=s:r&&r.amd?r(function(){return s}):this.xor128=s})(y$,typeof YT=="object"&&YT,typeof define=="function"&&define)});var w$=Mn((v$,ZT)=>{"use strict";(function(e,t,r){function n(i){var a=this,u="";a.next=function(){var p=a.x^a.x>>>2;return a.x=a.y,a.y=a.z,a.z=a.w,a.w=a.v,(a.d=a.d+362437|0)+(a.v=a.v^a.v<<4^(p^p<<1))|0},a.x=0,a.y=0,a.z=0,a.w=0,a.v=0,i===(i|0)?a.x=i:u+=i;for(var c=0;c<u.length+64;c++)a.x^=u.charCodeAt(c)|0,c==u.length&&(a.d=a.x<<10^a.x>>>4),a.next()}function o(i,a){return a.x=i.x,a.y=i.y,a.z=i.z,a.w=i.w,a.v=i.v,a.d=i.d,a}function s(i,a){var u=new n(i),c=a&&a.state,p=function(){return(u.next()>>>0)/4294967296};return p.double=function(){do var m=u.next()>>>11,h=(u.next()>>>0)/4294967296,x=(m+h)/(1<<21);while(x===0);return x},p.int32=u.next,p.quick=p,c&&(typeof c=="object"&&o(c,u),p.state=function(){return o(u,{})}),p}t&&t.exports?t.exports=s:r&&r.amd?r(function(){return s}):this.xorwow=s})(v$,typeof ZT=="object"&&ZT,typeof define=="function"&&define)});var S$=Mn((T$,QT)=>{"use strict";(function(e,t,r){function n(i){var a=this;a.next=function(){var c=a.x,p=a.i,m,h,x;return m=c[p],m^=m>>>7,h=m^m<<24,m=c[p+1&7],h^=m^m>>>10,m=c[p+3&7],h^=m^m>>>3,m=c[p+4&7],h^=m^m<<7,m=c[p+7&7],m=m^m<<13,h^=m^m<<9,c[p]=h,a.i=p+1&7,h};function u(c,p){var m,h,x=[];if(p===(p|0))h=x[0]=p;else for(p=""+p,m=0;m<p.length;++m)x[m&7]=x[m&7]<<15^p.charCodeAt(m)+x[m+1&7]<<13;for(;x.length<8;)x.push(0);for(m=0;m<8&&x[m]===0;++m);for(m==8?h=x[7]=-1:h=x[m],c.x=x,c.i=0,m=256;m>0;--m)c.next()}u(a,i)}function o(i,a){return a.x=i.x.slice(),a.i=i.i,a}function s(i,a){i==null&&(i=+new Date);var u=new n(i),c=a&&a.state,p=function(){return(u.next()>>>0)/4294967296};return p.double=function(){do var m=u.next()>>>11,h=(u.next()>>>0)/4294967296,x=(m+h)/(1<<21);while(x===0);return x},p.int32=u.next,p.quick=p,c&&(c.x&&o(c,u),p.state=function(){return o(u,{})}),p}t&&t.exports?t.exports=s:r&&r.amd?r(function(){return s}):this.xorshift7=s})(T$,typeof QT=="object"&&QT,typeof define=="function"&&define)});var E$=Mn((C$,JT)=>{"use strict";(function(e,t,r){function n(i){var a=this;a.next=function(){var c=a.w,p=a.X,m=a.i,h,x;return a.w=c=c+1640531527|0,x=p[m+34&127],h=p[m=m+1&127],x^=x<<13,h^=h<<17,x^=x>>>15,h^=h>>>12,x=p[m]=x^h,a.i=m,x+(c^c>>>16)|0};function u(c,p){var m,h,x,y,v,w=[],C=128;for(p===(p|0)?(h=p,p=null):(p=p+"\0",h=0,C=Math.max(C,p.length)),x=0,y=-32;y<C;++y)p&&(h^=p.charCodeAt((y+32)%p.length)),y===0&&(v=h),h^=h<<10,h^=h>>>15,h^=h<<4,h^=h>>>13,y>=0&&(v=v+1640531527|0,m=w[y&127]^=h+v,x=m==0?x+1:0);for(x>=128&&(w[(p&&p.length||0)&127]=-1),x=127,y=4*128;y>0;--y)h=w[x+34&127],m=w[x=x+1&127],h^=h<<13,m^=m<<17,h^=h>>>15,m^=m>>>12,w[x]=h^m;c.w=v,c.X=w,c.i=x}u(a,i)}function o(i,a){return a.i=i.i,a.w=i.w,a.X=i.X.slice(),a}function s(i,a){i==null&&(i=+new Date);var u=new n(i),c=a&&a.state,p=function(){return(u.next()>>>0)/4294967296};return p.double=function(){do var m=u.next()>>>11,h=(u.next()>>>0)/4294967296,x=(m+h)/(1<<21);while(x===0);return x},p.int32=u.next,p.quick=p,c&&(c.X&&o(c,u),p.state=function(){return o(u,{})}),p}t&&t.exports?t.exports=s:r&&r.amd?r(function(){return s}):this.xor4096=s})(C$,typeof JT=="object"&&JT,typeof define=="function"&&define)});var _$=Mn((N$,eS)=>{"use strict";(function(e,t,r){function n(i){var a=this,u="";a.next=function(){var p=a.b,m=a.c,h=a.d,x=a.a;return p=p<<25^p>>>7^m,m=m-h|0,h=h<<24^h>>>8^x,x=x-p|0,a.b=p=p<<20^p>>>12^m,a.c=m=m-h|0,a.d=h<<16^m>>>16^x,a.a=x-p|0},a.a=0,a.b=0,a.c=-1640531527,a.d=1367130551,i===Math.floor(i)?(a.a=i/4294967296|0,a.b=i|0):u+=i;for(var c=0;c<u.length+20;c++)a.b^=u.charCodeAt(c)|0,a.next()}function o(i,a){return a.a=i.a,a.b=i.b,a.c=i.c,a.d=i.d,a}function s(i,a){var u=new n(i),c=a&&a.state,p=function(){return(u.next()>>>0)/4294967296};return p.double=function(){do var m=u.next()>>>11,h=(u.next()>>>0)/4294967296,x=(m+h)/(1<<21);while(x===0);return x},p.int32=u.next,p.quick=p,c&&(typeof c=="object"&&o(c,u),p.state=function(){return o(u,{})}),p}t&&t.exports?t.exports=s:r&&r.amd?r(function(){return s}):this.tychei=s})(N$,typeof eS=="object"&&eS,typeof define=="function"&&define)});var I$=Mn(()=>{"use strict"});var k$=Mn((A$,A0)=>{"use strict";(function(e,t,r){var n=256,o=6,s=52,i="random",a=r.pow(n,o),u=r.pow(2,s),c=u*2,p=n-1,m;function h(D,P,G){var q=[];P=P==!0?{entropy:!0}:P||{};var Z=w(v(P.entropy?[D,I(t)]:D??C(),3),q),Y=new x(q),te=function(){for(var J=Y.g(o),ae=a,ge=0;J<u;)J=(J+ge)*n,ae*=n,ge=Y.g(1);for(;J>=c;)J/=2,ae/=2,ge>>>=1;return(J+ge)/ae};return te.int32=function(){return Y.g(4)|0},te.quick=function(){return Y.g(4)/4294967296},te.double=te,w(I(Y.S),t),(P.pass||G||function(J,ae,ge,ke){return ke&&(ke.S&&y(ke,Y),J.state=function(){return y(Y,{})}),ge?(r[i]=J,ae):J})(te,Z,"global"in P?P.global:this==r,P.state)}function x(D){var P,G=D.length,q=this,Z=0,Y=q.i=q.j=0,te=q.S=[];for(G||(D=[G++]);Z<n;)te[Z]=Z++;for(Z=0;Z<n;Z++)te[Z]=te[Y=p&Y+D[Z%G]+(P=te[Z])],te[Y]=P;(q.g=function(J){for(var ae,ge=0,ke=q.i,We=q.j,Re=q.S;J--;)ae=Re[ke=p&ke+1],ge=ge*n+Re[p&(Re[ke]=Re[We=p&We+ae])+(Re[We]=ae)];return q.i=ke,q.j=We,ge})(n)}function y(D,P){return P.i=D.i,P.j=D.j,P.S=D.S.slice(),P}function v(D,P){var G=[],q=typeof D,Z;if(P&&q=="object")for(Z in D)try{G.push(v(D[Z],P-1))}catch{}return G.length?G:q=="string"?D:D+"\0"}function w(D,P){for(var G=D+"",q,Z=0;Z<G.length;)P[p&Z]=p&(q^=P[p&Z]*19)+G.charCodeAt(Z++);return I(P)}function C(){try{var D;return m&&(D=m.randomBytes)?D=D(n):(D=new Uint8Array(n),(e.crypto||e.msCrypto).getRandomValues(D)),I(D)}catch{var P=e.navigator,G=P&&P.plugins;return[+new Date,e,G,e.screen,I(t)]}}function I(D){return String.fromCharCode.apply(0,D)}if(w(r.random(),t),typeof A0=="object"&&A0.exports){A0.exports=h;try{m=I$()}catch{}}else typeof define=="function"&&define.amd?define(function(){return h}):r["seed"+i]=h})(typeof self<"u"?self:A$,[],Math)});var R$=Mn((kve,$$)=>{"use strict";var xq=x$(),yq=b$(),bq=w$(),vq=S$(),wq=E$(),Tq=_$(),cl=k$();cl.alea=xq;cl.xor128=yq;cl.xorwow=bq;cl.xorshift7=vq;cl.xor4096=wq;cl.tychei=Tq;$$.exports=cl});var Au=class e{static ANCHOR_POINTS=[[0,0,0],[0,.1,0],[-.1,0,0],[-.1,-.1,0]];static fingerLookupIndices={thumb:[0,1,2,3,4],indexFinger:[0,5,6,7,8],middleFinger:[0,9,10,11,12],ringFinger:[0,13,14,15,16],pinky:[0,17,18,19,20]};static connections=[[0,1],[1,2],[2,3],[3,4],[0,5],[5,6],[6,7],[7,8],[0,9],[9,10],[10,11],[11,12],[0,13],[13,14],[14,15],[15,16],[0,17],[17,18],[18,19],[19,20]];static isHandSimilar(t,r,n=.005){if(t.handedness!==r.handedness)return!1;let o=e.calculateKeyPointsDifference(t.keypoints3D??[],r.keypoints3D??[]);return console.log("MAE",o),o<n}static calculateKeyPointsDifference(t,r){let n=[];return t.forEach((s,i)=>{n.push(this.calculatePointDIfference(s,r[i]))}),this.removeOutliers(n),n.reduce((s,i)=>s+i,0)/n.length}static calculatePointDIfference(t,r){let n=t.x&&r.x?Math.abs(t.x-r.x):0,o=t.y&&r.y?Math.abs(t.y-r.y):0,s=t.z&&r.z?Math.abs(t.z-r.z):0;return(n+o+s)/3}static removeOutliers(t){let r=t.indexOf(Math.max(...t));t.splice(r,1);let n=t.indexOf(Math.min(...t));t.splice(n,1)}static convertHandLandmarkResultToHand(t,r,n,o=!0){let s=[],{handedness:i,landmarks:a,worldLandmarks:u}=t,c=i.find(m=>m?.[0]?.categoryName==="Left"),p=i.find(m=>m?.[0]?.categoryName==="Right");if(c?.length){let m=c[0],h=m.index<t.landmarks.length?m.index:t.landmarks.length-1;s.push(this.convertHandnessToHand(m,t.landmarks[h],r,n,o))}if(p?.length){let m=p[0],h=m.index<t.landmarks.length?m.index:t.landmarks.length-1;s.push(this.convertHandnessToHand(m,t.landmarks[h],r,n,o))}return s}static convertHandnessToHand(t,r,n,o,s=!0){let i=s?r.map(u=>({x:(1-u.x)*n,y:u.y*o})):r.map(u=>({x:u.x*n,y:u.y*o})),a=s?r.map(u=>nc(Ta({},u),{x:1-u.x,y:u.y})):r;return{handedness:t.categoryName,score:t.score,keypoints:i,keypoints3D:a}}static drawHandLandmarks(t,r,n=!1){let o=t.getContext("2d");if(!o)return;let{width:s,height:i}=t;for(let u=0;u<r.length;u++){let c=n?r[u].x*s:r[u].x,p=n?r[u].y*i:r[u].y;this.drawPoint(o,c,p,2,"#ff0000")}let a=Object.keys(e.fingerLookupIndices);for(let u=0;u<a.length;u++){let c=a[u],p=e.fingerLookupIndices[c].map(m=>r[m]);this.drawPath(t,p,!1,"#0014dc",n)}}static drawPoint(t,r,n,o,s){t.beginPath(),t.arc(r,n,o,0,2*Math.PI),t.fillStyle=s,t.fill()}static drawPath(t,r,n,o,s=!1){let i=t.getContext("2d");if(!i)return;i.strokeStyle=o||"#000000";let a=new Path2D,{width:u,height:c}=t,p=s?r[0].x*u:r[0].x,m=s?r[0].y*c:r[0].y;a.moveTo(p,m);for(let h=1;h<r.length;h++){let{x,y}=r[h];x=s?x*u:x,y=s?y*c:y,a.lineTo(x,y)}n&&a.closePath(),i.stroke(a)}static isContinuousGesture(t,r){if(t?.length!==r?.length)return!1;let n=!0;for(let o=0;o<t.length;o++)n&&=t[o].handedness===r[o].handedness,n&&=!!t[o].handpose,n&&=t[o].handpose===r[o].handpose;return n}static getMove3DVector(t,r){let n=t.keypoints3D?.[4],o=r.keypoints3D?.[4];if(!n||!o)return[0,0,0];let s=(o?.x||0)-(n?.x||0),i=(o?.y||0)-(n?.y||0),a=(o?.z||0)-(n?.z||0);return console.log(s,i,a),[s,i,a]}static getMove2DVector(t,r){let n=t.keypoints[4],o=r.keypoints[4],s=o.x-n.x,i=o.y-n.y;return[s,i]}};var FM=ks(u3()),PM=ks(Ca());var ao=ks(Ca());var ac=new ao.GestureDescription("point_to_other");for(let e of[ao.Finger.Thumb,ao.Finger.Middle,ao.Finger.Ring,ao.Finger.Pinky])ac.addCurl(e,ao.FingerCurl.FullCurl,1),ac.addCurl(e,ao.FingerCurl.HalfCurl,1);ac.addCurl(ao.Finger.Thumb,ao.FingerCurl.NoCurl,1);ac.addCurl(ao.Finger.Index,ao.FingerCurl.NoCurl,1);var hn=ks(Ca());var Ea=new hn.GestureDescription("thumbs_up");Ea.addCurl(hn.Finger.Thumb,hn.FingerCurl.NoCurl,1);Ea.addDirection(hn.Finger.Thumb,hn.FingerDirection.VerticalUp,1);Ea.addCurl(hn.Finger.Index,hn.FingerCurl.FullCurl,1);Ea.addCurl(hn.Finger.Middle,hn.FingerCurl.FullCurl,1);Ea.addCurl(hn.Finger.Ring,hn.FingerCurl.FullCurl,1);Ea.addCurl(hn.Finger.Pinky,hn.FingerCurl.FullCurl,1);var Or=ks(Ca());var ai=new Or.GestureDescription("half_thumb_up");ai.addCurl(Or.Finger.Thumb,Or.FingerCurl.NoCurl,.1);ai.addCurl(Or.Finger.Thumb,Or.FingerCurl.HalfCurl,1);ai.addCurl(Or.Finger.Thumb,Or.FingerCurl.FullCurl,1);ai.addDirection(Or.Finger.Thumb,Or.FingerDirection.VerticalUp,1);ai.addCurl(Or.Finger.Index,Or.FingerCurl.FullCurl,1);ai.addCurl(Or.Finger.Middle,Or.FingerCurl.FullCurl,1);ai.addCurl(Or.Finger.Ring,Or.FingerCurl.FullCurl,1);ai.addCurl(Or.Finger.Pinky,Or.FingerCurl.FullCurl,1);var tn=ks(Ca());var Mi=new tn.GestureDescription("two_fingers");Mi.addCurl(tn.Finger.Thumb,tn.FingerCurl.NoCurl,.7);Mi.addCurl(tn.Finger.Thumb,tn.FingerCurl.HalfCurl,.7);Mi.addCurl(tn.Finger.Thumb,tn.FingerCurl.FullCurl,.2);Mi.addCurl(tn.Finger.Index,tn.FingerCurl.NoCurl,1);Mi.addCurl(tn.Finger.Middle,tn.FingerCurl.NoCurl,1);Mi.addCurl(tn.Finger.Ring,tn.FingerCurl.FullCurl,1);Mi.addCurl(tn.Finger.Pinky,tn.FingerCurl.FullCurl,1);var Do=ks(Ca());var Xf=new Do.GestureDescription("point_diagonal_up");for(let e of[Do.Finger.Thumb,Do.Finger.Index,Do.Finger.Middle,Do.Finger.Ring,Do.Finger.Pinky])Xf.addCurl(e,Do.FingerCurl.NoCurl,1),Xf.addDirection(e,Do.FingerDirection.DiagonalUpRight,.8),Xf.addDirection(e,Do.FingerDirection.DiagonalUpLeft,.8);var Fo=ks(Ca());var Yf=new Fo.GestureDescription("point_diagonal_down");for(let e of[Fo.Finger.Thumb,Fo.Finger.Index,Fo.Finger.Middle,Fo.Finger.Ring,Fo.Finger.Pinky])Yf.addCurl(e,Fo.FingerCurl.NoCurl,1),Yf.addDirection(e,Fo.FingerDirection.DiagonalDownRight,1),Yf.addDirection(e,Fo.FingerDirection.DiagonalDownLeft,1);var Fu=typeof self<"u"?self:{};function Hv(e,t){e:{for(var r=["CLOSURE_FLAGS"],n=Fu,o=0;o<r.length;o++)if((n=n[r[o]])==null){r=null;break e}r=n}return(e=r&&r[e])!=null?e:t}function ku(){throw Error("Invalid UTF8")}function l3(e,t){return t=String.fromCharCode.apply(null,t),e==null?t:e+t}var Id,Rv,Y7=typeof TextDecoder<"u",Z7,Q7=typeof TextEncoder<"u";function T_(e){if(Q7)e=(Z7||=new TextEncoder).encode(e);else{let r=0,n=new Uint8Array(3*e.length);for(let o=0;o<e.length;o++){var t=e.charCodeAt(o);if(t<128)n[r++]=t;else{if(t<2048)n[r++]=t>>6|192;else{if(t>=55296&&t<=57343){if(t<=56319&&o<e.length){let s=e.charCodeAt(++o);if(s>=56320&&s<=57343){t=1024*(t-55296)+s-56320+65536,n[r++]=t>>18|240,n[r++]=t>>12&63|128,n[r++]=t>>6&63|128,n[r++]=63&t|128;continue}o--}t=65533}n[r++]=t>>12|224,n[r++]=t>>6&63|128}n[r++]=63&t|128}}e=r===n.length?n:n.subarray(0,r)}return e}var um,S_=Hv(610401301,!1),J7=Hv(653718497,Hv(1,!0)),c3=Fu.navigator;function Kv(e){return!!S_&&!!um&&um.brands.some(({brand:t})=>t&&t.indexOf(e)!=-1)}function us(e){var t;return(t=Fu.navigator)&&(t=t.userAgent)||(t=""),t.indexOf(e)!=-1}function Ia(){return!!S_&&!!um&&um.brands.length>0}function Ov(){return Ia()?Kv("Chromium"):(us("Chrome")||us("CriOS"))&&!(!Ia()&&us("Edge"))||us("Silk")}function fw(e){return fw[" "](e),e}um=c3&&c3.userAgentData||null,fw[" "]=function(){};var e9=!Ia()&&(us("Trident")||us("MSIE"));!us("Android")||Ov(),Ov(),us("Safari")&&(Ov()||!Ia()&&us("Coast")||!Ia()&&us("Opera")||!Ia()&&us("Edge")||(Ia()?Kv("Microsoft Edge"):us("Edg/"))||Ia()&&Kv("Opera"));var C_={},tm=null;function t9(e){var t=e.length,r=3*t/4;r%3?r=Math.floor(r):"=.".indexOf(e[t-1])!=-1&&(r="=.".indexOf(e[t-2])!=-1?r-2:r-1);var n=new Uint8Array(r),o=0;return function(s,i){function a(x){for(;u<s.length;){var y=s.charAt(u++),v=tm[y];if(v!=null)return v;if(!/^[\s\xa0]*$/.test(y))throw Error("Unknown base64 encoding at char: "+y)}return x}E_();for(var u=0;;){var c=a(-1),p=a(0),m=a(64),h=a(64);if(h===64&&c===-1)break;i(c<<2|p>>4),m!=64&&(i(p<<4&240|m>>2),h!=64&&i(m<<6&192|h))}}(e,function(s){n[o++]=s}),o!==r?n.subarray(0,o):n}function E_(){if(!tm){tm={};for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".split(""),t=["+/=","+/","-_=","-_.","-_"],r=0;r<5;r++){var n=e.concat(t[r].split(""));C_[r]=n;for(var o=0;o<n.length;o++){var s=n[o];tm[s]===void 0&&(tm[s]=o)}}}}var N_=typeof Uint8Array<"u",__=!e9&&typeof btoa=="function";function p3(e){if(!__){var t;t===void 0&&(t=0),E_(),t=C_[t];var r=Array(Math.floor(e.length/3)),n=t[64]||"";let u=0,c=0;for(;u<e.length-2;u+=3){var o=e[u],s=e[u+1],i=e[u+2],a=t[o>>2];o=t[(3&o)<<4|s>>4],s=t[(15&s)<<2|i>>6],i=t[63&i],r[c++]=a+o+s+i}switch(a=0,i=n,e.length-u){case 2:i=t[(15&(a=e[u+1]))<<2]||n;case 1:e=e[u],r[c]=t[e>>2]+t[(3&e)<<4|a>>4]+i+n}return r.join("")}for(t="",r=0,n=e.length-10240;r<n;)t+=String.fromCharCode.apply(null,e.subarray(r,r+=10240));return t+=String.fromCharCode.apply(null,r?e.subarray(r):e),btoa(t)}var f3=/[-_.]/g,r9={"-":"+",_:"/",".":"="};function n9(e){return r9[e]||""}function I_(e){if(!__)return t9(e);f3.test(e)&&(e=e.replace(f3,n9)),e=atob(e);let t=new Uint8Array(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}function hm(e){return N_&&e!=null&&e instanceof Uint8Array}var mc={},o9;function A_(e){if(e!==mc)throw Error("illegal external caller")}function Pu(){return o9||=new zi(null,mc)}function mw(e){A_(mc);var t=e.g;return(t=t==null||hm(t)?t:typeof t=="string"?I_(t):null)==null?t:e.g=t}var zi=class{constructor(e,t){if(A_(t),this.g=e,e!=null&&e.length===0)throw Error("ByteString should be constructed with non-empty values")}h(){return new Uint8Array(mw(this)||0)}};function k_(e,t){e.__closure__error__context__984382||(e.__closure__error__context__984382={}),e.__closure__error__context__984382.severity=t}var s9;function dm(){let e=Error();k_(e,"incident"),function(t){Fu.setTimeout(()=>{throw t},0)}(e)}function qv(e){return k_(e=Error(e),"warning"),e}function hw(){return typeof BigInt=="function"}function Mo(e){return Array.prototype.slice.call(e)}var Tc=typeof Symbol=="function"&&typeof Symbol()=="symbol";function gm(e){return typeof Symbol=="function"&&typeof Symbol()=="symbol"?Symbol():e}var xm=gm(),m3=gm("0di"),Dv=gm("2ex"),Zf=gm("1oa"),h3=gm("0dg"),Qd=Tc?(e,t)=>{e[xm]|=t}:(e,t)=>{e.G!==void 0?e.G|=t:Object.defineProperties(e,{G:{value:t,configurable:!0,writable:!0,enumerable:!1}})},Md=Tc?(e,t)=>{e[xm]&=~t}:(e,t)=>{e.G!==void 0&&(e.G&=~t)},br=Tc?e=>0|e[xm]:e=>0|e.G,Mt=Tc?e=>e[xm]:e=>e.G,yr=Tc?(e,t)=>{e[xm]=t}:(e,t)=>{e.G!==void 0?e.G=t:Object.defineProperties(e,{G:{value:t,configurable:!0,writable:!0,enumerable:!1}})};function Bu(e){return Qd(e,34),e}function i9(e,t){yr(t,-30975&(0|e))}function jv(e,t){yr(t,-30941&(34|e))}var dw,ym={},$_={};function d3(e){return!(!e||typeof e!="object"||e.Ja!==$_)}function Jd(e){return e!==null&&typeof e=="object"&&!Array.isArray(e)&&e.constructor===Object}function gw(e,t,r){if(e!=null){if(typeof e=="string")e=e?new zi(e,mc):Pu();else if(e.constructor!==zi)if(hm(e))e=e.length?new zi(r?e:new Uint8Array(e),mc):Pu();else{if(!t)throw Error();e=void 0}}return e}function Ud(e){return!(!Array.isArray(e)||e.length)&&!!(1&br(e))}var g3=[];function Ki(e){if(2&e)throw Error()}yr(g3,55),dw=Object.freeze(g3);var Vd=class e{constructor(t,r,n){this.l=0,this.g=t,this.h=r,this.m=n}next(){if(this.l<this.g.length){let t=this.g[this.l++];return{done:!1,value:this.h?this.h.call(this.m,t):t}}return{done:!0,value:void 0}}[Symbol.iterator](){return new e(this.g,this.h,this.m)}},ka;function R_(e,t){(t=ka?t[ka]:void 0)&&(e[ka]=Mo(t))}var a9=Object.freeze({}),u9=Object.freeze({}),l9=Object.freeze({});function eg(e){return e.Qa=!0,e}var c9=eg(e=>typeof e=="number"),x3=eg(e=>typeof e=="string"),p9=eg(e=>typeof e=="boolean"),tg=typeof Fu.BigInt=="function"&&typeof Fu.BigInt(0)=="bigint",Xv=eg(e=>tg?e>=m9&&e<=d9:e[0]==="-"?y3(e,f9):y3(e,h9)),f9=Number.MIN_SAFE_INTEGER.toString(),m9=tg?BigInt(Number.MIN_SAFE_INTEGER):void 0,h9=Number.MAX_SAFE_INTEGER.toString(),d9=tg?BigInt(Number.MAX_SAFE_INTEGER):void 0;function y3(e,t){if(e.length>t.length)return!1;if(e.length<t.length||e===t)return!0;for(let r=0;r<e.length;r++){let n=e[r],o=t[r];if(n>o)return!1;if(n<o)return!0}}var g9=typeof Uint8Array.prototype.slice=="function",O_,Yt=0,Er=0;function b3(e){let t=e>>>0;Yt=t,Er=(e-t)/4294967296>>>0}function hc(e){if(e<0){b3(-e);let[t,r]=vw(Yt,Er);Yt=t>>>0,Er=r>>>0}else b3(e)}function xw(e){let t=O_||=new DataView(new ArrayBuffer(8));t.setFloat32(0,+e,!0),Er=0,Yt=t.getUint32(0,!0)}function yw(e,t){return 4294967296*t+(e>>>0)}function bw(e,t){let r=2147483648&t;return r&&(t=~t>>>0,(e=1+~e>>>0)==0&&(t=t+1>>>0)),e=yw(e,t),r?-e:e}function Gd(e,t){if(e>>>=0,(t>>>=0)<=2097151)var r=""+(4294967296*t+e);else hw()?r=""+(BigInt(t)<<BigInt(32)|BigInt(e)):(e=(16777215&e)+6777216*(r=16777215&(e>>>24|t<<8))+6710656*(t=t>>16&65535),r+=8147497*t,t*=2,e>=1e7&&(r+=e/1e7>>>0,e%=1e7),r>=1e7&&(t+=r/1e7>>>0,r%=1e7),r=t+v3(r)+v3(e));return r}function v3(e){return e=String(e),"0000000".slice(e.length)+e}function rg(e){if(e.length<16)hc(Number(e));else if(hw())e=BigInt(e),Yt=Number(e&BigInt(4294967295))>>>0,Er=Number(e>>BigInt(32)&BigInt(4294967295));else{let t=+(e[0]==="-");Er=Yt=0;let r=e.length;for(let n=t,o=(r-t)%6+t;o<=r;n=o,o+=6){let s=Number(e.slice(n,o));Er*=1e6,Yt=1e6*Yt+s,Yt>=4294967296&&(Er+=Math.trunc(Yt/4294967296),Er>>>=0,Yt>>>=0)}if(t){let[n,o]=vw(Yt,Er);Yt=n,Er=o}}}function vw(e,t){return t=~t,e?e=1+~e:t+=1,[e,t]}function Ba(e){return e==null||typeof e=="number"?e:e==="NaN"||e==="Infinity"||e==="-Infinity"?Number(e):void 0}function D_(e){return e==null||typeof e=="boolean"?e:typeof e=="number"?!!e:void 0}var x9=/^-?([1-9][0-9]*|0)(\.[0-9]+)?$/;function ng(e){let t=typeof e;switch(t){case"bigint":return!0;case"number":return Number.isFinite(e)}return t==="string"&&x9.test(e)}function Sc(e){if(e==null)return e;if(typeof e=="string"){if(!e)return;e=+e}return typeof e=="number"&&Number.isFinite(e)?0|e:void 0}function y9(e){if(e==null)return e;if(typeof e=="string"){if(!e)return;e=+e}return typeof e=="number"&&Number.isFinite(e)?e>>>0:void 0}function w3(e){return e[0]!=="-"&&(e.length<20||e.length===20&&Number(e.substring(0,6))<184467)}function ww(e){return e=Math.trunc(e),Number.isSafeInteger(e)||(hc(e),e=bw(Yt,Er)),e}function Tw(e){var t=Math.trunc(Number(e));if(Number.isSafeInteger(t))return String(t);if((t=e.indexOf("."))!==-1&&(e=e.substring(0,t)),!(e[0]==="-"?e.length<20||e.length===20&&Number(e.substring(0,7))>-922337:e.length<19||e.length===19&&Number(e.substring(0,6))<922337))if(rg(e),e=Yt,2147483648&(t=Er))if(hw())e=""+(BigInt(0|t)<<BigInt(32)|BigInt(e>>>0));else{let[r,n]=vw(e,t);e="-"+Gd(r,n)}else e=Gd(e,t);return e}function Wd(e){return e==null?e:typeof e=="bigint"?(Xv(e)?e=Number(e):(e=BigInt.asIntN(64,e),e=Xv(e)?Number(e):String(e)),e):ng(e)?typeof e=="number"?ww(e):Tw(e):void 0}function b9(e){if(e==null)return e;var t=typeof e;if(t==="bigint")return String(BigInt.asUintN(64,e));if(ng(e)){if(t==="string")return t=Math.trunc(Number(e)),Number.isSafeInteger(t)&&t>=0?e=String(t):((t=e.indexOf("."))!==-1&&(e=e.substring(0,t)),w3(e)||(rg(e),e=Gd(Yt,Er))),e;if(t==="number")return(e=Math.trunc(e))>=0&&Number.isSafeInteger(e)?e:function(r){if(r<0){hc(r);let n=Gd(Yt,Er);return r=Number(n),Number.isSafeInteger(r)?r:n}return w3(String(r))?r:(hc(r),yw(Yt,Er))}(e)}}function F_(e){if(typeof e!="string")throw Error();return e}function Cc(e){if(e!=null&&typeof e!="string")throw Error();return e}function $a(e){return e==null||typeof e=="string"?e:void 0}function Sw(e,t,r,n){if(e!=null&&typeof e=="object"&&e.X===ym)return e;if(!Array.isArray(e))return r?2&n?(e=t[m3])?t=e:(Bu((e=new t).u),t=t[m3]=e):t=new t:t=void 0,t;let o=r=br(e);return o===0&&(o|=32&n),o|=2&n,o!==r&&yr(e,o),new t(e)}function v9(e,t,r){if(t)e:{if(!ng(t=e))throw qv("int64");switch(typeof t){case"string":t=Tw(t);break e;case"bigint":if(e=t=BigInt.asIntN(64,t),x3(e)){if(!/^\s*(?:-?[1-9]\d*|0)?\s*$/.test(e))throw Error(String(e))}else if(c9(e)&&!Number.isSafeInteger(e))throw Error(String(e));t=tg?BigInt(t):p9(t)?t?"1":"0":x3(t)?t.trim()||"0":String(t);break e;default:t=ww(t)}}else t=Wd(e);return typeof(r=(e=t)==null?r?0:void 0:e)=="string"&&(t=+r,Number.isSafeInteger(t))?t:r}function P_(e){if(Qf===void 0&&(Qf=typeof Proxy=="function"?U_(Proxy):null),!Qf||!M_())return e;let t=dc?.get(e);return t||(Math.random()>.01?e:(function(r){if(Fv===void 0){let n=new Qf([],{});Fv=Array.prototype.concat.call([],n).length===1}Fv&&typeof Symbol=="function"&&Symbol.isConcatSpreadable&&(r[Symbol.isConcatSpreadable]=!0)}(e),t=new Qf(e,{set:(r,n,o)=>(dm(),r[n]=o,!0)}),function(r,n){(dc||=new Ou).set(r,n),(L_||=new Ou).set(n,r)}(e,t),t))}var dc,L_,Qf,Ou,Fv,lm,zd,B_,w9;function M_(){return Ou===void 0&&(Ou=typeof WeakMap=="function"?U_(WeakMap):null),Ou}function U_(e){try{return e.toString().indexOf("[native code]")!==-1?e:null}catch{return null}}function Cw(e,t,r){if(M_()){if(lm?.get(t)?.get(e)){if(r)return}else if(Math.random()>.01)return;var n=e.length;r={length:n};for(var o=0;o<Math.min(n,10);o++){if(n<=10)var s=o;else{s=n/10;let i=Math.floor(o*s);s=i+Math.floor(Math.random()*(Math.floor((o+1)*s)-i))}r[s]=e[s]}V_(e,r)?((o=(n=lm||=new Ou).get(t))||(o=new Ou,n.set(t,o)),o.set(e,r)):(dm(),cm(e,t))}}function Hd(e,t){let r=lm?.get(t)?.get(e);r&&!V_(e,r)&&(dm(),cm(e,t))}function V_(e,t){if(e.length!==t.length)return!1;for(let o in t){var r,n=Number(o);if((r=Number.isInteger(n))&&(r=e[n],n=t[n],r=!(Number.isNaN(r)?Number.isNaN(n):r===n)),r)return!1}return!0}function og(e){if(e&&lm?.has(e)){var t=e.u;if(t)for(let r=0;r<t.length;r++){let n=t[r];if(r===t.length-1&&Jd(n))for(let o in n){let s=n[o];Array.isArray(s)&&Hd(s,e)}else Array.isArray(n)&&Hd(n,e)}}}function cm(e,t){lm?.get(t)?.delete(e)}function Ra(e,t,r){return e=G_(e,t[0],t[1],r?1:2),t!==B_&&r&&Qd(e,16384),e}function G_(e,t,r,n){if(n=n??0,e==null&&(e=zd),zd=void 0,e==null){var o=96;r?(e=[r],o|=512):e=[],t&&(o=-33521665&o|(1023&t)<<15)}else{if(!Array.isArray(e))throw Error("narr");if(2048&(o=br(e)))throw Error("farr");if(64&o)return e;if(n===1||n===2||(o|=64),r&&(o|=512,r!==e[0]))throw Error("mid");e:{if(n=(r=e).length){let s=n-1;if(Jd(r[s])){if((t=s-(+!!(512&(o|=256))-1))>=1024)throw Error("pvtlmt");o=-33521665&o|(1023&t)<<15;break e}}if(t){if((t=Math.max(t,n-(+!!(512&o)-1)))>1024)throw Error("spvt");o=-33521665&o|(1023&t)<<15}}}return yr(e,o),e}var T9={},S9=function(){try{return fw(new class extends Map{constructor(){super()}}),!1}catch{return!0}}(),nm=class{constructor(){this.g=new Map}get(t){return this.g.get(t)}set(t,r){return this.g.set(t,r),this.size=this.g.size,this}delete(t){return t=this.g.delete(t),this.size=this.g.size,t}clear(){this.g.clear(),this.size=this.g.size}has(t){return this.g.has(t)}entries(){return this.g.entries()}keys(){return this.g.keys()}values(){return this.g.values()}forEach(t,r){return this.g.forEach(t,r)}[Symbol.iterator](){return this.entries()}},C9=S9?(Object.setPrototypeOf(nm.prototype,Map.prototype),Object.defineProperties(nm.prototype,{size:{value:0,configurable:!0,enumerable:!0,writable:!0}}),nm):class extends Map{constructor(){super()}};function T3(e){return e}function Pv(e){if(2&e.M)throw Error("Cannot mutate an immutable Map")}var cs=class extends C9{constructor(e,t,r=T3,n=T3){super();let o=br(e);o|=64,yr(e,o),this.M=o,this.T=t,this.S=r,this.Z=this.T?E9:n;for(let s=0;s<e.length;s++){let i=e[s],a=r(i[0],!1,!0),u=i[1];t?u===void 0&&(u=null):u=n(i[1],!1,!0,void 0,void 0,o),super.set(a,u)}}pa(e=S3){if(this.size!==0)return this.Y(e)}Y(e=S3){let t=[],r=super.entries();for(var n;!(n=r.next()).done;)(n=n.value)[0]=e(n[0]),n[1]=e(n[1]),t.push(n);return t}clear(){Pv(this),super.clear()}delete(e){return Pv(this),super.delete(this.S(e,!0,!1))}entries(){var e=this.oa();return new Vd(e,N9,this)}keys(){return this.Ia()}values(){var e=this.oa();return new Vd(e,cs.prototype.get,this)}forEach(e,t){super.forEach((r,n)=>{e.call(t,this.get(n),n,this)})}set(e,t){return Pv(this),(e=this.S(e,!0,!1))==null?this:t==null?(super.delete(e),this):super.set(e,this.Z(t,!0,!0,this.T,!1,this.M))}Oa(e){let t=this.S(e[0],!1,!0);e=e[1],e=this.T?e===void 0?null:e:this.Z(e,!1,!0,void 0,!1,this.M),super.set(t,e)}has(e){return super.has(this.S(e,!1,!1))}get(e){e=this.S(e,!1,!1);let t=super.get(e);if(t!==void 0){var r=this.T;return r?((r=this.Z(t,!1,!0,r,this.ta,this.M))!==t&&super.set(e,r),r):t}}oa(){return Array.from(super.keys())}Ia(){return super.keys()}[Symbol.iterator](){return this.entries()}};function E9(e,t,r,n,o,s){return e=Sw(e,n,r,s),o&&(e=ig(e)),e}function S3(e){return e}function N9(e){return[e,this.get(e)]}var _9;function C3(){return _9||=new cs(Bu([]),void 0,void 0,void 0,T9)}function Ew(e,t,r,n,o){if(e!=null){if(Array.isArray(e))e=Ud(e)?void 0:o&&2&br(e)?e:sg(e,t,r,n!==void 0,o);else if(Jd(e)){let s={};for(let i in e)s[i]=Ew(e[i],t,r,n,o);e=s}else e=t(e,n);return e}}function sg(e,t,r,n,o){let s=n||r?br(e):0;n=n?!!(32&s):void 0;let i=Mo(e);for(let a=0;a<i.length;a++)i[a]=Ew(i[a],t,r,n,o);return r&&(R_(i,e),r(s,i)),i}function I9(e){return Ew(e,Nw,void 0,void 0,!1)}function Nw(e){return e.X===ym?e.toJSON():e instanceof cs?e.pa(I9):function(t){switch(typeof t){case"number":return isFinite(t)?t:String(t);case"bigint":return Xv(t)?Number(t):String(t);case"boolean":return t?1:0;case"object":if(t)if(Array.isArray(t)){if(Ud(t))return}else{if(hm(t))return p3(t);if(t instanceof zi){let r=t.g;return r==null?"":typeof r=="string"?r:t.g=p3(r)}if(t instanceof cs)return t.pa()}}return t}(e)}function Yv(e,t,r=jv){if(e!=null){if(N_&&e instanceof Uint8Array)return t?e:new Uint8Array(e);if(Array.isArray(e)){var n=br(e);return 2&n?e:(t&&=n===0||!!(32&n)&&!(64&n||!(16&n)),t?(yr(e,-12293&(34|n)),e):sg(e,Yv,4&n?jv:r,!0,!0))}return e.X===ym?(r=e.u,e=2&(n=Mt(r))?e:_w(e,r,n,!0)):e instanceof cs&&!(2&e.M)&&(r=Bu(e.Y(Yv)),e=new cs(r,e.T,e.S,e.Z)),e}}function _w(e,t,r,n){return og(e),e=e.constructor,zd=t=W_(t,r,n),t=new e(t),zd=void 0,t}function W_(e,t,r){let n=r||2&t?jv:i9,o=!!(32&t);return e=function(s,i,a){let u=Mo(s);var c=u.length;let p=256&i?u[c-1]:void 0;for(c+=p?-1:0,i=512&i?1:0;i<c;i++)u[i]=a(u[i]);if(p){i=u[i]={};for(let m in p)i[m]=a(p[m])}return R_(u,s),u}(e,t,s=>Yv(s,o,n)),Qd(e,32|(r?2:0)),e}function ig(e){let t=e.u,r=Mt(t);return 2&r?_w(e,t,r,!1):e}function z_(e,t,r,n){return!(4&t)||r!=null&&(!n&&r===0&&(4096&t||8192&t)&&(e.constructor[h3]=1+(0|e.constructor[h3]))<5&&dm(),r!==0&&!(r&t))}function Oa(e,t){return hi(e=e.u,Mt(e),t)}function E3(e,t,r,n){if(!((t=n+(+!!(512&t)-1))<0||t>=e.length||t>=r))return e[t]}function hi(e,t,r,n){if(r===-1)return null;let o=t>>15&1023||536870912;if(!(r>=o)){var s=e.length;return n&&256&t&&(n=e[s-1][r])!=null?(E3(e,t,o,r)&&Dv!=null&&((t=(e=s9??={})[Dv]||0)>=4||(e[Dv]=t+1,dm())),n):E3(e,t,o,r)}return 256&t?e[e.length-1][r]:void 0}function tr(e,t,r){let n=e.u,o=Mt(n);return Ki(o),fr(n,o,t,r),e}function fr(e,t,r,n){let o=t>>15&1023||536870912;if(r>=o){let s,i=t;if(256&t)s=e[e.length-1];else{if(n==null)return i;s=e[o+(+!!(512&t)-1)]={},i|=256}return s[r]=n,r<o&&(e[r+(+!!(512&t)-1)]=void 0),i!==t&&yr(e,i),i}return e[r+(+!!(512&t)-1)]=n,256&t&&r in(e=e[e.length-1])&&delete e[r],t}function Ec(e,t,r,n,o){var s=2&t;o=hi(e,t,r,o),Array.isArray(o)||(o=dw);let i=!(2&n);n=!(1&n);let a=!!(32&t),u=br(o);return u!==0||!a||s||i?1&u||(u|=1,yr(o,u)):(u|=33,yr(o,u)),s?(e=!1,2&u||(Bu(o),e=!!(4&u)),(n||e)&&Object.freeze(o)):(s=!!(2&u)||!!(2048&u),n&&s?(o=Mo(o),s=1,a&&!i&&(s|=32),yr(o,s),fr(e,t,r,o)):i&&32&u&&!s&&Md(o,32)),o}function Od(e,t){e=e.u;let r=Mt(e),n=hi(e,r,t),o=Ba(n);return o!=null&&o!==n&&fr(e,r,t,o),o}function H_(e){e=e.u;let t=Mt(e),r=hi(e,t,1),n=gw(r,!0,!!(34&t));return n!=null&&n!==r&&fr(e,t,1,n),n}function $u(){return a9===void 0?2:5}function Ru(e,t,r,n,o,s){let i=e.u,a=Mt(i);n=2&a?1:n,s=!!s,o=K_(i,a,t,o);var u=br(o),c=o;if(Hd(c,e),n!==2&&n!==1||cm(c,e),z_(e,u,void 0,s)){4&u&&(o=Mo(o),u=Lu(u,a),a=fr(i,a,t,o));let m=c=0;for(;c<o.length;c++){let h=r(o[c]);h!=null&&(o[m++]=h)}m<c&&(o.length=m),u=-4097&(20|(u=q_(u,a))),yr(o,u&=-8193),2&u&&Object.freeze(o)}let p;return n===1||n===4&&32&u?Gi(u)||(e=u,(u|=2)!==e&&yr(o,u),Object.freeze(o)):(r=n===5&&(!!(32&u)||Gi(u)||!!dc?.get(o)),(n===2||r)&&Gi(u)&&(o=Mo(o),u=gc(u=Lu(u,a),a,s),yr(o,u),a=fr(i,a,t,o)),Gi(u)||(t=u,(u=gc(u,a,s))!==t&&yr(o,u)),r?(p=P_(o),Cw(o,e,!0)):n!==2||s||dc?.delete(o)),p||o}function K_(e,t,r,n){return e=hi(e,t,r,n),Array.isArray(e)?e:dw}function q_(e,t){return e===0&&(e=Lu(e,t)),1|e}function Gi(e){return!!(2&e)&&!!(4&e)||!!(2048&e)}function j_(e){e=Mo(e);for(let t=0;t<e.length;t++){let r=e[t]=Mo(e[t]);Array.isArray(r[1])&&(r[1]=Bu(r[1]))}return e}function Zv(e,t,r,n){e=e.u;let o=Mt(e);Ki(o),fr(e,o,t,(n==="0"?Number(r)===0:r===n)?void 0:r)}function Lv(e,t){var r=PI;return Aw(Iw(e=e.u),e,Mt(e),r)===t?t:-1}function Iw(e){if(Tc)return e[Zf]??(e[Zf]=new Map);if(Zf in e)return e[Zf];let t=new Map;return Object.defineProperty(e,Zf,{value:t}),t}function X_(e,t,r,n){let o=Iw(e),s=Aw(o,e,t,r);return s!==n&&(s&&(t=fr(e,t,s)),o.set(r,n)),t}function Aw(e,t,r,n){let o=e.get(n);if(o!=null)return o;o=0;for(let s=0;s<n.length;s++){let i=n[s];hi(t,r,i)!=null&&(o!==0&&(r=fr(t,r,o)),o=i)}return e.set(n,o),o}function kw(e,t,r,n){let o,s=Mt(e);if((n=hi(e,s,r,n))!=null&&n.X===ym)return(t=ig(n))!==n&&fr(e,s,r,t),t.u;if(Array.isArray(n)){let i=br(n);o=2&i?Ra(W_(n,i,!1),t,!0):64&i?n:Ra(o,t,!0)}else o=Ra(void 0,t,!0);return o!==n&&fr(e,s,r,o),o}function Y_(e,t,r,n){e=e.u;let o=Mt(e);return(t=Sw(n=hi(e,o,r,n),t,!1,o))!==n&&t!=null&&fr(e,o,r,t),t}function Et(e,t,r,n=!1){if((t=Y_(e,t,r,n))==null)return t;if(e=e.u,!(2&(n=Mt(e)))){let o=ig(t);o!==t&&fr(e,n,r,t=o)}return t}function Z_(e,t,r,n,o,s,i){let a=e.u;var u=!!(2&t);o=u?1:o,s=!!s,i&&=!u,u=K_(a,t,n);var c=br(u),p=u;if(Hd(p,e),o!==2&&o!==1||cm(p,e),!(p=!!(4&c))){var m=u,h=t;let y=!!(2&(c=q_(c,t)));y&&(h|=2);let v=!y,w=!0,C=0,I=0;for(;C<m.length;C++){let D=Sw(m[C],r,!1,h);if(D instanceof r){if(!y){let P=!!(2&br(D.u));v&&=!P,w&&=P}m[I++]=D}}I<C&&(m.length=I),c|=4,c=w?16|c:-17&c,yr(m,c=v?8|c:-9&c),y&&Object.freeze(m)}if(i&&!(8&c||!u.length&&(o===1||o===4&&32&c))){for(Gi(c)?(u=Mo(u),c=Lu(c,t),t=fr(a,t,n,u)):cm(u,e),r=u,i=c,m=0;m<r.length;m++)(c=r[m])!==(h=ig(c))&&(r[m]=h);i|=8,i=r.length?-17&i:16|i,yr(r,i),c=i}let x;return o===1||o===4&&32&c?Gi(c)||(e=c,(c|=!u.length||16&c&&(!p||32&c)?2:2048)!==e&&yr(u,c),Object.freeze(u)):(p=o===5&&(!!(32&c)||Gi(c)||!!dc?.get(u)),(o===2||p)&&Gi(c)&&(u=Mo(u),c=gc(c=Lu(c,t),t,s),yr(u,c),t=fr(a,t,n,u)),Gi(c)||(n=c,(c=gc(c,t,s))!==n&&yr(u,c)),p?(x=P_(u),Cw(u,e,!0)):o!==2||s||dc?.delete(u)),x||u}function Hi(e,t,r){let n=Mt(e.u);return Z_(e,n,t,r,$u(),!1,!(2&n))}function Ge(e,t,r,n){return n==null&&(n=void 0),tr(e,r,n)}function om(e,t,r,n){n==null&&(n=void 0);e:{e=e.u;let o=Mt(e);if(Ki(o),n==null){let s=Iw(e);if(Aw(s,e,o,r)!==t)break e;s.set(r,0)}else o=X_(e,o,r,t);fr(e,o,t,n)}}function Lu(e,t){return-2049&(e=32|(2&t?2|e:-3&e))}function gc(e,t,r){return 32&t&&r||(e&=-33),e}function Kd(e,t,r,n){let o=Mt(e.u);Ki(o),e=Z_(e,o,r,t,2,!0),n=n??new r,e.push(n),2&br(n.u)?Md(e,8):Md(e,16)}function $s(e,t){return e??t}function ls(e,t){return Sc(Oa(e,t))}function Dr(e,t){return $s(Od(e,t),0)}function fi(e,t){return $s($a(Oa(e,t)),"")}function pm(e,t,r){if(r!=null&&typeof r!="boolean")throw e=typeof r,Error(`Expected boolean but got ${e!="object"?e:r?Array.isArray(r)?"array":e:"null"}: ${r}`);tr(e,t,r)}function mi(e,t,r){if(r!=null){if(typeof r!="number"||!Number.isFinite(r))throw qv("int32");r|=0}tr(e,t,r)}function Le(e,t,r){if(r!=null&&typeof r!="number")throw Error(`Value of float/double field must be a number, found ${typeof r}: ${r}`);tr(e,t,r)}function qd(e,t,r){{let a=e.u,u=Mt(a);if(Ki(u),r==null)fr(a,u,t);else{r=L_?.get(r)||r;var n,o=br(r),s=o,i=!!(2&o)||Object.isFrozen(r);if((n=!i)&&((n=l9===void 0)||(n=!!J7&&u9!==void 0)),z_(e,o)){o=21,i&&(r=Mo(r),s=0,o=gc(o=Lu(o,u),u,!0));for(let c=0;c<r.length;c++)r[c]=F_(r[c])}n?(r=Mo(r),s=0,o=gc(o=Lu(o,u),u,!0)):i||Cw(r,e),o!==s&&yr(r,o),fr(a,u,t,r)}}}function ag(e,t,r){Ki(Mt(e.u)),Ru(e,t,$a,2,void 0,!0).push(F_(r))}function Q_(e,t){return Error(`Invalid wire type: ${e} (at position ${t})`)}function $w(){return Error("Failed to read varint, encoding is invalid.")}function J_(e,t){return Error(`Tried to read past the end of the data ${t} > ${e}`)}function Rw(e){if(typeof e=="string")return{buffer:I_(e),O:!1};if(Array.isArray(e))return{buffer:new Uint8Array(e),O:!1};if(e.constructor===Uint8Array)return{buffer:e,O:!1};if(e.constructor===ArrayBuffer)return{buffer:new Uint8Array(e),O:!1};if(e.constructor===zi)return{buffer:mw(e)||new Uint8Array(0),O:!0};if(e instanceof Uint8Array)return{buffer:new Uint8Array(e.buffer,e.byteOffset,e.byteLength),O:!1};throw Error("Type not convertible to a Uint8Array, expected a Uint8Array, an ArrayBuffer, a base64 encoded string, a ByteString or an Array of numbers")}function Ow(e,t){let r,n=0,o=0,s=0,i=e.h,a=e.g;do r=i[a++],n|=(127&r)<<s,s+=7;while(s<32&&128&r);for(s>32&&(o|=(127&r)>>4),s=3;s<32&&128&r;s+=7)r=i[a++],o|=(127&r)<<s;if(Du(e,a),r<128)return t(n>>>0,o>>>0);throw $w()}function Dw(e){let t=0,r=e.g,n=r+10,o=e.h;for(;r<n;){let s=o[r++];if(t|=s,(128&s)==0)return Du(e,r),!!(127&t)}throw $w()}function Da(e){let t=e.h,r=e.g,n=t[r++],o=127&n;if(128&n&&(n=t[r++],o|=(127&n)<<7,128&n&&(n=t[r++],o|=(127&n)<<14,128&n&&(n=t[r++],o|=(127&n)<<21,128&n&&(n=t[r++],o|=n<<28,128&n&&128&t[r++]&&128&t[r++]&&128&t[r++]&&128&t[r++]&&128&t[r++])))))throw $w();return Du(e,r),o}function Fa(e){return Da(e)>>>0}function Qv(e){var t=e.h;let r=e.g,n=t[r],o=t[r+1],s=t[r+2];return t=t[r+3],Du(e,e.g+4),(n<<0|o<<8|s<<16|t<<24)>>>0}function Jv(e){var t=Qv(e);e=2*(t>>31)+1;let r=t>>>23&255;return t&=8388607,r==255?t?NaN:e*(1/0):r==0?1401298464324817e-60*e*t:e*Math.pow(2,r-150)*(t+8388608)}function A9(e){return Da(e)}function Bv(e,t,{ca:r=!1}={}){e.ca=r,t&&(t=Rw(t),e.h=t.buffer,e.m=t.O,e.j=0,e.l=e.h.length,e.g=e.j)}function Du(e,t){if(e.g=t,t>e.l)throw J_(e.l,t)}function eI(e,t){if(t<0)throw Error(`Tried to read a negative byte length: ${t}`);let r=e.g,n=r+t;if(n>e.l)throw J_(t,e.l-r);return e.g=n,r}function tI(e,t){if(t==0)return Pu();var r=eI(e,t);return e.ca&&e.m?r=e.h.subarray(r,r+t):(e=e.h,r=r===(t=r+t)?new Uint8Array(0):g9?e.slice(r,t):new Uint8Array(e.subarray(r,t))),r.length==0?Pu():new zi(r,mc)}cs.prototype.toJSON=void 0,cs.prototype.Ja=$_;var N3=[];function rI(e){var t=e.g;if(t.g==t.l)return!1;e.l=e.g.g;var r=Fa(e.g);if(t=r>>>3,!((r&=7)>=0&&r<=5))throw Q_(r,e.l);if(t<1)throw Error(`Invalid field number: ${t} (at position ${e.l})`);return e.m=t,e.h=r,!0}function Dd(e){switch(e.h){case 0:e.h!=0?Dd(e):Dw(e.g);break;case 1:Du(e=e.g,e.g+8);break;case 2:if(e.h!=2)Dd(e);else{var t=Fa(e.g);Du(e=e.g,e.g+t)}break;case 5:Du(e=e.g,e.g+4);break;case 3:for(t=e.m;;){if(!rI(e))throw Error("Unmatched start-group tag: stream EOF");if(e.h==4){if(e.m!=t)throw Error("Unmatched end-group tag");break}Dd(e)}break;default:throw Q_(e.h,e.l)}}function bm(e,t,r){let n=e.g.l,o=Fa(e.g),s=e.g.g+o,i=s-n;if(i<=0&&(e.g.l=s,r(t,e,void 0,void 0,void 0),i=s-e.g.g),i)throw Error(`Message parsing ended unexpectedly. Expected to read ${o} bytes, instead read ${o-i} bytes, either the data ended unexpectedly or the message misreported its own length`);return e.g.g=s,e.g.l=n,t}function Fw(e){var t=Fa(e.g),r=eI(e=e.g,t);if(e=e.h,Y7){var n,o=e;(n=Rv)||(n=Rv=new TextDecoder("utf-8",{fatal:!0})),t=r+t,o=r===0&&t===o.length?o:o.subarray(r,t);try{var s=n.decode(o)}catch(a){if(Id===void 0){try{n.decode(new Uint8Array([128]))}catch{}try{n.decode(new Uint8Array([97])),Id=!0}catch{Id=!1}}throw!Id&&(Rv=void 0),a}}else{t=(s=r)+t,r=[];let a,u=null;for(;s<t;){var i=e[s++];i<128?r.push(i):i<224?s>=t?ku():(a=e[s++],i<194||(192&a)!=128?(s--,ku()):r.push((31&i)<<6|63&a)):i<240?s>=t-1?ku():(a=e[s++],(192&a)!=128||i===224&&a<160||i===237&&a>=160||(192&(n=e[s++]))!=128?(s--,ku()):r.push((15&i)<<12|(63&a)<<6|63&n)):i<=244?s>=t-2?ku():(a=e[s++],(192&a)!=128||a-144+(i<<28)>>30||(192&(n=e[s++]))!=128||(192&(o=e[s++]))!=128?(s--,ku()):(i=(7&i)<<18|(63&a)<<12|(63&n)<<6|63&o,i-=65536,r.push(55296+(i>>10&1023),56320+(1023&i)))):ku(),r.length>=8192&&(u=l3(u,r),r.length=0)}s=l3(u,r)}return s}function nI(e){let t=Fa(e.g);return tI(e.g,t)}function ug(e,t,r){var n=Fa(e.g);for(n=e.g.g+n;e.g.g<n;)r.push(t(e.g))}var Ad=[],jd;function Os(e,t,r){t.g?t.m(e,t.g,t.h,r,!0):t.m(e,t.h,r,!0)}var De=class{constructor(e,t){this.u=G_(e,t)}toJSON(){return oI(this)}l(){var e=lW;return e.g?e.l(this,e.g,e.h,!0):e.l(this,e.h,e.defaultValue,!0)}clone(){let e=this.u;return _w(this,e,Mt(e),!1)}O(){return!!(2&br(this.u))}};function oI(e){og(e),e=jd?e.u:sg(e.u,Nw,void 0,void 0,!1);{var t=!jd;let c=e.length;if(c){var r=e[c-1],n=Jd(r);n?c--:r=void 0;var o=e;if(n){e:{var s,i=r,a=!1;if(i)for(let p in i)isNaN(+p)?(s??={})[p]=i[p]:(n=i[p],Array.isArray(n)&&(Ud(n)||d3(n)&&n.size===0)&&(n=null),n==null&&(a=!0),n!=null&&((s??={})[p]=n));if(a||(s=i),s)for(let p in s){a=s;break e}a=null}i=a==null?r!=null:a!==r}for(;c>0&&((s=o[c-1])==null||Ud(s)||d3(s)&&s.size===0);c--)var u=!0;(o!==e||i||u)&&(t?(u||i||a)&&(o.length=c):o=Array.prototype.slice.call(o,0,c),a&&o.push(a)),u=o}else u=e}return u}function _3(e){return e?/^\d+$/.test(e)?(rg(e),new ew(Yt,Er)):null:k9||=new ew(0,0)}De.prototype.X=ym,De.prototype.toString=function(){try{return jd=!0,oI(this).toString()}finally{jd=!1}};var ew=class{constructor(e,t){this.h=e>>>0,this.g=t>>>0}},k9;function I3(e){return e?/^-?\d+$/.test(e)?(rg(e),new tw(Yt,Er)):null:$9||=new tw(0,0)}var tw=class{constructor(e,t){this.h=e>>>0,this.g=t>>>0}},$9;function pc(e,t,r){for(;r>0||t>127;)e.g.push(127&t|128),t=(t>>>7|r<<25)>>>0,r>>>=7;e.g.push(t)}function vm(e,t){for(;t>127;)e.g.push(127&t|128),t>>>=7;e.g.push(t)}function lg(e,t){if(t>=0)vm(e,t);else{for(let r=0;r<9;r++)e.g.push(127&t|128),t>>=7;e.g.push(1)}}function fm(e,t){e.g.push(t>>>0&255),e.g.push(t>>>8&255),e.g.push(t>>>16&255),e.g.push(t>>>24&255)}function xc(e,t){t.length!==0&&(e.l.push(t),e.h+=t.length)}function ps(e,t,r){vm(e.g,8*t+r)}function Pw(e,t){return ps(e,t,2),t=e.g.end(),xc(e,t),t.push(e.h),t}function Lw(e,t){var r=t.pop();for(r=e.h+e.g.length()-r;r>127;)t.push(127&r|128),r>>>=7,e.h++;t.push(r),e.h++}function cg(e,t,r){ps(e,t,2),vm(e.g,r.length),xc(e,e.g.end()),xc(e,r)}function Xd(e,t,r,n){r!=null&&(t=Pw(e,t),n(r,e),Lw(e,t))}function Ds(){let e=class{constructor(){throw Error()}};return Object.setPrototypeOf(e,e.prototype),e}var Bw=Ds(),sI=Ds(),Mw=Ds(),Uw=Ds(),iI=Ds(),Vw=Ds(),aI=Ds(),uI=Ds(),Nc=class{constructor(e,t,r){this.g=e,this.h=t,e=Bw,this.l=!!e&&r===e||!1}};function pg(e,t){return new Nc(e,t,Bw)}function lI(e,t,r,n,o){Xd(e,r,mI(t,n),o)}var R9=pg(function(e,t,r,n,o){return e.h===2&&(bm(e,kw(t,n,r),o),!0)},lI),O9=pg(function(e,t,r,n,o){return e.h===2&&(bm(e,kw(t,n,r,!0),o),!0)},lI),fg=Symbol(),Gw=Symbol(),A3=Symbol(),k3=Symbol(),cI,pI;function Mu(e,t,r,n){var o=n[e];if(o)return o;(o={}).W=function(m){switch(typeof m){case"boolean":return B_||=[0,void 0,!0];case"number":return m>0?void 0:m===0?w9||=[0,void 0]:[-m,void 0];case"string":return[0,m];case"object":return m}}(n[0]);var s=n[1];let i=1;s&&s.constructor===Object&&(o.ia=s,typeof(s=n[++i])=="function"&&(o.na=!0,cI??=s,pI??=n[i+1],s=n[i+=2]));let a={};for(;s&&Array.isArray(s)&&s.length&&typeof s[0]=="number"&&s[0]>0;){for(var u=0;u<s.length;u++)a[s[u]]=s;s=n[++i]}for(u=1;s!==void 0;){let m;typeof s=="number"&&(u+=s,s=n[++i]);var c=void 0;if(s instanceof Nc?m=s:(m=R9,i--),m?.l){s=n[++i],c=n;var p=i;typeof s=="function"&&(s=s(),c[p]=s),c=s}for(p=u+1,typeof(s=n[++i])=="number"&&s<0&&(p-=s,s=n[++i]);u<p;u++){let h=a[u];c?r(o,u,m,c,h):t(o,u,m,h)}}return n[e]=o}function fI(e){return Array.isArray(e)?e[0]instanceof Nc?e:[O9,e]:[e,void 0]}function mI(e,t){return e instanceof De?(og(e),e.u):Array.isArray(e)?Ra(e,t,!1):void 0}function Ww(e,t,r,n){let o=r.g;e[t]=n?(s,i,a)=>o(s,i,a,n):o}function zw(e,t,r,n,o){let s=r.g,i,a;e[t]=(u,c,p)=>s(u,c,p,a||=Mu(Gw,Ww,zw,n).W,i||=Hw(n),o)}function Hw(e){let t=e[A3];if(t!=null)return t;let r=Mu(Gw,Ww,zw,e);return t=r.na?(n,o)=>cI(n,o,r):(n,o)=>{let s=Mt(n);for(;rI(o)&&o.h!=4;){var i=o.m,a=r[i];if(a==null){var u=r.ia;u&&(u=u[i])&&(u=D9(u))!=null&&(a=r[i]=u)}a!=null&&a(o,n,i)||(i=(a=o).l,Dd(a),a.ha?a=void 0:(u=a.g.g-i,a.g.g=i,a=tI(a.g,u)),i=n,a&&(ka||=Symbol(),(u=i[ka])?u.push(a):i[ka]=[a]))}return 16384&s&&Bu(n),!0},e[A3]=t}function D9(e){let t=(e=fI(e))[0].g;if(e=e[1]){let r=Hw(e),n=Mu(Gw,Ww,zw,e).W;return(o,s,i)=>t(o,s,i,n,r)}return t}function mg(e,t,r){e[t]=r.h}function hg(e,t,r,n){let o,s,i=r.h;e[t]=(a,u,c)=>i(a,u,c,s||=Mu(fg,mg,hg,n).W,o||=hI(n))}function hI(e){let t=e[k3];if(!t){let r=Mu(fg,mg,hg,e);t=(n,o)=>dI(n,o,r),e[k3]=t}return t}function dI(e,t,r){for(var n=br(e),o=+!!(512&n)-1,s=e.length,i=512&n?1:0,a=s+(256&n?-1:0);i<a;i++){let u=e[i];if(u==null)continue;let c=i-o,p=$3(r,c);p&&p(t,u,c)}if(256&n){n=e[s-1];for(let u in n)o=+u,Number.isNaN(o)||(s=n[o])!=null&&(a=$3(r,o))&&a(t,s,o)}if(e=ka?e[ka]:void 0)for(xc(t,t.g.end()),r=0;r<e.length;r++)xc(t,mw(e[r])||new Uint8Array(0))}function $3(e,t){var r=e[t];if(r)return r;if((r=e.ia)&&(r=r[t])){var n=(r=fI(r))[0].h;if(r=r[1]){let o=hI(r),s=Mu(fg,mg,hg,r).W;r=e.na?pI(s,o):(i,a,u)=>n(i,a,u,s,o)}else r=n;return e[t]=r}}function _c(e,t){if(Array.isArray(t)){var r=br(t);if(4&r)return t;for(var n=0,o=0;n<t.length;n++){let s=e(t[n]);s!=null&&(t[o++]=s)}return o<n&&(t.length=o),yr(t,-12289&(5|r)),2&r&&Object.freeze(t),t}}function po(e,t,r){return new Nc(e,t,r)}function Ic(e,t,r){return new Nc(e,t,r)}function fo(e,t,r){fr(e,Mt(e),t,r)}var F9=pg(function(e,t,r,n,o){return e.h===2&&(e=bm(e,Ra([void 0,void 0],n,!0),o),Ki(n=Mt(t)),(o=hi(t,n,r))instanceof cs?2&o.M?((o=o.Y()).push(e),fr(t,n,r,o)):o.Oa(e):Array.isArray(o)?(2&br(o)&&fr(t,n,r,o=j_(o)),o.push(e)):fr(t,n,r,[e]),!0)},function(e,t,r,n,o){if(t instanceof cs)t.forEach((s,i)=>{Xd(e,r,Ra([i,s],n,!1),o)});else if(Array.isArray(t))for(let s=0;s<t.length;s++){let i=t[s];Array.isArray(i)&&Xd(e,r,Ra(i,n,!1),o)}});function gI(e,t,r){if(t=function(n){if(n==null)return n;let o=typeof n;if(o==="bigint")return String(BigInt.asIntN(64,n));if(ng(n)){if(o==="string")return Tw(n);if(o==="number")return ww(n)}}(t),t!=null&&(typeof t=="string"&&I3(t),t!=null))switch(ps(e,r,0),typeof t){case"number":e=e.g,hc(t),pc(e,Yt,Er);break;case"bigint":r=BigInt.asUintN(64,t),r=new tw(Number(r&BigInt(4294967295)),Number(r>>BigInt(32))),pc(e.g,r.h,r.g);break;default:r=I3(t),pc(e.g,r.h,r.g)}}function xI(e,t,r){(t=Sc(t))!=null&&t!=null&&(ps(e,r,0),lg(e.g,t))}function yI(e,t,r){(t=D_(t))!=null&&(ps(e,r,0),e.g.g.push(t?1:0))}function bI(e,t,r){(t=$a(t))!=null&&cg(e,r,T_(t))}function vI(e,t,r,n,o){Xd(e,r,mI(t,n),o)}function wI(e,t,r){(t=t==null||typeof t=="string"||hm(t)||t instanceof zi?t:void 0)!=null&&cg(e,r,Rw(t).buffer)}function TI(e,t,r){return(e.h===5||e.h===2)&&(t=Ec(t,Mt(t),r,2,!1),e.h==2?ug(e,Jv,t):t.push(Jv(e.g)),!0)}var Vi=po(function(e,t,r){if(e.h!==1)return!1;var n=e.g;e=Qv(n);let o=Qv(n);n=2*(o>>31)+1;let s=o>>>20&2047;return e=4294967296*(1048575&o)+e,fo(t,r,s==2047?e?NaN:n*(1/0):s==0?5e-324*n*e:n*Math.pow(2,s-1075)*(e+4503599627370496)),!0},function(e,t,r){(t=Ba(t))!=null&&(ps(e,r,1),e=e.g,(r=O_||=new DataView(new ArrayBuffer(8))).setFloat64(0,+t,!0),Yt=r.getUint32(0,!0),Er=r.getUint32(4,!0),fm(e,Yt),fm(e,Er))},Ds()),jr=po(function(e,t,r){return e.h===5&&(fo(t,r,Jv(e.g)),!0)},function(e,t,r){(t=Ba(t))!=null&&(ps(e,r,5),e=e.g,xw(t),fm(e,Yt))},Vw),P9=Ic(TI,function(e,t,r){if((t=_c(Ba,t))!=null)for(let i=0;i<t.length;i++){var n=e,o=r,s=t[i];s!=null&&(ps(n,o,5),n=n.g,xw(s),fm(n,Yt))}},Vw),Kw=Ic(TI,function(e,t,r){if((t=_c(Ba,t))!=null&&t.length){ps(e,r,2),vm(e.g,4*t.length);for(let n=0;n<t.length;n++)r=e.g,xw(t[n]),fm(r,Yt)}},Vw),Pa=po(function(e,t,r){return e.h===0&&(fo(t,r,Ow(e.g,bw)),!0)},gI,iI),Mv=po(function(e,t,r){return e.h===0&&(fo(t,r,(e=Ow(e.g,bw))===0?void 0:e),!0)},gI,iI),L9=po(function(e,t,r){return e.h===0&&(fo(t,r,Ow(e.g,yw)),!0)},function(e,t,r){if((t=b9(t))!=null&&(typeof t=="string"&&_3(t),t!=null))switch(ps(e,r,0),typeof t){case"number":e=e.g,hc(t),pc(e,Yt,Er);break;case"bigint":r=BigInt.asUintN(64,t),r=new ew(Number(r&BigInt(4294967295)),Number(r>>BigInt(32))),pc(e.g,r.h,r.g);break;default:r=_3(t),pc(e.g,r.h,r.g)}},Ds()),Nr=po(function(e,t,r){return e.h===0&&(fo(t,r,Da(e.g)),!0)},xI,Uw),dg=Ic(function(e,t,r){return(e.h===0||e.h===2)&&(t=Ec(t,Mt(t),r,2,!1),e.h==2?ug(e,Da,t):t.push(Da(e.g)),!0)},function(e,t,r){if((t=_c(Sc,t))!=null&&t.length){r=Pw(e,r);for(let n=0;n<t.length;n++)lg(e.g,t[n]);Lw(e,r)}},Uw),cc=po(function(e,t,r){return e.h===0&&(fo(t,r,(e=Da(e.g))===0?void 0:e),!0)},xI,Uw),xr=po(function(e,t,r){return e.h===0&&(fo(t,r,Dw(e.g)),!0)},yI,sI),sm=po(function(e,t,r){return e.h===0&&(fo(t,r,(e=Dw(e.g))===!1?void 0:e),!0)},yI,sI),Nn=Ic(function(e,t,r){if(e.h!==2)return!1;e=Fw(e);let n=Mt(t);return Ki(n),Ec(t,n,r,2).push(e),!0},function(e,t,r){if((t=_c($a,t))!=null)for(let i=0;i<t.length;i++){var n=e,o=r,s=t[i];s!=null&&cg(n,o,T_(s))}},Mw),Aa=po(function(e,t,r){return e.h===2&&(fo(t,r,(e=Fw(e))===""?void 0:e),!0)},bI,Mw),Bt=po(function(e,t,r){return e.h===2&&(fo(t,r,Fw(e)),!0)},bI,Mw),qr=function(e,t,r=Bw){return new Nc(e,t,r)}(function(e,t,r,n,o){if(e.h!==2)return!1;n=Ra(void 0,n,!0);let s=Mt(t);Ki(s);let i=Ec(t,s,r,3);return s=Mt(t),4&br(i)&&(i=Mo(i),yr(i,-2079&(1|br(i))),fr(t,s,r,i)),i.push(n),bm(e,n,o),!0},function(e,t,r,n,o){if(Array.isArray(t))for(let s=0;s<t.length;s++)vI(e,t[s],r,n,o)}),Wt=pg(function(e,t,r,n,o,s){return e.h===2&&(X_(t,br(t),s,r),bm(e,t=kw(t,n,r),o),!0)},vI),SI=po(function(e,t,r){return e.h===2&&(fo(t,r,nI(e)),!0)},wI,aI),B9=Ic(function(e,t,r){return(e.h===0||e.h===2)&&(t=Ec(t,Mt(t),r,2,!1),e.h==2?ug(e,Fa,t):t.push(Fa(e.g)),!0)},function(e,t,r){if((t=_c(y9,t))!=null)for(let i=0;i<t.length;i++){var n=e,o=r,s=t[i];s!=null&&(ps(n,o,0),vm(n.g,s))}},Ds()),Rs=po(function(e,t,r){return e.h===0&&(fo(t,r,Da(e.g)),!0)},function(e,t,r){(t=Sc(t))!=null&&(t=parseInt(t,10),ps(e,r,0),lg(e.g,t))},uI),rw=class{constructor(t,r){this.h=t,this.g=r,this.l=Et,this.m=Ge,this.defaultValue=void 0}};function Fs(e,t){return new rw(e,t)}function Ma(e,t){return(r,n)=>{if(Ad.length){let s=Ad.pop();s.o(n),Bv(s.g,r,n),r=s}else r=new class{constructor(s,i){if(N3.length){let a=N3.pop();Bv(a,s,i),s=a}else s=new class{constructor(a,u){this.h=null,this.m=!1,this.g=this.l=this.j=0,Bv(this,a,u)}clear(){this.h=null,this.m=!1,this.g=this.l=this.j=0,this.ca=!1}}(s,i);this.g=s,this.l=this.g.g,this.h=this.m=-1,this.o(i)}o({ha:s=!1}={}){this.ha=s}}(r,n);try{let s=new e,i=s.u;Hw(t)(i,r);var o=s}finally{r.g.clear(),r.m=-1,r.h=-1,Ad.length<100&&Ad.push(r)}return o}}function gg(e){return function(){og(this);let t=new class{constructor(){this.l=[],this.h=0,this.g=new class{constructor(){this.g=[]}length(){return this.g.length}end(){let i=this.g;return this.g=[],i}}}};dI(this.u,t,Mu(fg,mg,hg,e)),xc(t,t.g.end());let r=new Uint8Array(t.h),n=t.l,o=n.length,s=0;for(let i=0;i<o;i++){let a=n[i];r.set(a,s),s+=a.length}return t.l=[r],r}}var R3=class extends De{constructor(e){super(e)}},O3=[0,Aa,po(function(e,t,r){return e.h===2&&(fo(t,r,(e=nI(e))===Pu()?void 0:e),!0)},function(e,t,r){if(t!=null){if(t instanceof De){let n=t.Ra;return void(n&&(t=n(t),t!=null&&cg(e,r,Rw(t).buffer)))}if(Array.isArray(t))return}wI(e,t,r)},aI)],Uv,D3=globalThis.trustedTypes;function F3(e){Uv===void 0&&(Uv=function(){let r=null;if(!D3)return r;try{let n=o=>o;r=D3.createPolicy("goog#html",{createHTML:n,createScript:n,createScriptURL:n})}catch{}return r}());var t=Uv;return new class{constructor(r){this.g=r}toString(){return this.g+""}}(t?t.createScriptURL(e):e)}function M9(e,...t){if(t.length===0)return F3(e[0]);let r=e[0];for(let n=0;n<t.length;n++)r+=encodeURIComponent(t[n])+e[n+1];return F3(r)}var CI=[0,Nr,Rs,xr,-1,dg,Rs,-1],U9=class extends De{constructor(){super()}},EI=[0,xr,Bt,xr,Rs,-1,Ic(function(e,t,r){return(e.h===0||e.h===2)&&(t=Ec(t,Mt(t),r,2,!1),e.h==2?ug(e,A9,t):t.push(Da(e.g)),!0)},function(e,t,r){if((t=_c(Sc,t))!=null&&t.length){r=Pw(e,r);for(let n=0;n<t.length;n++)lg(e.g,t[n]);Lw(e,r)}},uI),Bt,-1,[0,xr,-1],Rs,xr,-1],NI=[0,Bt,-2],P3=class extends De{constructor(){super()}},_I=[0],II=[0,Nr,xr,1,xr,-3],Uo=class extends De{constructor(e){super(e,2)}},Br={};Br[336783863]=[0,Bt,xr,-1,Nr,[0,[1,2,3,4,5,6,7],Wt,_I,Wt,EI,Wt,NI,Wt,II,Wt,CI,Wt,[0,Bt,-2],Wt,[0,Bt,Rs]],[0,Bt],xr,[0,[1,3],[2,4],Wt,[0,dg],-1,Wt,[0,Nn],-1,qr,[0,Bt,-1]],Bt];var L3=[0,Mv,-1,sm,-3,Mv,dg,Aa,cc,Mv,-1,sm,cc,sm,-2,Aa];function Vo(e,t){Zv(e,2,Cc(t),"")}function rr(e,t){ag(e,3,t)}function wt(e,t){ag(e,4,t)}var Gn=class extends De{constructor(e){super(e,500)}o(e){return Ge(this,0,7,e)}},im=[-1,{}],B3=[0,Bt,1,im],M3=[0,Bt,Nn,im];function Go(e,t){Kd(e,1,Gn,t)}function sr(e,t){ag(e,10,t)}function _t(e,t){ag(e,15,t)}var mo=class extends De{constructor(e){super(e,500)}o(e){return Ge(this,0,1001,e)}},AI=[-500,qr,[-500,Aa,-1,Nn,-3,[-2,Br,xr],qr,O3,cc,-1,B3,M3,qr,[0,Aa,sm],Aa,L3,cc,Nn,987,Nn],4,qr,[-500,Bt,-1,[-1,{}],998,Bt],qr,[-500,Bt,Nn,-1,[-2,{},xr],997,Nn,-1],cc,qr,[-500,Bt,Nn,im,998,Nn],Nn,cc,B3,M3,qr,[0,Aa,-1,im],Nn,-2,L3,Aa,-1,sm,979,im,qr,O3];mo.prototype.g=gg(AI);var V9=Ma(mo,AI),G9=class extends De{constructor(e){super(e)}},kI=class extends De{constructor(e){super(e)}g(){return Hi(this,G9,1)}},$I=[0,qr,[0,Nr,jr,Bt,-1]],xg=Ma(kI,$I),W9=class extends De{constructor(e){super(e)}},z9=class extends De{constructor(e){super(e)}},Vv=class extends De{constructor(e){super(e)}h(){return Et(this,W9,2)}g(){return Hi(this,z9,5)}},RI=Ma(class extends De{constructor(e){super(e)}},[0,Nn,dg,Kw,[0,Rs,[0,Nr,-3],[0,jr,-3],[0,Nr,-1,[0,qr,[0,Nr,-2]]],qr,[0,jr,-1,Bt,jr]],Bt,-1,Pa,qr,[0,Nr,jr],Nn,Pa]),OI=class extends De{constructor(e){super(e)}},fc=Ma(class extends De{constructor(e){super(e)}},[0,qr,[0,jr,-4]]),DI=class extends De{constructor(e){super(e)}},wm=Ma(class extends De{constructor(e){super(e)}},[0,qr,[0,jr,-4]]),H9=class extends De{constructor(e){super(e)}},K9=[0,Nr,-1,Kw,Rs],FI=class extends De{constructor(){super()}};FI.prototype.g=gg([0,jr,-4,Pa]);var q9=class extends De{constructor(e){super(e)}},j9=Ma(class extends De{constructor(e){super(e)}},[0,qr,[0,1,Nr,Bt,$I],Pa]),U3=class extends De{constructor(e){super(e)}},X9=class extends De{constructor(e){super(e)}qa(){let e=H_(this);return e??Pu()}},Y9=class extends De{constructor(e){super(e)}},PI=[1,2],Z9=Ma(class extends De{constructor(e){super(e)}},[0,qr,[0,PI,Wt,[0,Kw],Wt,[0,SI],Nr,Bt],Pa]),qw=class extends De{constructor(e){super(e)}},LI=[0,Bt,Nr,jr,Nn,-1],V3=class extends De{constructor(e){super(e)}},Q9=[0,xr,-1],G3=class extends De{constructor(e){super(e)}},Fd=[1,2,3,4,5],Yd=class extends De{constructor(e){super(e)}g(){return H_(this)!=null}h(){return $a(Oa(this,2))!=null}},mr=class extends De{constructor(e){super(e)}g(){return D_(Oa(this,2))??!1}},BI=[0,SI,Bt,[0,Nr,Pa,-1],[0,L9,Pa]],Fr=[0,BI,xr,[0,Fd,Wt,II,Wt,EI,Wt,CI,Wt,_I,Wt,NI],Rs],yg=class extends De{constructor(e){super(e)}},jw=[0,Fr,jr,-1,Nr],J9=Fs(502141897,yg);Br[502141897]=jw;var eW=Ma(class extends De{constructor(e){super(e)}},[0,[0,Rs,-1,P9,B9],K9]),MI=class extends De{constructor(e){super(e)}},UI=class extends De{constructor(e){super(e)}},Xw=[0,Fr,jr,[0,Fr],xr],VI=[0,Fr,jw,Xw,jr,[0,[0,BI]]],tW=Fs(508968150,UI);Br[508968150]=VI,Br[508968149]=Xw;var GI=class extends De{constructor(e){super(e)}},rW=Fs(513916220,GI);Br[513916220]=[0,Fr,VI,Nr];var uc=class extends De{constructor(e){super(e)}h(){return Et(this,qw,2)}g(){tr(this,2)}},WI=[0,Fr,LI];Br[478825465]=WI;var nW=class extends De{constructor(e){super(e)}},zI=class extends De{constructor(e){super(e)}},Yw=class extends De{constructor(e){super(e)}},Zw=class extends De{constructor(e){super(e)}},HI=class extends De{constructor(e){super(e)}},W3=[0,Fr,[0,Fr],WI,-1],KI=[0,Fr,jr,Nr],Qw=[0,Fr,jr],qI=[0,Fr,KI,Qw,jr],oW=Fs(479097054,HI);Br[479097054]=[0,Fr,qI,W3],Br[463370452]=W3,Br[464864288]=KI;var sW=Fs(462713202,Zw);Br[462713202]=qI,Br[474472470]=Qw;var iW=class extends De{constructor(e){super(e)}},jI=class extends De{constructor(e){super(e)}},XI=class extends De{constructor(e){super(e)}},YI=class extends De{constructor(){super()}},Jw=[0,Fr,jr,-1,Nr],nw=[0,Fr,jr,xr];YI.prototype.g=gg([0,Fr,Qw,[0,Fr],jw,Xw,Jw,nw]);var ZI=class extends De{constructor(e){super(e)}},aW=Fs(456383383,ZI);Br[456383383]=[0,Fr,LI];var QI=class extends De{constructor(e){super(e)}},uW=Fs(476348187,QI);Br[476348187]=[0,Fr,Q9];var JI=class extends De{constructor(e){super(e)}},z3=class extends De{constructor(e){super(e)}},e4=[0,Rs,-1],lW=Fs(458105876,class extends De{constructor(e){super(e)}g(){var e=this.u;let t=Mt(e),r=2&t;return e=function(n,o,s){var i=z3;let a=2&o,u=!1;if(s==null){if(a)return C3();s=[]}else if(s.constructor===cs){if(!(2&s.M)||a)return s;s=s.Y()}else Array.isArray(s)?u=!!(2&br(s)):s=[];if(a){if(!s.length)return C3();u||(u=!0,Bu(s))}else u&&(u=!1,s=j_(s));return u||(64&br(s)?Md(s,32):32&o&&Qd(s,32)),fr(n,o,2,i=new cs(s,i,v9,void 0)),i}(e,t,hi(e,t,2)),!r&&z3&&(e.ta=!0),e}});Br[458105876]=[0,e4,F9,[!0,Pa,[0,Bt,-1,Nn]]];var eT=class extends De{constructor(e){super(e)}},t4=Fs(458105758,eT);Br[458105758]=[0,Fr,Bt,e4];var r4=class extends De{constructor(e){super(e)}},cW=Fs(443442058,r4);Br[443442058]=[0,Fr,Bt,Nr,jr,Nn,-1],Br[514774813]=Jw;var n4=class extends De{constructor(e){super(e)}},pW=Fs(516587230,n4);function ow(e,t){return t=t?t.clone():new qw,e.displayNamesLocale!==void 0?tr(t,1,Cc(e.displayNamesLocale)):e.displayNamesLocale===void 0&&tr(t,1),e.maxResults!==void 0?mi(t,2,e.maxResults):"maxResults"in e&&tr(t,2),e.scoreThreshold!==void 0?Le(t,3,e.scoreThreshold):"scoreThreshold"in e&&tr(t,3),e.categoryAllowlist!==void 0?qd(t,4,e.categoryAllowlist):"categoryAllowlist"in e&&tr(t,4),e.categoryDenylist!==void 0?qd(t,5,e.categoryDenylist):"categoryDenylist"in e&&tr(t,5),t}function tT(e,t=-1,r=""){return{categories:e.map(n=>({index:$s(ls(n,1),0)??-1,score:Dr(n,2)??0,categoryName:fi(n,3)??"",displayName:fi(n,4)??""})),headIndex:t,headName:r}}function o4(e){var t=Ru(e,3,Ba,$u()),r=Ru(e,2,Sc,$u()),n=Ru(e,1,$a,$u()),o=Ru(e,9,$a,$u());let s={categories:[],keypoints:[]};for(let i=0;i<t.length;i++)s.categories.push({score:t[i],index:r[i]??-1,categoryName:n[i]??"",displayName:o[i]??""});if((t=Et(e,Vv,4)?.h())&&(s.boundingBox={originX:ls(t,1)??0,originY:ls(t,2)??0,width:ls(t,3)??0,height:ls(t,4)??0,angle:0}),Et(e,Vv,4)?.g().length)for(let i of Et(e,Vv,4).g())s.keypoints.push({x:Od(i,1)??0,y:Od(i,2)??0,score:Od(i,4)??0,label:$a(Oa(i,3))??""});return s}function bg(e){let t=[];for(let r of Hi(e,DI,1))t.push({x:Dr(r,1)??0,y:Dr(r,2)??0,z:Dr(r,3)??0,visibility:Dr(r,4)??0});return t}function am(e){let t=[];for(let r of Hi(e,OI,1))t.push({x:Dr(r,1)??0,y:Dr(r,2)??0,z:Dr(r,3)??0,visibility:Dr(r,4)??0});return t}function H3(e){return Array.from(e,t=>t>127?t-256:t)}function K3(e,t){if(e.length!==t.length)throw Error(`Cannot compute cosine similarity between embeddings of different sizes (${e.length} vs. ${t.length}).`);let r=0,n=0,o=0;for(let s=0;s<e.length;s++)r+=e[s]*t[s],n+=e[s]*e[s],o+=t[s]*t[s];if(n<=0||o<=0)throw Error("Cannot compute cosine similarity on embedding with 0 norm.");return r/Math.sqrt(n*o)}var kd;Br[516587230]=[0,Fr,Jw,nw,jr],Br[518928384]=nw;var fW=new Uint8Array([0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,10,1,8,0,65,0,253,15,253,98,11]);function s4(){return ne(this,null,function*(){if(kd===void 0)try{yield WebAssembly.instantiate(fW),kd=!0}catch{kd=!1}return kd})}function Jf(r){return ne(this,arguments,function*(e,t=M9``){let n=(yield s4())?"wasm_internal":"wasm_nosimd_internal";return{wasmLoaderPath:`${t}/${e}_${n}.js`,wasmBinaryPath:`${t}/${e}_${n}.wasm`}})}var _a=class{};function i4(){var e=navigator;return typeof OffscreenCanvas<"u"&&(!function(t=navigator){return(t=t.userAgent).includes("Safari")&&!t.includes("Chrome")}(e)||!!((e=e.userAgent.match(/Version\/([\d]+).*Safari/))&&e.length>=1&&Number(e[1])>=17))}function q3(e){return ne(this,null,function*(){if(typeof importScripts!="function"){let t=document.createElement("script");return t.src=e.toString(),t.crossOrigin="anonymous",new Promise((r,n)=>{t.addEventListener("load",()=>{r()},!1),t.addEventListener("error",o=>{n(o)},!1),document.body.appendChild(t)})}importScripts(e.toString())})}function a4(e){return e.videoWidth!==void 0?[e.videoWidth,e.videoHeight]:e.naturalWidth!==void 0?[e.naturalWidth,e.naturalHeight]:e.displayWidth!==void 0?[e.displayWidth,e.displayHeight]:[e.width,e.height]}function Me(e,t,r){e.m||console.error("No wasm multistream support detected: ensure dependency inclusion of :gl_graph_runner_internal_multi_input target"),r(t=e.i.stringToNewUTF8(t)),e.i._free(t)}function j3(e,t,r){if(!e.i.canvas)throw Error("No OpenGL canvas configured.");if(r?e.i._bindTextureToStream(r):e.i._bindTextureToCanvas(),!(r=e.i.canvas.getContext("webgl2")||e.i.canvas.getContext("webgl")))throw Error("Failed to obtain WebGL context from the provided canvas. `getContext()` should only be invoked with `webgl` or `webgl2`.");e.i.gpuOriginForWebTexturesIsBottomLeft&&r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,!0),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,t),e.i.gpuOriginForWebTexturesIsBottomLeft&&r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,!1);let[n,o]=a4(t);return!e.l||n===e.i.canvas.width&&o===e.i.canvas.height||(e.i.canvas.width=n,e.i.canvas.height=o),[n,o]}function X3(e,t,r){e.m||console.error("No wasm multistream support detected: ensure dependency inclusion of :gl_graph_runner_internal_multi_input target");let n=new Uint32Array(t.length);for(let o=0;o<t.length;o++)n[o]=e.i.stringToNewUTF8(t[o]);t=e.i._malloc(4*n.length),e.i.HEAPU32.set(n,t>>2),r(t);for(let o of n)e.i._free(o);e.i._free(t)}function ui(e,t,r){e.i.simpleListeners=e.i.simpleListeners||{},e.i.simpleListeners[t]=r}function Na(e,t,r){let n=[];e.i.simpleListeners=e.i.simpleListeners||{},e.i.simpleListeners[t]=(o,s,i)=>{s?(r(n,i),n=[]):n.push(o)}}_a.forVisionTasks=function(e){return Jf("vision",e)},_a.forTextTasks=function(e){return Jf("text",e)},_a.forGenAiExperimentalTasks=function(e){return Jf("genai_experimental",e)},_a.forGenAiTasks=function(e){return Jf("genai",e)},_a.forAudioTasks=function(e){return Jf("audio",e)},_a.isSimdSupported=function(){return s4()};function mW(e,t,r,n){return ne(this,null,function*(){return e=yield((o,s,i,a,u)=>ne(this,null,function*(){if(s&&(yield q3(s)),!self.ModuleFactory||i&&(yield q3(i),!self.ModuleFactory))throw Error("ModuleFactory not set.");return self.Module&&u&&((s=self.Module).locateFile=u.locateFile,u.mainScriptUrlOrBlob&&(s.mainScriptUrlOrBlob=u.mainScriptUrlOrBlob)),u=yield self.ModuleFactory(self.Module||u),self.ModuleFactory=self.Module=void 0,new o(u,a)}))(e,r.wasmLoaderPath,r.assetLoaderPath,t,{locateFile:o=>o.endsWith(".wasm")?r.wasmBinaryPath.toString():r.assetBinaryPath&&o.endsWith(".data")?r.assetBinaryPath.toString():o}),yield e.o(n),e})}function Gv(e,t){let r=Et(e.baseOptions,Yd,1)||new Yd;typeof t=="string"?(tr(r,2,Cc(t)),tr(r,1)):t instanceof Uint8Array&&(tr(r,1,gw(t,!1,!1)),tr(r,2)),Ge(e.baseOptions,0,1,r)}function Y3(e){try{let t=e.H.length;if(t===1)throw Error(e.H[0].message);if(t>1)throw Error("Encountered multiple errors: "+e.H.map(r=>r.message).join(", "))}finally{e.H=[]}}function Ae(e,t){e.B=Math.max(e.B,t)}function vg(e,t){e.A=new Gn,Vo(e.A,"PassThroughCalculator"),rr(e.A,"free_memory"),wt(e.A,"free_memory_unused_out"),sr(t,"free_memory"),Go(t,e.A)}function yc(e,t){rr(e.A,t),wt(e.A,t+"_unused_out")}function wg(e){e.g.addBoolToStream(!0,"free_memory",e.B)}var Pd=class{constructor(e){this.g=e,this.H=[],this.B=0,this.g.setAutoRenderToScreen(!1)}l(e,t=!0){if(t){let r=e.baseOptions||{};if(e.baseOptions?.modelAssetBuffer&&e.baseOptions?.modelAssetPath)throw Error("Cannot set both baseOptions.modelAssetPath and baseOptions.modelAssetBuffer");if(!(Et(this.baseOptions,Yd,1)?.g()||Et(this.baseOptions,Yd,1)?.h()||e.baseOptions?.modelAssetBuffer||e.baseOptions?.modelAssetPath))throw Error("Either baseOptions.modelAssetPath or baseOptions.modelAssetBuffer must be set");if(function(n,o){let s=Et(n.baseOptions,G3,3);if(!s){var i=s=new G3,a=new P3;om(i,4,Fd,a)}"delegate"in o&&(o.delegate==="GPU"?(o=s,i=new U9,om(o,2,Fd,i)):(o=s,i=new P3,om(o,4,Fd,i))),Ge(n.baseOptions,0,3,s)}(this,r),r.modelAssetPath)return fetch(r.modelAssetPath.toString()).then(n=>{if(n.ok)return n.arrayBuffer();throw Error(`Failed to fetch model: ${r.modelAssetPath} (${n.status})`)}).then(n=>{try{this.g.i.FS_unlink("/model.dat")}catch{}this.g.i.FS_createDataFile("/","model.dat",new Uint8Array(n),!0,!1,!1),Gv(this,"/model.dat"),this.m(),this.J()});if(r.modelAssetBuffer instanceof Uint8Array)Gv(this,r.modelAssetBuffer);else if(r.modelAssetBuffer)return function(n){return ne(this,null,function*(){let o=[];for(var s=0;;){let{done:i,value:a}=yield n.read();if(i)break;o.push(a),s+=a.length}if(o.length===0)return new Uint8Array(0);if(o.length===1)return o[0];n=new Uint8Array(s),s=0;for(let i of o)n.set(i,s),s+=i.length;return n})}(r.modelAssetBuffer).then(n=>{Gv(this,n),this.m(),this.J()})}return this.m(),this.J(),Promise.resolve()}J(){}ea(){let e;if(this.g.ea(t=>{e=V9(t)}),!e)throw Error("Failed to retrieve CalculatorGraphConfig");return e}setGraph(e,t){this.g.attachErrorListener((r,n)=>{this.H.push(Error(n))}),this.g.Ma(),this.g.setGraph(e,t),this.A=void 0,Y3(this)}finishProcessing(){this.g.finishProcessing(),Y3(this)}close(){this.A=void 0,this.g.closeGraph()}};function Vn(e,t){if(!e)throw Error(`Unable to obtain required WebGL resource: ${t}`);return e}Pd.prototype.close=Pd.prototype.close,function(e,t){e=e.split(".");var r,n=Fu;for((e[0]in n)||n.execScript===void 0||n.execScript("var "+e[0]);e.length&&(r=e.shift());)e.length||t===void 0?n=n[r]&&n[r]!==Object.prototype[r]?n[r]:n[r]={}:n[r]=t}("TaskRunner",Pd);var sw=class{constructor(t,r,n,o){this.g=t,this.h=r,this.m=n,this.l=o}bind(){this.g.bindVertexArray(this.h)}close(){this.g.deleteVertexArray(this.h),this.g.deleteBuffer(this.m),this.g.deleteBuffer(this.l)}};function Z3(e,t,r){let n=e.g;if(r=Vn(n.createShader(r),"Failed to create WebGL shader"),n.shaderSource(r,t),n.compileShader(r),!n.getShaderParameter(r,n.COMPILE_STATUS))throw Error(`Could not compile WebGL shader: ${n.getShaderInfoLog(r)}`);return n.attachShader(e.h,r),r}function Q3(e,t){let r=e.g,n=Vn(r.createVertexArray(),"Failed to create vertex array");r.bindVertexArray(n);let o=Vn(r.createBuffer(),"Failed to create buffer");r.bindBuffer(r.ARRAY_BUFFER,o),r.enableVertexAttribArray(e.P),r.vertexAttribPointer(e.P,2,r.FLOAT,!1,0,0),r.bufferData(r.ARRAY_BUFFER,new Float32Array([-1,-1,-1,1,1,1,1,-1]),r.STATIC_DRAW);let s=Vn(r.createBuffer(),"Failed to create buffer");return r.bindBuffer(r.ARRAY_BUFFER,s),r.enableVertexAttribArray(e.J),r.vertexAttribPointer(e.J,2,r.FLOAT,!1,0,0),r.bufferData(r.ARRAY_BUFFER,new Float32Array(t?[0,1,0,0,1,0,1,1]:[0,0,0,1,1,1,1,0]),r.STATIC_DRAW),r.bindBuffer(r.ARRAY_BUFFER,null),r.bindVertexArray(null),new sw(r,n,o,s)}function rT(e,t){if(e.g){if(t!==e.g)throw Error("Cannot change GL context once initialized")}else e.g=t}function Tm(e,t,r,n){return rT(e,t),e.h||(e.m(),e.C()),r?(e.s||(e.s=Q3(e,!0)),r=e.s):(e.v||(e.v=Q3(e,!1)),r=e.v),t.useProgram(e.h),r.bind(),e.l(),e=n(),r.g.bindVertexArray(null),e}function La(e,t,r){return rT(e,t),e=Vn(t.createTexture(),"Failed to create texture"),t.bindTexture(t.TEXTURE_2D,e),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,r??t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,r??t.LINEAR),t.bindTexture(t.TEXTURE_2D,null),e}function Tg(e,t,r){rT(e,t),e.A||(e.A=Vn(t.createFramebuffer(),"Failed to create framebuffe.")),t.bindFramebuffer(t.FRAMEBUFFER,e.A),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,r,0)}function nT(e){e.g?.bindFramebuffer(e.g.FRAMEBUFFER,null)}var Ac=class{H(){return`
  precision mediump float;
  varying vec2 vTex;
  uniform sampler2D inputTexture;
  void main() {
    gl_FragColor = texture2D(inputTexture, vTex);
  }
 `}m(){let e=this.g;if(this.h=Vn(e.createProgram(),"Failed to create WebGL program"),this.ba=Z3(this,`
  attribute vec2 aVertex;
  attribute vec2 aTex;
  varying vec2 vTex;
  void main(void) {
    gl_Position = vec4(aVertex, 0.0, 1.0);
    vTex = aTex;
  }`,e.VERTEX_SHADER),this.aa=Z3(this,this.H(),e.FRAGMENT_SHADER),e.linkProgram(this.h),!e.getProgramParameter(this.h,e.LINK_STATUS))throw Error(`Error during program linking: ${e.getProgramInfoLog(this.h)}`);this.P=e.getAttribLocation(this.h,"aVertex"),this.J=e.getAttribLocation(this.h,"aTex")}C(){}l(){}close(){if(this.h){let e=this.g;e.deleteProgram(this.h),e.deleteShader(this.ba),e.deleteShader(this.aa)}this.A&&this.g.deleteFramebuffer(this.A),this.v&&this.v.close(),this.s&&this.s.close()}},hW=class extends Ac{H(){return`
  precision mediump float;
  uniform sampler2D backgroundTexture;
  uniform sampler2D maskTexture;
  uniform sampler2D colorMappingTexture;
  varying vec2 vTex;
  void main() {
    vec4 backgroundColor = texture2D(backgroundTexture, vTex);
    float category = texture2D(maskTexture, vTex).r;
    vec4 categoryColor = texture2D(colorMappingTexture, vec2(category, 0.0));
    gl_FragColor = mix(backgroundColor, categoryColor, categoryColor.a);
  }
 `}C(){let e=this.g;e.activeTexture(e.TEXTURE1),this.B=La(this,e,e.LINEAR),e.activeTexture(e.TEXTURE2),this.j=La(this,e,e.NEAREST)}m(){super.m();let e=this.g;this.L=Vn(e.getUniformLocation(this.h,"backgroundTexture"),"Uniform location"),this.U=Vn(e.getUniformLocation(this.h,"colorMappingTexture"),"Uniform location"),this.K=Vn(e.getUniformLocation(this.h,"maskTexture"),"Uniform location")}l(){super.l();let e=this.g;e.uniform1i(this.K,0),e.uniform1i(this.L,1),e.uniform1i(this.U,2)}close(){this.B&&this.g.deleteTexture(this.B),this.j&&this.g.deleteTexture(this.j),super.close()}},dW=class extends Ac{H(){return`
  precision mediump float;
  uniform sampler2D maskTexture;
  uniform sampler2D defaultTexture;
  uniform sampler2D overlayTexture;
  varying vec2 vTex;
  void main() {
    float confidence = texture2D(maskTexture, vTex).r;
    vec4 defaultColor = texture2D(defaultTexture, vTex);
    vec4 overlayColor = texture2D(overlayTexture, vTex);
    // Apply the alpha from the overlay and merge in the default color
    overlayColor = mix(defaultColor, overlayColor, overlayColor.a);
    gl_FragColor = mix(defaultColor, overlayColor, confidence);
  }
 `}C(){let e=this.g;e.activeTexture(e.TEXTURE1),this.j=La(this,e),e.activeTexture(e.TEXTURE2),this.B=La(this,e)}m(){super.m();let e=this.g;this.K=Vn(e.getUniformLocation(this.h,"defaultTexture"),"Uniform location"),this.L=Vn(e.getUniformLocation(this.h,"overlayTexture"),"Uniform location"),this.I=Vn(e.getUniformLocation(this.h,"maskTexture"),"Uniform location")}l(){super.l();let e=this.g;e.uniform1i(this.I,0),e.uniform1i(this.K,1),e.uniform1i(this.L,2)}close(){this.j&&this.g.deleteTexture(this.j),this.B&&this.g.deleteTexture(this.B),super.close()}};function Wi(e,t){switch(t){case 0:return e.g.find(r=>r instanceof Uint8Array);case 1:return e.g.find(r=>r instanceof Float32Array);case 2:return e.g.find(r=>typeof WebGLTexture<"u"&&r instanceof WebGLTexture);default:throw Error(`Type is not supported: ${t}`)}}function iw(e){var t=Wi(e,1);if(!t){if(t=Wi(e,0))t=new Float32Array(t).map(n=>n/255);else{t=new Float32Array(e.width*e.height);let n=bc(e);var r=oT(e);if(Tg(r,n,u4(e)),"iPad Simulator;iPhone Simulator;iPod Simulator;iPad;iPhone;iPod".split(";").includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"document"in self&&"ontouchend"in self.document){r=new Float32Array(e.width*e.height*4),n.readPixels(0,0,e.width,e.height,n.RGBA,n.FLOAT,r);for(let o=0,s=0;o<t.length;++o,s+=4)t[o]=r[s]}else n.readPixels(0,0,e.width,e.height,n.RED,n.FLOAT,t)}e.g.push(t)}return t}function u4(e){let t=Wi(e,2);if(!t){let r=bc(e);t=c4(e);let n=iw(e),o=l4(e);r.texImage2D(r.TEXTURE_2D,0,o,e.width,e.height,0,r.RED,r.FLOAT,n),aw(e)}return t}function bc(e){if(!e.canvas)throw Error("Conversion to different image formats require that a canvas is passed when initializing the image.");return e.h||(e.h=Vn(e.canvas.getContext("webgl2"),"You cannot use a canvas that is already bound to a different type of rendering context.")),e.h}function l4(e){if(e=bc(e),!$d)if(e.getExtension("EXT_color_buffer_float")&&e.getExtension("OES_texture_float_linear")&&e.getExtension("EXT_float_blend"))$d=e.R32F;else{if(!e.getExtension("EXT_color_buffer_half_float"))throw Error("GPU does not fully support 4-channel float32 or float16 formats");$d=e.R16F}return $d}function oT(e){return e.l||(e.l=new Ac),e.l}function c4(e){let t=bc(e);t.viewport(0,0,e.width,e.height),t.activeTexture(t.TEXTURE0);let r=Wi(e,2);return r||(r=La(oT(e),t,e.m?t.LINEAR:t.NEAREST),e.g.push(r),e.j=!0),t.bindTexture(t.TEXTURE_2D,r),r}function aw(e){e.h.bindTexture(e.h.TEXTURE_2D,null)}var $d,Kr=class{constructor(e,t,r,n,o,s,i){this.g=e,this.m=t,this.j=r,this.canvas=n,this.l=o,this.width=s,this.height=i,this.j&&--J3===0&&console.error("You seem to be creating MPMask instances without invoking .close(). This leaks resources.")}Ha(){return!!Wi(this,0)}la(){return!!Wi(this,1)}R(){return!!Wi(this,2)}ka(){return(t=Wi(e=this,0))||(t=iw(e),t=new Uint8Array(t.map(r=>255*r)),e.g.push(t)),t;var e,t}ja(){return iw(this)}N(){return u4(this)}clone(){let e=[];for(let t of this.g){let r;if(t instanceof Uint8Array)r=new Uint8Array(t);else if(t instanceof Float32Array)r=new Float32Array(t);else{if(!(t instanceof WebGLTexture))throw Error(`Type is not supported: ${t}`);{let n=bc(this),o=oT(this);n.activeTexture(n.TEXTURE1),r=La(o,n,this.m?n.LINEAR:n.NEAREST),n.bindTexture(n.TEXTURE_2D,r);let s=l4(this);n.texImage2D(n.TEXTURE_2D,0,s,this.width,this.height,0,n.RED,n.FLOAT,null),n.bindTexture(n.TEXTURE_2D,null),Tg(o,n,r),Tm(o,n,!1,()=>{c4(this),n.clearColor(0,0,0,0),n.clear(n.COLOR_BUFFER_BIT),n.drawArrays(n.TRIANGLE_FAN,0,4),aw(this)}),nT(o),aw(this)}}e.push(r)}return new Kr(e,this.m,this.R(),this.canvas,this.l,this.width,this.height)}close(){this.j&&bc(this).deleteTexture(Wi(this,2)),J3=-1}};Kr.prototype.close=Kr.prototype.close,Kr.prototype.clone=Kr.prototype.clone,Kr.prototype.getAsWebGLTexture=Kr.prototype.N,Kr.prototype.getAsFloat32Array=Kr.prototype.ja,Kr.prototype.getAsUint8Array=Kr.prototype.ka,Kr.prototype.hasWebGLTexture=Kr.prototype.R,Kr.prototype.hasFloat32Array=Kr.prototype.la,Kr.prototype.hasUint8Array=Kr.prototype.Ha;var J3=250,gW={color:"white",lineWidth:4,radius:6};function Wv(e){return Ta(nc(Ta({},gW),{fillColor:(e=e||{}).color}),e)}function Ui(e,t){return e instanceof Function?e(t):e}function e_(e,t,r){return Math.max(Math.min(t,r),Math.min(Math.max(t,r),e))}function em(e){if(!e.l)throw Error("CPU rendering requested but CanvasRenderingContext2D not provided.");return e.l}function mm(e){if(!e.j)throw Error("GPU rendering requested but WebGL2RenderingContext not provided.");return e.j}function t_(e,t,r){if(t.R())r(t.N());else{let n=t.la()?t.ja():t.ka();e.m=e.m??new Ac;let o=mm(e);r((e=new Kr([n],t.m,!1,o.canvas,e.m,t.width,t.height)).N()),e.close()}}function r_(e,t,r,n){let o=function(a){return a.g||(a.g=new hW),a.g}(e),s=mm(e),i=Array.isArray(r)?new ImageData(new Uint8ClampedArray(r),1,1):r;Tm(o,s,!0,()=>{(function(u,c,p,m){let h=u.g;if(h.activeTexture(h.TEXTURE0),h.bindTexture(h.TEXTURE_2D,c),h.activeTexture(h.TEXTURE1),h.bindTexture(h.TEXTURE_2D,u.B),h.texImage2D(h.TEXTURE_2D,0,h.RGBA,h.RGBA,h.UNSIGNED_BYTE,p),u.I&&function(x,y){if(x!==y)return!1;x=x.entries(),y=y.entries();for(let[w,C]of x){x=w;let I=C;var v=y.next();if(v.done)return!1;let[D,P]=v.value;if(v=P,x!==D||I[0]!==v[0]||I[1]!==v[1]||I[2]!==v[2]||I[3]!==v[3])return!1}return!!y.next().done}(u.I,m))h.activeTexture(h.TEXTURE2),h.bindTexture(h.TEXTURE_2D,u.j);else{u.I=m;let x=Array(1024).fill(0);m.forEach((y,v)=>{if(y.length!==4)throw Error(`Color at index ${v} is not a four-channel value.`);x[4*v]=y[0],x[4*v+1]=y[1],x[4*v+2]=y[2],x[4*v+3]=y[3]}),h.activeTexture(h.TEXTURE2),h.bindTexture(h.TEXTURE_2D,u.j),h.texImage2D(h.TEXTURE_2D,0,h.RGBA,256,1,0,h.RGBA,h.UNSIGNED_BYTE,new Uint8Array(x))}})(o,t,i,n),s.clearColor(0,0,0,0),s.clear(s.COLOR_BUFFER_BIT),s.drawArrays(s.TRIANGLE_FAN,0,4);let a=o.g;a.activeTexture(a.TEXTURE0),a.bindTexture(a.TEXTURE_2D,null),a.activeTexture(a.TEXTURE1),a.bindTexture(a.TEXTURE_2D,null),a.activeTexture(a.TEXTURE2),a.bindTexture(a.TEXTURE_2D,null)})}function n_(e,t,r,n){let o=mm(e),s=function(u){return u.h||(u.h=new dW),u.h}(e),i=Array.isArray(r)?new ImageData(new Uint8ClampedArray(r),1,1):r,a=Array.isArray(n)?new ImageData(new Uint8ClampedArray(n),1,1):n;Tm(s,o,!0,()=>{var u=s.g;u.activeTexture(u.TEXTURE0),u.bindTexture(u.TEXTURE_2D,t),u.activeTexture(u.TEXTURE1),u.bindTexture(u.TEXTURE_2D,s.j),u.texImage2D(u.TEXTURE_2D,0,u.RGBA,u.RGBA,u.UNSIGNED_BYTE,i),u.activeTexture(u.TEXTURE2),u.bindTexture(u.TEXTURE_2D,s.B),u.texImage2D(u.TEXTURE_2D,0,u.RGBA,u.RGBA,u.UNSIGNED_BYTE,a),o.clearColor(0,0,0,0),o.clear(o.COLOR_BUFFER_BIT),o.drawArrays(o.TRIANGLE_FAN,0,4),o.bindTexture(o.TEXTURE_2D,null),(u=s.g).activeTexture(u.TEXTURE0),u.bindTexture(u.TEXTURE_2D,null),u.activeTexture(u.TEXTURE1),u.bindTexture(u.TEXTURE_2D,null),u.activeTexture(u.TEXTURE2),u.bindTexture(u.TEXTURE_2D,null)})}var uo=class{constructor(e,t){e instanceof CanvasRenderingContext2D||e instanceof OffscreenCanvasRenderingContext2D?(this.l=e,this.j=t):this.j=e}Aa(e,t){if(e){var r=em(this);t=Wv(t),r.save();var n=r.canvas,o=0;for(let s of e)r.fillStyle=Ui(t.fillColor,{index:o,from:s}),r.strokeStyle=Ui(t.color,{index:o,from:s}),r.lineWidth=Ui(t.lineWidth,{index:o,from:s}),(e=new Path2D).arc(s.x*n.width,s.y*n.height,Ui(t.radius,{index:o,from:s}),0,2*Math.PI),r.fill(e),r.stroke(e),++o;r.restore()}}za(e,t,r){if(e&&t){var n=em(this);r=Wv(r),n.save();var o=n.canvas,s=0;for(let i of t){n.beginPath(),t=e[i.start];let a=e[i.end];t&&a&&(n.strokeStyle=Ui(r.color,{index:s,from:t,to:a}),n.lineWidth=Ui(r.lineWidth,{index:s,from:t,to:a}),n.moveTo(t.x*o.width,t.y*o.height),n.lineTo(a.x*o.width,a.y*o.height)),++s,n.stroke()}n.restore()}}wa(e,t){let r=em(this);t=Wv(t),r.save(),r.beginPath(),r.lineWidth=Ui(t.lineWidth,{}),r.strokeStyle=Ui(t.color,{}),r.fillStyle=Ui(t.fillColor,{}),r.moveTo(e.originX,e.originY),r.lineTo(e.originX+e.width,e.originY),r.lineTo(e.originX+e.width,e.originY+e.height),r.lineTo(e.originX,e.originY+e.height),r.lineTo(e.originX,e.originY),r.stroke(),r.fill(),r.restore()}xa(e,t,r=[0,0,0,255]){this.l?function(n,o,s,i){let a=mm(n);t_(n,o,u=>{r_(n,u,s,i),(u=em(n)).drawImage(a.canvas,0,0,u.canvas.width,u.canvas.height)})}(this,e,r,t):r_(this,e.N(),r,t)}ya(e,t,r){this.l?function(n,o,s,i){let a=mm(n);t_(n,o,u=>{n_(n,u,s,i),(u=em(n)).drawImage(a.canvas,0,0,u.canvas.width,u.canvas.height)})}(this,e,t,r):n_(this,e.N(),t,r)}close(){this.g?.close(),this.g=void 0,this.h?.close(),this.h=void 0,this.m?.close(),this.m=void 0}};function pi(e,t){switch(t){case 0:return e.g.find(r=>r instanceof ImageData);case 1:return e.g.find(r=>typeof ImageBitmap<"u"&&r instanceof ImageBitmap);case 2:return e.g.find(r=>typeof WebGLTexture<"u"&&r instanceof WebGLTexture);default:throw Error(`Type is not supported: ${t}`)}}function p4(e){var t=pi(e,0);if(!t){t=vc(e);let r=Sg(e),n=new Uint8Array(e.width*e.height*4);Tg(r,t,Ld(e)),t.readPixels(0,0,e.width,e.height,t.RGBA,t.UNSIGNED_BYTE,n),nT(r),t=new ImageData(new Uint8ClampedArray(n.buffer),e.width,e.height),e.g.push(t)}return t}function Ld(e){let t=pi(e,2);if(!t){let r=vc(e);t=Bd(e);let n=pi(e,1)||p4(e);r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,n),rm(e)}return t}function vc(e){if(!e.canvas)throw Error("Conversion to different image formats require that a canvas is passed when iniitializing the image.");return e.h||(e.h=Vn(e.canvas.getContext("webgl2"),"You cannot use a canvas that is already bound to a different type of rendering context.")),e.h}function Sg(e){return e.l||(e.l=new Ac),e.l}function Bd(e){let t=vc(e);t.viewport(0,0,e.width,e.height),t.activeTexture(t.TEXTURE0);let r=pi(e,2);return r||(r=La(Sg(e),t),e.g.push(r),e.m=!0),t.bindTexture(t.TEXTURE_2D,r),r}function rm(e){e.h.bindTexture(e.h.TEXTURE_2D,null)}function o_(e){let t=vc(e);return Tm(Sg(e),t,!0,()=>function(r,n){let o=r.canvas;if(o.width===r.width&&o.height===r.height)return n();let s=o.width,i=o.height;return o.width=r.width,o.height=r.height,r=n(),o.width=s,o.height=i,r}(e,()=>{if(t.bindFramebuffer(t.FRAMEBUFFER,null),t.clearColor(0,0,0,0),t.clear(t.COLOR_BUFFER_BIT),t.drawArrays(t.TRIANGLE_FAN,0,4),!(e.canvas instanceof OffscreenCanvas))throw Error("Conversion to ImageBitmap requires that the MediaPipe Tasks is initialized with an OffscreenCanvas");return e.canvas.transferToImageBitmap()}))}uo.prototype.close=uo.prototype.close,uo.prototype.drawConfidenceMask=uo.prototype.ya,uo.prototype.drawCategoryMask=uo.prototype.xa,uo.prototype.drawBoundingBox=uo.prototype.wa,uo.prototype.drawConnectors=uo.prototype.za,uo.prototype.drawLandmarks=uo.prototype.Aa,uo.lerp=function(e,t,r,n,o){return e_(n*(1-(e-t)/(r-t))+o*(1-(r-e)/(r-t)),n,o)},uo.clamp=e_;var rn=class{constructor(e,t,r,n,o,s,i){this.g=e,this.j=t,this.m=r,this.canvas=n,this.l=o,this.width=s,this.height=i,(this.j||this.m)&&--s_===0&&console.error("You seem to be creating MPImage instances without invoking .close(). This leaks resources.")}Ga(){return!!pi(this,0)}ma(){return!!pi(this,1)}R(){return!!pi(this,2)}Ea(){return p4(this)}Da(){var e=pi(this,1);return e||(Ld(this),Bd(this),e=o_(this),rm(this),this.g.push(e),this.j=!0),e}N(){return Ld(this)}clone(){let e=[];for(let t of this.g){let r;if(t instanceof ImageData)r=new ImageData(t.data,this.width,this.height);else if(t instanceof WebGLTexture){let n=vc(this),o=Sg(this);n.activeTexture(n.TEXTURE1),r=La(o,n),n.bindTexture(n.TEXTURE_2D,r),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,this.width,this.height,0,n.RGBA,n.UNSIGNED_BYTE,null),n.bindTexture(n.TEXTURE_2D,null),Tg(o,n,r),Tm(o,n,!1,()=>{Bd(this),n.clearColor(0,0,0,0),n.clear(n.COLOR_BUFFER_BIT),n.drawArrays(n.TRIANGLE_FAN,0,4),rm(this)}),nT(o),rm(this)}else{if(!(t instanceof ImageBitmap))throw Error(`Type is not supported: ${t}`);Ld(this),Bd(this),r=o_(this),rm(this)}e.push(r)}return new rn(e,this.ma(),this.R(),this.canvas,this.l,this.width,this.height)}close(){this.j&&pi(this,1).close(),this.m&&vc(this).deleteTexture(pi(this,2)),s_=-1}};rn.prototype.close=rn.prototype.close,rn.prototype.clone=rn.prototype.clone,rn.prototype.getAsWebGLTexture=rn.prototype.N,rn.prototype.getAsImageBitmap=rn.prototype.Da,rn.prototype.getAsImageData=rn.prototype.Ea,rn.prototype.hasWebGLTexture=rn.prototype.R,rn.prototype.hasImageBitmap=rn.prototype.ma,rn.prototype.hasImageData=rn.prototype.Ga;var s_=250;function Ps(...e){return e.map(([t,r])=>({start:t,end:r}))}var xW=function(e){return class extends e{Ma(){this.i._registerModelResourcesGraphService()}}}((i_=class{constructor(e,t){this.l=!0,this.i=e,this.g=null,this.h=0,this.m=typeof this.i._addIntToInputStream=="function",t!==void 0?this.i.canvas=t:i4()?this.i.canvas=new OffscreenCanvas(1,1):(console.warn("OffscreenCanvas not supported and GraphRunner constructor glCanvas parameter is undefined. Creating backup canvas."),this.i.canvas=document.createElement("canvas"))}initializeGraph(e){return ne(this,null,function*(){let t=yield(yield fetch(e)).arrayBuffer();e=!(e.endsWith(".pbtxt")||e.endsWith(".textproto")),this.setGraph(new Uint8Array(t),e)})}setGraphFromString(e){this.setGraph(new TextEncoder().encode(e),!1)}setGraph(e,t){let r=e.length,n=this.i._malloc(r);this.i.HEAPU8.set(e,n),t?this.i._changeBinaryGraph(r,n):this.i._changeTextGraph(r,n),this.i._free(n)}configureAudio(e,t,r,n,o){this.i._configureAudio||console.warn('Attempting to use configureAudio without support for input audio. Is build dep ":gl_graph_runner_audio" missing?'),Me(this,n||"input_audio",s=>{Me(this,o=o||"audio_header",i=>{this.i._configureAudio(s,i,e,t??0,r)})})}setAutoResizeCanvas(e){this.l=e}setAutoRenderToScreen(e){this.i._setAutoRenderToScreen(e)}setGpuBufferVerticalFlip(e){this.i.gpuOriginForWebTexturesIsBottomLeft=e}ea(e){ui(this,"__graph_config__",t=>{e(t)}),Me(this,"__graph_config__",t=>{this.i._getGraphConfig(t,void 0)}),delete this.i.simpleListeners.__graph_config__}attachErrorListener(e){this.i.errorListener=e}attachEmptyPacketListener(e,t){this.i.emptyPacketListeners=this.i.emptyPacketListeners||{},this.i.emptyPacketListeners[e]=t}addAudioToStream(e,t,r){this.addAudioToStreamWithShape(e,0,0,t,r)}addAudioToStreamWithShape(e,t,r,n,o){let s=4*e.length;this.h!==s&&(this.g&&this.i._free(this.g),this.g=this.i._malloc(s),this.h=s),this.i.HEAPF32.set(e,this.g/4),Me(this,n,i=>{this.i._addAudioToInputStream(this.g,t,r,i,o)})}addGpuBufferToStream(e,t,r){Me(this,t,n=>{let[o,s]=j3(this,e,n);this.i._addBoundTextureToStream(n,o,s,r)})}addBoolToStream(e,t,r){Me(this,t,n=>{this.i._addBoolToInputStream(e,n,r)})}addDoubleToStream(e,t,r){Me(this,t,n=>{this.i._addDoubleToInputStream(e,n,r)})}addFloatToStream(e,t,r){Me(this,t,n=>{this.i._addFloatToInputStream(e,n,r)})}addIntToStream(e,t,r){Me(this,t,n=>{this.i._addIntToInputStream(e,n,r)})}addUintToStream(e,t,r){Me(this,t,n=>{this.i._addUintToInputStream(e,n,r)})}addStringToStream(e,t,r){Me(this,t,n=>{Me(this,e,o=>{this.i._addStringToInputStream(o,n,r)})})}addStringRecordToStream(e,t,r){Me(this,t,n=>{X3(this,Object.keys(e),o=>{X3(this,Object.values(e),s=>{this.i._addFlatHashMapToInputStream(o,s,Object.keys(e).length,n,r)})})})}addProtoToStream(e,t,r,n){Me(this,r,o=>{Me(this,t,s=>{let i=this.i._malloc(e.length);this.i.HEAPU8.set(e,i),this.i._addProtoToInputStream(i,e.length,s,o,n),this.i._free(i)})})}addEmptyPacketToStream(e,t){Me(this,e,r=>{this.i._addEmptyPacketToInputStream(r,t)})}addBoolVectorToStream(e,t,r){Me(this,t,n=>{let o=this.i._allocateBoolVector(e.length);if(!o)throw Error("Unable to allocate new bool vector on heap.");for(let s of e)this.i._addBoolVectorEntry(o,s);this.i._addBoolVectorToInputStream(o,n,r)})}addDoubleVectorToStream(e,t,r){Me(this,t,n=>{let o=this.i._allocateDoubleVector(e.length);if(!o)throw Error("Unable to allocate new double vector on heap.");for(let s of e)this.i._addDoubleVectorEntry(o,s);this.i._addDoubleVectorToInputStream(o,n,r)})}addFloatVectorToStream(e,t,r){Me(this,t,n=>{let o=this.i._allocateFloatVector(e.length);if(!o)throw Error("Unable to allocate new float vector on heap.");for(let s of e)this.i._addFloatVectorEntry(o,s);this.i._addFloatVectorToInputStream(o,n,r)})}addIntVectorToStream(e,t,r){Me(this,t,n=>{let o=this.i._allocateIntVector(e.length);if(!o)throw Error("Unable to allocate new int vector on heap.");for(let s of e)this.i._addIntVectorEntry(o,s);this.i._addIntVectorToInputStream(o,n,r)})}addUintVectorToStream(e,t,r){Me(this,t,n=>{let o=this.i._allocateUintVector(e.length);if(!o)throw Error("Unable to allocate new unsigned int vector on heap.");for(let s of e)this.i._addUintVectorEntry(o,s);this.i._addUintVectorToInputStream(o,n,r)})}addStringVectorToStream(e,t,r){Me(this,t,n=>{let o=this.i._allocateStringVector(e.length);if(!o)throw Error("Unable to allocate new string vector on heap.");for(let s of e)Me(this,s,i=>{this.i._addStringVectorEntry(o,i)});this.i._addStringVectorToInputStream(o,n,r)})}addBoolToInputSidePacket(e,t){Me(this,t,r=>{this.i._addBoolToInputSidePacket(e,r)})}addDoubleToInputSidePacket(e,t){Me(this,t,r=>{this.i._addDoubleToInputSidePacket(e,r)})}addFloatToInputSidePacket(e,t){Me(this,t,r=>{this.i._addFloatToInputSidePacket(e,r)})}addIntToInputSidePacket(e,t){Me(this,t,r=>{this.i._addIntToInputSidePacket(e,r)})}addUintToInputSidePacket(e,t){Me(this,t,r=>{this.i._addUintToInputSidePacket(e,r)})}addStringToInputSidePacket(e,t){Me(this,t,r=>{Me(this,e,n=>{this.i._addStringToInputSidePacket(n,r)})})}addProtoToInputSidePacket(e,t,r){Me(this,r,n=>{Me(this,t,o=>{let s=this.i._malloc(e.length);this.i.HEAPU8.set(e,s),this.i._addProtoToInputSidePacket(s,e.length,o,n),this.i._free(s)})})}addBoolVectorToInputSidePacket(e,t){Me(this,t,r=>{let n=this.i._allocateBoolVector(e.length);if(!n)throw Error("Unable to allocate new bool vector on heap.");for(let o of e)this.i._addBoolVectorEntry(n,o);this.i._addBoolVectorToInputSidePacket(n,r)})}addDoubleVectorToInputSidePacket(e,t){Me(this,t,r=>{let n=this.i._allocateDoubleVector(e.length);if(!n)throw Error("Unable to allocate new double vector on heap.");for(let o of e)this.i._addDoubleVectorEntry(n,o);this.i._addDoubleVectorToInputSidePacket(n,r)})}addFloatVectorToInputSidePacket(e,t){Me(this,t,r=>{let n=this.i._allocateFloatVector(e.length);if(!n)throw Error("Unable to allocate new float vector on heap.");for(let o of e)this.i._addFloatVectorEntry(n,o);this.i._addFloatVectorToInputSidePacket(n,r)})}addIntVectorToInputSidePacket(e,t){Me(this,t,r=>{let n=this.i._allocateIntVector(e.length);if(!n)throw Error("Unable to allocate new int vector on heap.");for(let o of e)this.i._addIntVectorEntry(n,o);this.i._addIntVectorToInputSidePacket(n,r)})}addUintVectorToInputSidePacket(e,t){Me(this,t,r=>{let n=this.i._allocateUintVector(e.length);if(!n)throw Error("Unable to allocate new unsigned int vector on heap.");for(let o of e)this.i._addUintVectorEntry(n,o);this.i._addUintVectorToInputSidePacket(n,r)})}addStringVectorToInputSidePacket(e,t){Me(this,t,r=>{let n=this.i._allocateStringVector(e.length);if(!n)throw Error("Unable to allocate new string vector on heap.");for(let o of e)Me(this,o,s=>{this.i._addStringVectorEntry(n,s)});this.i._addStringVectorToInputSidePacket(n,r)})}attachBoolListener(e,t){ui(this,e,t),Me(this,e,r=>{this.i._attachBoolListener(r)})}attachBoolVectorListener(e,t){Na(this,e,t),Me(this,e,r=>{this.i._attachBoolVectorListener(r)})}attachIntListener(e,t){ui(this,e,t),Me(this,e,r=>{this.i._attachIntListener(r)})}attachIntVectorListener(e,t){Na(this,e,t),Me(this,e,r=>{this.i._attachIntVectorListener(r)})}attachUintListener(e,t){ui(this,e,t),Me(this,e,r=>{this.i._attachUintListener(r)})}attachUintVectorListener(e,t){Na(this,e,t),Me(this,e,r=>{this.i._attachUintVectorListener(r)})}attachDoubleListener(e,t){ui(this,e,t),Me(this,e,r=>{this.i._attachDoubleListener(r)})}attachDoubleVectorListener(e,t){Na(this,e,t),Me(this,e,r=>{this.i._attachDoubleVectorListener(r)})}attachFloatListener(e,t){ui(this,e,t),Me(this,e,r=>{this.i._attachFloatListener(r)})}attachFloatVectorListener(e,t){Na(this,e,t),Me(this,e,r=>{this.i._attachFloatVectorListener(r)})}attachStringListener(e,t){ui(this,e,t),Me(this,e,r=>{this.i._attachStringListener(r)})}attachStringVectorListener(e,t){Na(this,e,t),Me(this,e,r=>{this.i._attachStringVectorListener(r)})}attachProtoListener(e,t,r){ui(this,e,t),Me(this,e,n=>{this.i._attachProtoListener(n,r||!1)})}attachProtoVectorListener(e,t,r){Na(this,e,t),Me(this,e,n=>{this.i._attachProtoVectorListener(n,r||!1)})}attachAudioListener(e,t,r){this.i._attachAudioListener||console.warn('Attempting to use attachAudioListener without support for output audio. Is build dep ":gl_graph_runner_audio_out" missing?'),ui(this,e,(n,o)=>{n=new Float32Array(n.buffer,n.byteOffset,n.length/4),t(n,o)}),Me(this,e,n=>{this.i._attachAudioListener(n,r||!1)})}finishProcessing(){this.i._waitUntilIdle()}closeGraph(){this.i._closeGraph(),this.i.simpleListeners=void 0,this.i.emptyPacketListeners=void 0}},class extends i_{get ga(){return this.i}sa(e,t,r){Me(this,t,n=>{let[o,s]=j3(this,e,n);this.ga._addBoundTextureAsImageToStream(n,o,s,r)})}V(e,t){ui(this,e,t),Me(this,e,r=>{this.ga._attachImageListener(r)})}da(e,t){Na(this,e,t),Me(this,e,r=>{this.ga._attachImageVectorListener(r)})}})),i_,fs=class extends xW{};function gt(e,t,r){return ne(this,null,function*(){return function(n,o,s,i){return ne(this,null,function*(){return mW(n,o,s,i)})}(e,r.canvas??(i4()?void 0:document.createElement("canvas")),t,r)})}function f4(e,t,r,n){if(e.U){let s=new FI;if(r?.regionOfInterest){if(!e.ra)throw Error("This task doesn't support region-of-interest.");var o=r.regionOfInterest;if(o.left>=o.right||o.top>=o.bottom)throw Error("Expected RectF with left < right and top < bottom.");if(o.left<0||o.top<0||o.right>1||o.bottom>1)throw Error("Expected RectF values to be in [0,1].");Le(s,1,(o.left+o.right)/2),Le(s,2,(o.top+o.bottom)/2),Le(s,4,o.right-o.left),Le(s,3,o.bottom-o.top)}else Le(s,1,.5),Le(s,2,.5),Le(s,4,1),Le(s,3,1);if(r?.rotationDegrees){if(r?.rotationDegrees%90!=0)throw Error("Expected rotation to be a multiple of 90\xB0.");if(Le(s,5,-Math.PI*r.rotationDegrees/180),r?.rotationDegrees%180!=0){let[i,a]=a4(t);r=Dr(s,3)*a/i,o=Dr(s,4)*i/a,Le(s,4,r),Le(s,3,o)}}e.g.addProtoToStream(s.g(),"mediapipe.NormalizedRect",e.U,n)}e.g.sa(t,e.ba,n??performance.now()),e.finishProcessing()}function ms(e,t,r){if(e.baseOptions?.g())throw Error("Task is not initialized with image mode. 'runningMode' must be set to 'IMAGE'.");f4(e,t,r,e.B+1)}function di(e,t,r,n){if(!e.baseOptions?.g())throw Error("Task is not initialized with video mode. 'runningMode' must be set to 'VIDEO'.");f4(e,t,r,n)}function wc(e,t,r,n){var o=t.data;let s=t.width,i=s*(t=t.height);if((o instanceof Uint8Array||o instanceof Float32Array)&&o.length!==i)throw Error("Unsupported channel count: "+o.length/i);return e=new Kr([o],r,!1,e.g.i.canvas,e.P,s,t),n?e.clone():e}var co=class extends Pd{constructor(e,t,r,n){super(e),this.g=e,this.ba=t,this.U=r,this.ra=n,this.P=new Ac}l(e,t=!0){if("runningMode"in e&&pm(this.baseOptions,2,!!e.runningMode&&e.runningMode!=="IMAGE"),e.canvas!==void 0&&this.g.i.canvas!==e.canvas)throw Error("You must create a new task to reset the canvas.");return super.l(e,t)}close(){this.P.close(),super.close()}};co.prototype.close=co.prototype.close;var ss=class extends co{constructor(e,t){super(new fs(e,t),"image_in","norm_rect_in",!1),this.j={detections:[]},Ge(e=this.h=new yg,0,1,t=new mr),Le(this.h,2,.5),Le(this.h,3,.3)}get baseOptions(){return Et(this.h,mr,1)}set baseOptions(e){Ge(this.h,0,1,e)}o(e){return"minDetectionConfidence"in e&&Le(this.h,2,e.minDetectionConfidence??.5),"minSuppressionThreshold"in e&&Le(this.h,3,e.minSuppressionThreshold??.3),this.l(e)}D(e,t){return this.j={detections:[]},ms(this,e,t),this.j}F(e,t,r){return this.j={detections:[]},di(this,e,r,t),this.j}m(){var e=new mo;sr(e,"image_in"),sr(e,"norm_rect_in"),_t(e,"detections");let t=new Uo;Os(t,J9,this.h);let r=new Gn;Vo(r,"mediapipe.tasks.vision.face_detector.FaceDetectorGraph"),rr(r,"IMAGE:image_in"),rr(r,"NORM_RECT:norm_rect_in"),wt(r,"DETECTIONS:detections"),r.o(t),Go(e,r),this.g.attachProtoVectorListener("detections",(n,o)=>{for(let s of n)n=RI(s),this.j.detections.push(o4(n));Ae(this,o)}),this.g.attachEmptyPacketListener("detections",n=>{Ae(this,n)}),e=e.g(),this.setGraph(new Uint8Array(e),!0)}};ss.prototype.detectForVideo=ss.prototype.F,ss.prototype.detect=ss.prototype.D,ss.prototype.setOptions=ss.prototype.o,ss.createFromModelPath=function(e,t){return ne(this,null,function*(){return gt(ss,e,{baseOptions:{modelAssetPath:t}})})},ss.createFromModelBuffer=function(e,t){return gt(ss,e,{baseOptions:{modelAssetBuffer:t}})},ss.createFromOptions=function(e,t){return gt(ss,e,t)};var sT=Ps([61,146],[146,91],[91,181],[181,84],[84,17],[17,314],[314,405],[405,321],[321,375],[375,291],[61,185],[185,40],[40,39],[39,37],[37,0],[0,267],[267,269],[269,270],[270,409],[409,291],[78,95],[95,88],[88,178],[178,87],[87,14],[14,317],[317,402],[402,318],[318,324],[324,308],[78,191],[191,80],[80,81],[81,82],[82,13],[13,312],[312,311],[311,310],[310,415],[415,308]),iT=Ps([263,249],[249,390],[390,373],[373,374],[374,380],[380,381],[381,382],[382,362],[263,466],[466,388],[388,387],[387,386],[386,385],[385,384],[384,398],[398,362]),aT=Ps([276,283],[283,282],[282,295],[295,285],[300,293],[293,334],[334,296],[296,336]),m4=Ps([474,475],[475,476],[476,477],[477,474]),uT=Ps([33,7],[7,163],[163,144],[144,145],[145,153],[153,154],[154,155],[155,133],[33,246],[246,161],[161,160],[160,159],[159,158],[158,157],[157,173],[173,133]),lT=Ps([46,53],[53,52],[52,65],[65,55],[70,63],[63,105],[105,66],[66,107]),h4=Ps([469,470],[470,471],[471,472],[472,469]),cT=Ps([10,338],[338,297],[297,332],[332,284],[284,251],[251,389],[389,356],[356,454],[454,323],[323,361],[361,288],[288,397],[397,365],[365,379],[379,378],[378,400],[400,377],[377,152],[152,148],[148,176],[176,149],[149,150],[150,136],[136,172],[172,58],[58,132],[132,93],[93,234],[234,127],[127,162],[162,21],[21,54],[54,103],[103,67],[67,109],[109,10]),d4=[...sT,...iT,...aT,...uT,...lT,...cT],g4=Ps([127,34],[34,139],[139,127],[11,0],[0,37],[37,11],[232,231],[231,120],[120,232],[72,37],[37,39],[39,72],[128,121],[121,47],[47,128],[232,121],[121,128],[128,232],[104,69],[69,67],[67,104],[175,171],[171,148],[148,175],[118,50],[50,101],[101,118],[73,39],[39,40],[40,73],[9,151],[151,108],[108,9],[48,115],[115,131],[131,48],[194,204],[204,211],[211,194],[74,40],[40,185],[185,74],[80,42],[42,183],[183,80],[40,92],[92,186],[186,40],[230,229],[229,118],[118,230],[202,212],[212,214],[214,202],[83,18],[18,17],[17,83],[76,61],[61,146],[146,76],[160,29],[29,30],[30,160],[56,157],[157,173],[173,56],[106,204],[204,194],[194,106],[135,214],[214,192],[192,135],[203,165],[165,98],[98,203],[21,71],[71,68],[68,21],[51,45],[45,4],[4,51],[144,24],[24,23],[23,144],[77,146],[146,91],[91,77],[205,50],[50,187],[187,205],[201,200],[200,18],[18,201],[91,106],[106,182],[182,91],[90,91],[91,181],[181,90],[85,84],[84,17],[17,85],[206,203],[203,36],[36,206],[148,171],[171,140],[140,148],[92,40],[40,39],[39,92],[193,189],[189,244],[244,193],[159,158],[158,28],[28,159],[247,246],[246,161],[161,247],[236,3],[3,196],[196,236],[54,68],[68,104],[104,54],[193,168],[168,8],[8,193],[117,228],[228,31],[31,117],[189,193],[193,55],[55,189],[98,97],[97,99],[99,98],[126,47],[47,100],[100,126],[166,79],[79,218],[218,166],[155,154],[154,26],[26,155],[209,49],[49,131],[131,209],[135,136],[136,150],[150,135],[47,126],[126,217],[217,47],[223,52],[52,53],[53,223],[45,51],[51,134],[134,45],[211,170],[170,140],[140,211],[67,69],[69,108],[108,67],[43,106],[106,91],[91,43],[230,119],[119,120],[120,230],[226,130],[130,247],[247,226],[63,53],[53,52],[52,63],[238,20],[20,242],[242,238],[46,70],[70,156],[156,46],[78,62],[62,96],[96,78],[46,53],[53,63],[63,46],[143,34],[34,227],[227,143],[123,117],[117,111],[111,123],[44,125],[125,19],[19,44],[236,134],[134,51],[51,236],[216,206],[206,205],[205,216],[154,153],[153,22],[22,154],[39,37],[37,167],[167,39],[200,201],[201,208],[208,200],[36,142],[142,100],[100,36],[57,212],[212,202],[202,57],[20,60],[60,99],[99,20],[28,158],[158,157],[157,28],[35,226],[226,113],[113,35],[160,159],[159,27],[27,160],[204,202],[202,210],[210,204],[113,225],[225,46],[46,113],[43,202],[202,204],[204,43],[62,76],[76,77],[77,62],[137,123],[123,116],[116,137],[41,38],[38,72],[72,41],[203,129],[129,142],[142,203],[64,98],[98,240],[240,64],[49,102],[102,64],[64,49],[41,73],[73,74],[74,41],[212,216],[216,207],[207,212],[42,74],[74,184],[184,42],[169,170],[170,211],[211,169],[170,149],[149,176],[176,170],[105,66],[66,69],[69,105],[122,6],[6,168],[168,122],[123,147],[147,187],[187,123],[96,77],[77,90],[90,96],[65,55],[55,107],[107,65],[89,90],[90,180],[180,89],[101,100],[100,120],[120,101],[63,105],[105,104],[104,63],[93,137],[137,227],[227,93],[15,86],[86,85],[85,15],[129,102],[102,49],[49,129],[14,87],[87,86],[86,14],[55,8],[8,9],[9,55],[100,47],[47,121],[121,100],[145,23],[23,22],[22,145],[88,89],[89,179],[179,88],[6,122],[122,196],[196,6],[88,95],[95,96],[96,88],[138,172],[172,136],[136,138],[215,58],[58,172],[172,215],[115,48],[48,219],[219,115],[42,80],[80,81],[81,42],[195,3],[3,51],[51,195],[43,146],[146,61],[61,43],[171,175],[175,199],[199,171],[81,82],[82,38],[38,81],[53,46],[46,225],[225,53],[144,163],[163,110],[110,144],[52,65],[65,66],[66,52],[229,228],[228,117],[117,229],[34,127],[127,234],[234,34],[107,108],[108,69],[69,107],[109,108],[108,151],[151,109],[48,64],[64,235],[235,48],[62,78],[78,191],[191,62],[129,209],[209,126],[126,129],[111,35],[35,143],[143,111],[117,123],[123,50],[50,117],[222,65],[65,52],[52,222],[19,125],[125,141],[141,19],[221,55],[55,65],[65,221],[3,195],[195,197],[197,3],[25,7],[7,33],[33,25],[220,237],[237,44],[44,220],[70,71],[71,139],[139,70],[122,193],[193,245],[245,122],[247,130],[130,33],[33,247],[71,21],[21,162],[162,71],[170,169],[169,150],[150,170],[188,174],[174,196],[196,188],[216,186],[186,92],[92,216],[2,97],[97,167],[167,2],[141,125],[125,241],[241,141],[164,167],[167,37],[37,164],[72,38],[38,12],[12,72],[38,82],[82,13],[13,38],[63,68],[68,71],[71,63],[226,35],[35,111],[111,226],[101,50],[50,205],[205,101],[206,92],[92,165],[165,206],[209,198],[198,217],[217,209],[165,167],[167,97],[97,165],[220,115],[115,218],[218,220],[133,112],[112,243],[243,133],[239,238],[238,241],[241,239],[214,135],[135,169],[169,214],[190,173],[173,133],[133,190],[171,208],[208,32],[32,171],[125,44],[44,237],[237,125],[86,87],[87,178],[178,86],[85,86],[86,179],[179,85],[84,85],[85,180],[180,84],[83,84],[84,181],[181,83],[201,83],[83,182],[182,201],[137,93],[93,132],[132,137],[76,62],[62,183],[183,76],[61,76],[76,184],[184,61],[57,61],[61,185],[185,57],[212,57],[57,186],[186,212],[214,207],[207,187],[187,214],[34,143],[143,156],[156,34],[79,239],[239,237],[237,79],[123,137],[137,177],[177,123],[44,1],[1,4],[4,44],[201,194],[194,32],[32,201],[64,102],[102,129],[129,64],[213,215],[215,138],[138,213],[59,166],[166,219],[219,59],[242,99],[99,97],[97,242],[2,94],[94,141],[141,2],[75,59],[59,235],[235,75],[24,110],[110,228],[228,24],[25,130],[130,226],[226,25],[23,24],[24,229],[229,23],[22,23],[23,230],[230,22],[26,22],[22,231],[231,26],[112,26],[26,232],[232,112],[189,190],[190,243],[243,189],[221,56],[56,190],[190,221],[28,56],[56,221],[221,28],[27,28],[28,222],[222,27],[29,27],[27,223],[223,29],[30,29],[29,224],[224,30],[247,30],[30,225],[225,247],[238,79],[79,20],[20,238],[166,59],[59,75],[75,166],[60,75],[75,240],[240,60],[147,177],[177,215],[215,147],[20,79],[79,166],[166,20],[187,147],[147,213],[213,187],[112,233],[233,244],[244,112],[233,128],[128,245],[245,233],[128,114],[114,188],[188,128],[114,217],[217,174],[174,114],[131,115],[115,220],[220,131],[217,198],[198,236],[236,217],[198,131],[131,134],[134,198],[177,132],[132,58],[58,177],[143,35],[35,124],[124,143],[110,163],[163,7],[7,110],[228,110],[110,25],[25,228],[356,389],[389,368],[368,356],[11,302],[302,267],[267,11],[452,350],[350,349],[349,452],[302,303],[303,269],[269,302],[357,343],[343,277],[277,357],[452,453],[453,357],[357,452],[333,332],[332,297],[297,333],[175,152],[152,377],[377,175],[347,348],[348,330],[330,347],[303,304],[304,270],[270,303],[9,336],[336,337],[337,9],[278,279],[279,360],[360,278],[418,262],[262,431],[431,418],[304,408],[408,409],[409,304],[310,415],[415,407],[407,310],[270,409],[409,410],[410,270],[450,348],[348,347],[347,450],[422,430],[430,434],[434,422],[313,314],[314,17],[17,313],[306,307],[307,375],[375,306],[387,388],[388,260],[260,387],[286,414],[414,398],[398,286],[335,406],[406,418],[418,335],[364,367],[367,416],[416,364],[423,358],[358,327],[327,423],[251,284],[284,298],[298,251],[281,5],[5,4],[4,281],[373,374],[374,253],[253,373],[307,320],[320,321],[321,307],[425,427],[427,411],[411,425],[421,313],[313,18],[18,421],[321,405],[405,406],[406,321],[320,404],[404,405],[405,320],[315,16],[16,17],[17,315],[426,425],[425,266],[266,426],[377,400],[400,369],[369,377],[322,391],[391,269],[269,322],[417,465],[465,464],[464,417],[386,257],[257,258],[258,386],[466,260],[260,388],[388,466],[456,399],[399,419],[419,456],[284,332],[332,333],[333,284],[417,285],[285,8],[8,417],[346,340],[340,261],[261,346],[413,441],[441,285],[285,413],[327,460],[460,328],[328,327],[355,371],[371,329],[329,355],[392,439],[439,438],[438,392],[382,341],[341,256],[256,382],[429,420],[420,360],[360,429],[364,394],[394,379],[379,364],[277,343],[343,437],[437,277],[443,444],[444,283],[283,443],[275,440],[440,363],[363,275],[431,262],[262,369],[369,431],[297,338],[338,337],[337,297],[273,375],[375,321],[321,273],[450,451],[451,349],[349,450],[446,342],[342,467],[467,446],[293,334],[334,282],[282,293],[458,461],[461,462],[462,458],[276,353],[353,383],[383,276],[308,324],[324,325],[325,308],[276,300],[300,293],[293,276],[372,345],[345,447],[447,372],[352,345],[345,340],[340,352],[274,1],[1,19],[19,274],[456,248],[248,281],[281,456],[436,427],[427,425],[425,436],[381,256],[256,252],[252,381],[269,391],[391,393],[393,269],[200,199],[199,428],[428,200],[266,330],[330,329],[329,266],[287,273],[273,422],[422,287],[250,462],[462,328],[328,250],[258,286],[286,384],[384,258],[265,353],[353,342],[342,265],[387,259],[259,257],[257,387],[424,431],[431,430],[430,424],[342,353],[353,276],[276,342],[273,335],[335,424],[424,273],[292,325],[325,307],[307,292],[366,447],[447,345],[345,366],[271,303],[303,302],[302,271],[423,266],[266,371],[371,423],[294,455],[455,460],[460,294],[279,278],[278,294],[294,279],[271,272],[272,304],[304,271],[432,434],[434,427],[427,432],[272,407],[407,408],[408,272],[394,430],[430,431],[431,394],[395,369],[369,400],[400,395],[334,333],[333,299],[299,334],[351,417],[417,168],[168,351],[352,280],[280,411],[411,352],[325,319],[319,320],[320,325],[295,296],[296,336],[336,295],[319,403],[403,404],[404,319],[330,348],[348,349],[349,330],[293,298],[298,333],[333,293],[323,454],[454,447],[447,323],[15,16],[16,315],[315,15],[358,429],[429,279],[279,358],[14,15],[15,316],[316,14],[285,336],[336,9],[9,285],[329,349],[349,350],[350,329],[374,380],[380,252],[252,374],[318,402],[402,403],[403,318],[6,197],[197,419],[419,6],[318,319],[319,325],[325,318],[367,364],[364,365],[365,367],[435,367],[367,397],[397,435],[344,438],[438,439],[439,344],[272,271],[271,311],[311,272],[195,5],[5,281],[281,195],[273,287],[287,291],[291,273],[396,428],[428,199],[199,396],[311,271],[271,268],[268,311],[283,444],[444,445],[445,283],[373,254],[254,339],[339,373],[282,334],[334,296],[296,282],[449,347],[347,346],[346,449],[264,447],[447,454],[454,264],[336,296],[296,299],[299,336],[338,10],[10,151],[151,338],[278,439],[439,455],[455,278],[292,407],[407,415],[415,292],[358,371],[371,355],[355,358],[340,345],[345,372],[372,340],[346,347],[347,280],[280,346],[442,443],[443,282],[282,442],[19,94],[94,370],[370,19],[441,442],[442,295],[295,441],[248,419],[419,197],[197,248],[263,255],[255,359],[359,263],[440,275],[275,274],[274,440],[300,383],[383,368],[368,300],[351,412],[412,465],[465,351],[263,467],[467,466],[466,263],[301,368],[368,389],[389,301],[395,378],[378,379],[379,395],[412,351],[351,419],[419,412],[436,426],[426,322],[322,436],[2,164],[164,393],[393,2],[370,462],[462,461],[461,370],[164,0],[0,267],[267,164],[302,11],[11,12],[12,302],[268,12],[12,13],[13,268],[293,300],[300,301],[301,293],[446,261],[261,340],[340,446],[330,266],[266,425],[425,330],[426,423],[423,391],[391,426],[429,355],[355,437],[437,429],[391,327],[327,326],[326,391],[440,457],[457,438],[438,440],[341,382],[382,362],[362,341],[459,457],[457,461],[461,459],[434,430],[430,394],[394,434],[414,463],[463,362],[362,414],[396,369],[369,262],[262,396],[354,461],[461,457],[457,354],[316,403],[403,402],[402,316],[315,404],[404,403],[403,315],[314,405],[405,404],[404,314],[313,406],[406,405],[405,313],[421,418],[418,406],[406,421],[366,401],[401,361],[361,366],[306,408],[408,407],[407,306],[291,409],[409,408],[408,291],[287,410],[410,409],[409,287],[432,436],[436,410],[410,432],[434,416],[416,411],[411,434],[264,368],[368,383],[383,264],[309,438],[438,457],[457,309],[352,376],[376,401],[401,352],[274,275],[275,4],[4,274],[421,428],[428,262],[262,421],[294,327],[327,358],[358,294],[433,416],[416,367],[367,433],[289,455],[455,439],[439,289],[462,370],[370,326],[326,462],[2,326],[326,370],[370,2],[305,460],[460,455],[455,305],[254,449],[449,448],[448,254],[255,261],[261,446],[446,255],[253,450],[450,449],[449,253],[252,451],[451,450],[450,252],[256,452],[452,451],[451,256],[341,453],[453,452],[452,341],[413,464],[464,463],[463,413],[441,413],[413,414],[414,441],[258,442],[442,441],[441,258],[257,443],[443,442],[442,257],[259,444],[444,443],[443,259],[260,445],[445,444],[444,260],[467,342],[342,445],[445,467],[459,458],[458,250],[250,459],[289,392],[392,290],[290,289],[290,328],[328,460],[460,290],[376,433],[433,435],[435,376],[250,290],[290,392],[392,250],[411,416],[416,433],[433,411],[341,463],[463,464],[464,341],[453,464],[464,465],[465,453],[357,465],[465,412],[412,357],[343,412],[412,399],[399,343],[360,363],[363,440],[440,360],[437,399],[399,456],[456,437],[420,456],[456,363],[363,420],[401,435],[435,288],[288,401],[372,383],[383,353],[353,372],[339,255],[255,249],[249,339],[448,261],[261,255],[255,448],[133,243],[243,190],[190,133],[133,155],[155,112],[112,133],[33,246],[246,247],[247,33],[33,130],[130,25],[25,33],[398,384],[384,286],[286,398],[362,398],[398,414],[414,362],[362,463],[463,341],[341,362],[263,359],[359,467],[467,263],[263,249],[249,255],[255,263],[466,467],[467,260],[260,466],[75,60],[60,166],[166,75],[238,239],[239,79],[79,238],[162,127],[127,139],[139,162],[72,11],[11,37],[37,72],[121,232],[232,120],[120,121],[73,72],[72,39],[39,73],[114,128],[128,47],[47,114],[233,232],[232,128],[128,233],[103,104],[104,67],[67,103],[152,175],[175,148],[148,152],[119,118],[118,101],[101,119],[74,73],[73,40],[40,74],[107,9],[9,108],[108,107],[49,48],[48,131],[131,49],[32,194],[194,211],[211,32],[184,74],[74,185],[185,184],[191,80],[80,183],[183,191],[185,40],[40,186],[186,185],[119,230],[230,118],[118,119],[210,202],[202,214],[214,210],[84,83],[83,17],[17,84],[77,76],[76,146],[146,77],[161,160],[160,30],[30,161],[190,56],[56,173],[173,190],[182,106],[106,194],[194,182],[138,135],[135,192],[192,138],[129,203],[203,98],[98,129],[54,21],[21,68],[68,54],[5,51],[51,4],[4,5],[145,144],[144,23],[23,145],[90,77],[77,91],[91,90],[207,205],[205,187],[187,207],[83,201],[201,18],[18,83],[181,91],[91,182],[182,181],[180,90],[90,181],[181,180],[16,85],[85,17],[17,16],[205,206],[206,36],[36,205],[176,148],[148,140],[140,176],[165,92],[92,39],[39,165],[245,193],[193,244],[244,245],[27,159],[159,28],[28,27],[30,247],[247,161],[161,30],[174,236],[236,196],[196,174],[103,54],[54,104],[104,103],[55,193],[193,8],[8,55],[111,117],[117,31],[31,111],[221,189],[189,55],[55,221],[240,98],[98,99],[99,240],[142,126],[126,100],[100,142],[219,166],[166,218],[218,219],[112,155],[155,26],[26,112],[198,209],[209,131],[131,198],[169,135],[135,150],[150,169],[114,47],[47,217],[217,114],[224,223],[223,53],[53,224],[220,45],[45,134],[134,220],[32,211],[211,140],[140,32],[109,67],[67,108],[108,109],[146,43],[43,91],[91,146],[231,230],[230,120],[120,231],[113,226],[226,247],[247,113],[105,63],[63,52],[52,105],[241,238],[238,242],[242,241],[124,46],[46,156],[156,124],[95,78],[78,96],[96,95],[70,46],[46,63],[63,70],[116,143],[143,227],[227,116],[116,123],[123,111],[111,116],[1,44],[44,19],[19,1],[3,236],[236,51],[51,3],[207,216],[216,205],[205,207],[26,154],[154,22],[22,26],[165,39],[39,167],[167,165],[199,200],[200,208],[208,199],[101,36],[36,100],[100,101],[43,57],[57,202],[202,43],[242,20],[20,99],[99,242],[56,28],[28,157],[157,56],[124,35],[35,113],[113,124],[29,160],[160,27],[27,29],[211,204],[204,210],[210,211],[124,113],[113,46],[46,124],[106,43],[43,204],[204,106],[96,62],[62,77],[77,96],[227,137],[137,116],[116,227],[73,41],[41,72],[72,73],[36,203],[203,142],[142,36],[235,64],[64,240],[240,235],[48,49],[49,64],[64,48],[42,41],[41,74],[74,42],[214,212],[212,207],[207,214],[183,42],[42,184],[184,183],[210,169],[169,211],[211,210],[140,170],[170,176],[176,140],[104,105],[105,69],[69,104],[193,122],[122,168],[168,193],[50,123],[123,187],[187,50],[89,96],[96,90],[90,89],[66,65],[65,107],[107,66],[179,89],[89,180],[180,179],[119,101],[101,120],[120,119],[68,63],[63,104],[104,68],[234,93],[93,227],[227,234],[16,15],[15,85],[85,16],[209,129],[129,49],[49,209],[15,14],[14,86],[86,15],[107,55],[55,9],[9,107],[120,100],[100,121],[121,120],[153,145],[145,22],[22,153],[178,88],[88,179],[179,178],[197,6],[6,196],[196,197],[89,88],[88,96],[96,89],[135,138],[138,136],[136,135],[138,215],[215,172],[172,138],[218,115],[115,219],[219,218],[41,42],[42,81],[81,41],[5,195],[195,51],[51,5],[57,43],[43,61],[61,57],[208,171],[171,199],[199,208],[41,81],[81,38],[38,41],[224,53],[53,225],[225,224],[24,144],[144,110],[110,24],[105,52],[52,66],[66,105],[118,229],[229,117],[117,118],[227,34],[34,234],[234,227],[66,107],[107,69],[69,66],[10,109],[109,151],[151,10],[219,48],[48,235],[235,219],[183,62],[62,191],[191,183],[142,129],[129,126],[126,142],[116,111],[111,143],[143,116],[118,117],[117,50],[50,118],[223,222],[222,52],[52,223],[94,19],[19,141],[141,94],[222,221],[221,65],[65,222],[196,3],[3,197],[197,196],[45,220],[220,44],[44,45],[156,70],[70,139],[139,156],[188,122],[122,245],[245,188],[139,71],[71,162],[162,139],[149,170],[170,150],[150,149],[122,188],[188,196],[196,122],[206,216],[216,92],[92,206],[164,2],[2,167],[167,164],[242,141],[141,241],[241,242],[0,164],[164,37],[37,0],[11,72],[72,12],[12,11],[12,38],[38,13],[13,12],[70,63],[63,71],[71,70],[31,226],[226,111],[111,31],[36,101],[101,205],[205,36],[203,206],[206,165],[165,203],[126,209],[209,217],[217,126],[98,165],[165,97],[97,98],[237,220],[220,218],[218,237],[237,239],[239,241],[241,237],[210,214],[214,169],[169,210],[140,171],[171,32],[32,140],[241,125],[125,237],[237,241],[179,86],[86,178],[178,179],[180,85],[85,179],[179,180],[181,84],[84,180],[180,181],[182,83],[83,181],[181,182],[194,201],[201,182],[182,194],[177,137],[137,132],[132,177],[184,76],[76,183],[183,184],[185,61],[61,184],[184,185],[186,57],[57,185],[185,186],[216,212],[212,186],[186,216],[192,214],[214,187],[187,192],[139,34],[34,156],[156,139],[218,79],[79,237],[237,218],[147,123],[123,177],[177,147],[45,44],[44,4],[4,45],[208,201],[201,32],[32,208],[98,64],[64,129],[129,98],[192,213],[213,138],[138,192],[235,59],[59,219],[219,235],[141,242],[242,97],[97,141],[97,2],[2,141],[141,97],[240,75],[75,235],[235,240],[229,24],[24,228],[228,229],[31,25],[25,226],[226,31],[230,23],[23,229],[229,230],[231,22],[22,230],[230,231],[232,26],[26,231],[231,232],[233,112],[112,232],[232,233],[244,189],[189,243],[243,244],[189,221],[221,190],[190,189],[222,28],[28,221],[221,222],[223,27],[27,222],[222,223],[224,29],[29,223],[223,224],[225,30],[30,224],[224,225],[113,247],[247,225],[225,113],[99,60],[60,240],[240,99],[213,147],[147,215],[215,213],[60,20],[20,166],[166,60],[192,187],[187,213],[213,192],[243,112],[112,244],[244,243],[244,233],[233,245],[245,244],[245,128],[128,188],[188,245],[188,114],[114,174],[174,188],[134,131],[131,220],[220,134],[174,217],[217,236],[236,174],[236,198],[198,134],[134,236],[215,177],[177,58],[58,215],[156,143],[143,124],[124,156],[25,110],[110,7],[7,25],[31,228],[228,25],[25,31],[264,356],[356,368],[368,264],[0,11],[11,267],[267,0],[451,452],[452,349],[349,451],[267,302],[302,269],[269,267],[350,357],[357,277],[277,350],[350,452],[452,357],[357,350],[299,333],[333,297],[297,299],[396,175],[175,377],[377,396],[280,347],[347,330],[330,280],[269,303],[303,270],[270,269],[151,9],[9,337],[337,151],[344,278],[278,360],[360,344],[424,418],[418,431],[431,424],[270,304],[304,409],[409,270],[272,310],[310,407],[407,272],[322,270],[270,410],[410,322],[449,450],[450,347],[347,449],[432,422],[422,434],[434,432],[18,313],[313,17],[17,18],[291,306],[306,375],[375,291],[259,387],[387,260],[260,259],[424,335],[335,418],[418,424],[434,364],[364,416],[416,434],[391,423],[423,327],[327,391],[301,251],[251,298],[298,301],[275,281],[281,4],[4,275],[254,373],[373,253],[253,254],[375,307],[307,321],[321,375],[280,425],[425,411],[411,280],[200,421],[421,18],[18,200],[335,321],[321,406],[406,335],[321,320],[320,405],[405,321],[314,315],[315,17],[17,314],[423,426],[426,266],[266,423],[396,377],[377,369],[369,396],[270,322],[322,269],[269,270],[413,417],[417,464],[464,413],[385,386],[386,258],[258,385],[248,456],[456,419],[419,248],[298,284],[284,333],[333,298],[168,417],[417,8],[8,168],[448,346],[346,261],[261,448],[417,413],[413,285],[285,417],[326,327],[327,328],[328,326],[277,355],[355,329],[329,277],[309,392],[392,438],[438,309],[381,382],[382,256],[256,381],[279,429],[429,360],[360,279],[365,364],[364,379],[379,365],[355,277],[277,437],[437,355],[282,443],[443,283],[283,282],[281,275],[275,363],[363,281],[395,431],[431,369],[369,395],[299,297],[297,337],[337,299],[335,273],[273,321],[321,335],[348,450],[450,349],[349,348],[359,446],[446,467],[467,359],[283,293],[293,282],[282,283],[250,458],[458,462],[462,250],[300,276],[276,383],[383,300],[292,308],[308,325],[325,292],[283,276],[276,293],[293,283],[264,372],[372,447],[447,264],[346,352],[352,340],[340,346],[354,274],[274,19],[19,354],[363,456],[456,281],[281,363],[426,436],[436,425],[425,426],[380,381],[381,252],[252,380],[267,269],[269,393],[393,267],[421,200],[200,428],[428,421],[371,266],[266,329],[329,371],[432,287],[287,422],[422,432],[290,250],[250,328],[328,290],[385,258],[258,384],[384,385],[446,265],[265,342],[342,446],[386,387],[387,257],[257,386],[422,424],[424,430],[430,422],[445,342],[342,276],[276,445],[422,273],[273,424],[424,422],[306,292],[292,307],[307,306],[352,366],[366,345],[345,352],[268,271],[271,302],[302,268],[358,423],[423,371],[371,358],[327,294],[294,460],[460,327],[331,279],[279,294],[294,331],[303,271],[271,304],[304,303],[436,432],[432,427],[427,436],[304,272],[272,408],[408,304],[395,394],[394,431],[431,395],[378,395],[395,400],[400,378],[296,334],[334,299],[299,296],[6,351],[351,168],[168,6],[376,352],[352,411],[411,376],[307,325],[325,320],[320,307],[285,295],[295,336],[336,285],[320,319],[319,404],[404,320],[329,330],[330,349],[349,329],[334,293],[293,333],[333,334],[366,323],[323,447],[447,366],[316,15],[15,315],[315,316],[331,358],[358,279],[279,331],[317,14],[14,316],[316,317],[8,285],[285,9],[9,8],[277,329],[329,350],[350,277],[253,374],[374,252],[252,253],[319,318],[318,403],[403,319],[351,6],[6,419],[419,351],[324,318],[318,325],[325,324],[397,367],[367,365],[365,397],[288,435],[435,397],[397,288],[278,344],[344,439],[439,278],[310,272],[272,311],[311,310],[248,195],[195,281],[281,248],[375,273],[273,291],[291,375],[175,396],[396,199],[199,175],[312,311],[311,268],[268,312],[276,283],[283,445],[445,276],[390,373],[373,339],[339,390],[295,282],[282,296],[296,295],[448,449],[449,346],[346,448],[356,264],[264,454],[454,356],[337,336],[336,299],[299,337],[337,338],[338,151],[151,337],[294,278],[278,455],[455,294],[308,292],[292,415],[415,308],[429,358],[358,355],[355,429],[265,340],[340,372],[372,265],[352,346],[346,280],[280,352],[295,442],[442,282],[282,295],[354,19],[19,370],[370,354],[285,441],[441,295],[295,285],[195,248],[248,197],[197,195],[457,440],[440,274],[274,457],[301,300],[300,368],[368,301],[417,351],[351,465],[465,417],[251,301],[301,389],[389,251],[394,395],[395,379],[379,394],[399,412],[412,419],[419,399],[410,436],[436,322],[322,410],[326,2],[2,393],[393,326],[354,370],[370,461],[461,354],[393,164],[164,267],[267,393],[268,302],[302,12],[12,268],[312,268],[268,13],[13,312],[298,293],[293,301],[301,298],[265,446],[446,340],[340,265],[280,330],[330,425],[425,280],[322,426],[426,391],[391,322],[420,429],[429,437],[437,420],[393,391],[391,326],[326,393],[344,440],[440,438],[438,344],[458,459],[459,461],[461,458],[364,434],[434,394],[394,364],[428,396],[396,262],[262,428],[274,354],[354,457],[457,274],[317,316],[316,402],[402,317],[316,315],[315,403],[403,316],[315,314],[314,404],[404,315],[314,313],[313,405],[405,314],[313,421],[421,406],[406,313],[323,366],[366,361],[361,323],[292,306],[306,407],[407,292],[306,291],[291,408],[408,306],[291,287],[287,409],[409,291],[287,432],[432,410],[410,287],[427,434],[434,411],[411,427],[372,264],[264,383],[383,372],[459,309],[309,457],[457,459],[366,352],[352,401],[401,366],[1,274],[274,4],[4,1],[418,421],[421,262],[262,418],[331,294],[294,358],[358,331],[435,433],[433,367],[367,435],[392,289],[289,439],[439,392],[328,462],[462,326],[326,328],[94,2],[2,370],[370,94],[289,305],[305,455],[455,289],[339,254],[254,448],[448,339],[359,255],[255,446],[446,359],[254,253],[253,449],[449,254],[253,252],[252,450],[450,253],[252,256],[256,451],[451,252],[256,341],[341,452],[452,256],[414,413],[413,463],[463,414],[286,441],[441,414],[414,286],[286,258],[258,441],[441,286],[258,257],[257,442],[442,258],[257,259],[259,443],[443,257],[259,260],[260,444],[444,259],[260,467],[467,445],[445,260],[309,459],[459,250],[250,309],[305,289],[289,290],[290,305],[305,290],[290,460],[460,305],[401,376],[376,435],[435,401],[309,250],[250,392],[392,309],[376,411],[411,433],[433,376],[453,341],[341,464],[464,453],[357,453],[453,465],[465,357],[343,357],[357,412],[412,343],[437,343],[343,399],[399,437],[344,360],[360,440],[440,344],[420,437],[437,456],[456,420],[360,420],[420,363],[363,360],[361,401],[401,288],[288,361],[265,372],[372,353],[353,265],[390,339],[339,249],[249,390],[339,448],[448,255],[255,339]);function a_(e){e.j={faceLandmarks:[],faceBlendshapes:[],facialTransformationMatrixes:[]}}var Cr=class extends co{constructor(e,t){super(new fs(e,t),"image_in","norm_rect",!1),this.j={faceLandmarks:[],faceBlendshapes:[],facialTransformationMatrixes:[]},this.outputFacialTransformationMatrixes=this.outputFaceBlendshapes=!1,Ge(e=this.h=new UI,0,1,t=new mr),this.v=new MI,Ge(this.h,0,3,this.v),this.s=new yg,Ge(this.h,0,2,this.s),mi(this.s,4,1),Le(this.s,2,.5),Le(this.v,2,.5),Le(this.h,4,.5)}get baseOptions(){return Et(this.h,mr,1)}set baseOptions(e){Ge(this.h,0,1,e)}o(e){return"numFaces"in e&&mi(this.s,4,e.numFaces??1),"minFaceDetectionConfidence"in e&&Le(this.s,2,e.minFaceDetectionConfidence??.5),"minTrackingConfidence"in e&&Le(this.h,4,e.minTrackingConfidence??.5),"minFacePresenceConfidence"in e&&Le(this.v,2,e.minFacePresenceConfidence??.5),"outputFaceBlendshapes"in e&&(this.outputFaceBlendshapes=!!e.outputFaceBlendshapes),"outputFacialTransformationMatrixes"in e&&(this.outputFacialTransformationMatrixes=!!e.outputFacialTransformationMatrixes),this.l(e)}D(e,t){return a_(this),ms(this,e,t),this.j}F(e,t,r){return a_(this),di(this,e,r,t),this.j}m(){var e=new mo;sr(e,"image_in"),sr(e,"norm_rect"),_t(e,"face_landmarks");let t=new Uo;Os(t,tW,this.h);let r=new Gn;Vo(r,"mediapipe.tasks.vision.face_landmarker.FaceLandmarkerGraph"),rr(r,"IMAGE:image_in"),rr(r,"NORM_RECT:norm_rect"),wt(r,"NORM_LANDMARKS:face_landmarks"),r.o(t),Go(e,r),this.g.attachProtoVectorListener("face_landmarks",(n,o)=>{for(let s of n)n=wm(s),this.j.faceLandmarks.push(bg(n));Ae(this,o)}),this.g.attachEmptyPacketListener("face_landmarks",n=>{Ae(this,n)}),this.outputFaceBlendshapes&&(_t(e,"blendshapes"),wt(r,"BLENDSHAPES:blendshapes"),this.g.attachProtoVectorListener("blendshapes",(n,o)=>{if(this.outputFaceBlendshapes)for(let s of n)n=xg(s),this.j.faceBlendshapes.push(tT(n.g()??[]));Ae(this,o)}),this.g.attachEmptyPacketListener("blendshapes",n=>{Ae(this,n)})),this.outputFacialTransformationMatrixes&&(_t(e,"face_geometry"),wt(r,"FACE_GEOMETRY:face_geometry"),this.g.attachProtoVectorListener("face_geometry",(n,o)=>{if(this.outputFacialTransformationMatrixes)for(let s of n)(n=Et(eW(s),H9,2))&&this.j.facialTransformationMatrixes.push({rows:$s(ls(n,1),0)??0,columns:$s(ls(n,2),0)??0,data:Ru(n,3,Ba,$u()).slice()??[]});Ae(this,o)}),this.g.attachEmptyPacketListener("face_geometry",n=>{Ae(this,n)})),e=e.g(),this.setGraph(new Uint8Array(e),!0)}};Cr.prototype.detectForVideo=Cr.prototype.F,Cr.prototype.detect=Cr.prototype.D,Cr.prototype.setOptions=Cr.prototype.o,Cr.createFromModelPath=function(e,t){return gt(Cr,e,{baseOptions:{modelAssetPath:t}})},Cr.createFromModelBuffer=function(e,t){return gt(Cr,e,{baseOptions:{modelAssetBuffer:t}})},Cr.createFromOptions=function(e,t){return gt(Cr,e,t)},Cr.FACE_LANDMARKS_LIPS=sT,Cr.FACE_LANDMARKS_LEFT_EYE=iT,Cr.FACE_LANDMARKS_LEFT_EYEBROW=aT,Cr.FACE_LANDMARKS_LEFT_IRIS=m4,Cr.FACE_LANDMARKS_RIGHT_EYE=uT,Cr.FACE_LANDMARKS_RIGHT_EYEBROW=lT,Cr.FACE_LANDMARKS_RIGHT_IRIS=h4,Cr.FACE_LANDMARKS_FACE_OVAL=cT,Cr.FACE_LANDMARKS_CONTOURS=d4,Cr.FACE_LANDMARKS_TESSELATION=g4;var li=class extends co{constructor(e,t){super(new fs(e,t),"image_in","norm_rect",!0),Ge(e=this.j=new GI,0,1,t=new mr)}get baseOptions(){return Et(this.j,mr,1)}set baseOptions(e){Ge(this.j,0,1,e)}o(e){return super.l(e)}Pa(e,t,r){let n=typeof t!="function"?t:{};if(this.h=typeof t=="function"?t:r,ms(this,e,n??{}),!this.h)return this.s}m(){var e=new mo;sr(e,"image_in"),sr(e,"norm_rect"),_t(e,"stylized_image");let t=new Uo;Os(t,rW,this.j);let r=new Gn;Vo(r,"mediapipe.tasks.vision.face_stylizer.FaceStylizerGraph"),rr(r,"IMAGE:image_in"),rr(r,"NORM_RECT:norm_rect"),wt(r,"STYLIZED_IMAGE:stylized_image"),r.o(t),Go(e,r),this.g.V("stylized_image",(n,o)=>{var s=!this.h,i=n.data,a=n.width;let u=a*(n=n.height);if(i instanceof Uint8Array)if(i.length===3*u){let c=new Uint8ClampedArray(4*u);for(let p=0;p<u;++p)c[4*p]=i[3*p],c[4*p+1]=i[3*p+1],c[4*p+2]=i[3*p+2],c[4*p+3]=255;i=new ImageData(c,a,n)}else{if(i.length!==4*u)throw Error("Unsupported channel count: "+i.length/u);i=new ImageData(new Uint8ClampedArray(i.buffer,i.byteOffset,i.length),a,n)}else if(!(i instanceof WebGLTexture))throw Error(`Unsupported format: ${i.constructor.name}`);a=new rn([i],!1,!1,this.g.i.canvas,this.P,a,n),this.s=s=s?a.clone():a,this.h&&this.h(s),Ae(this,o)}),this.g.attachEmptyPacketListener("stylized_image",n=>{this.s=null,this.h&&this.h(null),Ae(this,n)}),e=e.g(),this.setGraph(new Uint8Array(e),!0)}};li.prototype.stylize=li.prototype.Pa,li.prototype.setOptions=li.prototype.o,li.createFromModelPath=function(e,t){return gt(li,e,{baseOptions:{modelAssetPath:t}})},li.createFromModelBuffer=function(e,t){return gt(li,e,{baseOptions:{modelAssetBuffer:t}})},li.createFromOptions=function(e,t){return gt(li,e,t)};var pT=Ps([0,1],[1,2],[2,3],[3,4],[0,5],[5,6],[6,7],[7,8],[5,9],[9,10],[10,11],[11,12],[9,13],[13,14],[14,15],[15,16],[13,17],[0,17],[17,18],[18,19],[19,20]);function u_(e){e.gestures=[],e.landmarks=[],e.worldLandmarks=[],e.handedness=[]}function l_(e){return e.gestures.length===0?{gestures:[],landmarks:[],worldLandmarks:[],handedness:[],handednesses:[]}:{gestures:e.gestures,landmarks:e.landmarks,worldLandmarks:e.worldLandmarks,handedness:e.handedness,handednesses:e.handedness}}function c_(e,t=!0){let r=[];for(let o of e){var n=xg(o);e=[];for(let s of n.g())n=t&&ls(s,1)!=null?$s(ls(s,1),0):-1,e.push({score:Dr(s,2)??0,index:n,categoryName:fi(s,3)??"",displayName:fi(s,4)??""});r.push(e)}return r}var Po=class extends co{constructor(e,t){super(new fs(e,t),"image_in","norm_rect",!1),this.gestures=[],this.landmarks=[],this.worldLandmarks=[],this.handedness=[],Ge(e=this.j=new HI,0,1,t=new mr),this.s=new Zw,Ge(this.j,0,2,this.s),this.C=new Yw,Ge(this.s,0,3,this.C),this.v=new zI,Ge(this.s,0,2,this.v),this.h=new nW,Ge(this.j,0,3,this.h),Le(this.v,2,.5),Le(this.s,4,.5),Le(this.C,2,.5)}get baseOptions(){return Et(this.j,mr,1)}set baseOptions(e){Ge(this.j,0,1,e)}o(e){if(mi(this.v,3,e.numHands??1),"minHandDetectionConfidence"in e&&Le(this.v,2,e.minHandDetectionConfidence??.5),"minTrackingConfidence"in e&&Le(this.s,4,e.minTrackingConfidence??.5),"minHandPresenceConfidence"in e&&Le(this.C,2,e.minHandPresenceConfidence??.5),e.cannedGesturesClassifierOptions){var t=new uc,r=t,n=ow(e.cannedGesturesClassifierOptions,Et(this.h,uc,3)?.h());Ge(r,0,2,n),Ge(this.h,0,3,t)}else e.cannedGesturesClassifierOptions===void 0&&Et(this.h,uc,3)?.g();return e.customGesturesClassifierOptions?(Ge(r=t=new uc,0,2,n=ow(e.customGesturesClassifierOptions,Et(this.h,uc,4)?.h())),Ge(this.h,0,4,t)):e.customGesturesClassifierOptions===void 0&&Et(this.h,uc,4)?.g(),this.l(e)}Ka(e,t){return u_(this),ms(this,e,t),l_(this)}La(e,t,r){return u_(this),di(this,e,r,t),l_(this)}m(){var e=new mo;sr(e,"image_in"),sr(e,"norm_rect"),_t(e,"hand_gestures"),_t(e,"hand_landmarks"),_t(e,"world_hand_landmarks"),_t(e,"handedness");let t=new Uo;Os(t,oW,this.j);let r=new Gn;Vo(r,"mediapipe.tasks.vision.gesture_recognizer.GestureRecognizerGraph"),rr(r,"IMAGE:image_in"),rr(r,"NORM_RECT:norm_rect"),wt(r,"HAND_GESTURES:hand_gestures"),wt(r,"LANDMARKS:hand_landmarks"),wt(r,"WORLD_LANDMARKS:world_hand_landmarks"),wt(r,"HANDEDNESS:handedness"),r.o(t),Go(e,r),this.g.attachProtoVectorListener("hand_landmarks",(n,o)=>{for(let s of n){n=wm(s);let i=[];for(let a of Hi(n,DI,1))i.push({x:Dr(a,1)??0,y:Dr(a,2)??0,z:Dr(a,3)??0,visibility:Dr(a,4)??0});this.landmarks.push(i)}Ae(this,o)}),this.g.attachEmptyPacketListener("hand_landmarks",n=>{Ae(this,n)}),this.g.attachProtoVectorListener("world_hand_landmarks",(n,o)=>{for(let s of n){n=fc(s);let i=[];for(let a of Hi(n,OI,1))i.push({x:Dr(a,1)??0,y:Dr(a,2)??0,z:Dr(a,3)??0,visibility:Dr(a,4)??0});this.worldLandmarks.push(i)}Ae(this,o)}),this.g.attachEmptyPacketListener("world_hand_landmarks",n=>{Ae(this,n)}),this.g.attachProtoVectorListener("hand_gestures",(n,o)=>{this.gestures.push(...c_(n,!1)),Ae(this,o)}),this.g.attachEmptyPacketListener("hand_gestures",n=>{Ae(this,n)}),this.g.attachProtoVectorListener("handedness",(n,o)=>{this.handedness.push(...c_(n)),Ae(this,o)}),this.g.attachEmptyPacketListener("handedness",n=>{Ae(this,n)}),e=e.g(),this.setGraph(new Uint8Array(e),!0)}};function p_(e){return{landmarks:e.landmarks,worldLandmarks:e.worldLandmarks,handednesses:e.handedness,handedness:e.handedness}}Po.prototype.recognizeForVideo=Po.prototype.La,Po.prototype.recognize=Po.prototype.Ka,Po.prototype.setOptions=Po.prototype.o,Po.createFromModelPath=function(e,t){return gt(Po,e,{baseOptions:{modelAssetPath:t}})},Po.createFromModelBuffer=function(e,t){return gt(Po,e,{baseOptions:{modelAssetBuffer:t}})},Po.createFromOptions=function(e,t){return gt(Po,e,t)},Po.HAND_CONNECTIONS=pT;var Un=class extends co{constructor(e,t){super(new fs(e,t),"image_in","norm_rect",!1),this.landmarks=[],this.worldLandmarks=[],this.handedness=[],Ge(e=this.h=new Zw,0,1,t=new mr),this.s=new Yw,Ge(this.h,0,3,this.s),this.j=new zI,Ge(this.h,0,2,this.j),mi(this.j,3,1),Le(this.j,2,.5),Le(this.s,2,.5),Le(this.h,4,.5)}get baseOptions(){return Et(this.h,mr,1)}set baseOptions(e){Ge(this.h,0,1,e)}o(e){return"numHands"in e&&mi(this.j,3,e.numHands??1),"minHandDetectionConfidence"in e&&Le(this.j,2,e.minHandDetectionConfidence??.5),"minTrackingConfidence"in e&&Le(this.h,4,e.minTrackingConfidence??.5),"minHandPresenceConfidence"in e&&Le(this.s,2,e.minHandPresenceConfidence??.5),this.l(e)}D(e,t){return this.landmarks=[],this.worldLandmarks=[],this.handedness=[],ms(this,e,t),p_(this)}F(e,t,r){return this.landmarks=[],this.worldLandmarks=[],this.handedness=[],di(this,e,r,t),p_(this)}m(){var e=new mo;sr(e,"image_in"),sr(e,"norm_rect"),_t(e,"hand_landmarks"),_t(e,"world_hand_landmarks"),_t(e,"handedness");let t=new Uo;Os(t,sW,this.h);let r=new Gn;Vo(r,"mediapipe.tasks.vision.hand_landmarker.HandLandmarkerGraph"),rr(r,"IMAGE:image_in"),rr(r,"NORM_RECT:norm_rect"),wt(r,"LANDMARKS:hand_landmarks"),wt(r,"WORLD_LANDMARKS:world_hand_landmarks"),wt(r,"HANDEDNESS:handedness"),r.o(t),Go(e,r),this.g.attachProtoVectorListener("hand_landmarks",(n,o)=>{for(let s of n)n=wm(s),this.landmarks.push(bg(n));Ae(this,o)}),this.g.attachEmptyPacketListener("hand_landmarks",n=>{Ae(this,n)}),this.g.attachProtoVectorListener("world_hand_landmarks",(n,o)=>{for(let s of n)n=fc(s),this.worldLandmarks.push(am(n));Ae(this,o)}),this.g.attachEmptyPacketListener("world_hand_landmarks",n=>{Ae(this,n)}),this.g.attachProtoVectorListener("handedness",(n,o)=>{var s=this.handedness,i=s.push;let a=[];for(let u of n){n=xg(u);let c=[];for(let p of n.g())c.push({score:Dr(p,2)??0,index:$s(ls(p,1),0)??-1,categoryName:fi(p,3)??"",displayName:fi(p,4)??""});a.push(c)}i.call(s,...a),Ae(this,o)}),this.g.attachEmptyPacketListener("handedness",n=>{Ae(this,n)}),e=e.g(),this.setGraph(new Uint8Array(e),!0)}};Un.prototype.detectForVideo=Un.prototype.F,Un.prototype.detect=Un.prototype.D,Un.prototype.setOptions=Un.prototype.o,Un.createFromModelPath=function(e,t){return gt(Un,e,{baseOptions:{modelAssetPath:t}})},Un.createFromModelBuffer=function(e,t){return gt(Un,e,{baseOptions:{modelAssetBuffer:t}})},Un.createFromOptions=function(e,t){return gt(Un,e,t)},Un.HAND_CONNECTIONS=pT;var x4=Ps([0,1],[1,2],[2,3],[3,7],[0,4],[4,5],[5,6],[6,8],[9,10],[11,12],[11,13],[13,15],[15,17],[15,19],[15,21],[17,19],[12,14],[14,16],[16,18],[16,20],[16,22],[18,20],[11,23],[12,24],[23,24],[23,25],[24,26],[25,27],[26,28],[27,29],[28,30],[29,31],[30,32],[27,31],[28,32]);function f_(e){e.h={faceLandmarks:[],faceBlendshapes:[],poseLandmarks:[],poseWorldLandmarks:[],poseSegmentationMasks:[],leftHandLandmarks:[],leftHandWorldLandmarks:[],rightHandLandmarks:[],rightHandWorldLandmarks:[]}}function m_(e){try{if(!e.C)return e.h;e.C(e.h)}finally{wg(e)}}function Rd(e,t){e=wm(e),t.push(bg(e))}var pr=class extends co{constructor(e,t){super(new fs(e,t),"input_frames_image",null,!1),this.h={faceLandmarks:[],faceBlendshapes:[],poseLandmarks:[],poseWorldLandmarks:[],poseSegmentationMasks:[],leftHandLandmarks:[],leftHandWorldLandmarks:[],rightHandLandmarks:[],rightHandWorldLandmarks:[]},this.outputPoseSegmentationMasks=this.outputFaceBlendshapes=!1,Ge(e=this.j=new YI,0,1,t=new mr),this.K=new Yw,Ge(this.j,0,2,this.K),this.aa=new iW,Ge(this.j,0,3,this.aa),this.s=new yg,Ge(this.j,0,4,this.s),this.I=new MI,Ge(this.j,0,5,this.I),this.v=new jI,Ge(this.j,0,6,this.v),this.L=new XI,Ge(this.j,0,7,this.L),Le(this.s,2,.5),Le(this.s,3,.3),Le(this.I,2,.5),Le(this.v,2,.5),Le(this.v,3,.3),Le(this.L,2,.5),Le(this.K,2,.5)}get baseOptions(){return Et(this.j,mr,1)}set baseOptions(e){Ge(this.j,0,1,e)}o(e){return"minFaceDetectionConfidence"in e&&Le(this.s,2,e.minFaceDetectionConfidence??.5),"minFaceSuppressionThreshold"in e&&Le(this.s,3,e.minFaceSuppressionThreshold??.3),"minFacePresenceConfidence"in e&&Le(this.I,2,e.minFacePresenceConfidence??.5),"outputFaceBlendshapes"in e&&(this.outputFaceBlendshapes=!!e.outputFaceBlendshapes),"minPoseDetectionConfidence"in e&&Le(this.v,2,e.minPoseDetectionConfidence??.5),"minPoseSuppressionThreshold"in e&&Le(this.v,3,e.minPoseSuppressionThreshold??.3),"minPosePresenceConfidence"in e&&Le(this.L,2,e.minPosePresenceConfidence??.5),"outputPoseSegmentationMasks"in e&&(this.outputPoseSegmentationMasks=!!e.outputPoseSegmentationMasks),"minHandLandmarksConfidence"in e&&Le(this.K,2,e.minHandLandmarksConfidence??.5),this.l(e)}D(e,t,r){let n=typeof t!="function"?t:{};return this.C=typeof t=="function"?t:r,f_(this),ms(this,e,n),m_(this)}F(e,t,r,n){let o=typeof r!="function"?r:{};return this.C=typeof r=="function"?r:n,f_(this),di(this,e,o,t),m_(this)}m(){var e=new mo;sr(e,"input_frames_image"),_t(e,"pose_landmarks"),_t(e,"pose_world_landmarks"),_t(e,"face_landmarks"),_t(e,"left_hand_landmarks"),_t(e,"left_hand_world_landmarks"),_t(e,"right_hand_landmarks"),_t(e,"right_hand_world_landmarks");let t=new Uo,r=new R3;Zv(r,1,Cc("type.googleapis.com/mediapipe.tasks.vision.holistic_landmarker.proto.HolisticLandmarkerGraphOptions"),""),function(o,s){if(s!=null)if(Array.isArray(s))tr(o,2,sg(s,Nw,void 0,void 0,!1));else{if(!(typeof s=="string"||s instanceof zi||hm(s)))throw Error("invalid value in Any.value field: "+s+" expected a ByteString, a base64 encoded string, a Uint8Array or a jspb array");Zv(o,2,gw(s,!1,!1),Pu())}}(r,this.j.g());let n=new Gn;Vo(n,"mediapipe.tasks.vision.holistic_landmarker.HolisticLandmarkerGraph"),Kd(n,8,R3,r),rr(n,"IMAGE:input_frames_image"),wt(n,"POSE_LANDMARKS:pose_landmarks"),wt(n,"POSE_WORLD_LANDMARKS:pose_world_landmarks"),wt(n,"FACE_LANDMARKS:face_landmarks"),wt(n,"LEFT_HAND_LANDMARKS:left_hand_landmarks"),wt(n,"LEFT_HAND_WORLD_LANDMARKS:left_hand_world_landmarks"),wt(n,"RIGHT_HAND_LANDMARKS:right_hand_landmarks"),wt(n,"RIGHT_HAND_WORLD_LANDMARKS:right_hand_world_landmarks"),n.o(t),Go(e,n),vg(this,e),this.g.attachProtoListener("pose_landmarks",(o,s)=>{Rd(o,this.h.poseLandmarks),Ae(this,s)}),this.g.attachEmptyPacketListener("pose_landmarks",o=>{Ae(this,o)}),this.g.attachProtoListener("pose_world_landmarks",(o,s)=>{var i=this.h.poseWorldLandmarks;o=fc(o),i.push(am(o)),Ae(this,s)}),this.g.attachEmptyPacketListener("pose_world_landmarks",o=>{Ae(this,o)}),this.outputPoseSegmentationMasks&&(wt(n,"POSE_SEGMENTATION_MASK:pose_segmentation_mask"),yc(this,"pose_segmentation_mask"),this.g.V("pose_segmentation_mask",(o,s)=>{this.h.poseSegmentationMasks=[wc(this,o,!0,!this.C)],Ae(this,s)}),this.g.attachEmptyPacketListener("pose_segmentation_mask",o=>{this.h.poseSegmentationMasks=[],Ae(this,o)})),this.g.attachProtoListener("face_landmarks",(o,s)=>{Rd(o,this.h.faceLandmarks),Ae(this,s)}),this.g.attachEmptyPacketListener("face_landmarks",o=>{Ae(this,o)}),this.outputFaceBlendshapes&&(_t(e,"extra_blendshapes"),wt(n,"FACE_BLENDSHAPES:extra_blendshapes"),this.g.attachProtoListener("extra_blendshapes",(o,s)=>{var i=this.h.faceBlendshapes;this.outputFaceBlendshapes&&(o=xg(o),i.push(tT(o.g()??[]))),Ae(this,s)}),this.g.attachEmptyPacketListener("extra_blendshapes",o=>{Ae(this,o)})),this.g.attachProtoListener("left_hand_landmarks",(o,s)=>{Rd(o,this.h.leftHandLandmarks),Ae(this,s)}),this.g.attachEmptyPacketListener("left_hand_landmarks",o=>{Ae(this,o)}),this.g.attachProtoListener("left_hand_world_landmarks",(o,s)=>{var i=this.h.leftHandWorldLandmarks;o=fc(o),i.push(am(o)),Ae(this,s)}),this.g.attachEmptyPacketListener("left_hand_world_landmarks",o=>{Ae(this,o)}),this.g.attachProtoListener("right_hand_landmarks",(o,s)=>{Rd(o,this.h.rightHandLandmarks),Ae(this,s)}),this.g.attachEmptyPacketListener("right_hand_landmarks",o=>{Ae(this,o)}),this.g.attachProtoListener("right_hand_world_landmarks",(o,s)=>{var i=this.h.rightHandWorldLandmarks;o=fc(o),i.push(am(o)),Ae(this,s)}),this.g.attachEmptyPacketListener("right_hand_world_landmarks",o=>{Ae(this,o)}),e=e.g(),this.setGraph(new Uint8Array(e),!0)}};pr.prototype.detectForVideo=pr.prototype.F,pr.prototype.detect=pr.prototype.D,pr.prototype.setOptions=pr.prototype.o,pr.createFromModelPath=function(e,t){return gt(pr,e,{baseOptions:{modelAssetPath:t}})},pr.createFromModelBuffer=function(e,t){return gt(pr,e,{baseOptions:{modelAssetBuffer:t}})},pr.createFromOptions=function(e,t){return gt(pr,e,t)},pr.HAND_CONNECTIONS=pT,pr.POSE_CONNECTIONS=x4,pr.FACE_LANDMARKS_LIPS=sT,pr.FACE_LANDMARKS_LEFT_EYE=iT,pr.FACE_LANDMARKS_LEFT_EYEBROW=aT,pr.FACE_LANDMARKS_LEFT_IRIS=m4,pr.FACE_LANDMARKS_RIGHT_EYE=uT,pr.FACE_LANDMARKS_RIGHT_EYEBROW=lT,pr.FACE_LANDMARKS_RIGHT_IRIS=h4,pr.FACE_LANDMARKS_FACE_OVAL=cT,pr.FACE_LANDMARKS_CONTOURS=d4,pr.FACE_LANDMARKS_TESSELATION=g4;var is=class extends co{constructor(e,t){super(new fs(e,t),"input_image","norm_rect",!0),this.j={classifications:[]},Ge(e=this.h=new ZI,0,1,t=new mr)}get baseOptions(){return Et(this.h,mr,1)}set baseOptions(e){Ge(this.h,0,1,e)}o(e){return Ge(this.h,0,2,ow(e,Et(this.h,qw,2))),this.l(e)}ua(e,t){return this.j={classifications:[]},ms(this,e,t),this.j}va(e,t,r){return this.j={classifications:[]},di(this,e,r,t),this.j}m(){var e=new mo;sr(e,"input_image"),sr(e,"norm_rect"),_t(e,"classifications");let t=new Uo;Os(t,aW,this.h);let r=new Gn;Vo(r,"mediapipe.tasks.vision.image_classifier.ImageClassifierGraph"),rr(r,"IMAGE:input_image"),rr(r,"NORM_RECT:norm_rect"),wt(r,"CLASSIFICATIONS:classifications"),r.o(t),Go(e,r),this.g.attachProtoListener("classifications",(n,o)=>{this.j=function(s){let i={classifications:Hi(s,q9,1).map(a=>tT(Et(a,kI,4)?.g()??[],$s(ls(a,2),0),fi(a,3)))};return Wd(Oa(s,2))!=null&&(i.timestampMs=$s(Wd(Oa(s,2)),0)),i}(j9(n)),Ae(this,o)}),this.g.attachEmptyPacketListener("classifications",n=>{Ae(this,n)}),e=e.g(),this.setGraph(new Uint8Array(e),!0)}};is.prototype.classifyForVideo=is.prototype.va,is.prototype.classify=is.prototype.ua,is.prototype.setOptions=is.prototype.o,is.createFromModelPath=function(e,t){return gt(is,e,{baseOptions:{modelAssetPath:t}})},is.createFromModelBuffer=function(e,t){return gt(is,e,{baseOptions:{modelAssetBuffer:t}})},is.createFromOptions=function(e,t){return gt(is,e,t)};var Lo=class extends co{constructor(e,t){super(new fs(e,t),"image_in","norm_rect",!0),this.h=new QI,this.embeddings={embeddings:[]},Ge(e=this.h,0,1,t=new mr)}get baseOptions(){return Et(this.h,mr,1)}set baseOptions(e){Ge(this.h,0,1,e)}o(e){var t=this.h,r=Et(this.h,V3,2);return r=r?r.clone():new V3,e.l2Normalize!==void 0?pm(r,1,e.l2Normalize):"l2Normalize"in e&&tr(r,1),e.quantize!==void 0?pm(r,2,e.quantize):"quantize"in e&&tr(r,2),Ge(t,0,2,r),this.l(e)}Ba(e,t){return ms(this,e,t),this.embeddings}Ca(e,t,r){return di(this,e,r,t),this.embeddings}m(){var e=new mo;sr(e,"image_in"),sr(e,"norm_rect"),_t(e,"embeddings_out");let t=new Uo;Os(t,uW,this.h);let r=new Gn;Vo(r,"mediapipe.tasks.vision.image_embedder.ImageEmbedderGraph"),rr(r,"IMAGE:image_in"),rr(r,"NORM_RECT:norm_rect"),wt(r,"EMBEDDINGS:embeddings_out"),r.o(t),Go(e,r),this.g.attachProtoListener("embeddings_out",(n,o)=>{n=Z9(n),this.embeddings=function(s){return{embeddings:Hi(s,Y9,1).map(i=>{let a={headIndex:$s(ls(i,3),0)??-1,headName:fi(i,4)??""};if(Y_(i,U3,Lv(i,1))!==void 0)i=Ru(i=Et(i,U3,Lv(i,1)),1,Ba,$u()),a.floatEmbedding=i.slice();else{let u=new Uint8Array(0);a.quantizedEmbedding=Et(i,X9,Lv(i,2))?.qa()?.h()??u}return a}),timestampMs:$s(Wd(Oa(s,2)),0)}}(n),Ae(this,o)}),this.g.attachEmptyPacketListener("embeddings_out",n=>{Ae(this,n)}),e=e.g(),this.setGraph(new Uint8Array(e),!0)}};Lo.cosineSimilarity=function(e,t){if(e.floatEmbedding&&t.floatEmbedding)e=K3(e.floatEmbedding,t.floatEmbedding);else{if(!e.quantizedEmbedding||!t.quantizedEmbedding)throw Error("Cannot compute cosine similarity between quantized and float embeddings.");e=K3(H3(e.quantizedEmbedding),H3(t.quantizedEmbedding))}return e},Lo.prototype.embedForVideo=Lo.prototype.Ca,Lo.prototype.embed=Lo.prototype.Ba,Lo.prototype.setOptions=Lo.prototype.o,Lo.createFromModelPath=function(e,t){return gt(Lo,e,{baseOptions:{modelAssetPath:t}})},Lo.createFromModelBuffer=function(e,t){return gt(Lo,e,{baseOptions:{modelAssetBuffer:t}})},Lo.createFromOptions=function(e,t){return gt(Lo,e,t)};var uw=class{constructor(e,t,r){this.confidenceMasks=e,this.categoryMask=t,this.qualityScores=r}close(){this.confidenceMasks?.forEach(e=>{e.close()}),this.categoryMask?.close()}};function h_(e){e.categoryMask=void 0,e.confidenceMasks=void 0,e.qualityScores=void 0}function d_(e){try{let t=new uw(e.confidenceMasks,e.categoryMask,e.qualityScores);if(!e.j)return t;e.j(t)}finally{wg(e)}}uw.prototype.close=uw.prototype.close;var lo=class extends co{constructor(e,t){super(new fs(e,t),"image_in","norm_rect",!1),this.s=[],this.outputCategoryMask=!1,this.outputConfidenceMasks=!0,this.h=new eT,this.v=new JI,Ge(this.h,0,3,this.v),Ge(e=this.h,0,1,t=new mr)}get baseOptions(){return Et(this.h,mr,1)}set baseOptions(e){Ge(this.h,0,1,e)}o(e){return e.displayNamesLocale!==void 0?tr(this.h,2,Cc(e.displayNamesLocale)):"displayNamesLocale"in e&&tr(this.h,2),"outputCategoryMask"in e&&(this.outputCategoryMask=e.outputCategoryMask??!1),"outputConfidenceMasks"in e&&(this.outputConfidenceMasks=e.outputConfidenceMasks??!0),super.l(e)}J(){(function(e){let t=Hi(e.ea(),Gn,1).filter(r=>fi(r,1).includes("mediapipe.tasks.TensorsToSegmentationCalculator"));if(e.s=[],t.length>1)throw Error("The graph has more than one mediapipe.tasks.TensorsToSegmentationCalculator.");t.length===1&&(Et(t[0],Uo,7)?.l()?.g()??new Map).forEach((r,n)=>{e.s[Number(n)]=fi(r,1)})})(this)}fa(e,t,r){let n=typeof t!="function"?t:{};return this.j=typeof t=="function"?t:r,h_(this),ms(this,e,n),d_(this)}Na(e,t,r,n){let o=typeof r!="function"?r:{};return this.j=typeof r=="function"?r:n,h_(this),di(this,e,o,t),d_(this)}Fa(){return this.s}m(){var e=new mo;sr(e,"image_in"),sr(e,"norm_rect");let t=new Uo;Os(t,t4,this.h);let r=new Gn;Vo(r,"mediapipe.tasks.vision.image_segmenter.ImageSegmenterGraph"),rr(r,"IMAGE:image_in"),rr(r,"NORM_RECT:norm_rect"),r.o(t),Go(e,r),vg(this,e),this.outputConfidenceMasks&&(_t(e,"confidence_masks"),wt(r,"CONFIDENCE_MASKS:confidence_masks"),yc(this,"confidence_masks"),this.g.da("confidence_masks",(n,o)=>{this.confidenceMasks=n.map(s=>wc(this,s,!0,!this.j)),Ae(this,o)}),this.g.attachEmptyPacketListener("confidence_masks",n=>{this.confidenceMasks=[],Ae(this,n)})),this.outputCategoryMask&&(_t(e,"category_mask"),wt(r,"CATEGORY_MASK:category_mask"),yc(this,"category_mask"),this.g.V("category_mask",(n,o)=>{this.categoryMask=wc(this,n,!1,!this.j),Ae(this,o)}),this.g.attachEmptyPacketListener("category_mask",n=>{this.categoryMask=void 0,Ae(this,n)})),_t(e,"quality_scores"),wt(r,"QUALITY_SCORES:quality_scores"),this.g.attachFloatVectorListener("quality_scores",(n,o)=>{this.qualityScores=n,Ae(this,o)}),this.g.attachEmptyPacketListener("quality_scores",n=>{this.categoryMask=void 0,Ae(this,n)}),e=e.g(),this.setGraph(new Uint8Array(e),!0)}};lo.prototype.getLabels=lo.prototype.Fa,lo.prototype.segmentForVideo=lo.prototype.Na,lo.prototype.segment=lo.prototype.fa,lo.prototype.setOptions=lo.prototype.o,lo.createFromModelPath=function(e,t){return gt(lo,e,{baseOptions:{modelAssetPath:t}})},lo.createFromModelBuffer=function(e,t){return gt(lo,e,{baseOptions:{modelAssetBuffer:t}})},lo.createFromOptions=function(e,t){return gt(lo,e,t)};var lw=class{constructor(e,t,r){this.confidenceMasks=e,this.categoryMask=t,this.qualityScores=r}close(){this.confidenceMasks?.forEach(e=>{e.close()}),this.categoryMask?.close()}};lw.prototype.close=lw.prototype.close;var yW=class extends De{constructor(e){super(e)}},lc=[0,Nr,-2],Zd=[0,Vi,-3,xr,Vi,-1],g_=[0,Zd],x_=[0,Zd,Nr,-1],zv=class extends De{constructor(e){super(e)}},y_=[0,Vi,-1,xr],bW=class extends De{constructor(){super()}},b_=class extends De{constructor(e){super(e)}},cw=[1,2,3,4,5,6,7,8,9,10,14,15],y4=class extends De{constructor(){super()}};y4.prototype.g=gg([0,qr,[0,cw,Wt,Zd,Wt,[0,Zd,lc],Wt,g_,Wt,[0,g_,lc],Wt,y_,Wt,[0,Vi,-3,xr,Rs],Wt,[0,Vi,-3,xr],Wt,[0,Bt,Vi,-2,xr,Nr,xr,-1,2,Vi,lc],Wt,x_,Wt,[0,x_,lc],Vi,lc,Bt,Wt,[0,Vi,-3,xr,lc,-1],Wt,[0,qr,y_]],Bt,[0,Bt,Nr,-1,xr]]);var ci=class extends co{constructor(e,t){super(new fs(e,t),"image_in","norm_rect_in",!1),this.outputCategoryMask=!1,this.outputConfidenceMasks=!0,this.h=new eT,this.s=new JI,Ge(this.h,0,3,this.s),Ge(e=this.h,0,1,t=new mr)}get baseOptions(){return Et(this.h,mr,1)}set baseOptions(e){Ge(this.h,0,1,e)}o(e){return"outputCategoryMask"in e&&(this.outputCategoryMask=e.outputCategoryMask??!1),"outputConfidenceMasks"in e&&(this.outputConfidenceMasks=e.outputConfidenceMasks??!0),super.l(e)}fa(e,t,r,n){let o=typeof r!="function"?r:{};this.j=typeof r=="function"?r:n,this.qualityScores=this.categoryMask=this.confidenceMasks=void 0,r=this.B+1,n=new y4;let s=new b_;var i=new yW;if(mi(i,1,255),Ge(s,0,12,i),t.keypoint&&t.scribble)throw Error("Cannot provide both keypoint and scribble.");if(t.keypoint){var a=new zv;pm(a,3,!0),Le(a,1,t.keypoint.x),Le(a,2,t.keypoint.y),om(s,5,cw,a)}else{if(!t.scribble)throw Error("Must provide either a keypoint or a scribble.");for(a of(i=new bW,t.scribble))pm(t=new zv,3,!0),Le(t,1,a.x),Le(t,2,a.y),Kd(i,1,zv,t);om(s,15,cw,i)}Kd(n,1,b_,s),this.g.addProtoToStream(n.g(),"drishti.RenderData","roi_in",r),ms(this,e,o);e:{try{let c=new lw(this.confidenceMasks,this.categoryMask,this.qualityScores);if(!this.j){var u=c;break e}this.j(c)}finally{wg(this)}u=void 0}return u}m(){var e=new mo;sr(e,"image_in"),sr(e,"roi_in"),sr(e,"norm_rect_in");let t=new Uo;Os(t,t4,this.h);let r=new Gn;Vo(r,"mediapipe.tasks.vision.interactive_segmenter.InteractiveSegmenterGraph"),rr(r,"IMAGE:image_in"),rr(r,"ROI:roi_in"),rr(r,"NORM_RECT:norm_rect_in"),r.o(t),Go(e,r),vg(this,e),this.outputConfidenceMasks&&(_t(e,"confidence_masks"),wt(r,"CONFIDENCE_MASKS:confidence_masks"),yc(this,"confidence_masks"),this.g.da("confidence_masks",(n,o)=>{this.confidenceMasks=n.map(s=>wc(this,s,!0,!this.j)),Ae(this,o)}),this.g.attachEmptyPacketListener("confidence_masks",n=>{this.confidenceMasks=[],Ae(this,n)})),this.outputCategoryMask&&(_t(e,"category_mask"),wt(r,"CATEGORY_MASK:category_mask"),yc(this,"category_mask"),this.g.V("category_mask",(n,o)=>{this.categoryMask=wc(this,n,!1,!this.j),Ae(this,o)}),this.g.attachEmptyPacketListener("category_mask",n=>{this.categoryMask=void 0,Ae(this,n)})),_t(e,"quality_scores"),wt(r,"QUALITY_SCORES:quality_scores"),this.g.attachFloatVectorListener("quality_scores",(n,o)=>{this.qualityScores=n,Ae(this,o)}),this.g.attachEmptyPacketListener("quality_scores",n=>{this.categoryMask=void 0,Ae(this,n)}),e=e.g(),this.setGraph(new Uint8Array(e),!0)}};ci.prototype.segment=ci.prototype.fa,ci.prototype.setOptions=ci.prototype.o,ci.createFromModelPath=function(e,t){return gt(ci,e,{baseOptions:{modelAssetPath:t}})},ci.createFromModelBuffer=function(e,t){return gt(ci,e,{baseOptions:{modelAssetBuffer:t}})},ci.createFromOptions=function(e,t){return gt(ci,e,t)};var as=class extends co{constructor(e,t){super(new fs(e,t),"input_frame_gpu","norm_rect",!1),this.j={detections:[]},Ge(e=this.h=new r4,0,1,t=new mr)}get baseOptions(){return Et(this.h,mr,1)}set baseOptions(e){Ge(this.h,0,1,e)}o(e){return e.displayNamesLocale!==void 0?tr(this.h,2,Cc(e.displayNamesLocale)):"displayNamesLocale"in e&&tr(this.h,2),e.maxResults!==void 0?mi(this.h,3,e.maxResults):"maxResults"in e&&tr(this.h,3),e.scoreThreshold!==void 0?Le(this.h,4,e.scoreThreshold):"scoreThreshold"in e&&tr(this.h,4),e.categoryAllowlist!==void 0?qd(this.h,5,e.categoryAllowlist):"categoryAllowlist"in e&&tr(this.h,5),e.categoryDenylist!==void 0?qd(this.h,6,e.categoryDenylist):"categoryDenylist"in e&&tr(this.h,6),this.l(e)}D(e,t){return this.j={detections:[]},ms(this,e,t),this.j}F(e,t,r){return this.j={detections:[]},di(this,e,r,t),this.j}m(){var e=new mo;sr(e,"input_frame_gpu"),sr(e,"norm_rect"),_t(e,"detections");let t=new Uo;Os(t,cW,this.h);let r=new Gn;Vo(r,"mediapipe.tasks.vision.ObjectDetectorGraph"),rr(r,"IMAGE:input_frame_gpu"),rr(r,"NORM_RECT:norm_rect"),wt(r,"DETECTIONS:detections"),r.o(t),Go(e,r),this.g.attachProtoVectorListener("detections",(n,o)=>{for(let s of n)n=RI(s),this.j.detections.push(o4(n));Ae(this,o)}),this.g.attachEmptyPacketListener("detections",n=>{Ae(this,n)}),e=e.g(),this.setGraph(new Uint8Array(e),!0)}};as.prototype.detectForVideo=as.prototype.F,as.prototype.detect=as.prototype.D,as.prototype.setOptions=as.prototype.o,as.createFromModelPath=function(e,t){return ne(this,null,function*(){return gt(as,e,{baseOptions:{modelAssetPath:t}})})},as.createFromModelBuffer=function(e,t){return gt(as,e,{baseOptions:{modelAssetBuffer:t}})},as.createFromOptions=function(e,t){return gt(as,e,t)};var pw=class{constructor(e,t,r){this.landmarks=e,this.worldLandmarks=t,this.segmentationMasks=r}close(){this.segmentationMasks?.forEach(e=>{e.close()})}};function v_(e){e.landmarks=[],e.worldLandmarks=[],e.segmentationMasks=void 0}function w_(e){try{let t=new pw(e.landmarks,e.worldLandmarks,e.segmentationMasks);if(!e.s)return t;e.s(t)}finally{wg(e)}}pw.prototype.close=pw.prototype.close;var Bo=class extends co{constructor(e,t){super(new fs(e,t),"image_in","norm_rect",!1),this.landmarks=[],this.worldLandmarks=[],this.outputSegmentationMasks=!1,Ge(e=this.h=new n4,0,1,t=new mr),this.v=new XI,Ge(this.h,0,3,this.v),this.j=new jI,Ge(this.h,0,2,this.j),mi(this.j,4,1),Le(this.j,2,.5),Le(this.v,2,.5),Le(this.h,4,.5)}get baseOptions(){return Et(this.h,mr,1)}set baseOptions(e){Ge(this.h,0,1,e)}o(e){return"numPoses"in e&&mi(this.j,4,e.numPoses??1),"minPoseDetectionConfidence"in e&&Le(this.j,2,e.minPoseDetectionConfidence??.5),"minTrackingConfidence"in e&&Le(this.h,4,e.minTrackingConfidence??.5),"minPosePresenceConfidence"in e&&Le(this.v,2,e.minPosePresenceConfidence??.5),"outputSegmentationMasks"in e&&(this.outputSegmentationMasks=e.outputSegmentationMasks??!1),this.l(e)}D(e,t,r){let n=typeof t!="function"?t:{};return this.s=typeof t=="function"?t:r,v_(this),ms(this,e,n),w_(this)}F(e,t,r,n){let o=typeof r!="function"?r:{};return this.s=typeof r=="function"?r:n,v_(this),di(this,e,o,t),w_(this)}m(){var e=new mo;sr(e,"image_in"),sr(e,"norm_rect"),_t(e,"normalized_landmarks"),_t(e,"world_landmarks"),_t(e,"segmentation_masks");let t=new Uo;Os(t,pW,this.h);let r=new Gn;Vo(r,"mediapipe.tasks.vision.pose_landmarker.PoseLandmarkerGraph"),rr(r,"IMAGE:image_in"),rr(r,"NORM_RECT:norm_rect"),wt(r,"NORM_LANDMARKS:normalized_landmarks"),wt(r,"WORLD_LANDMARKS:world_landmarks"),r.o(t),Go(e,r),vg(this,e),this.g.attachProtoVectorListener("normalized_landmarks",(n,o)=>{this.landmarks=[];for(let s of n)n=wm(s),this.landmarks.push(bg(n));Ae(this,o)}),this.g.attachEmptyPacketListener("normalized_landmarks",n=>{this.landmarks=[],Ae(this,n)}),this.g.attachProtoVectorListener("world_landmarks",(n,o)=>{this.worldLandmarks=[];for(let s of n)n=fc(s),this.worldLandmarks.push(am(n));Ae(this,o)}),this.g.attachEmptyPacketListener("world_landmarks",n=>{this.worldLandmarks=[],Ae(this,n)}),this.outputSegmentationMasks&&(wt(r,"SEGMENTATION_MASK:segmentation_masks"),yc(this,"segmentation_masks"),this.g.da("segmentation_masks",(n,o)=>{this.segmentationMasks=n.map(s=>wc(this,s,!0,!this.s)),Ae(this,o)}),this.g.attachEmptyPacketListener("segmentation_masks",n=>{this.segmentationMasks=[],Ae(this,n)})),e=e.g(),this.setGraph(new Uint8Array(e),!0)}};Bo.prototype.detectForVideo=Bo.prototype.F,Bo.prototype.detect=Bo.prototype.D,Bo.prototype.setOptions=Bo.prototype.o,Bo.createFromModelPath=function(e,t){return gt(Bo,e,{baseOptions:{modelAssetPath:t}})},Bo.createFromModelBuffer=function(e,t){return gt(Bo,e,{baseOptions:{modelAssetBuffer:t}})},Bo.createFromOptions=function(e,t){return gt(Bo,e,t)},Bo.POSE_CONNECTIONS=x4;var yD=ks(v4());var Sm=class{constructor(t,r){this.backend=t,this.dataMover=r,this.data=new WeakMap,this.dataIdsCount=0}get(t){return this.data.has(t)||this.dataMover.moveData(this.backend,t),this.data.get(t)}set(t,r){this.dataIdsCount++,this.data.set(t,r)}has(t){return this.data.has(t)}delete(t){return this.dataIdsCount--,this.data.delete(t)}numDataIds(){return this.dataIdsCount}},Uu=class{refCount(t){return ho("refCount")}incRef(t){return ho("incRef")}timerAvailable(){return!0}time(t){return ho("time")}read(t){return ho("read")}readSync(t){return ho("readSync")}readToGPU(t,r){return ho("readToGPU")}numDataIds(){return ho("numDataIds")}disposeData(t,r){return ho("disposeData")}write(t,r,n){return ho("write")}move(t,r,n,o,s){return ho("move")}createTensorFromGPUData(t,r,n){return ho("createTensorFromGPUData")}memory(){return ho("memory")}floatPrecision(){return ho("floatPrecision")}epsilon(){return this.floatPrecision()===32?1e-7:1e-4}dispose(){return ho("dispose")}};function ho(e){throw new Error(`'${e}' not yet implemented or not found in the registry. This kernel may not be supported by the tfjs backend you have chosen`)}function w4(e){let t=e.length,r=0;for(;t>0;)r=Math.random()*t|0,t--,Cg(e,t,r)}function vW(e,t){if(e.length!==t.length)throw new Error(`Array sizes must match to be shuffled together First array length was ${e.length}Second array length was ${t.length}`);let r=e.length,n=0;for(;r>0;)n=Math.random()*r|0,r--,Cg(e,r,n),Cg(t,r,n)}function kc(e,t,r){return Math.max(e,Math.min(t,r))}function wW(e){return e%2===0?e:e+1}function Cg(e,t,r){let n=e[t];e[t]=e[r],e[r]=n}function TW(e){let t=0;for(let r=0;r<e.length;r++)t+=e[r];return t}function SW(e,t){let r=Math.random();return t*r+(1-r)*e}function CW(e,t){let r=0;for(let n=0;n<e.length;n++){let o=Number(e[n])-Number(t[n]);r+=o*o}return r}function O(e,t){if(!e)throw new Error(typeof t=="string"?t:t())}function ir(e,t,r=""){O(go(e,t),()=>r+` Shapes ${e} and ${t} must match`)}function Wo(e){O(e!=null,()=>"The input to the tensor constructor must be a non-null value.")}function rt(e){if(e.length===0)return 1;let t=e[0];for(let r=1;r<e.length;r++)t*=e[r];return t}function EW(e){return e.length===0}function fT(e,t){if(e===t)return!0;if(e==null||t==null||e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(e[r]!==null&&t[r]!==null&&e[r]!==t[r])return!1;return!0}function go(e,t){if(e===t)return!0;if(e==null||t==null||e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}function qi(e){return e%1===0}function NW(e){if(Math.tanh!=null)return Math.tanh(e);if(e===1/0)return 1;if(e===-1/0)return-1;{let t=Math.exp(2*e);return(t-1)/(t+1)}}function _W(e){let t=Math.ceil(Math.sqrt(e));return[t,Math.ceil(e/t)]}function IW(e){let t=new Uint32Array(e);for(let r=0;r<e;++r)t[r]=r;return w4(t),t}function Gu(e,t){return t<=e.length?e:e+" ".repeat(t-e.length)}function AW(e,t=o=>0,r,n){return new Promise((o,s)=>{let i=0,a=()=>{if(e()){o();return}i++;let u=t(i);if(r!=null&&i>=r){s();return}n!=null?n(a,u):setTimeout(a,u)};a()})}function kW(e,t){let r=1,n=-1;for(let s=0;s<e.length;++s)if(e[s]>=0)r*=e[s];else if(e[s]===-1){if(n!==-1)throw Error(`Shapes can only have 1 implicit size. Found -1 at dim ${n} and dim ${s}`);n=s}else if(e[s]<0)throw Error(`Shapes can not be < 0. Found ${e[s]} at dim ${s}`);if(n===-1){if(t>0&&t!==r)throw Error(`Size(${t}) must match the product of shape ${e}`);return e}if(r===0)throw Error(`Cannot infer the missing size in [${e}] when there are 0 elements`);if(t%r!==0)throw Error(`The implicit shape can't be a fractional number. Got ${t} / ${r}`);let o=e.slice();return o[n]=t/r,o}function Ua(e,t){let r=t.length;return e=e==null?t.map((n,o)=>o):[].concat(e),O(e.every(n=>n>=-r&&n<r),()=>`All values in axis param must be in range [-${r}, ${r}) but got axis ${e}`),O(e.every(n=>qi(n)),()=>`All values in axis param must be integers but got axis ${e}`),e.map(n=>n<0?r+n:n)}function mT(e,t){let r=[],n=[],o=t!=null&&Array.isArray(t)&&t.length===0,s=t==null||o?null:Ua(t,e).sort(),i=0;for(let a=0;a<e.length;++a){if(s!=null){if(s[i]===a&&e[a]!==1)throw new Error(`Can't squeeze axis ${a} since its dim '${e[a]}' is not 1`);(s[i]==null||s[i]>a)&&e[a]===1&&(r.push(e[a]),n.push(a)),s[i]<=a&&i++}e[a]!==1&&(r.push(e[a]),n.push(a))}return{newShape:r,keptDims:n}}function hT(e,t){return Eg(e,t)}function Eg(e,t){let r=null;if(e==null||e==="float32")r=new Float32Array(t);else if(e==="int32")r=new Int32Array(t);else if(e==="bool")r=new Uint8Array(t);else if(e==="string")r=new Array(t);else throw new Error(`Unknown data type ${e}`);return r}function dT(e,t){for(let r=0;r<e.length;r++){let n=e[r];if(isNaN(n)||!isFinite(n))throw Error(`A tensor of type ${t} being uploaded contains ${n}.`)}}function gT(e){return e==="bool"||e==="complex64"||e==="float32"||e==="int32"||e==="string"}function $W(e,t){return!(t==="complex64"||t==="float32"&&e!=="complex64"||t==="int32"&&e!=="float32"&&e!=="complex64"||t==="bool"&&e==="bool")}function $c(e){if(e==="float32"||e==="int32")return 4;if(e==="complex64")return 8;if(e==="bool")return 1;throw new Error(`Unknown dtype ${e}`)}function xT(e){if(e==null)return 0;let t=0;return e.forEach(r=>t+=r.length),t}function Rc(e){return typeof e=="string"||e instanceof String}function T4(e){return typeof e=="boolean"}function S4(e){return typeof e=="number"}function Va(e){return Array.isArray(e)?Va(e[0]):e instanceof Float32Array?"float32":e instanceof Int32Array||e instanceof Uint8Array||e instanceof Uint8ClampedArray?"int32":S4(e)?"float32":Rc(e)?"string":T4(e)?"bool":"float32"}function Oc(e){return!!(e&&e.constructor&&e.call&&e.apply)}function Dc(e,t){for(let r=t;r<e;++r)if(e%r===0)return r;return e}function gi(e){let t=e.length;if(t<2)return[];let r=new Array(t-1);r[t-2]=e[t-1];for(let n=t-3;n>=0;--n)r[n]=r[n+1]*e[n+1];return r}function C4(e,t,r,n=!1){let o=new Array;if(t.length===1){let s=t[0]*(n?2:1);for(let i=0;i<s;i++)o[i]=r[e+i]}else{let s=t[0],i=t.slice(1),a=i.reduce((u,c)=>u*c)*(n?2:1);for(let u=0;u<s;u++)o[u]=C4(e+u*a,i,r,n)}return o}function Vu(e,t,r=!1){if(e.length===0)return t[0];let n=e.reduce((o,s)=>o*s)*(r?2:1);if(n===0)return[];if(n!==t.length)throw new Error(`[${e}] does not match the input size ${t.length}${r?" for a complex tensor":""}.`);return C4(0,e,t,r)}function RW(e,t){if(Array.isArray(e))return e;if(t==="float32")return e instanceof Float32Array?e:new Float32Array(e);if(t==="int32")return e instanceof Int32Array?e:new Int32Array(e);if(t==="bool"||t==="string")return Uint8Array.from(new Int32Array(e));throw new Error(`Unknown dtype ${t}`)}function Cm(e,t){let r=Fc(e,t);for(let n=0;n<r.length;n++)r[n]=1;return r}function Fc(e,t){if(t==null||t==="float32"||t==="complex64")return new Float32Array(e);if(t==="int32")return new Int32Array(e);if(t==="bool")return new Uint8Array(e);throw new Error(`Unknown data type ${t}`)}function OW(e,t){let r=e.reduce((n,o)=>n*o,1);if(t==null||t==="float32")return Vu(e,new Float32Array(r));if(t==="int32")return Vu(e,new Int32Array(r));if(t==="bool")return Vu(e,new Uint8Array(r));throw new Error(`Unknown data type ${t}`)}function Zt(e){e.forEach(t=>{O(Number.isInteger(t)&&t>=0,()=>`Tensor must have a shape comprised of positive integers but got shape [${e}].`)})}function DW(e,t,r){if(t===0)return 0;if(t===1)return e[0];let n=e[e.length-1];for(let o=0;o<e.length-1;++o)n+=r[o]*e[o];return n}function FW(e,t,r){if(t===0)return[];if(t===1)return[e];let n=new Array(t);for(let o=0;o<n.length-1;++o)n[o]=Math.floor(e/r[o]),e-=n[o]*r[o];return n[n.length-1]=e,n}function Wu(e){return e&&e.then&&typeof e.then=="function"}var E4="tfjsflags",Em=class{constructor(t){this.global=t,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=LW,this.populateURLFlags()}setPlatform(t,r){this.platform!=null&&(z().getBool("IS_TEST")||z().getBool("PROD")||console.warn(`Platform ${this.platformName} has already been set. Overwriting the platform with ${t}.`)),this.platformName=t,this.platform=r}registerFlag(t,r,n){if(this.flagRegistry[t]={evaluationFn:r,setHook:n},this.urlFlags[t]!=null){let o=this.urlFlags[t];z().getBool("IS_TEST")||z().getBool("PROD")||console.warn(`Setting feature override from URL ${t}: ${o}.`),this.set(t,o)}}getAsync(t){return ne(this,null,function*(){return t in this.flags?this.flags[t]:(this.flags[t]=yield this.evaluateFlag(t),this.flags[t])})}get(t){if(t in this.flags)return this.flags[t];let r=this.evaluateFlag(t);if(Wu(r))throw new Error(`Flag ${t} cannot be synchronously evaluated. Please use getAsync() instead.`);return this.flags[t]=r,this.flags[t]}getNumber(t){return this.get(t)}getBool(t){return this.get(t)}getString(t){return this.get(t)}getFlags(){return this.flags}get features(){return this.flags}set(t,r){if(this.flagRegistry[t]==null)throw new Error(`Cannot set flag ${t} as it has not been registered.`);this.flags[t]=r,this.flagRegistry[t].setHook!=null&&this.flagRegistry[t].setHook(r)}evaluateFlag(t){if(this.flagRegistry[t]==null)throw new Error(`Cannot evaluate flag '${t}': no evaluation function found.`);return this.flagRegistry[t].evaluationFn()}setFlags(t){this.flags=Object.assign({},t)}reset(){this.flags={},this.urlFlags={},this.populateURLFlags()}populateURLFlags(){if(typeof this.global>"u"||typeof this.global.location>"u"||typeof this.global.location.search>"u")return;let t=this.getQueryParams(this.global.location.search);E4 in t&&t[E4].split(",").forEach(n=>{let[o,s]=n.split(":");this.urlFlags[o]=MW(o,s)})}};function LW(e){let t={};return e.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(r,...n)=>(BW(t,n[0],n[1]),n.join("="))),t}function BW(e,t,r){e[decodeURIComponent(t)]=decodeURIComponent(r||"")}function MW(e,t){let r=t.toLowerCase();return r==="true"||r==="false"?r==="true":`${+r}`===r?+r:t}function z(){return yT}var yT=null;function N4(e){yT=e}var bT;function vT(){if(bT==null){let e;if(typeof window<"u")e=window;else if(typeof global<"u")e=global;else if(typeof process<"u")e=process;else if(typeof self<"u")e=self;else throw new Error("Could not find a global object");bT=e}return bT}function UW(){let e=vT();return e._tfGlobals==null&&(e._tfGlobals=new Map),e._tfGlobals}function Nm(e,t){let r=UW();if(r.has(e))return r.get(e);{let n=t();return r.set(e,n),r.get(e)}}var _m="Abs",Ng="Acos",_g="Acosh",Ga="Add",Ig="AddN",Ag="All",kg="Any",$g="ArgMax",Rg="ArgMin",Og="Asin",Dg="Asinh",Fg="Atan",Pg="Atanh",Lg="Atan2",Bg="AvgPool",_4="AvgPoolGrad",Mg="AvgPool3D",I4="AvgPool3DGrad",Ug="BatchMatMul",Vg="BatchToSpaceND",Gg="Bincount",Pc="BitwiseAnd";var Wg="BroadcastArgs",zu="Cast",Lc="Ceil",zg="ClipByValue",Im="Complex",Hg="ComplexAbs",Kg="Concat",qg="Conv2D",jg="Conv2DBackpropFilter",Xg="Conv2DBackpropInput",Yg="Conv3D",A4="Conv3DBackpropFilterV2",Zg="Conv3DBackpropInputV2",Qg="Cos",Jg="Cosh",ex="Cumprod",tx="Cumsum",rx="CropAndResize",nx="DenseBincount",ox="DepthToSpace",sx="DepthwiseConv2dNative",ix="DepthwiseConv2dNativeBackpropFilter",ax="DepthwiseConv2dNativeBackpropInput",ux="Diag",lx="Dilation2D";var wT="Draw",cx="RealDiv",px="Einsum",fx="Elu",k4="EluGrad",mx="Erf",Bc="Equal",Mc="Exp",hx="ExpandDims",Uc="Expm1",dx="FFT",gx="Fill",xx="FlipLeftRight",Vc="Floor",Gc="FloorDiv",yx="FusedBatchNorm",bx="GatherV2",vx="GatherNd",Wc="Greater",zc="GreaterEqual",Hu="Identity",wx="IFFT",Tx="Imag",Sx="IsFinite",Cx="IsInf",Ex="IsNan",Nx="LeakyRelu",Hc="Less",Kc="LessEqual",_x="LinSpace",qc="Log",Ix="Log1p",Ax="LogicalAnd",kx="LogicalNot",$x="LogicalOr";var Rx="LRN",$4="LRNGrad";var Ox="Max",jc="Maximum",Dx="MaxPool",R4="MaxPoolGrad",Fx="MaxPool3D",O4="MaxPool3DGrad",Px="MaxPoolWithArgmax",Lx="Mean",Bx="Min",Xc="Minimum",Mx="MirrorPad",Ux="Mod",Vx="Multinomial",Yc="Multiply",Am="Neg",Zc="NotEqual",Gx="NonMaxSuppressionV3",Wx="NonMaxSuppressionV4",zx="NonMaxSuppressionV5",Hx="OnesLike",Kx="OneHot",qx="Pack",jx="PadV2";var Xx="Pow",Yx="Prelu",km="Prod",Zx="RaggedGather",Qx="RaggedRange",Jx="RaggedTensorToTensor",e1="Range",$m="Real",t1="Reciprocal",r1="Relu",n1="Reshape",o1="ResizeNearestNeighbor",D4="ResizeNearestNeighborGrad",s1="ResizeBilinear",F4="ResizeBilinearGrad",i1="Relu6",a1="Reverse",u1="Round",Qc="Rsqrt",l1="ScatterNd",c1="TensorScatterUpdate",p1="SearchSorted",f1="Select",m1="Selu",Rm="Slice",h1="Sin",d1="Sinh",g1="Sign",Jc="Sigmoid",x1="Softplus",ep="Sqrt",y1="Sum",b1="SpaceToBatchND",v1="SplitV",w1="Softmax",T1="SparseFillEmptyRows",S1="SparseReshape",C1="SparseSegmentMean",E1="SparseSegmentSum",N1="SparseToDense",tp="SquaredDifference",P4="Square",rp="StaticRegexReplace",_1="StridedSlice",I1="StringNGrams",A1="StringSplit",k1="StringToHashBucketFast",np="Sub",$1="Tan",R1="Tanh",op="Tile",O1="TopK",D1="Transform",sp="Transpose",F1="Unique",P1="Unpack",L1="UnsortedSegmentSum";var B1="ZerosLike",M1="Step",Om="FromPixels",U1="RotateWithOffset",Dm="_FusedMatMul",Fm="FusedConv2D",Pm="FusedDepthwiseConv2D";function ji(...e){z().getBool("IS_TEST")||z().getBool("PROD")||console.warn(...e)}function VW(...e){z().getBool("IS_TEST")||z().getBool("PROD")||console.log(...e)}var V1=Nm("kernelRegistry",()=>new Map),GW=Nm("gradRegistry",()=>new Map);function ip(e,t){let r=M4(e,t);return V1.get(r)}function TT(e){return GW.get(e)}function ST(e){let t=V1.entries(),r=[];for(;;){let{done:n,value:o}=t.next();if(n)break;let[s,i]=o,[a]=s.split("_");a===e&&r.push(i)}return r}function B4(e){let{kernelName:t,backendName:r}=e,n=M4(t,r);V1.has(n)&&ji(`The kernel '${t}' for backend '${r}' is already registered`),V1.set(n,e)}function M4(e,t){return`${t}_${e}`}var A={};$t(A,{arraysEqual:()=>go,arraysEqualWithNull:()=>fT,assert:()=>O,assertNonNegativeIntegerDimensions:()=>Zt,assertNonNull:()=>Wo,assertShapesMatch:()=>ir,bytesFromStringArray:()=>xT,bytesPerElement:()=>$c,checkConversionForErrors:()=>dT,clamp:()=>kc,computeStrides:()=>gi,convertBackendValuesAndArrayBuffer:()=>RW,createScalarValue:()=>XW,createShuffledIndices:()=>IW,decodeString:()=>pp,distSquared:()=>CW,encodeString:()=>cp,fetch:()=>ZW,fingerPrint64:()=>jW,flatten:()=>za,getArrayFromDType:()=>Eg,getTypedArrayFromDType:()=>hT,hasEncodingLoss:()=>$W,hexToLong:()=>Lm,indexToLoc:()=>FW,inferDtype:()=>Va,inferFromImplicitShape:()=>kW,isBoolean:()=>T4,isFunction:()=>Oc,isInt:()=>qi,isNumber:()=>S4,isPromise:()=>Wu,isScalarShape:()=>EW,isString:()=>Rc,isTypedArray:()=>dn,isValidDtype:()=>gT,locToIndex:()=>DW,makeOnesTypedArray:()=>Cm,makeZerosNestedTypedArray:()=>OW,makeZerosTypedArray:()=>Fc,nearestDivisor:()=>Dc,nearestLargerEven:()=>wW,now:()=>Yu,parseAxisParam:()=>Ua,randUniform:()=>SW,repeatedTry:()=>AW,rightPad:()=>Gu,shuffle:()=>w4,shuffleCombo:()=>vW,sizeFromShape:()=>rt,sizeToSquarishShape:()=>_W,squeezeShape:()=>mT,sum:()=>TW,swap:()=>Cg,tanh:()=>NW,toNestedArray:()=>Vu,toTypedArray:()=>lp});function G1(e){return e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array||e instanceof Uint8ClampedArray}var _T=ks(Y4());var Xu=_T.default||_T;function Lm(e){return Xu.fromString(e,!0,16)}var Q4=Lm("c3a5c85c97cb3127"),ju=Lm("b492b66fbe98f273"),_n=Lm("9ae16a3b2f90404f");function NT(e){return e.xor(e.shru(47))}function J4(e,t,r){let n=e.slice(t,t+r);return Xu.fromBytes(Array.from(n),!0,!0)}function Qt(e,t){return J4(e,t,8)}function Z4(e,t){return J4(e,t,4)}function Xr(e,t){return t===0?e:e.shru(t).or(e.shl(64-t))}function Wa(e,t,r=Lm("9ddfea08eb382d69")){let n=e.xor(t).mul(r);n=n.xor(n.shru(47));let o=t.xor(n).mul(r);return o=o.xor(o.shru(47)),o=o.mul(r),o}function zW(e,t,r,n,o,s){o=o.add(e),s=Xr(s.add(o).add(n),21);let i=o;return o=o.add(t),o=o.add(r),s=s.add(Xr(o,44)),[o.add(n),s.add(i)]}function z1(e,t,r,n){return zW(Qt(e,t),Qt(e,t+8),Qt(e,t+16),Qt(e,t+24),r,n)}function HW(e,t=e.length){if(t>=8){let r=_n.add(t*2),n=Qt(e,0).add(_n),o=Qt(e,t-8),s=Xr(o,37).mul(r).add(n),i=Xr(n,25).add(o).mul(r);return Wa(s,i,r)}if(t>=4){let r=_n.add(t*2),n=Z4(e,0);return Wa(n.shl(3).add(t),Z4(e,t-4),r)}if(t>0){let r=e[0],n=e[t>>1],o=e[t-1],s=r+(n<<8),i=t+(o<<2);return NT(_n.mul(s).xor(Q4.mul(i))).mul(_n)}return _n}function KW(e,t=e.length){let r=_n.add(t*2),n=Qt(e,0).mul(ju),o=Qt(e,8),s=Qt(e,t-8).mul(r),i=Qt(e,t-16).mul(_n);return Wa(Xr(n.add(o),43).add(Xr(s,30)).add(i),n.add(Xr(o.add(_n),18)).add(s),r)}function qW(e,t=e.length){let r=_n.add(t*2),n=Qt(e,0).mul(_n),o=Qt(e,8),s=Qt(e,t-8).mul(r),i=Qt(e,t-16).mul(_n),a=Xr(n.add(o),43).add(Xr(s,30)).add(i),u=Wa(a,n.add(Xr(o.add(_n),18)).add(s),r),c=Qt(e,16).mul(r),p=Qt(e,24),m=a.add(Qt(e,t-32)).mul(r),h=u.add(Qt(e,t-24)).mul(r);return Wa(Xr(c.add(p),43).add(Xr(m,30)).add(h),c.add(Xr(p.add(n),18)).add(m),r)}function jW(e,t=e.length){let r=Xu.fromNumber(81,!0);if(t<=32)return t<=16?HW(e,t):KW(e,t);if(t<=64)return qW(e,t);let n=r,o=r.mul(ju).add(113),s=NT(o.mul(_n).add(113)).mul(_n),i=[Xu.UZERO,Xu.UZERO],a=[Xu.UZERO,Xu.UZERO];n=n.mul(_n).add(Qt(e,0));let u=0,c=(t-1>>6)*64,p=c+(t-1&63)-63;do n=Xr(n.add(o).add(i[0]).add(Qt(e,u+8)),37).mul(ju),o=Xr(o.add(i[1]).add(Qt(e,u+48)),42).mul(ju),n=n.xor(a[1]),o=o.add(i[0]).add(Qt(e,u+40)),s=Xr(s.add(a[0]),33).mul(ju),i=z1(e,u,i[1].mul(ju),n.add(a[0])),a=z1(e,u+32,s.add(a[1]),o.add(Qt(e,u+16))),[s,n]=[n,s],u+=64;while(u!==c);let m=ju.add(s.and(255).shl(1));return u=p,a[0]=a[0].add(t-1&63),i[0]=i[0].add(a[0]),a[0]=a[0].add(i[0]),n=Xr(n.add(o).add(i[0]).add(Qt(e,u+8)),37).mul(m),o=Xr(o.add(i[1]).add(Qt(e,u+48)),42).mul(m),n=n.xor(a[1].mul(9)),o=o.add(i[0].mul(9).add(Qt(e,u+40))),s=Xr(s.add(a[0]),33).mul(m),i=z1(e,u,i[1].mul(m),n.add(a[0])),a=z1(e,u+32,s.add(a[1]),o.add(Qt(e,u+16))),[s,n]=[n,s],Wa(Wa(i[0],a[0],m).add(NT(o).mul(Q4)).add(s),Wa(i[1],a[1],m).add(n),m)}function XW(e,t){return t==="string"?cp(e):lp([e],t)}function YW(e,t){return e instanceof Float32Array&&t==="float32"||e instanceof Int32Array&&t==="int32"||e instanceof Uint8Array&&t==="bool"}function lp(e,t){if(t==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(e)&&(e=za(e)),z().getBool("DEBUG")&&dT(e,t),YW(e,t))return e;if(t==null||t==="float32"||t==="complex64")return new Float32Array(e);if(t==="int32")return new Int32Array(e);if(t==="bool"){let r=new Uint8Array(e.length);for(let n=0;n<r.length;++n)Math.round(e[n])!==0&&(r[n]=1);return r}else throw new Error(`Unknown data type ${t}`)}function Yu(){return z().platform.now()}function ZW(e,t){return z().platform.fetch(e,t)}function cp(e,t="utf-8"){return t=t||"utf-8",z().platform.encode(e,t)}function pp(e,t="utf-8"){return t=t||"utf-8",z().platform.decode(e,t)}function dn(e){return z().platform.isTypedArray!=null?z().platform.isTypedArray(e):G1(e)}function za(e,t=[],r=!1){if(t==null&&(t=[]),typeof e=="boolean"||typeof e=="number"||typeof e=="string"||Wu(e)||e==null||dn(e)&&r)t.push(e);else if(Array.isArray(e)||dn(e))for(let n=0;n<e.length;++n)za(e[n],t,r);else{let n=-1;for(let o of Object.keys(e))/^([1-9]+[0-9]*|0)$/.test(o)&&(n=Math.max(n,Number(o)));for(let o=0;o<=n;o++)za(e[o],t,r)}return t}var H1=class{constructor(t,r){this.backendTimer=t,this.logger=r,r==null&&(this.logger=new IT)}profileKernel(t,r,n){let o,s=()=>{o=n()},i,a=Yu();if(this.backendTimer.timerAvailable())i=this.backendTimer.time(s);else{s();for(let c of o)c.dataSync();i=Promise.resolve({kernelMs:Yu()-a})}if(z().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(let c=0;c<o.length;c++){let p=o[c];p.data().then(m=>{QW(m,p.dtype,t)})}return{kernelName:t,outputs:o,inputs:r,timeMs:i.then(c=>c.kernelMs),extraInfo:i.then(c=>c.getExtraProfileInfo!=null?c.getExtraProfileInfo():"")}}logKernelProfile(t){let{kernelName:r,outputs:n,timeMs:o,inputs:s,extraInfo:i}=t;n.forEach(a=>{Promise.all([a.data(),o,i]).then(u=>{this.logger.logKernelProfile(r,a,u[0],u[1],s,u[2])})})}};function QW(e,t,r){if(t!=="float32")return!1;for(let n=0;n<e.length;n++){let o=e[n];if(isNaN(o)||!isFinite(o))return console.warn(`Found ${o} in the result of '${r}'`),!0}return!1}var IT=class{logKernelProfile(t,r,n,o,s,i){let a=typeof o=="number"?Gu(`${o}ms`,9):o.error,u=Gu(t,25),c=r.rank,p=r.size,m=Gu(r.shape.toString(),14),h="";for(let x in s){let y=s[x];if(y!=null){let v=y.shape||r.shape,w=v.length;h+=`${x}: ${w}D ${w>0?v:""} `}}console.log(`%c${u}	%c${a}	%c${c}D ${m}	%c${p}	%c${h}	%c${i}`,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}};function eA(e,t,r){let n={},o={};for(let u=0;u<t.length;u++)n[t[u].id]=!0;for(let u=0;u<e.length;u++){let c=e[u],p=c.inputs;for(let m in p){let h=p[m],x=!1;for(let y=0;y<t.length;y++)if(n[h.id]){c.outputs.forEach(v=>n[v.id]=!0),x=!0,o[c.id]=!0;break}if(x)break}}let s={};s[r.id]=!0;let i={};for(let u=e.length-1;u>=0;u--){let c=e[u],p=c.inputs;for(let m=0;m<c.outputs.length;m++)if(s[c.outputs[m].id]){for(let h in p)s[p[h].id]=!0,i[c.id]=!0;break}}let a=[];for(let u=0;u<e.length;u++){let c=e[u];if(o[c.id]&&i[c.id]){let p={};for(let h in c.inputs){let x=c.inputs[h];n[x.id]&&(p[h]=x)}let m=Object.assign({},c);m.inputs=p,m.outputs=c.outputs,a.push(m)}}return a}function tA(e,t,r,n){for(let o=t.length-1;o>=0;o--){let s=t[o],i=[];if(s.outputs.forEach(u=>{let c=e[u.id];c!=null?i.push(c):i.push(null)}),s.gradient==null)throw new Error(`Cannot compute gradient: gradient function not found for ${s.kernelName}.`);let a=s.gradient(i);for(let u in s.inputs){if(!(u in a))throw new Error(`Cannot backprop through input ${u}. Available gradients found: ${Object.keys(a)}.`);let c=r(()=>a[u]());if(c.dtype!=="float32")throw new Error(`Error in gradient for op ${s.kernelName}. The gradient of input ${u} must have 'float32' dtype, but has '${c.dtype}'`);let p=s.inputs[u];if(!go(c.shape,p.shape))throw new Error(`Error in gradient for op ${s.kernelName}. The gradient of input '${u}' has shape '${c.shape}', which does not match the shape of the input '${p.shape}'`);if(e[p.id]==null)e[p.id]=c;else{let m=e[p.id];e[p.id]=n(m,c),m.dispose()}}}}var rA=20,Bm=3,AT=7;function nA(e,t,r,n){let o=gi(t),s=JW(e,t,r,o),i=t.length,a=K1(e,t,r,o,s),u=["Tensor"];return n&&(u.push(`  dtype: ${r}`),u.push(`  rank: ${i}`),u.push(`  shape: [${t}]`),u.push("  values:")),u.push(a.map(c=>"    "+c).join(`
`)),u.join(`
`)}function JW(e,t,r,n){let o=rt(t),s=n[n.length-1],i=new Array(s).fill(0),a=t.length,u=r==="complex64"?Um(e):e;if(a>1)for(let c=0;c<o/s;c++){let p=c*s;for(let m=0;m<s;m++)i[m]=Math.max(i[m],Mm(u[p+m],0,r).length)}return i}function Mm(e,t,r){let n;return Array.isArray(e)?n=`${parseFloat(e[0].toFixed(AT))} + ${parseFloat(e[1].toFixed(AT))}j`:Rc(e)?n=`'${e}'`:r==="bool"?n=oA(e):n=parseFloat(e.toFixed(AT)).toString(),Gu(n,t)}function oA(e){return e===0?"false":"true"}function K1(e,t,r,n,o,s=!0){let i=r==="complex64"?2:1,a=t[0],u=t.length;if(u===0){if(r==="complex64"){let v=Um(e);return[Mm(v[0],0,r)]}return r==="bool"?[oA(e[0])]:[e[0].toString()]}if(u===1){if(a>rA){let w=Bm*i,C=Array.from(e.slice(0,w)),I=Array.from(e.slice((a-Bm)*i,a*i));return r==="complex64"&&(C=Um(C),I=Um(I)),["["+C.map((D,P)=>Mm(D,o[P],r)).join(", ")+", ..., "+I.map((D,P)=>Mm(D,o[a-Bm+P],r)).join(", ")+"]"]}return["["+(r==="complex64"?Um(e):Array.from(e)).map((w,C)=>Mm(w,o[C],r)).join(", ")+"]"]}let c=t.slice(1),p=n.slice(1),m=n[0]*i,h=[];if(a>rA){for(let v=0;v<Bm;v++){let w=v*m,C=w+m;h.push(...K1(e.slice(w,C),c,r,p,o,!1))}h.push("...");for(let v=a-Bm;v<a;v++){let w=v*m,C=w+m;h.push(...K1(e.slice(w,C),c,r,p,o,v===a-1))}}else for(let v=0;v<a;v++){let w=v*m,C=w+m;h.push(...K1(e.slice(w,C),c,r,p,o,v===a-1))}let x=u===2?",":"";h[0]="["+(a>0?h[0]+x:"");for(let v=1;v<h.length-1;v++)h[v]=" "+h[v]+x;let y=`,
`;for(let v=2;v<u;v++)y+=`
`;return h[h.length-1]=" "+h[h.length-1]+"]"+(s?"":y),h}function Um(e){let t=[];for(let r=0;r<e.length;r+=2)t.push([e[r],e[r+1]]);return t}var zo=class{constructor(t,r,n){if(this.dtype=r,this.shape=t.slice(),this.size=rt(t),n!=null){let o=n.length;O(o===this.size,()=>`Length of values '${o}' does not match the size inferred by the shape '${this.size}'.`)}if(r==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=n||Eg(r,this.size),this.strides=gi(t)}set(t,...r){r.length===0&&(r=[0]),O(r.length===this.rank,()=>`The number of provided coordinates (${r.length}) must match the rank (${this.rank})`);let n=this.locToIndex(r);this.values[n]=t}get(...t){t.length===0&&(t=[0]);let r=0;for(let o of t){if(o<0||o>=this.shape[r]){let s=`Requested out of range element at ${t}.   Buffer shape=${this.shape}`;throw new Error(s)}r++}let n=t[t.length-1];for(let o=0;o<t.length-1;++o)n+=this.strides[o]*t[o];return this.values[n]}locToIndex(t){if(this.rank===0)return 0;if(this.rank===1)return t[0];let r=t[t.length-1];for(let n=0;n<t.length-1;++n)r+=this.strides[n]*t[n];return r}indexToLoc(t){if(this.rank===0)return[];if(this.rank===1)return[t];let r=new Array(this.shape.length);for(let n=0;n<r.length-1;++n)r[n]=Math.floor(t/this.strides[n]),t-=r[n]*this.strides[n];return r[r.length-1]=t,r}get rank(){return this.shape.length}toTensor(){return Bs().makeTensor(this.values,this.shape,this.dtype)}},Bs=null,fp=null,ez=null;function sA(e){Bs=e}function iA(e){fp=e}function aA(e){ez=e}var It=class{constructor(t,r,n,o){this.kept=!1,this.isDisposedInternal=!1,this.shape=t.slice(),this.dtype=r||"float32",this.size=rt(t),this.strides=gi(t),this.dataId=n,this.id=o,this.rankType=this.rank<5?this.rank.toString():"higher"}get rank(){return this.shape.length}buffer(){return ne(this,null,function*(){let t=yield this.data();return fp.buffer(this.shape,this.dtype,t)})}bufferSync(){return fp.buffer(this.shape,this.dtype,this.dataSync())}array(){return ne(this,null,function*(){let t=yield this.data();return Vu(this.shape,t,this.dtype==="complex64")})}arraySync(){return Vu(this.shape,this.dataSync(),this.dtype==="complex64")}data(){return ne(this,null,function*(){this.throwIfDisposed();let t=Bs().read(this.dataId);if(this.dtype==="string"){let r=yield t;try{return r.map(n=>pp(n))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}}return t})}dataToGPU(t){return this.throwIfDisposed(),Bs().readToGPU(this.dataId,t)}dataSync(){this.throwIfDisposed();let t=Bs().readSync(this.dataId);if(this.dtype==="string")try{return t.map(r=>pp(r))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return t}bytes(){return ne(this,null,function*(){this.throwIfDisposed();let t=yield Bs().read(this.dataId);return this.dtype==="string"?t:new Uint8Array(t.buffer)})}dispose(){this.isDisposed||(this.kerasMask&&this.kerasMask.dispose(),Bs().disposeTensor(this),this.isDisposedInternal=!0)}get isDisposed(){return this.isDisposedInternal}throwIfDisposed(){if(this.isDisposed)throw new Error("Tensor is disposed.")}print(t=!1){return fp.print(this,t)}clone(){return this.throwIfDisposed(),fp.clone(this)}toString(t=!1){let r=this.dataSync();return nA(r,this.shape,this.dtype,t)}cast(t){return this.throwIfDisposed(),fp.cast(this,t)}variable(t=!0,r,n){return this.throwIfDisposed(),Bs().makeVariable(this,t,r,n)}};Object.defineProperty(It,Symbol.hasInstance,{value:e=>!!e&&e.data!=null&&e.dataSync!=null&&e.throwIfDisposed!=null});function kT(){return Nm("Tensor",()=>It)}kT();var Xi=class extends It{constructor(t,r,n,o){super(t.shape,t.dtype,t.dataId,o),this.trainable=r,this.name=n}assign(t){if(t.dtype!==this.dtype)throw new Error(`dtype of the new value (${t.dtype}) and previous value (${this.dtype}) must match`);if(!go(t.shape,this.shape))throw new Error(`shape of the new value (${t.shape}) and previous value (${this.shape}) must match`);Bs().disposeTensor(this),this.dataId=t.dataId,Bs().incRef(this,null)}dispose(){Bs().disposeVariable(this),this.isDisposedInternal=!0}};Object.defineProperty(Xi,Symbol.hasInstance,{value:e=>e instanceof It&&e.assign!=null&&e.assign instanceof Function});var uA=function(e){return e.float32="float32",e.int32="int32",e.bool="int32",e.complex64="complex64",e}(uA||{}),lA=function(e){return e.float32="float32",e.int32="int32",e.bool="bool",e.complex64="complex64",e}(lA||{}),cA=function(e){return e.float32="float32",e.int32="float32",e.bool="float32",e.complex64="complex64",e}(cA||{}),pA=function(e){return e.float32="complex64",e.int32="complex64",e.bool="complex64",e.complex64="complex64",e}(pA||{}),tz={float32:cA,int32:uA,bool:lA,complex64:pA};function gn(e,t){if(e==="string"||t==="string"){if(e==="string"&&t==="string")return"string";throw new Error(`Can not upcast ${e} with ${t}`)}return tz[e][t]}function Zu(e){return gn(e,"int32")}function q1(e){return e!=null&&typeof e=="object"&&"texture"in e&&e.texture instanceof WebGLTexture}function j1(e){return typeof GPUBuffer<"u"&&e!=null&&typeof e=="object"&&"buffer"in e&&e.buffer instanceof GPUBuffer}function Je(e,t){if(e.dtype===t.dtype)return[e,t];let r=gn(e.dtype,t.dtype);return[e.cast(r),t.cast(r)]}function fA(e,t){O(e.dtype===t.dtype,()=>`The dtypes of the first(${e.dtype}) and second(${t.dtype}) input must match`)}function X1(e){let t=[];return mA(e,t,new Set),t}function mA(e,t,r){if(e==null)return;if(e instanceof It){t.push(e);return}if(!rz(e))return;let n=e;for(let o in n){let s=n[o];r.has(s)||(r.add(s),mA(s,t,r))}}function rz(e){return Array.isArray(e)||typeof e=="object"}function $T(e){return e.kernelName!=null}var Y1=class{constructor(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map(t=>t.name)))}}}dispose(){for(let t in this.registeredVariables)this.registeredVariables[t].dispose()}},nz=(()=>{class e{constructor(r){this.ENV=r,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new Y1}ready(){return ne(this,null,function*(){if(this.pendingBackendInit!=null)return this.pendingBackendInit.then(()=>{});if(this.backendInstance!=null)return;let r=this.getSortedBackends();for(let n=0;n<r.length;n++){let o=r[n];if(yield this.initializeBackend(o).success){yield this.setBackend(o);return}}throw new Error("Could not initialize any backends, all backend initializations failed.")})}get backend(){if(this.pendingBackendInit!=null)throw new Error(`Backend '${this.backendName}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);if(this.backendInstance==null){let{name:r,asyncInit:n}=this.initializeBackendsAndReturnBest();if(n)throw new Error(`The highest priority backend '${r}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);this.setBackend(r)}return this.backendInstance}backendNames(){return Object.keys(this.registryFactory)}findBackend(r){if(!(r in this.registry))if(r in this.registryFactory){let{asyncInit:n}=this.initializeBackend(r);if(n)return null}else return null;return this.registry[r]}findBackendFactory(r){return r in this.registryFactory?this.registryFactory[r].factory:null}registerBackend(r,n,o=1){return r in this.registryFactory?(ji(`${r} backend was already registered. Reusing existing backend factory.`),!1):(this.registryFactory[r]={factory:n,priority:o},!0)}setBackend(r){return ne(this,null,function*(){if(this.registryFactory[r]==null)throw new Error(`Backend name '${r}' not found in registry`);if(this.backendName=r,this.registry[r]==null){this.backendInstance=null;let{success:n,asyncInit:o}=this.initializeBackend(r);if(!(o?yield n:n))return!1}return this.backendInstance=this.registry[r],this.setupRegisteredKernels(),this.profiler=new H1(this.backendInstance),!0})}setupRegisteredKernels(){ST(this.backendName).forEach(n=>{n.setupFunc!=null&&n.setupFunc(this.backendInstance)})}disposeRegisteredKernels(r){ST(r).forEach(o=>{o.disposeFunc!=null&&o.disposeFunc(this.registry[r])})}initializeBackend(r){let n=this.registryFactory[r];if(n==null)throw new Error(`Cannot initialize backend ${r}, no registration found.`);try{let o=n.factory();if(o&&!(o instanceof Uu)&&typeof o.then=="function"){let s=++this.pendingBackendInitId,i=o.then(a=>s<this.pendingBackendInitId?!1:(this.registry[r]=a,this.pendingBackendInit=null,!0)).catch(a=>(s<this.pendingBackendInitId||(this.pendingBackendInit=null,ji(`Initialization of backend ${r} failed`),ji(a.stack||a.message)),!1));return this.pendingBackendInit=i,{success:i,asyncInit:!0}}else return this.registry[r]=o,{success:!0,asyncInit:!1}}catch(o){return ji(`Initialization of backend ${r} failed`),ji(o.stack||o.message),{success:!1,asyncInit:!1}}}removeBackend(r){if(!(r in this.registryFactory))throw new Error(`${r} backend not found in registry`);this.backendName===r&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,r in this.registry&&(this.disposeRegisteredKernels(r),this.registry[r].dispose(),delete this.registry[r]),delete this.registryFactory[r],this.backendName===r&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}getSortedBackends(){if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((r,n)=>this.registryFactory[n].priority-this.registryFactory[r].priority)}initializeBackendsAndReturnBest(){let r=this.getSortedBackends();for(let n=0;n<r.length;n++){let o=r[n],{success:s,asyncInit:i}=this.initializeBackend(o);if(i||s)return{name:o,asyncInit:i}}throw new Error("Could not initialize any backends, all backend initializations failed.")}moveData(r,n){let o=this.state.tensorInfo.get(n),s=o.backend,i=this.readSync(n),a=s.refCount(n);s.disposeData(n,!0),o.backend=r,r.move(n,i,o.shape,o.dtype,a),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}tidy(r,n){let o=null;if(n==null){if(typeof r!="function")throw new Error("Please provide a function to tidy()");n=r}else{if(typeof r!="string"&&!(r instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof n!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");o=r}let s;return this.scopedRun(()=>this.startScope(o),()=>this.endScope(s),()=>(s=n(),s instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),s))}scopedRun(r,n,o){r();try{let s=o();return n(),s}catch(s){throw n(),s}}nextTensorId(){return e.nextTensorId++}nextVariableId(){return e.nextVariableId++}clone(r){let n=R.runKernel(Hu,{x:r}),o={x:r},s=a=>({x:()=>{let u="float32",c={x:a},p={dtype:u};return R.runKernel(zu,c,p)}}),i=[];return this.addTapeNode(this.state.activeScope.name,o,[n],s,i,{}),n}runKernel(r,n,o){if(this.backendName==null&&this.backend,!(ip(r,this.backendName)!=null))throw new Error(`Kernel '${r}' not registered for backend '${this.backendName}'`);return this.runKernelFunc({kernelName:r,inputs:n,attrs:o})}shouldCheckForMemLeaks(){return this.ENV.getBool("IS_TEST")}checkKernelForMemLeak(r,n,o){let s=this.backend.numDataIds(),i=0;o.forEach(c=>{i+=c.dtype==="complex64"?3:1});let a=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],u=s-n-i-a;if(u>0)throw new Error(`Backend '${this.backendName}' has an internal memory leak (${u} data ids) after running '${r}'`)}runKernelFunc(r){let n,o=[],s=this.isTapeOn(),i=this.state.numBytes,a=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);let u;this.backendName==null&&this.backend;let c,p=$T(r)?r.kernelName:this.state.activeScope!=null?this.state.activeScope.name:"";if($T(r)){let{kernelName:v,inputs:w,attrs:C}=r;this.backendName==null&&this.backend;let I=ip(v,this.backendName);O(I!=null,()=>`Cannot find registered kernel '${v}' for backend '${this.backendName}'`),u=()=>{let D=this.backend.numDataIds();c=I.kernelFunc({inputs:w,attrs:C,backend:this.backend});let P=Array.isArray(c)?c:[c];this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(v,D,P);let G=P.map(q=>q.rank!=null?q:this.makeTensorFromTensorInfo(q));if(s){let q=this.getTensorsForGradient(v,w,G);o=this.saveTensorsForBackwardMode(q)}return G}}else{let{forwardFunc:v}=r,w=C=>{s&&(o=C.map(I=>this.keep(this.clone(I))))};u=()=>{let C=this.backend.numDataIds();c=this.tidy(()=>v(this.backend,w));let I=Array.isArray(c)?c:[c];return this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(p,C,I),I}}let{inputs:m,attrs:h}=r,x=$T(r)?null:r.backwardsFunc,y;return this.scopedRun(()=>this.state.kernelDepth++,()=>this.state.kernelDepth--,()=>{!this.ENV.getBool("DEBUG")&&!this.state.profiling?n=u():(y=this.profiler.profileKernel(p,m,()=>u()),this.ENV.getBool("DEBUG")&&this.profiler.logKernelProfile(y),n=y.outputs)}),s&&this.addTapeNode(p,m,n,x,o,h),this.state.profiling&&this.state.activeProfile.kernels.push({name:p,bytesAdded:this.state.numBytes-i,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-a,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(m).map(v=>m[v]!=null?m[v].shape:null),outputShapes:n.map(v=>v.shape),kernelTimeMs:y.timeMs,extraInfo:y.extraInfo}),Array.isArray(c)?n:n[0]}saveTensorsForBackwardMode(r){return r.map(o=>this.keep(this.clone(o)))}getTensorsForGradient(r,n,o){let s=TT(r);if(s!=null){let i=s.inputsToSave||[],a=s.outputsToSave||[],u;s.saveAllInputs?(O(Array.isArray(n),()=>"saveAllInputs is true, expected inputs to be an array."),u=Object.keys(n).map(p=>n[p])):u=i.map(p=>n[p]);let c=o.filter((p,m)=>a[m]);return u.concat(c)}return[]}makeTensor(r,n,o,s){if(r==null)throw new Error("Values passed to engine.makeTensor() are null");o=o||"float32",s=s||this.backend;let i=r;o==="string"&&Rc(r[0])&&(i=r.map(c=>cp(c)));let a=s.write(i,n,o),u=new It(n,o,a,this.nextTensorId());if(this.trackTensor(u,s),o==="string"){let c=this.state.tensorInfo.get(a),p=xT(i);this.state.numBytes+=p-c.bytes,c.bytes=p}return u}makeTensorFromDataId(r,n,o,s){o=o||"float32";let i={dataId:r,shape:n,dtype:o};return this.makeTensorFromTensorInfo(i,s)}makeTensorFromTensorInfo(r,n){let{dataId:o,shape:s,dtype:i}=r,a=new It(s,i,o,this.nextTensorId());return this.trackTensor(a,n),a}makeVariable(r,n=!0,o,s){o=o||this.nextVariableId().toString(),s!=null&&s!==r.dtype&&(r=r.cast(s));let i=new Xi(r,n,o,this.nextTensorId());if(this.state.registeredVariables[i.name]!=null)throw new Error(`Variable with name ${i.name} was already registered`);return this.state.registeredVariables[i.name]=i,this.incRef(i,this.backend),i}trackTensor(r,n){this.state.numTensors++,r.dtype==="string"&&this.state.numStringTensors++;let o=0;r.dtype!=="complex64"&&r.dtype!=="string"&&(o=r.size*$c(r.dtype)),this.state.numBytes+=o,this.state.tensorInfo.has(r.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(r.dataId,{backend:n||this.backend,dtype:r.dtype,shape:r.shape,bytes:o})),r instanceof Xi||this.track(r)}incRef(r,n){this.trackTensor(r,n),this.backend.incRef(r.dataId)}removeDataId(r,n){this.state.tensorInfo.has(r)&&this.state.tensorInfo.get(r).backend===n&&(this.state.tensorInfo.delete(r),this.state.numDataBuffers--)}disposeTensor(r){if(!this.state.tensorInfo.has(r.dataId))return;let n=this.state.tensorInfo.get(r.dataId);if(this.state.numTensors--,r.dtype==="string"&&(this.state.numStringTensors--,this.state.numBytes-=n.bytes),r.dtype!=="complex64"&&r.dtype!=="string"){let o=r.size*$c(r.dtype);this.state.numBytes-=o}n.backend.disposeData(r.dataId)&&this.removeDataId(r.dataId,n.backend)}disposeVariables(){for(let r in this.state.registeredVariables){let n=this.state.registeredVariables[r];this.disposeVariable(n)}}disposeVariable(r){this.disposeTensor(r),this.state.registeredVariables[r.name]!=null&&delete this.state.registeredVariables[r.name]}memory(){let r=this.backend.memory();return r.numTensors=this.state.numTensors,r.numDataBuffers=this.state.numDataBuffers,r.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(r.unreliable=!0,r.reasons==null&&(r.reasons=[]),r.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),r}profile(r){return ne(this,null,function*(){this.state.profiling=!0;let n=this.state.numBytes,o=this.state.numTensors;this.state.activeProfile.kernels=[],this.state.activeProfile.result=yield r(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max(...this.state.activeProfile.kernels.map(s=>s.totalBytesSnapshot)),this.state.activeProfile.newBytes=this.state.numBytes-n,this.state.activeProfile.newTensors=this.state.numTensors-o;for(let s of this.state.activeProfile.kernels)s.kernelTimeMs=yield s.kernelTimeMs,s.extraInfo=yield s.extraInfo;return this.state.activeProfile})}isTapeOn(){return this.state.gradientDepth>0&&this.state.kernelDepth===0}addTapeNode(r,n,o,s,i,a){let u={id:this.state.nextTapeNodeId++,kernelName:r,inputs:n,outputs:o,saved:i},c=TT(r);c!=null&&(s=c.gradFunc),s!=null&&(u.gradient=p=>(p=p.map((m,h)=>{if(m==null){let x=o[h],y=Fc(x.size,x.dtype);return this.makeTensor(y,x.shape,x.dtype)}return m}),s(p.length>1?p:p[0],i,a))),this.state.activeTape.push(u)}keep(r){return r.kept=!0,r}startTape(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++}endTape(){this.state.gradientDepth--}startScope(r){let n={track:[],name:"unnamed scope",id:this.state.nextScopeId++};r&&(n.name=r),this.state.scopeStack.push(n),this.state.activeScope=n}endScope(r){let n=X1(r),o=new Set(n.map(i=>i.id));for(let i=0;i<this.state.activeScope.track.length;i++){let a=this.state.activeScope.track[i];!a.kept&&!o.has(a.id)&&a.dispose()}let s=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],n.forEach(i=>{!i.kept&&i.scopeId===s.id&&this.track(i)})}gradients(r,n,o,s=!1){if(O(n.length>0,()=>"gradients() received an empty list of xs."),o!=null&&o.dtype!=="float32")throw new Error(`dy must have 'float32' dtype, but has '${o.dtype}'`);let i=this.scopedRun(()=>this.startTape(),()=>this.endTape(),()=>this.tidy("forward",r));O(i instanceof It,()=>"The result y returned by f() must be a tensor.");let a=eA(this.state.activeTape,n,i);if(!s&&a.length===0&&n.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",()=>{let u={};u[i.id]=o??oz(i.shape),tA(u,a,p=>this.tidy(p),sz);let c=n.map(p=>u[p.id]);return this.state.gradientDepth===0&&(this.state.activeTape.forEach(p=>{for(let m of p.saved)m.dispose()}),this.state.activeTape=null),{value:i,grads:c}})}customGrad(r){return O(Oc(r),()=>"The f passed in customGrad(f) must be a function."),(...n)=>{O(n.every(u=>u instanceof It),()=>"The args passed in customGrad(f)(x1, x2,...) must all be tensors");let o,s={};n.forEach((u,c)=>{s[c]=u});let i=(u,c)=>(o=r(...n,c),O(o.value instanceof It,()=>"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"),O(Oc(o.gradFunc),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."),o.value),a=(u,c)=>{let p=o.gradFunc(u,c),m=Array.isArray(p)?p:[p];O(m.length===n.length,()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."),O(m.every(x=>x instanceof It),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors.");let h={};return m.forEach((x,y)=>{h[y]=()=>x}),h};return this.runKernelFunc({forwardFunc:i,backwardsFunc:a,inputs:s})}}readSync(r){return this.state.tensorInfo.get(r).backend.readSync(r)}read(r){return this.state.tensorInfo.get(r).backend.read(r)}readToGPU(r,n){return this.state.tensorInfo.get(r).backend.readToGPU(r,n)}time(r){return ne(this,null,function*(){let n=Yu(),o=yield this.backend.time(r);return o.wallMs=Yu()-n,o})}track(r){return this.state.activeScope!=null&&(r.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(r)),r}get registeredVariables(){return this.state.registeredVariables}reset(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new Y1;for(let r in this.registry)this.disposeRegisteredKernels(r),this.registry[r].dispose(),delete this.registry[r];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}}return e.nextTensorId=0,e.nextVariableId=0,e})();function oz(e){let t=Cm(rt(e),"float32");return R.makeTensor(t,e,"float32")}function RT(){let e=vT();if(e._tfengine==null){let t=new Em(e);e._tfengine=new nz(t)}return N4(e._tfengine.ENV),sA(()=>e._tfengine),e._tfengine}var R=RT();function sz(e,t){let r={a:e,b:t};return R.runKernel(Ga,r)}var Ha={};$t(Ha,{isBrowser:()=>DT,isMobile:()=>uz,mockIsMobile:()=>az});function iz(){return typeof navigator<"u"&&navigator!=null}var OT;function az(e){OT=e}function uz(e){if(OT!==void 0)return OT;if(e||iz()){if(e||(e=navigator),e.product==="ReactNative")return!0;let t=e.userAgent||e.vendor||(typeof window<"u"?window.opera:"");if(!t){let r=e;return r.userAgentData&&r.userAgentData.mobile}return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4))}return!1}function DT(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}var Wn=z();Wn.registerFlag("DEBUG",()=>!1,e=>{e&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")});Wn.registerFlag("IS_BROWSER",()=>DT());Wn.registerFlag("IS_NODE",()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u");Wn.registerFlag("IS_CHROME",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor));Wn.registerFlag("IS_SAFARI",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Safari/.test(navigator.userAgent)&&/Apple/.test(navigator.vendor));Wn.registerFlag("PROD",()=>!1);Wn.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",()=>Wn.getBool("DEBUG"));Wn.registerFlag("DEPRECATION_WARNINGS_ENABLED",()=>!0);Wn.registerFlag("IS_TEST",()=>!1);Wn.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",()=>Wn.getBool("DEBUG"));Wn.registerFlag("WRAP_TO_IMAGEBITMAP",()=>!1);Wn.registerFlag("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU",()=>!1);Wn.registerFlag("USE_SETTIMEOUTCUSTOM",()=>!1);function zn(e,t){let r=e;if(dn(e))return t==="string"?[]:[e.length];if(q1(e)){let o=e.channels||"RGBA";return[e.height,e.width*o.length]}else if(j1(e))return[e.buffer.size/(t==null?4:$c(t))];if(!Array.isArray(e))return[];let n=[];for(;Array.isArray(r)||dn(r)&&t!=="string";)n.push(r.length),r=r[0];return Array.isArray(e)&&z().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&dA(e,n,[]),n}function dA(e,t,r){if(r=r||[],!Array.isArray(e)&&!dn(e)){O(t.length===0,()=>`Element arr[${r.join("][")}] is a primitive, but should be an array/TypedArray of ${t[0]} elements`);return}O(t.length>0,()=>`Element arr[${r.join("][")}] should be a primitive, but is an array of ${e.length} elements`),O(e.length===t[0],()=>`Element arr[${r.join("][")}] should have ${t[0]} elements, but has ${e.length} elements`);let n=t.slice(1);for(let o=0;o<e.length;++o)dA(e[o],n,r.concat(o))}function hA(e,t,r,n){if(e!=="string_or_numeric"){if(e==null)throw new Error("Expected dtype cannot be null.");if(e!=="numeric"&&e!==t||e==="numeric"&&t==="string")throw new Error(`Argument '${r}' passed to '${n}' must be ${e} tensor, but got ${t} tensor`)}}function E(e,t,r,n="numeric"){if(e instanceof kT())return hA(n,e.dtype,t,r),e;let o=Va(e);if(o!=="string"&&["bool","int32","float32"].indexOf(n)>=0&&(o=n),hA(n,o,t,r),e==null||!dn(e)&&!Array.isArray(e)&&typeof e!="number"&&typeof e!="boolean"&&typeof e!="string"){let u=e==null?"null":e.constructor.name;throw new Error(`Argument '${t}' passed to '${r}' must be a Tensor or TensorLike, but got '${u}'`)}let s=zn(e,o);!dn(e)&&!Array.isArray(e)&&(e=[e]);let a=o!=="string"?lp(e,o):za(e,[],!0);return R.makeTensor(a,s,o)}function Qu(e,t,r,n="numeric"){if(!Array.isArray(e))throw new Error(`Argument ${t} passed to ${r} must be a \`Tensor[]\` or \`TensorLike[]\``);return e.map((s,i)=>E(s,`${t}[${i}]`,r,n))}var FT="__op";function _(e){let t=Object.keys(e);if(t.length!==1)throw new Error(`Please provide an object with a single key (operation name) mapping to a function. Got an object with ${t.length} keys.`);let r=t[0],n=e[r];r.endsWith("_")&&(r=r.substring(0,r.length-1)),r=r+FT;let o=(...s)=>{R.startScope(r);try{let i=n(...s);return Wu(i)&&console.error("Cannot return a Promise inside of tidy."),R.endScope(i),i}catch(i){throw R.endScope(null),i}};return Object.defineProperty(o,"name",{value:r,configurable:!0}),o}function lz(e,t){let r=E(e,"real","complex"),n=E(t,"imag","complex");ir(r.shape,n.shape,`real and imag shapes, ${r.shape} and ${n.shape}, must match in call to tf.complex().`);let o={real:r,imag:n};return R.runKernel(Im,o)}var Hn=_({complex_:lz});function In(e,t,r,n){if(n==null)n=Va(e);else if(n==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(j1(e)||q1(e)){if(n!=="float32"&&n!=="int32")throw new Error(`Creating tensor from GPU data only supports 'float32'|'int32' dtype, while the dtype is ${n}.`);return R.backend.createTensorFromGPUData(e,t||r,n)}if(!dn(e)&&!Array.isArray(e)&&typeof e!="number"&&typeof e!="boolean"&&typeof e!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(t!=null){Zt(t);let o=rt(t),s=rt(r);O(o===s,()=>`Based on the provided shape, [${t}], the tensor should have ${o} values but has ${s}`);for(let i=0;i<r.length;++i){let a=r[i],u=i===r.length-1?a!==rt(t.slice(i)):!0;O(r[i]===t[i]||!u,()=>`Error creating a new Tensor. Inferred shape (${r}) does not match the provided shape (${t}). `)}}return!dn(e)&&!Array.isArray(e)&&(e=[e]),t=t||r,e=n!=="string"?lp(e,n):za(e,[],!0),R.makeTensor(e,t,n)}function An(e,t,r){let n=zn(e,r);return In(e,t,n,r)}var Yi={float32:4,float16:2,int32:4,uint16:2,uint8:1,bool:1,complex64:8};var nn=class e{static join(t){return new e(t).slice()}constructor(t){if(this.shards=[],this.previousShardIndex=0,t==null||(t instanceof Array||(t=[t]),t=t.map(n=>dn(n)?n.buffer:n),t.length===0))return;this.bufferUniformSize=t[0].byteLength;let r=0;for(let n=0;n<t.length;n++){let o=t[n];n!==t.length-1&&o.byteLength!==this.bufferUniformSize&&(this.bufferUniformSize=void 0);let s=r+o.byteLength;this.shards.push({buffer:o,start:r,end:s}),r=s}this.shards.length===0&&(this.byteLength=0),this.byteLength=this.shards[this.shards.length-1].end}slice(t=0,r=this.byteLength){if(this.shards.length===0)return new ArrayBuffer(0);if(t=isNaN(Number(t))?0:t,r=isNaN(Number(r))?0:r,t=Math.max(0,t),r=Math.min(this.byteLength,r),r<=t)return new ArrayBuffer(0);let n=this.findShardForByte(t);if(n===-1)throw new Error(`Could not find start shard for byte ${t}`);let o=r-t,s=new ArrayBuffer(o),i=new Uint8Array(s),a=0;for(let u=n;u<this.shards.length;u++){let c=this.shards[u],m=t+a-c.start,h=a,y=Math.min(r,c.end)-c.start,v=new Uint8Array(c.buffer,m,y-m);if(i.set(v,h),a+=v.length,r<c.end)break}return s}findShardForByte(t){if(this.shards.length===0||t<0||t>=this.byteLength)return-1;if(this.bufferUniformSize!=null)return this.previousShardIndex=Math.floor(t/this.bufferUniformSize),this.previousShardIndex;function r(o){return t<o.start?-1:t>=o.end?1:0}if(r(this.shards[this.previousShardIndex])===0)return this.previousShardIndex;let n=cz(this.shards,r);return n===-1?-1:(this.previousShardIndex=n,this.previousShardIndex)}};function cz(e,t){let r=0,n=e.length;for(;r<=n;){let o=Math.floor((n-r)/2)+r,s=t(e[o]);if(s===0)return o;s<0?n=o:r=o+1}return-1}function pz(e){z().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(e+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}aA(pz);function Zi(){return R}function Ue(e,t){return R.tidy(e,t)}function St(e){X1(e).forEach(r=>r.dispose())}function Kn(e){return R.keep(e)}function gA(){return R.backendName}function xA(e,t,r=1){return R.registerBackend(e,t,r)}function yA(){return R.backend}var Ka=4;function wA(e,t){return ne(this,null,function*(){let r=[],n=[],o=Array.isArray(e)?e.map(i=>i.name):Object.keys(e);for(let i=0;i<o.length;++i){let a=o[i],u=Array.isArray(e)?e[i].tensor:e[a];if(u.dtype!=="float32"&&u.dtype!=="int32"&&u.dtype!=="bool"&&u.dtype!=="string"&&u.dtype!=="complex64")throw new Error(`Unsupported dtype in weight '${a}': ${u.dtype}`);let c={name:a,shape:u.shape,dtype:u.dtype};if(u.dtype==="string"){let p=new Promise(m=>ne(this,null,function*(){let h=yield u.bytes(),x=h.reduce((w,C)=>w+C.length,0)+Ka*h.length,y=new Uint8Array(x),v=0;for(let w=0;w<h.length;w++){let C=h[w],I=new Uint8Array(new Uint32Array([C.length]).buffer);y.set(I,v),v+=Ka,y.set(C,v),v+=C.length}m(y)}));n.push(p)}else n.push(u.data());t!=null&&(c.group=t),r.push(c)}let s=yield Promise.all(n);return{data:hz(s),specs:r}})}function Z1(e,t){let r=new nn(e),n={},o=0;for(let s of t){let i=fz(s,(a,u)=>r.slice(o+a,o+u));n[s.name]=TA(s,r.slice(o,o+i)),o+=i}return n}function fz(e,t){let r=rt(e.shape),n;if("quantization"in e){let o=e.quantization;n=Yi[o.dtype]}else if(e.dtype==="string"){let o=0;for(let s=0;s<r;s++)o+=Ka+new Uint32Array(t(o,o+Ka))[0];return o}else n=Yi[e.dtype];return r*n}function mz(e,t){return ne(this,null,function*(){let r=rt(e.shape),n;if("quantization"in e){let o=e.quantization;n=Yi[o.dtype]}else if(e.dtype==="string"){let o=0;for(let s=0;s<r;s++)o+=Ka+new Uint32Array(yield t(o,o+Ka))[0];return o}else n=Yi[e.dtype];return r*n})}function TA(e,t){let r=e.name,n=e.dtype,o=e.shape,s=rt(o),i,a=0;if("quantization"in e){let u=e.quantization;if(u.dtype==="uint8"||u.dtype==="uint16"){if(!("min"in u&&"scale"in u))throw new Error(`Weight ${e.name} with quantization ${u.dtype} doesn't have corresponding metadata min and scale.`)}else if(u.dtype==="float16"){if(n!=="float32")throw new Error(`Weight ${e.name} is quantized with ${u.dtype} which only supports weights of type float32 not ${n}.`)}else throw new Error(`Weight ${e.name} has unknown quantization dtype ${u.dtype}. Supported quantization dtypes are: 'uint8', 'uint16', and 'float16'.`);let c=Yi[u.dtype],p=u.dtype==="uint8"?new Uint8Array(t):new Uint16Array(t);if(n==="float32")if(u.dtype==="uint8"||u.dtype==="uint16"){i=new Float32Array(p.length);for(let m=0;m<p.length;m++){let h=p[m];i[m]=h*u.scale+u.min}}else if(u.dtype==="float16")i=yz()(p);else throw new Error(`Unsupported quantization type ${u.dtype} for weight type float32.`);else if(n==="int32"){if(u.dtype!=="uint8"&&u.dtype!=="uint16")throw new Error(`Unsupported quantization type ${u.dtype} for weight type int32.`);i=new Int32Array(p.length);for(let m=0;m<p.length;m++){let h=p[m];i[m]=Math.round(h*u.scale+u.min)}}else throw new Error(`Unsupported dtype in weight '${r}': ${n}`);a+=s*c}else if(n==="string"){let u=rt(e.shape);i=[];for(let c=0;c<u;c++){let p=new Uint32Array(t.slice(a,a+Ka))[0];a+=Ka;let m=new Uint8Array(t.slice(a,a+p));i.push(m),a+=p}}else{let u=Yi[n];if(n==="float32")i=new Float32Array(t);else if(n==="int32")i=new Int32Array(t);else if(n==="bool")i=new Uint8Array(t);else if(n==="complex64"){i=new Float32Array(t);let c=new Float32Array(i.length/2),p=new Float32Array(i.length/2);for(let y=0;y<c.length;y++)c[y]=i[y*2],p[y]=i[y*2+1];let m=An(c,o,"float32"),h=An(p,o,"float32"),x=Hn(m,h);return m.dispose(),h.dispose(),x}else throw new Error(`Unsupported dtype in weight '${r}': ${n}`);a+=s*u}return An(i,o,n)}function bA(e,t,r){return ne(this,null,function*(){let n=new Uint8Array(t);for(;n.byteLength<r;){let{done:o,value:s}=yield e.read();if(o&&s==null){let a=r-n.byteLength;throw new Error(`Reader is done but ${a} bytes are still expected`)}let i=new Uint8Array(n.length+s.byteLength);i.set(n,0),i.set(new Uint8Array(s),n.length),n=i}return n.buffer})}function Q1(e,t){return ne(this,null,function*(){let r={},n=e.getReader(),o=new ArrayBuffer(0);for(let s of t){let i=yield mz(s,(c,p)=>ne(this,null,function*(){return o=yield bA(n,o,p),o.slice(c,p)}));o=yield bA(n,o,i);let a=o.slice(0,i);o=o.slice(i);let u=TA(s,a);if(r[s.name]=u,gA()==="webgpu"){let c=yA();"uploadToGPU"in c&&rt(u.shape)>=z().get("WEBGPU_CPU_HANDOFF_SIZE_THRESHOLD")&&c.uploadToGPU(u.dataId)}}return r})}function hz(e){if(e===null)throw new Error(`Invalid input value: ${JSON.stringify(e)}`);let t=0,r=[];e.forEach(s=>{if(t+=s.byteLength,r.push(s.byteLength===s.buffer.byteLength?s:new s.constructor(s)),!(s instanceof Float32Array||s instanceof Int32Array||s instanceof Uint8Array))throw new Error(`Unsupported TypedArray subtype: ${s.constructor.name}`)});let n=new Uint8Array(t),o=0;return r.forEach(s=>{n.set(new Uint8Array(s.buffer),o),o+=s.byteLength}),n.buffer}var PT=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function vA(e){return PT?Buffer.byteLength(e,"utf8"):new Blob([e]).size}function SA(e){if(PT)return Buffer.from(e).toString("base64");let t=new Uint8Array(e),r="";for(let n=0,o=t.length;n<o;n++)r+=String.fromCharCode(t[n]);return btoa(r)}function CA(e){if(PT){let n=Buffer.from(e,"base64");return n.buffer.slice(n.byteOffset,n.byteOffset+n.byteLength)}let t=atob(e),r=new Uint8Array(t.length);for(let n=0;n<t.length;++n)r.set([t.charCodeAt(n)],n);return r.buffer}function EA(e){return nn.join(e)}function LT(e){let t="/";for(e=e.trim();e.endsWith(t);)e=e.slice(0,e.length-1);let r=e.split(t);return r[r.length-1]}function J1(e,t){let r={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,weightsManifest:t};return e.signature!=null&&(r.signature=e.signature),e.userDefinedMetadata!=null&&(r.userDefinedMetadata=e.userDefinedMetadata),e.modelInitializer!=null&&(r.modelInitializer=e.modelInitializer),e.initializerSignature!=null&&(r.initializerSignature=e.initializerSignature),e.trainingConfig!=null&&(r.trainingConfig=e.trainingConfig),r}function BT(e,t,r){let n={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy};if(e.trainingConfig!=null&&(n.trainingConfig=e.trainingConfig),e.weightsManifest!=null){if(!t)throw new Error("modelJSON has weightsManifest but weightSpecs is null");if(!r)throw new Error("modelJSON has weightsManifest but weightData is null");n.weightSpecs=t,n.weightData=r}return e.signature!=null&&(n.signature=e.signature),e.userDefinedMetadata!=null&&(n.userDefinedMetadata=e.userDefinedMetadata),e.modelInitializer!=null&&(n.modelInitializer=e.modelInitializer),e.initializerSignature!=null&&(n.initializerSignature=e.initializerSignature),n}function mp(e,t){return ne(this,null,function*(){let r,n;return e.weightsManifest!=null&&([r,n]=yield t(e.weightsManifest)),BT(e,r,n)})}function xi(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:e.modelTopology==null?0:vA(JSON.stringify(e.modelTopology)),weightSpecsBytes:e.weightSpecs==null?0:vA(JSON.stringify(e.weightSpecs)),weightDataBytes:e.weightData==null?0:new nn(e.weightData).byteLength}}function Vm(e){let t=[];for(let r of e)t.push(...r.weights);return t}function dz(){let e=r=>{let n=r<<13,o=0;for(;!(n&8388608);)o-=8388608,n<<=1;return n&=-8388609,o+=947912704,n|o},t=new Uint32Array(2048);t[0]=0;for(let r=1;r<1024;r++)t[r]=e(r);for(let r=1024;r<2048;r++)t[r]=939524096+(r-1024<<13);return t}function gz(){let e=new Uint32Array(64);e[0]=0,e[31]=1199570944,e[32]=2147483648,e[63]=3347054592;for(let t=1;t<31;t++)e[t]=t<<23;for(let t=33;t<63;t++)e[t]=2147483648+(t-32<<23);return e}function xz(){let e=new Uint32Array(64);for(let t=0;t<64;t++)e[t]=1024;return e[0]=e[32]=0,e}function yz(){let e=dz(),t=gz(),r=xz();return n=>{let o=new ArrayBuffer(4*n.length),s=new Uint32Array(o);for(let i=0;i<n.length;i++){let a=n[i],u=e[r[a>>10]+(a&1023)]+t[a>>10];s[i]=u}return new Float32Array(o)}}var Mr=class e{constructor(){this.saveRouters=[],this.loadRouters=[]}static getInstance(){return e.instance==null&&(e.instance=new e),e.instance}static registerSaveRouter(t){e.getInstance().saveRouters.push(t)}static registerLoadRouter(t){e.getInstance().loadRouters.push(t)}static getSaveHandlers(t){return e.getHandlers(t,"save")}static getLoadHandlers(t,r){return e.getHandlers(t,"load",r)}static getHandlers(t,r,n){let o=[];return(r==="load"?e.getInstance().loadRouters:e.getInstance().saveRouters).forEach(i=>{let a=i(t,n);a!==null&&o.push(a)}),o}},NA=e=>Mr.registerSaveRouter(e),_A=e=>Mr.registerLoadRouter(e),IA=e=>Mr.getSaveHandlers(e),AA=(e,t)=>Mr.getLoadHandlers(e,t);var MT="tensorflowjs",UT=1,Ju="models_store",qa="model_info_store";function kA(){if(!z().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");let e=typeof window>"u"?self:window,t=e.indexedDB||e.mozIndexedDB||e.webkitIndexedDB||e.msIndexedDB||e.shimIndexedDB;if(t==null)throw new Error("The current browser does not appear to support IndexedDB.");return t}function VT(e){let t=e.result;t.createObjectStore(Ju,{keyPath:"modelPath"}),t.createObjectStore(qa,{keyPath:"modelPath"})}var el=(()=>{class e{constructor(r){if(this.indexedDB=kA(),r==null||!r)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=r}save(r){return ne(this,null,function*(){if(r.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return this.databaseAction(this.modelPath,r)})}load(){return ne(this,null,function*(){return this.databaseAction(this.modelPath)})}databaseAction(r,n){return new Promise((o,s)=>{let i=this.indexedDB.open(MT,UT);i.onupgradeneeded=()=>VT(i),i.onsuccess=()=>{let a=i.result;if(n==null){let u=a.transaction(Ju,"readonly"),p=u.objectStore(Ju).get(this.modelPath);p.onsuccess=()=>{if(p.result==null)return a.close(),s(new Error(`Cannot find model with path '${this.modelPath}' in IndexedDB.`));o(p.result.modelArtifacts)},p.onerror=m=>(a.close(),s(p.error)),u.oncomplete=()=>a.close()}else{n.weightData=nn.join(n.weightData);let u=xi(n),c=a.transaction(qa,"readwrite"),p=c.objectStore(qa),m;try{m=p.put({modelPath:this.modelPath,modelArtifactsInfo:u})}catch(x){return s(x)}let h;m.onsuccess=()=>{h=a.transaction(Ju,"readwrite");let x=h.objectStore(Ju),y;try{y=x.put({modelPath:this.modelPath,modelArtifacts:n,modelArtifactsInfo:u})}catch(v){return s(v)}y.onsuccess=()=>o({modelArtifactsInfo:u}),y.onerror=v=>{p=c.objectStore(qa);let w=p.delete(this.modelPath);w.onsuccess=()=>(a.close(),s(y.error)),w.onerror=C=>(a.close(),s(y.error))}},m.onerror=x=>(a.close(),s(m.error)),c.oncomplete=()=>{h==null?a.close():h.oncomplete=()=>a.close()}}},i.onerror=a=>s(i.error)})}}return e.URL_SCHEME="indexeddb://",e})();var $A=e=>z().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(el.URL_SCHEME)?bz(e.slice(el.URL_SCHEME.length)):null;Mr.registerSaveRouter($A);Mr.registerLoadRouter($A);function bz(e){return new el(e)}function vz(e){return e.startsWith(el.URL_SCHEME)?e.slice(el.URL_SCHEME.length):e}var e0=class{constructor(){this.indexedDB=kA()}listModels(){return ne(this,null,function*(){return new Promise((t,r)=>{let n=this.indexedDB.open(MT,UT);n.onupgradeneeded=()=>VT(n),n.onsuccess=()=>{let o=n.result,s=o.transaction(qa,"readonly"),a=s.objectStore(qa).getAll();a.onsuccess=()=>{let u={};for(let c of a.result)u[c.modelPath]=c.modelArtifactsInfo;t(u)},a.onerror=u=>(o.close(),r(a.error)),s.oncomplete=()=>o.close()},n.onerror=o=>r(n.error)})})}removeModel(t){return ne(this,null,function*(){return t=vz(t),new Promise((r,n)=>{let o=this.indexedDB.open(MT,UT);o.onupgradeneeded=()=>VT(o),o.onsuccess=()=>{let s=o.result,i=s.transaction(qa,"readwrite"),a=i.objectStore(qa),u=a.get(t),c;u.onsuccess=()=>{if(u.result==null)return s.close(),n(new Error(`Cannot find model with path '${t}' in IndexedDB.`));{let p=a.delete(t),m=()=>{c=s.transaction(Ju,"readwrite");let x=c.objectStore(Ju).delete(t);x.onsuccess=()=>r(u.result.modelArtifactsInfo),x.onerror=y=>n(u.error)};p.onsuccess=m,p.onerror=h=>(m(),s.close(),n(u.error))}},u.onerror=p=>(s.close(),n(u.error)),i.oncomplete=()=>{c==null?s.close():c.oncomplete=()=>s.close()}},o.onerror=s=>n(o.error)})})}};var Qi="/",hp="tensorflowjs_models",RA="info",wz="model_topology",Tz="weight_specs",Sz="weight_data",Cz="model_metadata";function OA(e){return{info:[hp,e,RA].join(Qi),topology:[hp,e,wz].join(Qi),weightSpecs:[hp,e,Tz].join(Qi),weightData:[hp,e,Sz].join(Qi),modelMetadata:[hp,e,Cz].join(Qi)}}function DA(e){for(let t of Object.values(e))window.localStorage.removeItem(t)}function Ez(e){let t=e.split(Qi);if(t.length<3)throw new Error(`Invalid key format: ${e}`);return t.slice(1,t.length-1).join(Qi)}function Nz(e){return e.startsWith(tl.URL_SCHEME)?e.slice(tl.URL_SCHEME.length):e}var tl=(()=>{class e{constructor(r){if(!z().getBool("IS_BROWSER")||typeof window>"u"||typeof window.localStorage>"u")throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,r==null||!r)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=r,this.keys=OA(this.modelPath)}save(r){return ne(this,null,function*(){if(r.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");{let n=JSON.stringify(r.modelTopology),o=JSON.stringify(r.weightSpecs),s=xi(r),i=nn.join(r.weightData);try{this.LS.setItem(this.keys.info,JSON.stringify(s)),this.LS.setItem(this.keys.topology,n),this.LS.setItem(this.keys.weightSpecs,o),this.LS.setItem(this.keys.weightData,SA(i));let a={format:r.format,generatedBy:r.generatedBy,convertedBy:r.convertedBy,signature:r.signature!=null?r.signature:void 0,userDefinedMetadata:r.userDefinedMetadata!=null?r.userDefinedMetadata:void 0,modelInitializer:r.modelInitializer!=null?r.modelInitializer:void 0,initializerSignature:r.initializerSignature!=null?r.initializerSignature:void 0,trainingConfig:r.trainingConfig!=null?r.trainingConfig:void 0};return this.LS.setItem(this.keys.modelMetadata,JSON.stringify(a)),{modelArtifactsInfo:s}}catch{throw DA(this.keys),new Error(`Failed to save model '${this.modelPath}' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes=${s.modelTopologyBytes}, weightSpecsBytes=${s.weightSpecsBytes}, weightDataBytes=${s.weightDataBytes}.`)}}})}load(){return ne(this,null,function*(){let r=JSON.parse(this.LS.getItem(this.keys.info));if(r==null)throw new Error(`In local storage, there is no model with name '${this.modelPath}'`);if(r.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");let n={},o=JSON.parse(this.LS.getItem(this.keys.topology));if(o==null)throw new Error(`In local storage, the topology of model '${this.modelPath}' is missing.`);n.modelTopology=o;let s=JSON.parse(this.LS.getItem(this.keys.weightSpecs));if(s==null)throw new Error(`In local storage, the weight specs of model '${this.modelPath}' are missing.`);n.weightSpecs=s;let i=this.LS.getItem(this.keys.modelMetadata);if(i!=null){let u=JSON.parse(i);n.format=u.format,n.generatedBy=u.generatedBy,n.convertedBy=u.convertedBy,u.signature!=null&&(n.signature=u.signature),u.userDefinedMetadata!=null&&(n.userDefinedMetadata=u.userDefinedMetadata),u.modelInitializer!=null&&(n.modelInitializer=u.modelInitializer),u.initializerSignature!=null&&(n.initializerSignature=u.initializerSignature),u.trainingConfig!=null&&(n.trainingConfig=u.trainingConfig)}let a=this.LS.getItem(this.keys.weightData);if(a==null)throw new Error(`In local storage, the binary weight values of model '${this.modelPath}' are missing.`);return n.weightData=CA(a),n})}}return e.URL_SCHEME="localstorage://",e})();var FA=e=>z().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(tl.URL_SCHEME)?_z(e.slice(tl.URL_SCHEME.length)):null;Mr.registerSaveRouter(FA);Mr.registerLoadRouter(FA);function _z(e){return new tl(e)}var t0=class{constructor(){O(z().getBool("IS_BROWSER"),()=>"Current environment is not a web browser"),O(typeof window>"u"||typeof window.localStorage<"u",()=>"Current browser does not appear to support localStorage"),this.LS=window.localStorage}listModels(){return ne(this,null,function*(){let t={},r=hp+Qi,n=Qi+RA;for(let o=0;o<this.LS.length;++o){let s=this.LS.key(o);if(s.startsWith(r)&&s.endsWith(n)){let i=Ez(s);t[i]=JSON.parse(this.LS.getItem(s))}}return t})}removeModel(t){return ne(this,null,function*(){t=Nz(t);let r=OA(t);if(this.LS.getItem(r.info)==null)throw new Error(`Cannot find model at path '${t}'`);let n=JSON.parse(this.LS.getItem(r.info));return DA(r),n})}};var dp="://",Ms=class e{constructor(){this.managers={}}static getInstance(){return e.instance==null&&(e.instance=new e),e.instance}static registerManager(t,r){O(t!=null,()=>"scheme must not be undefined or null."),t.endsWith(dp)&&(t=t.slice(0,t.indexOf(dp))),O(t.length>0,()=>"scheme must not be an empty string.");let n=e.getInstance();O(n.managers[t]==null,()=>`A model store manager is already registered for scheme '${t}'.`),n.managers[t]=r}static getManager(t){let r=e.getInstance().managers[t];if(r==null)throw new Error(`Cannot find model manager for scheme '${t}'`);return r}static getSchemes(){return Object.keys(e.getInstance().managers)}};function r0(e){if(e.indexOf(dp)===-1)throw new Error(`The url string provided does not contain a scheme. Supported schemes are: ${Ms.getSchemes().join(",")}`);return{scheme:e.split(dp)[0],path:e.split(dp)[1]}}function PA(e,t,r=!1){return ne(this,null,function*(){O(e!==t,()=>`Old path and new path are the same: '${e}'`);let n=Mr.getLoadHandlers(e);O(n.length>0,()=>`Copying failed because no load handler is found for source URL ${e}.`),O(n.length<2,()=>`Copying failed because more than one (${n.length}) load handlers for source URL ${e}.`);let o=n[0],s=Mr.getSaveHandlers(t);O(s.length>0,()=>`Copying failed because no save handler is found for destination URL ${t}.`),O(s.length<2,()=>`Copying failed because more than one (${n.length}) save handlers for destination URL ${t}.`);let i=s[0],a=r0(e).scheme,u=r0(e).path,c=a===r0(e).scheme,p=yield o.load();r&&c&&(yield Ms.getManager(a).removeModel(u));let m=yield i.save(p);return r&&!c&&(yield Ms.getManager(a).removeModel(u)),m.modelArtifactsInfo})}function LA(){return ne(this,null,function*(){let e=Ms.getSchemes(),t={};for(let r of e){let n=yield Ms.getManager(r).listModels();for(let o in n){let s=r+dp+o;t[s]=n[o]}}return t})}function BA(e){return ne(this,null,function*(){let t=r0(e);return Ms.getManager(t.scheme).removeModel(t.path)})}function MA(e,t){return ne(this,null,function*(){return PA(e,t,!1)})}function UA(e,t){return ne(this,null,function*(){return PA(e,t,!0)})}var GT=class{constructor(){this.messageName="setTimeoutCustom",this.functionRefs=[],this.handledMessageCount=0,this.hasEventListener=!1}fetch(t,r){return fetch(t,r)}now(){return performance.now()}encode(t,r){if(r!=="utf-8"&&r!=="utf8")throw new Error(`Browser's encoder only supports utf-8, but got ${r}`);return this.textEncoder==null&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(t)}decode(t,r){return new TextDecoder(r).decode(t)}setTimeoutCustom(t,r){if(typeof window>"u"||!z().getBool("USE_SETTIMEOUTCUSTOM")){setTimeout(t,r);return}this.functionRefs.push(t),setTimeout(()=>{window.postMessage({name:this.messageName,index:this.functionRefs.length-1},"*")},r),this.hasEventListener||(this.hasEventListener=!0,window.addEventListener("message",n=>{if(n.source===window&&n.data.name===this.messageName){n.stopPropagation();let o=this.functionRefs[n.data.index];o(),this.handledMessageCount++,this.handledMessageCount===this.functionRefs.length&&(this.functionRefs=[],this.handledMessageCount=0)}},!0))}isTypedArray(t){return G1(t)}};if(z().get("IS_BROWSER")){z().setPlatform("browser",new GT);try{Ms.registerManager(tl.URL_SCHEME,new t0)}catch{}try{Ms.registerManager(el.URL_SCHEME,new e0)}catch{}}var Az={importFetch:()=>GA()},WT;var zT=class{constructor(){this.util=WA(),this.textEncoder=new this.util.TextEncoder}fetch(t,r){return z().global.fetch!=null?z().global.fetch(t,r):(WT==null&&(WT=Az.importFetch()),WT(t,r))}now(){let t=process.hrtime();return t[0]*1e3+t[1]/1e6}encode(t,r){if(r!=="utf-8"&&r!=="utf8")throw new Error(`Node built-in encoder only supports utf-8, but got ${r}`);return this.textEncoder.encode(t)}decode(t,r){return t.length===0?"":new this.util.TextDecoder(r).decode(t)}isTypedArray(t){return this.util.types.isFloat32Array(t)||this.util.types.isInt32Array(t)||this.util.types.isUint8Array(t)||this.util.types.isUint8ClampedArray(t)}};z().get("IS_NODE")&&!z().get("IS_BROWSER")&&z().setPlatform("node",new zT);function st(e,t="float32",r){return t=t||"float32",Zt(e),new zo(e,t,r)}function kz(e,t){let r=E(e,"x","cast");if(!gT(t))throw new Error(`Failed to cast to unknown dtype ${t}`);if(t==="string"&&r.dtype!=="string"||t!=="string"&&r.dtype==="string")throw new Error("Only strings can be casted to strings");let n={x:r},o={dtype:t};return R.runKernel(zu,n,o)}var it=_({cast_:kz});function $z(e){let r={x:E(e,"x","clone","string_or_numeric")};return R.runKernel(Hu,r)}var bo=_({clone_:$z});function n0(e,t=!1){console.log(e.toString(t))}RT();var Rz={buffer:st,cast:it,clone:bo,print:n0};iA(Rz);function Oz(e,t){let r=E(e,"a","add"),n=E(t,"b","add");[r,n]=Je(r,n);let o={a:r,b:n};return R.runKernel(Ga,o)}var Se=_({add_:Oz});function Dz(e,t){let r=E(e,"a","floorDiv"),n=E(t,"b","floorDiv");[r,n]=Je(r,n);let o={a:r,b:n};return R.runKernel(Gc,o)}var o0=_({floorDiv_:Dz});function Fz(e,t){let r=E(e,"a","div"),n=E(t,"b","div");if([r,n]=Je(r,n),r.dtype==="int32"&&n.dtype==="int32")return o0(r,n);let o={a:r,b:n},s={};return R.runKernel(cx,o,s)}var ze=_({div_:Fz});function Pz(e,t){let r=E(e,"a","mul"),n=E(t,"b","mul");[r,n]=Je(r,n);let o={a:r,b:n};return R.runKernel(Yc,o)}var ce=_({mul_:Pz});function Lz(e){let t=E(e,"x","abs");if(t.dtype==="complex64"){let r={x:t};return R.runKernel(Hg,r)}else{let r={x:t};return R.runKernel(_m,r)}}var Yr=_({abs_:Lz});function Bz(e){let r={x:E(e,"x","acos")};return R.runKernel(Ng,r)}var zA=_({acos_:Bz});function Mz(e){let r={x:E(e,"x","acosh")};return R.runKernel(_g,r)}var HA=_({acosh_:Mz});function Uz(e){O(Array.isArray(e),()=>"The argument passed to tf.addN() must be a list of tensors"),O(e.length>=1,()=>`Must pass at least one tensor to tf.addN(), but got ${e.length}`);let t=e.map((o,s)=>E(o,`tensors${s}`,"addN")),r=t[0];t.forEach(o=>{if(o.dtype!==r.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")}),t.forEach(o=>{if(!go(o.shape,r.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")});let n=t;return R.runKernel(Ig,n)}var KA=_({addN_:Uz});function Vz(e,t=null,r=!1){let o={x:E(e,"x","all","bool")},s={axis:t,keepDims:r};return R.runKernel(Ag,o,s)}var qA=_({all_:Vz});function Gz(e,t=null,r=!1){let o={x:E(e,"x","any","bool")},s={axis:t,keepDims:r};return R.runKernel(kg,o,s)}var jA=_({any_:Gz});function Wz(e,t=0){let n={x:E(e,"x","argMax")},o={axis:t};return R.runKernel($g,n,o)}var XA=_({argMax_:Wz});function zz(e,t=0){let n={x:E(e,"x","argMin")},o={axis:t};return R.runKernel(Rg,n,o)}var YA=_({argMin_:zz});function Hz(e){let r={x:E(e,"x","asin")};return R.runKernel(Og,r)}var ZA=_({asin_:Hz});function Kz(e){let r={x:E(e,"x","asinh")};return R.runKernel(Dg,r)}var QA=_({asinh_:Kz});function qz(e){let r={x:E(e,"x","atan")};return R.runKernel(Fg,r)}var JA=_({atan_:qz});function jz(e,t){let r=E(e,"a","atan2"),n=E(t,"b","atan2");[r,n]=Je(r,n);let o={a:r,b:n};return R.runKernel(Lg,o)}var ek=_({atan2_:jz});function Xz(e){let r={x:E(e,"x","atanh")};return R.runKernel(Pg,r)}var tk=_({atanh_:Xz});function Yz(e,t,r,n,o="NHWC",s){let i=e[3],a=[...t,i],u=nk(o);return ol(e,a,r,s,n,null,null,u)}function KT(e,t,r,n,o,s,i="channelsLast"){let[a,u]=Gm(t),c;if(i==="channelsLast")c=[a,u,e[3],e[3]];else if(i==="channelsFirst")c=[a,u,e[1],e[1]];else throw new Error(`Unknown dataFormat ${i}`);return ol(e,c,r,n,o,s,!1,i)}function Zz(e,t,r,n,o,s,i="NDHWC"){let[a,u,c]=HT(t),p,m;if(i==="NDHWC")m="channelsLast",p=[a,u,c,e[4],e[4]];else if(i==="NCDHW")m="channelsFirst",p=[a,u,c,e[1],e[1]];else throw new Error(`Unknown dataFormat ${i}`);return rk(e,p,r,n,o,!1,m,s)}function ol(e,t,r,n,o,s,i=!1,a="channelsLast"){let[u,c,p,m]=[-1,-1,-1,-1];if(a==="channelsLast")[u,c,p,m]=e;else if(a==="channelsFirst")[u,m,c,p]=e;else throw new Error(`Unknown dataFormat ${a}`);let[h,x,,y]=t,[v,w]=Gm(r),[C,I]=Gm(n),D=xp(h,C),P=xp(x,I),{padInfo:G,outHeight:q,outWidth:Z}=eH(o,c,p,v,w,D,P,s,a),Y=i?y*m:y,te;return a==="channelsFirst"?te=[u,Y,q,Z]:a==="channelsLast"&&(te=[u,q,Z,Y]),{batchSize:u,dataFormat:a,inHeight:c,inWidth:p,inChannels:m,outHeight:q,outWidth:Z,outChannels:Y,padInfo:G,strideHeight:v,strideWidth:w,filterHeight:h,filterWidth:x,effectiveFilterHeight:D,effectiveFilterWidth:P,dilationHeight:C,dilationWidth:I,inShape:e,outShape:te,filterShape:t}}function rk(e,t,r,n,o,s=!1,i="channelsLast",a){let[u,c,p,m,h]=[-1,-1,-1,-1,-1];if(i==="channelsLast")[u,c,p,m,h]=e;else if(i==="channelsFirst")[u,h,c,p,m]=e;else throw new Error(`Unknown dataFormat ${i}`);let[x,y,v,,w]=t,[C,I,D]=HT(r),[P,G,q]=HT(n),Z=xp(x,P),Y=xp(y,G),te=xp(v,q),{padInfo:J,outDepth:ae,outHeight:ge,outWidth:ke}=tH(o,c,p,m,C,I,D,Z,Y,te,a),We=s?w*h:w,Re;return i==="channelsFirst"?Re=[u,We,ae,ge,ke]:i==="channelsLast"&&(Re=[u,ae,ge,ke,We]),{batchSize:u,dataFormat:i,inDepth:c,inHeight:p,inWidth:m,inChannels:h,outDepth:ae,outHeight:ge,outWidth:ke,outChannels:We,padInfo:J,strideDepth:C,strideHeight:I,strideWidth:D,filterDepth:x,filterHeight:y,filterWidth:v,effectiveFilterDepth:Z,effectiveFilterHeight:Y,effectiveFilterWidth:te,dilationDepth:P,dilationHeight:G,dilationWidth:q,inShape:e,outShape:Re,filterShape:t}}function Qz(e,t,r,n,o){n==null&&(n=qT(e,t,r));let s=e[0],i=e[1],a=Wm((s-t+2*n)/r+1,o),u=Wm((i-t+2*n)/r+1,o);return[a,u]}function Jz(e,t,r,n,o,s){o==null&&(o=qT(e,t[0],n[0]));let i=[0,0,0,r];for(let a=0;a<3;a++)e[a]+2*o>=t[a]&&(i[a]=Wm((e[a]-t[a]+2*o)/n[a]+1,s));return i}function qT(e,t,r,n=1){let o=xp(t,n);return Math.floor((e[0]*(r-1)-r+o)/2)}function Gm(e){return typeof e=="number"?[e,e,e]:e.length===2?[e[0],e[1],1]:e}function HT(e){return typeof e=="number"?[e,e,e]:e}function xp(e,t){return t<=1?e:e+(e-1)*(t-1)}function eH(e,t,r,n,o,s,i,a,u){let c,p,m;if(typeof e=="number"){c={top:e,bottom:e,left:e,right:e,type:e===0?"VALID":"NUMBER"};let x=Qz([t,r],s,n,e,a);p=x[0],m=x[1]}else if(e==="same"){p=Math.ceil(t/n),m=Math.ceil(r/o);let h=Math.max(0,(p-1)*n+s-t),x=Math.max(0,(m-1)*o+i-r),y=Math.floor(h/2),v=h-y,w=Math.floor(x/2),C=x-w;c={top:y,bottom:v,left:w,right:C,type:"SAME"}}else if(e==="valid")c={top:0,bottom:0,left:0,right:0,type:"VALID"},p=Math.ceil((t-s+1)/n),m=Math.ceil((r-i+1)/o);else if(typeof e=="object"){let h=u==="channelsLast"?e[1][0]:e[2][0],x=u==="channelsLast"?e[1][1]:e[2][1],y=u==="channelsLast"?e[2][0]:e[3][0],v=u==="channelsLast"?e[2][1]:e[3][1];c={top:h,bottom:x,left:y,right:v,type:h===0&&x===0&&y===0&&v===0?"VALID":"EXPLICIT"},p=Wm((t-s+h+x)/n+1,a),m=Wm((r-i+y+v)/o+1,a)}else throw Error(`Unknown padding parameter: ${e}`);return{padInfo:c,outHeight:p,outWidth:m}}function tH(e,t,r,n,o,s,i,a,u,c,p){let m,h,x,y;if(e==="valid"&&(e=0),typeof e=="number"){m={top:e,bottom:e,left:e,right:e,front:e,back:e,type:e===0?"VALID":"NUMBER"};let w=Jz([t,r,n,1],[a,u,c],1,[o,s,i],e,p);h=w[0],x=w[1],y=w[2]}else if(e==="same"){h=Math.ceil(t/o),x=Math.ceil(r/s),y=Math.ceil(n/i);let v=(h-1)*o+a-t,w=(x-1)*s+u-r,C=(y-1)*i+c-n,I=Math.floor(v/2),D=v-I,P=Math.floor(w/2),G=w-P,q=Math.floor(C/2),Z=C-q;m={top:P,bottom:G,left:q,right:Z,front:I,back:D,type:"SAME"}}else throw Error(`Unknown padding parameter: ${e}`);return{padInfo:m,outDepth:h,outHeight:x,outWidth:y}}function Wm(e,t){if(!t)return Math.trunc(e);switch(t){case"round":return Math.round(e);case"ceil":return Math.ceil(e);case"floor":return Math.floor(e);default:throw new Error(`Unknown roundingMode ${t}`)}}function nl(e){let[t,r,n]=Gm(e);return t===1&&r===1&&n===1}function xn(e,t){return nl(e)||nl(t)}function yi(e){return Gm(e).every(t=>t>0)}function nk(e){if(e==="NHWC")return"channelsLast";if(e==="NCHW")return"channelsFirst";throw new Error(`Unknown dataFormat ${e}`)}function vr(e,t,r){if(r!=null){if(typeof t=="string")throw Error(`Error in ${e}: pad must be an integer when using dimRoundingMode ${r} but got pad ${t}.`);if(typeof t=="number")O(qi(t),()=>`Error in ${e}: pad must be an integer when using dimRoundingMode ${r} but got pad ${t}.`);else if(typeof t=="object")t.forEach(n=>{n.forEach(o=>{O(qi(o),()=>`Error in ${e}: pad must be an integer when using dimRoundingMode ${r} but got pad ${o}.`)})});else throw Error(`Error in ${e}: Unknown padding parameter: ${t}`)}}function rH(e,t){let n={x:E(e,"x","reshape","string_or_numeric")},o={shape:t};return R.runKernel(n1,n,o)}var Q=_({reshape_:rH});function nH(e,t,r,n,o){let s=E(e,"x","avgPool","float32"),i=1;O(xn(r,i),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${r} and dilations '${i}'`);let a=s,u=!1;s.rank===3&&(u=!0,a=Q(s,[1,s.shape[0],s.shape[1],s.shape[2]])),O(a.rank===4,()=>`Error in avgPool: x must be rank 4 but got rank ${a.rank}.`),vr("avgPool",n,o);let c={x:a},p={filterSize:t,strides:r,pad:n,dimRoundingMode:o},m=R.runKernel(Bg,c,p);return m=it(m,s.dtype),u?Q(m,[m.shape[1],m.shape[2],m.shape[3]]):m}var s0=_({avgPool_:nH});function oH(e,t,r,n,o,s="NDHWC"){let i=E(e,"x","avgPool3d","float32"),a=i,u=!1;i.rank===4&&(u=!0,a=Q(i,[1,i.shape[0],i.shape[1],i.shape[2],i.shape[3]])),O(a.rank===5,()=>`Error in avgPool3d: x must be rank 5 but got rank ${a.rank}.`),O(s==="NDHWC",()=>`Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of ${s}`),O(typeof r=="number"&&r>0||Array.isArray(r)&&r[0]>0&&r[1]>0&&r[2]>0,()=>`Error in avgPool3d: Stride must be > 0, but got '${r}'`),vr("avgPool3d",n,o);let c={x:a},p={filterSize:t,strides:r,pad:n,dimRoundingMode:o,dataFormat:s},m=R.runKernel(Mg,c,p);return m=it(m,a.dtype),u?Q(m,[m.shape[1],m.shape[2],m.shape[3],m.shape[4]]):m}var ok=_({avgPool3d_:oH});function sH(e,t=0){O(e.length>=1,()=>"Pass at least one tensor to concat");let r=Qu(e,"tensors","concat","string_or_numeric");if(r[0].dtype==="complex64"&&r.forEach(s=>{if(s.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype ${s.dtype}. `)}),r.length===1)return bo(r[0]);let n=r,o={axis:t};return R.runKernel(Kg,n,o)}var Rt=_({concat_:sH});function iH(e,t,r=!1,n=!1){let o=E(e,"a","matMul"),s=E(t,"b","matMul");[o,s]=Je(o,s);let i={a:o,b:s},a={transposeA:r,transposeB:n};return R.runKernel(Ug,i,a)}var xt=_({matMul_:iH});function aH(e){let r={x:E(e,"x","sigmoid","float32")};return R.runKernel(Jc,r)}var xs=_({sigmoid_:aH});function uH(e,t,r){let n=E(e,"x","slice","string_or_numeric");if(n.rank===0)throw new Error("Slicing scalar is not possible");let o={x:n},s={begin:t,size:r};return R.runKernel(Rm,o,s)}var Ve=_({slice_:uH});function lH(e){let r={x:E(e,"x","tanh","float32")};return R.runKernel(R1,r)}var zm=_({tanh_:lH});function cH(e,t,r,n,o,s){let i=E(e,"forgetBias","basicLSTMCell"),a=E(t,"lstmKernel","basicLSTMCell"),u=E(r,"lstmBias","basicLSTMCell"),c=E(n,"data","basicLSTMCell"),p=E(o,"c","basicLSTMCell"),m=E(s,"h","basicLSTMCell"),h=Rt([c,m],1),x=xt(h,a),y=Se(x,u),v=y.shape[0],w=y.shape[1]/4,C=[v,w],I=Ve(y,[0,0],C),D=Ve(y,[0,w],C),P=Ve(y,[0,w*2],C),G=Ve(y,[0,w*3],C),q=Se(ce(xs(I),zm(D)),ce(p,xs(Se(i,P)))),Z=ce(zm(q),xs(G));return[q,Z]}var sk=_({basicLSTMCell_:cH});function pH(e,t,r){let n=E(e,"x","batchToSpaceND"),o=t.reduce((a,u)=>a*u);O(n.rank>=1+t.length,()=>`input rank is ${n.rank} but should be > than blockShape.length ${t.length}`),O(r.length===t.length,()=>`crops.length is ${r.length} but should be equal to blockShape.length  ${t.length}`),O(n.shape[0]%o===0,()=>`input tensor batch is ${n.shape[0]} but is not divisible by the product of the elements of blockShape ${t.join(" * ")} === ${o}`);let s={x:n},i={blockShape:t,crops:r};return R.runKernel(Vg,s,i)}var i0=_({batchToSpaceND_:pH});function ik(e){let t;return e.rank===0||e.rank===1?t=Q(e,[1,1,1,e.size]):e.rank===2?t=Q(e,[1,1,e.shape[0],e.shape[1]]):e.rank===3?t=Q(e,[1,e.shape[0],e.shape[1],e.shape[2]]):t=e,t}function fH(e,t,r,n,o,s){s==null&&(s=.001);let i=E(e,"x","batchNorm"),a=E(t,"mean","batchNorm"),u=E(r,"variance","batchNorm"),c;o!=null&&(c=E(o,"scale","batchNorm"));let p;n!=null&&(p=E(n,"offset","batchNorm")),O(a.rank===u.rank,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),O(p==null||a.rank===p.rank,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),O(c==null||a.rank===c.rank,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");let h={x:ik(i),scale:c,offset:p,mean:a,variance:u},x={varianceEpsilon:s},y=R.runKernel(yx,h,x);return Q(y,i.shape)}var ja=_({batchNorm_:fH});function mH(e,t,r,n,o,s){let i=E(e,"x","batchNorm"),a=E(t,"mean","batchNorm"),u=E(r,"variance","batchNorm"),c;o!=null&&(c=E(o,"scale","batchNorm"));let p;return n!=null&&(p=E(n,"offset","batchNorm")),O(i.rank===2,()=>`Error in batchNorm2D: x must be rank 2 but got rank ${i.rank}.`),O(a.rank===2||a.rank===1,()=>`Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank ${a.rank}.`),O(u.rank===2||u.rank===1,()=>`Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank ${u.rank}.`),c!=null&&O(c.rank===2||c.rank===1,()=>`Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank ${c.rank}.`),p!=null&&O(p.rank===2||p.rank===1,()=>`Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank ${p.rank}.`),ja(i,a,u,p,c,s)}var ak=_({batchNorm2d_:mH});function hH(e,t,r,n,o,s){let i=E(e,"x","batchNorm"),a=E(t,"mean","batchNorm"),u=E(r,"variance","batchNorm"),c;o!=null&&(c=E(o,"scale","batchNorm"));let p;return n!=null&&(p=E(n,"offset","batchNorm")),O(i.rank===3,()=>`Error in batchNorm3D: x must be rank 3 but got rank ${i.rank}.`),O(a.rank===3||a.rank===1,()=>`Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank ${a.rank}.`),O(u.rank===3||u.rank===1,()=>`Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank ${u.rank}.`),c!=null&&O(c.rank===3||c.rank===1,()=>`Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank ${c.rank}.`),p!=null&&O(p.rank===3||p.rank===1,()=>`Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank ${p.rank}.`),ja(i,a,u,p,c,s)}var uk=_({batchNorm3d_:hH});function dH(e,t,r,n,o,s){let i=E(e,"x","batchNorm"),a=E(t,"mean","batchNorm"),u=E(r,"variance","batchNorm"),c;o!=null&&(c=E(o,"scale","batchNorm"));let p;return n!=null&&(p=E(n,"offset","batchNorm")),O(i.rank===4,()=>`Error in batchNorm4D: x must be rank 4 but got rank ${i.rank}.`),O(a.rank===4||a.rank===1,()=>`Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank ${a.rank}.`),O(u.rank===4||u.rank===1,()=>`Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank ${u.rank}.`),c!=null&&O(c.rank===4||c.rank===1,()=>`Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank ${c.rank}.`),p!=null&&O(p.rank===4||p.rank===1,()=>`Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank ${p.rank}.`),ja(i,a,u,p,c,s)}var lk=_({batchNorm4d_:dH});function gH(e,t,r){let n=E(e,"x","bincount"),o=E(t,"weights","bincount");O(n.dtype==="int32",()=>`Error in bincount: input dtype must be int32, but got ${n.dtype}`),O(r>=0,()=>`size must be non-negative, but got ${r}.`),O(o.size===n.size||o.size===0,()=>`Error in bincount: weights must have the same size as input or0-length, but got input shape: ${n.shape}, weights shape: ${o.shape}.`);let s={x:n,weights:o},i={size:r};return R.runKernel(Gg,s,i)}var a0=_({bincount_:gH});function xH(e,t){let r=E(e,"x","bitwiseAnd"),n=E(t,"y","bitwiseAnd");if(!go(r.shape,n.shape))throw new Error(`BitwiseAnd: Tensors must have the same shape. x: ${r.shape}, y: ${n.shape}`);if(r.dtype!=="int32"||n.dtype!=="int32")throw new Error(`BitwiseAnd: Only supports 'int32' values in tensor, found type of x: ${r.dtype} and type of y: ${n.dtype}`);let o={a:r,b:n};return R.runKernel(Pc,o)}var ck=_({bitwiseAnd_:xH});function yH(e,t){let r=E(e,"s0","broadcastArgs","int32"),n=E(t,"s1","broadcastArgs","int32");if(r.rank!==1)throw new Error(`broadcastArgs(): first input must be a vector (rank=1). Has rank ${r.rank}`);if(n.rank!==1)throw new Error(`broadcastArgs(): second input must be a vector (rank=1). Has rank ${n.rank}`);let o={s0:r,s1:n};return R.runKernel(Wg,o)}var pk=_({broadcastArgs_:yH});function bH(e,t){let r=E(e,"broadcastTo","x"),n=r.shape;if(Zt(t),t.length<r.rank)throw new Error(`broadcastTo(): shape.length=${t.length} < input.rank=${r.rank}.`);if(t.length>r.rank){let c=r.shape.slice();for(;c.length<t.length;)c.unshift(1);r=Q(r,c)}let o=r.shape,s=Array.from(t);for(let c=t.length-1;c>=0;c--)if(o[c]===t[c])s[c]=1;else if(r.shape[c]!==1)throw new Error(`broadcastTo(): [${n}] cannot be broadcast to [${t}].`);if(s.map((c,p)=>c>1?p:-1).filter(c=>c>=0).length===0)return bo(r);let a={x:r},u={reps:s};return R.runKernel(op,a,u)}var Xa=_({broadcastTo_:bH});function vH(e){let r={x:E(e,"x","ceil","float32")};return R.runKernel(Lc,r)}var fk=_({ceil_:vH});function vi(e,t,r){Zt(e),r=r||Va(t);let n={shape:e,value:t,dtype:r};return R.runKernel(gx,{},n)}function wH(e,t,r){let n=E(e,"x","clipByValue");if(O(t<=r,()=>`Error in clip: min (${t}) must be less than or equal to max (${r}).`),t===r)return vi(n.shape,t,n.dtype);let o={x:n},s={clipValueMin:t,clipValueMax:r};return R.runKernel(zg,o,s)}var u0=_({clipByValue_:wH});function TH(e){return Rt(e,0)}var mk=_({concat1d_:TH});function SH(e,t){return Rt(e,t)}var hk=_({concat2d_:SH});function CH(e,t){return Rt(e,t)}var dk=_({concat3d_:CH});function EH(e,t){return Rt(e,t)}var gk=_({concat4d_:EH});function NH(e,t,r,n,o="NHWC",s=[1,1],i){let a=E(e,"x","conv2d","float32"),u=E(t,"filter","conv2d","float32"),c=a,p=!1;a.rank===3&&(p=!0,c=Q(a,[1,a.shape[0],a.shape[1],a.shape[2]])),O(c.rank===4,()=>`Error in conv2d: input must be rank 4, but got rank ${c.rank}.`),O(u.rank===4,()=>`Error in conv2d: filter must be rank 4, but got rank ${u.rank}.`),vr("conv2d",n,i);let m=o==="NHWC"?c.shape[3]:c.shape[1];O(m===u.shape[2],()=>`Error in conv2d: depth of input (${m}) must match input depth for filter ${u.shape[2]}.`),O(xn(r,s),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${r} and dilations '${s}'`),O(yi(s),()=>"Error in conv2D: Dilated rates should be larger than 0."),O(yi(r),()=>"Error in conv2D: Strides should be larger than 0.");let h={x:c,filter:u},x={strides:r,pad:n,dataFormat:o,dilations:s,dimRoundingMode:i},y=R.runKernel(qg,h,x);return p?Q(y,[y.shape[1],y.shape[2],y.shape[3]]):y}var Ya=_({conv2d_:NH});function _H(e,t,r,n,o="NWC",s=1,i){let a=E(e,"x","conv1d"),u=E(t,"filter","conv1d"),c=a,p=!1;a.rank===2&&(p=!0,c=Q(a,[1,a.shape[0],a.shape[1]])),O(c.rank===3,()=>`Error in conv1d: input must be rank 3, but got rank ${c.rank}.`),O(u.rank===3,()=>`Error in conv1d: filter must be rank 3, but got rank ${u.rank}.`),vr("conv1d",n,i),O(c.shape[2]===u.shape[1],()=>`Error in conv1d: depth of input (${c.shape[2]}) must match input depth for filter ${u.shape[1]}.`),O(xn(r,s),()=>`Error in conv1D: Either stride or dilation must be 1. Got stride ${r} and dilation '${s}'`),O(yi(s),()=>"Error in conv1D: Dilated rates should be larger than 0."),O(yi(r),()=>"Error in conv1D: Stride should be larger than 0."),O(o==="NWC",()=>`Error in conv1d: got dataFormat of ${o} but only NWC is currently supported.`);let m=Q(u,[1,u.shape[0],u.shape[1],u.shape[2]]),h=Q(c,[c.shape[0],1,c.shape[1],c.shape[2]]),w=Ya(h,m,[1,r],n,"NHWC",[1,s],i);return p?Q(w,[w.shape[2],w.shape[3]]):Q(w,[w.shape[0],w.shape[2],w.shape[3]])}var xk=_({conv1d_:_H});function IH(e,t,r,n,o,s="NHWC",i){O(e.length===t.rank,()=>`Length of inShape (${e.length}) and rank of dy (${t.rank}) must match`);let a=e,u=t,c=!1;t.rank===3&&(c=!0,u=Q(t,[1,t.shape[0],t.shape[1],t.shape[2]]),a=[1,e[0],e[1],e[2]]),O(a.length===4,()=>`Error in conv2dDerInput: inShape must be length 4, but got length ${a.length}.`),O(u.rank===4,()=>`Error in conv2dDerInput: dy must be rank 4, but got rank ${u.rank}`),O(r.rank===4,()=>`Error in conv2dDerInput: filter must be rank 4, but got rank ${r.rank}`);let p=s==="NHWC"?a[3]:a[1],m=s==="NHWC"?u.shape[3]:u.shape[1];O(p===r.shape[2],()=>`Error in conv2dDerInput: depth of input (${p}) must match input depth for filter ${r.shape[2]}.`),O(m===r.shape[3],()=>`Error in conv2dDerInput: depth of output (${m}) must match output depth for filter ${r.shape[3]}.`),vr("conv2dDerInput",o,i);let h={dy:u,filter:r},x={strides:n,pad:o,dataFormat:s,dimRoundingMode:i,inputShape:a},y=R.runKernel(Xg,h,x);return c?Q(y,[y.shape[1],y.shape[2],y.shape[3]]):y}var l0=_({conv2DBackpropInput_:IH});function AH(e,t,r,n,o,s){let i=E(e,"x","conv2dTranspose"),a=E(t,"filter","conv2dTranspose");return l0(r,i,a,n,o,"NHWC",s)}var yk=_({conv2dTranspose_:AH});function kH(e,t,r,n,o="NDHWC",s=[1,1,1]){let i=E(e,"x","conv3d"),a=E(t,"filter","conv3d"),u=i,c=!1;i.rank===4&&(c=!0,u=Q(i,[1,i.shape[0],i.shape[1],i.shape[2],i.shape[3]])),O(u.rank===5,()=>`Error in conv3d: input must be rank 5, but got rank ${u.rank}.`),O(a.rank===5,()=>`Error in conv3d: filter must be rank 5, but got rank ${a.rank}.`),O(u.shape[4]===a.shape[3],()=>`Error in conv3d: depth of input (${u.shape[4]}) must match input depth for filter ${a.shape[3]}.`),O(xn(r,s),()=>`Error in conv3D: Either strides or dilations must be 1. Got strides ${r} and dilations '${s}'`),O(o==="NDHWC",()=>`Error in conv3d: got dataFormat of ${o} but only NDHWC is currently supported.`),O(yi(s),()=>"Error in conv3D: Dilated rates should be larger than 0."),O(yi(r),()=>"Error in conv3D: Strides should be larger than 0.");let p={x:u,filter:a},m={strides:r,pad:n,dataFormat:o,dilations:s},h=R.runKernel(Yg,p,m);return c?Q(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}var bk=_({conv3d_:kH});function $H(e,t,r,n,o){O(e.length===t.rank,()=>`Length of inShape (${e.length}) and rank of dy (${t.rank}) must match`);let s=e,i=t,a=!1;t.rank===4&&(a=!0,i=Q(t,[1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]]),s=[1,e[0],e[1],e[2],e[3]]);let u=s[4],c=i.shape[4];O(s.length===5,()=>`Error in conv3dDerInput: inShape must be length 5, but got length ${s.length}.`),O(i.rank===5,()=>`Error in conv3dDerInput: dy must be rank 5, but got rank ${i.rank}`),O(r.rank===5,()=>`Error in conv3dDerInput: filter must be rank 5, but got rank ${r.rank}`),O(u===r.shape[3],()=>`Error in conv3dDerInput: depth of input (${u}) must match input depth for filter ${r.shape[3]}.`),O(c===r.shape[4],()=>`Error in conv3dDerInput: depth of output (${c}) must match output depth for filter ${r.shape[4]}.`);let p={dy:i,filter:r},m={pad:o,strides:n,inputShape:s},h=R.runKernel(Zg,p,m);return a?Q(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}var vk=_({conv3DBackpropInput_:$H});function RH(e,t,r,n,o){let s=E(e,"x","conv3dTranspose"),i=E(t,"filter","conv3dTranspose");return vk(r,s,i,n,o)}var wk=_({conv3dTranspose_:RH});function OH(e){let r={x:E(e,"x","cos","float32")};return R.runKernel(Qg,r)}var Tk=_({cos_:OH});function DH(e){let r={x:E(e,"x","cosh","float32")};return R.runKernel(Jg,r)}var Sk=_({cosh_:DH});function FH(e,t=0,r=!1,n=!1){let s={x:E(e,"x","cumprod")},i={axis:t,exclusive:r,reverse:n};return R.runKernel(ex,s,i)}var Ck=_({cumprod_:FH});function PH(e,t=0,r=!1,n=!1){let s={x:E(e,"x","cumsum")},i={axis:t,exclusive:r,reverse:n};return R.runKernel(tx,s,i)}var Ek=_({cumsum_:PH});function LH(e,t,r,n=!1){let o=E(e,"x","denseBincount"),s=E(t,"weights","denseBincount");O(o.dtype==="int32",()=>`Error in denseBincount: input dtype must be int32, but got ${o.dtype}`),O(o.rank<=2,()=>`Error in denseBincount: input must be at most rank 2, but got rank ${o.rank}.`),O(r>=0,()=>`size must be non-negative, but got ${r}.`),O(s.size===o.size||s.size===0,()=>`Error in denseBincount: weights must have the same shape as x or 0-length, but got x shape: ${o.shape}, weights shape: ${s.shape}.`);let i={x:o,weights:s},a={size:r,binaryOutput:n};return R.runKernel(nx,i,a)}var Nk=_({denseBincount_:LH});function BH(e,t,r="NHWC"){let n=E(e,"x","depthToSpace","float32"),o=r==="NHWC"?n.shape[1]:n.shape[2],s=r==="NHWC"?n.shape[2]:n.shape[3],i=r==="NHWC"?n.shape[3]:n.shape[1];O(t>1,()=>`blockSize should be > 1 for depthToSpace, but was: ${t}`),O(o*t>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${o} and ${t}  for depthToSpace with input shape
    ${n.shape}`),O(s*t>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${s} and ${t} for depthToSpace with input shape
        ${n.shape}`),O(i%(t*t)===0,()=>`Dimension size must be evenly divisible by ${t*t} but is ${i} for depthToSpace with input shape ${n.shape}`);let a={x:n},u={blockSize:t,dataFormat:r};return R.runKernel(ox,a,u)}var _k=_({depthToSpace_:BH});function MH(e,t,r,n,o="NHWC",s=[1,1],i){let a=E(e,"x","depthwiseConv2d","float32"),u=E(t,"filter","depthwiseConv2d","float32"),c=a,p=!1;a.rank===3&&(p=!0,c=Q(a,[1,a.shape[0],a.shape[1],a.shape[2]])),O(c.rank===4,()=>`Error in depthwiseConv2d: input must be rank 4, but got rank ${c.rank}.`),O(u.rank===4,()=>`Error in depthwiseConv2d: filter must be rank 4, but got rank ${u.rank}.`);let m=o==="NHWC"?c.shape[3]:c.shape[1];O(m===u.shape[2],()=>`Error in depthwiseConv2d: number of input channels (${m}) must match the inChannels dimension in filter ${u.shape[2]}.`),vr("depthwiseConv2d",n,i);let h={x:c,filter:u},x={strides:r,pad:n,dataFormat:o,dilations:s,dimRoundingMode:i},y=R.runKernel(sx,h,x);return p?Q(y,[y.shape[1],y.shape[2],y.shape[3]]):y}var yp=_({depthwiseConv2d_:MH});function UH(e){let r={x:E(e,"x","diag")};return R.runKernel(ux,r)}var Ik=_({diag_:UH});function VH(e,t,r,n,o=[1,1],s="NHWC"){let i=E(e,"x","dilation2d"),a=E(t,"filter","dilation2d");O(i.rank===3||i.rank===4,()=>`Error in dilation2d: input must be rank 3 or 4, but got rank ${i.rank}.`),O(a.rank===3,()=>`Error in dilation2d: filter must be rank 3, but got rank ${a.rank}.`),O(s==="NHWC",()=>`Error in dilation2d: Only NHWC is currently supported, but got dataFormat of ${s}`);let u=i,c=!1;i.rank===3&&(u=Q(i,[1,i.shape[0],i.shape[1],i.shape[2]]),c=!0),O(u.shape[3]===a.shape[2],()=>`Error in dilation2d:  input and filter must have the same depth: ${u.shape[3]} vs ${a.shape[2]}`);let p={x:u,filter:a},m={strides:r,pad:n,dilations:o},h=R.runKernel(lx,p,m);return c?Q(h,[h.shape[1],h.shape[2],h.shape[3]]):h}var Ak=_({dilation2d_:VH});var Za={};$t(Za,{assertAndGetBroadcastShape:()=>ht,getBroadcastDims:()=>kk,getReductionAxes:()=>c0});function kk(e,t){let r=e.length,n=[];for(let o=0;o<r;o++){let s=r-1-o,i=e[s]||1;(t[t.length-1-o]||1)>1&&i===1&&n.unshift(s)}return n}function c0(e,t){let r=[];for(let n=0;n<t.length;n++){let o=e[e.length-n-1],s=t.length-n-1,i=t[s];(o==null||o===1&&i>1)&&r.unshift(s)}return r}function ht(e,t){let r=Math.max(e.length,t.length),n=new Array(r);for(let o=0;o<r;o++){let s=e[e.length-o-1];s==null&&(s=1);let i=t[t.length-o-1];if(i==null&&(i=1),s===1)n[r-o-1]=i;else if(i===1)n[r-o-1]=s;else if(s!==i){let a=`Operands could not be broadcast together with shapes ${e} and ${t}.`;throw Error(a)}else n[r-o-1]=s}return n}function GH(e,t){let r=E(e,"a","equal","string_or_numeric"),n=E(t,"b","equal","string_or_numeric");[r,n]=Je(r,n),ht(r.shape,n.shape);let o={a:r,b:n};return R.runKernel(Bc,o)}var p0=_({equal_:GH});function WH(e,t,r){let n=E(t,"a","where"),o=E(r,"b","where"),s=E(e,"condition","where","bool"),i=ht(ht(s.shape,n.shape),o.shape),a=Xa(s,i),u=Xa(n,i),c=Xa(o,i),p={condition:a,t:u,e:c};return R.runKernel(f1,p)}var Ho=_({where_:WH});function zH(e){let r={x:E(e,"x","zerosLike")};return R.runKernel(B1,r)}var Pr=_({zerosLike_:zH});function HH(e,t){let r=E(e,"a","div"),n=E(t,"b","div");[r,n]=Je(r,n);let o=ze(r,n),s=Pr(o),i=p0(n,s);return Ho(i,s,o)}var $k=_({divNoNan_:HH});function KH(e,t){let r=E(e,"t1","dot"),n=E(t,"t2","dot");O((r.rank===1||r.rank===2)&&(n.rank===1||n.rank===2),()=>`Error in dot: inputs must all be rank 1 or 2, but got ranks ${r.rank} and ${n.rank}.`);let o=r.rank===1?r.size:r.shape[1],s=n.rank===1?n.size:n.shape[0];if(O(o===s,()=>`Error in dot: inner dimensions of inputs must match, but got ${o} and ${s}.`),r.rank===1&&n.rank===1){let i=Q(r,[1,-1]),a=Q(n,[-1,1]),u=xt(i,a);return Q(u,[])}else if(r.rank===1&&n.rank===2){let i=Q(r,[1,-1]),a=Q(n,[n.shape[0],n.shape[1]]),u=xt(i,a);return Q(u,[u.size])}else if(r.rank===2&&n.rank===1){let i=Q(n,[-1,1]),a=xt(r,i);return Q(a,[a.size])}else{let i=Q(n,[n.shape[0],n.shape[1]]);return xt(r,i)}}var Rk=_({dot_:KH});function qH(e,...t){let r=t.map((o,s)=>E(o,`tensors${s}`,"einsum")),n={equation:e};return R.runKernel(px,r,n)}var Qa=_({einsum_:qH});function jH(e){let r={x:E(e,"x","elu","float32")};return R.runKernel(fx,r)}var f0=_({elu_:jH});function XH(e,t){let r=E(e,"x","ensureShape","string_or_numeric");if(!fT(r.shape,t))throw new Error(`EnsureShape: Shape of tensor ${r.shape} is not compatible with expected shape ${t}`);return e}var Ok=_({ensureShape_:XH});function YH(e){let t=E(e,"x","erf");O(t.dtype==="int32"||t.dtype==="float32",()=>"Input dtype must be `int32` or `float32`."),t.dtype==="int32"&&(t=it(t,"float32"));let r={x:t};return R.runKernel(mx,r)}var Dk=_({erf_:YH});function jT(e,t){for(let r=0;r<e.length;++r)if(e[e.length-r-1]!==t-1-r)return!1;return!0}function Fk(e,t,r){let n=e.length+t.length,o=[],s=0,i=0;for(let a=0;a<n;a++)r.indexOf(a)===-1?o.push(e[s++]):o.push(t[i++]);return o}function ZH(e,t){let r=[],n=e.length;for(let s=0;s<n;s++)t.indexOf(s)===-1&&r.push(e[s]);let o=t.map(s=>e[s]);return[r,o]}function Ji(e,t){let r=t.map(n=>1);return Fk(e,r,t)}function QH(e,t,r){O(jT(t,r),()=>`${e} supports only inner-most axes for now. Got axes ${t} and rank-${r} input.`)}function JH(e,t){if(jT(e,t))return null;let r=[];for(let n=0;n<t;++n)e.indexOf(n)===-1&&r.push(n);return e.forEach(n=>r.push(n)),r}function eK(e){return e.map((t,r)=>[r,t]).sort((t,r)=>t[1]-r[1]).map(t=>t[0])}function tK(e,t){let r=[];for(let n=t-e;n<t;++n)r.push(n);return r}function nK(e,t=null,r=!1){let o={x:E(e,"x","max")},s={reductionIndices:t,keepDims:r};return R.runKernel(Ox,o,s)}var wi=_({max_:nK});function oK(e,t=null,r=!1){let o={x:E(e,"x","min")},s={axis:t,keepDims:r};return R.runKernel(Bx,o,s)}var Hm=_({min_:oK});function sK(e,t){let r=E(e,"base","pow"),n=E(t,"exp","pow");[r,n]=Je(r,n);let o={a:r,b:n};return R.runKernel(Xx,o)}var ea=_({pow_:sK});function Be(e,t){if((dn(e)&&t!=="string"||Array.isArray(e))&&t!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(t==="string"&&dn(e)&&!(e instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return In(e,[],[],t)}function iK(e){let r={x:E(e,"x","sqrt","float32")};return R.runKernel(ep,r)}var qn=_({sqrt_:iK});function aK(e){let t=E(e,"x","square"),r={};return R.runKernel("Square",{x:t},r)}var Zr=_({square_:aK});function uK(e,t=null,r=!1){let n=E(e,"x","sum");n.dtype==="bool"&&(n=it(n,"int32"));let o={x:n},s={axis:t,keepDims:r};return R.runKernel(y1,o,s)}var yt=_({sum_:uK});function lK(e,t="euclidean",r=null,n=!1){e=E(e,"x","norm");let o=Pk(e,t,r),s=o.shape;if(n){let i=Ua(r,e.shape);s=Ji(o.shape,i)}return Q(o,s)}function Pk(e,t,r=null){if(e.rank===0)return Yr(e);if(e.rank!==1&&r===null)return Pk(Q(e,[-1]),t,r);if(e.rank===1||typeof r=="number"||Array.isArray(r)&&r.length===1){if(t===1)return yt(Yr(e),r);if(t===1/0)return wi(Yr(e),r);if(t===-1/0)return Hm(Yr(e),r);if(t==="euclidean"||t===2)return qn(yt(ea(Yr(e),Be(2,"int32")),r));throw new Error(`Error in norm: invalid ord value: ${t}`)}if(Array.isArray(r)&&r.length===2){if(t===1)return wi(yt(Yr(e),r[0]),r[1]-1);if(t===1/0)return wi(yt(Yr(e),r[1]),r[0]);if(t===-1/0)return Hm(yt(Yr(e),r[1]),r[0]);if(t==="fro"||t==="euclidean")return qn(yt(Zr(e),r));throw new Error(`Error in norm: invalid ord value: ${t}`)}throw new Error(`Error in norm: invalid axis: ${r}`)}var sl=_({norm_:lK});function cK(e,t=null,r=!1){return sl(e,"euclidean",t,r)}var Lk=_({euclideanNorm_:cK});function pK(e){let r={x:E(e,"x","exp")};return R.runKernel(Mc,r)}var jn=_({exp_:pK});function fK(e,t=0){let r=E(e,"x","expandDims","string_or_numeric");O(t<=r.rank,()=>"Axis must be <= rank of the tensor");let n={input:r},o={dim:t};return R.runKernel(hx,n,o)}var vo=_({expandDims_:fK});function mK(e){let r={x:E(e,"x","expm1")};return R.runKernel(Uc,r)}var Bk=_({expm1_:mK});function hK(e,t){let r=E(e,"x","tile","string_or_numeric");O(r.rank===t.length,()=>`Error in transpose: rank of input ${r.rank} must match length of reps ${t}.`);let n={x:r},o={reps:t};return R.runKernel(op,n,o)}var Ja=_({tile_:hK});function dK(e,t,r,n="float32"){t==null&&(t=e);let o=st([e,t],n),s=e<=t?e:t;for(let a=0;a<s;++a)o.set(1,a,a);let i=Q(o.toTensor(),[e,t]);if(r==null)return i;if(r.length===1)return Ja(vo(i,0),[r[0],1,1]);if(r.length===2)return Ja(vo(vo(i,0),0),[r[0],r[1],1,1]);if(r.length===3)return Ja(vo(vo(vo(i,0),0),0),[r[0],r[1],r[2],1,1]);throw new Error(`eye() currently supports only 1D and 2D batchShapes, but received ${r.length}D.`)}var m0=_({eye_:dK});function gK(e){let r={x:E(e,"x","floor","float32")};return R.runKernel(Vc,r)}var h0=_({floor_:gK});function xK(e,t,r=0,n=0){let o=E(e,"x","gather"),s=E(t,"indices","gather","int32"),i={x:o,indices:s},a={axis:r,batchDims:n};return R.runKernel(bx,i,a)}var d0=_({gather_:xK});function yK(e,t){let r=E(e,"a","greater","string_or_numeric"),n=E(t,"b","greater","string_or_numeric");[r,n]=Je(r,n),ht(r.shape,n.shape);let o={a:r,b:n};return R.runKernel(Wc,o)}var il=_({greater_:yK});function bK(e,t){let r=E(e,"a","greaterEqual","string_or_numeric"),n=E(t,"b","greaterEqual","string_or_numeric");[r,n]=Je(r,n),ht(r.shape,n.shape);let o={a:r,b:n};return R.runKernel(zc,o)}var g0=_({greaterEqual_:bK});function vK(e){let r={input:E(e,"input","imag")};return R.runKernel(Tx,r)}var eu=_({imag_:vK});function wK(e){let r={x:E(e,"x","isFinite")};return R.runKernel(Sx,r)}var Mk=_({isFinite_:wK});function TK(e){let r={x:E(e,"x","isInf")};return R.runKernel(Cx,r)}var Uk=_({isInf_:TK});function SK(e){let r={x:E(e,"x","isNaN")};return R.runKernel(Ex,r)}var Vk=_({isNaN_:SK});function CK(e,t=.2){let n={x:E(e,"x","leakyRelu")},o={alpha:t};return R.runKernel(Nx,n,o)}var x0=_({leakyRelu_:CK});function EK(e,t){let r=E(e,"a","less","string_or_numeric"),n=E(t,"b","less","string_or_numeric");[r,n]=Je(r,n),ht(r.shape,n.shape);let o={a:r,b:n};return R.runKernel(Hc,o)}var Km=_({less_:EK});function NK(e,t){let r=E(e,"a","lessEqual","string_or_numeric"),n=E(t,"b","lessEqual","string_or_numeric");[r,n]=Je(r,n),ht(r.shape,n.shape);let o={a:r,b:n};return R.runKernel(Kc,o)}var bp=_({lessEqual_:NK});function Gk(e,t,r){if(r<=0)throw new Error("The number of values should be positive.");let n={start:e,stop:t,num:r};return R.runKernel(_x,{},n)}function _K(e,t=5,r=1,n=1,o=.5){let s=E(e,"x","localResponseNormalization");O(s.rank===4||s.rank===3,()=>`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank ${s.rank}.`),O(qi(t),()=>`Error in localResponseNormalization: depthRadius must be an integer but got depthRadius ${t}.`);let i=s,a=!1;s.rank===3&&(a=!0,i=Q(s,[1,s.shape[0],s.shape[1],s.shape[2]]));let u={x:i},c={depthRadius:t,bias:r,alpha:n,beta:o},p=R.runKernel(Rx,u,c);return a?Q(p,[p.shape[1],p.shape[2],p.shape[3]]):p}var Wk=_({localResponseNormalization_:_K});function IK(e){let r={x:E(e,"x","log","float32")};return R.runKernel(qc,r)}var ta=_({log_:IK});function AK(e){let r={x:E(e,"x","log1p")};return R.runKernel(Ix,r)}var y0=_({log1p_:AK});function zk(e,t){O(Oc(e),()=>"The f passed in variableGrads(f) must be a function"),O(t==null||Array.isArray(t)&&t.every(c=>c instanceof Xi),()=>"The varList passed in variableGrads(f, varList) must be an array of variables");let r=t!=null;if(!r){t=[];for(let c in R.registeredVariables)t.push(R.registeredVariables[c])}let n=r?t.filter(c=>!c.trainable):null,o=t.length;t=t.filter(c=>c.trainable),O(t.length>0,()=>`variableGrads() expects at least one of the input variables to be trainable, but none of the ${o} variables is trainable.`);let s=!0,{value:i,grads:a}=R.gradients(e,t,null,s);O(a.some(c=>c!=null),()=>"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."),O(i.rank===0,()=>`The f passed in variableGrads(f) must return a scalar, but it returned a rank-${i.rank} tensor`);let u={};return t.forEach((c,p)=>{a[p]!=null&&(u[c.name]=a[p])}),n?.forEach(c=>u[c.name]=null),{value:i,grads:u}}function Xn(e){return R.customGrad(e)}function kK(e){let r={x:E(e,"x","neg")};return R.runKernel(Am,r)}var on=_({neg_:kK});function $K(e){let r={x:E(e,"x","softplus")};return R.runKernel(x1,r)}var b0=_({softplus_:$K});function RK(e){let t=E(e,"x","logSigmoid");return Xn(n=>({value:on(b0(on(n))),gradFunc:i=>ce(i,xs(on(n)))}))(t)}var Hk=_({logSigmoid_:RK});function OK(e,t){let r=E(e,"a","sub"),n=E(t,"b","sub");[r,n]=Je(r,n);let o={a:r,b:n};return R.runKernel(np,o)}var Fe=_({sub_:OK});function DK(e,t=-1){let r=E(e,"logits","logSoftmax");if(t===-1&&(t=r.rank-1),t!==r.rank-1)throw Error(`Log Softmax along a non-last dimension is not yet supported. Logits was rank ${r.rank} and axis was ${t}`);return Xn((o,s)=>{let a=wi(o,t,!0),u=Fe(o,a),c=Fe(it(u,"float32"),ta(yt(jn(u),t,!0)));return s([c]),{value:c,gradFunc:(m,h)=>{let[x]=h,y=!0,v=jn(x);return Fe(m,ce(yt(m,t,y),v))}}})(r)}var Kk=_({logSoftmax_:DK});function FK(e,t=null,r=!1){let n=E(e,"x","logSumExp"),o=Ua(t,n.shape),s=wi(n,o,!0),i=Fe(n,s),a=jn(i),u=yt(a,o),c=ta(u),p=Se(Q(s,c.shape),c);if(r){let m=Ji(p.shape,o);return Q(p,m)}return p}var v0=_({logSumExp_:FK});function PK(e,t){let r=E(e,"a","logicalAnd","bool"),n=E(t,"b","logicalAnd","bool");ht(r.shape,n.shape);let o={a:r,b:n};return R.runKernel(Ax,o)}var al=_({logicalAnd_:PK});function LK(e){let r={x:E(e,"x","logicalNot","bool")};return R.runKernel(kx,r)}var w0=_({logicalNot_:LK});function BK(e,t){let r=E(e,"a","logicalOr","bool"),n=E(t,"b","logicalOr","bool");ht(r.shape,n.shape);let o={a:r,b:n};return R.runKernel($x,o)}var T0=_({logicalOr_:BK});function MK(e,t){let r=E(e,"a","logicalXor","bool"),n=E(t,"b","logicalXor","bool");return ht(r.shape,n.shape),al(T0(e,t),w0(al(e,t)))}var qk=_({logicalXor_:MK});var S0=2147483648;function UK(e,t,r="left"){let n=E(e,"sortedSequence","searchSorted"),o=E(t,"values","searchSorted"),s=n.shape[n.shape.length-1],i=o.shape[o.shape.length-1],a=Q(n,[-1,s]),u=Q(o,[-1,i]);if(a.rank<2)throw new Error("Sorted input argument must be at least 2-dimensional");if(a.shape[0]!==u.shape[0])throw new Error("Leading dimension of 'sortedSequence' and 'values' must match.");if(rt(u.shape)>=S0)throw new Error(`values tensor size must less than ${S0}`);if(a.shape[1]>=S0)throw new Error(`trailing dim_size must less than ${S0} for int32 output type, was ${a.shape[1]}`);let c={sortedSequence:a,values:u},p={side:r};return R.runKernel(p1,c,p)}var qm=_({searchSorted_:UK});function jk(e,t){return qm(e,t,"left")}function VK(e,t,r,n,o){let s=E(e,"x","maxPool"),i=1,a=s,u=!1;s.rank===3&&(u=!0,a=Q(s,[1,s.shape[0],s.shape[1],s.shape[2]])),O(a.rank===4,()=>`Error in maxPool: input must be rank 4 but got rank ${a.rank}.`),O(xn(r,i),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${r} and dilations '${i}'`),vr("maxPool",n,o);let c={x:a},p={filterSize:t,strides:r,pad:n,dimRoundingMode:o},m=R.runKernel(Dx,c,p);return u?Q(m,[m.shape[1],m.shape[2],m.shape[3]]):m}var C0=_({maxPool_:VK});function GK(e,t=[1,1,1],r,n,o,s="NDHWC"){let i=E(e,"x","maxPool3d"),a=i,u=!1;i.rank===4&&(u=!0,a=Q(i,[1,i.shape[0],i.shape[1],i.shape[2],i.shape[3]])),O(a.rank===5,()=>`Error in maxPool3d: x must be rank 5 but got rank ${a.rank}.`),O(s==="NDHWC",()=>`Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of ${s}`),vr("maxPool3d",n,o);let c={x:a},p={filterSize:t,strides:r,pad:n,dimRoundingMode:o,dataFormat:s},m=R.runKernel(Fx,c,p);return u?Q(m,[m.shape[1],m.shape[2],m.shape[3],m.shape[4]]):m}var Xk=_({maxPool3d_:GK});function WK(e,t,r,n,o=!1){let i={x:E(e,"x","maxPoolWithArgmax")},a={filterSize:t,strides:r,pad:n,includeBatchInIndex:o},u=R.runKernel(Px,i,a);return{result:u[0],indexes:u[1]}}var Yk=_({maxPoolWithArgmax_:WK});function zK(e,t){let r=E(e,"a","maximum"),n=E(t,"b","maximum");[r,n]=Je(r,n),r.dtype==="bool"&&(r=it(r,"int32"),n=it(n,"int32")),ht(r.shape,n.shape);let o={a:r,b:n};return R.runKernel(jc,o)}var E0=_({maximum_:zK});function HK(e,t=null,r=!1){let o={x:E(e,"x","mean")},s={axis:t,keepDims:r};return R.runKernel(Lx,o,s)}var ul=_({mean_:HK});function ys(e,t="float32"){if(Zt(e),t==="complex64"){let n=ys(e,"float32"),o=ys(e,"float32");return Hn(n,o)}let r=Fc(rt(e),t);return R.makeTensor(r,e,t)}function Ti(e,t="float32"){if(Zt(e),t==="complex64"){let n=Ti(e,"float32"),o=ys(e,"float32");return Hn(n,o)}let r=Cm(rt(e),t);return R.makeTensor(r,e,t)}function Zk(e,t,{indexing:r="xy"}={}){if(r!=="xy"&&r!=="ij")throw new TypeError(`${r} is not a valid third argument to meshgrid`);if(e===void 0)return[];let n=E(e,"x","meshgrid",e instanceof It?e.dtype:"float32");if(t===void 0)return[n];let o=E(t,"y","meshgrid",t instanceof It?t.dtype:"float32"),s=rt(n.shape),i=rt(o.shape);return r==="xy"?(n=Q(n,[1,-1]),o=Q(o,[-1,1]),[xt(Ti([i,1],n.dtype),n),xt(o,Ti([1,s],o.dtype))]):(n=Q(n,[-1,1]),o=Q(o,[1,-1]),[xt(n,Ti([1,i],n.dtype)),xt(Ti([s,1],o.dtype),o)])}function KK(e,t){let r=E(e,"a","minimum"),n=E(t,"b","minimum");[r,n]=Je(r,n),r.dtype==="bool"&&(r=it(r,"int32"),n=it(n,"int32")),ht(r.shape,n.shape);let o={a:r,b:n};return R.runKernel(Xc,o)}var ll=_({minimum_:KK});function qK(e,t,r){O(r==="reflect"||r==="symmetric",()=>`Invalid mode. Mode must be either reflect or symmetric. Got ${r}.`);let n=E(e,"x","mirrorPad");if(n.rank===0)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");O(t.length===n.rank,()=>`Padding doesn't match input. Must be ${n.rank}. Got ${t.length}.`);let o=r==="reflect"?1:0;for(let a=0;a<n.rank;a++)O(t[a].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),O(t[a][0]>=0&&t[a][0]<=n.shape[a]-o&&t[a][1]>=0&&t[a][1]<=n.shape[a]-o,()=>`Padding in dimension ${a} cannot be greater than or equal to ${n.shape[a]-o} or less than 0 for input of shape ${n.shape}`);let s={paddings:t,mode:r},i={x:n};return R.runKernel(Mx,i,s)}var Qk=_({mirrorPad_:qK});function jK(e,t){let r=E(e,"a","mod"),n=E(t,"b","mod");[r,n]=Je(r,n);let o={a:r,b:n};return R.runKernel(Ux,o)}var Jk=_({mod_:jK});function XK(e,t=null,r=!1){e=E(e,"x","moments");let n=Ua(t,e.shape),o=ul(e,n,r),s=o.shape;r||(s=Ji(o.shape,n));let i=Zr(Fe(it(e,"float32"),Q(o,s))),a=ul(i,n,r);return{mean:o,variance:a}}var e$=_({moments_:XK});function YK(e,t,r,n){let o=E(t,"data","multiRNNCell"),s=Qu(r,"c","multiRNNCell"),i=Qu(n,"h","multiRNNCell"),a=o,u=[];for(let m=0;m<e.length;m++){let h=e[m](a,s[m],i[m]);u.push(h[0]),u.push(h[1]),a=h[1]}let c=[],p=[];for(let m=0;m<u.length;m+=2)c.push(u[m]),p.push(u[m+1]);return[c,p]}var t$=_({multiRNNCell_:YK});function ZK(e,t,r,n=!1){let o=E(e,"logits","multinomial"),s=o.size,i=o.rank;if(s<2)throw new Error(`Error in multinomial: you need at least 2 outcomes, but got ${s}.`);if(i>2)throw new Error(`Rank of probabilities must be 1 or 2, but is ${i}`);r=r||Math.random();let u={logits:i===1?Q(o,[1,-1]):o},c={numSamples:t,seed:r,normalized:n},p=R.runKernel(Vx,u,c);return i===1?Q(p,[p.size]):p}var r$=_({multinomial_:ZK});function QK(e,t){let r=E(e,"a","notEqual","string_or_numeric"),n=E(t,"b","notEqual","string_or_numeric");[r,n]=Je(r,n),ht(r.shape,n.shape);let o={a:r,b:n};return R.runKernel(Zc,o)}var N0=_({notEqual_:QK});function JK(e,t,r=1,n=0,o="int32"){if(t<2)throw new Error(`Error in oneHot: depth must be >=2, but it is ${t}`);let i={indices:E(e,"indices","oneHot","int32")},a={dtype:o,depth:t,onValue:r,offValue:n};return R.runKernel(Kx,i,a)}var n$=_({oneHot_:JK});function eq(e){let r={x:E(e,"x","onesLike")};return R.runKernel(Hx,r)}var o$=_({onesLike_:eq});function tq(e,t){let r=E(e,"v1","outerProduct"),n=E(t,"v2","outerProduct");O(r.rank===1&&n.rank===1,()=>`Error in outerProduct: inputs must be rank 1, but got ranks ${r.rank} and ${n.rank}.`);let o=Q(r,[-1,1]),s=Q(n,[1,-1]);return xt(o,s)}var s$=_({outerProduct_:tq});function rq(e,t,r=0){let n=E(e,"x","pad");if(n.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");let o={paddings:t,constantValue:r},s={x:n};return R.runKernel(jx,s,o)}var Si=_({pad_:rq});function nq(e,t,r=0){return O(t.length===2,()=>"Invalid number of paddings. Must be length of 2."),Si(e,[t],r)}var i$=_({pad1d_:nq});function oq(e,t,r=0){return O(t.length===2&&t[0].length===2&&t[1].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),Si(e,t,r)}var a$=_({pad2d_:oq});function sq(e,t,r=0){return O(t.length===3&&t[0].length===2&&t[1].length===2&&t[2].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),Si(e,t,r)}var u$=_({pad3d_:sq});function iq(e,t,r=0){return O(t.length===4&&t[0].length===2&&t[1].length===2&&t[2].length===2&&t[3].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),Si(e,t,r)}var l$=_({pad4d_:iq});function aq(e,t,r){let n=E(e,"x","spaceToBatchND");O(n.rank>=1+t.length,()=>`input rank ${n.rank} should be > than [blockShape] ${t.length}`),O(r.length===t.length,()=>`paddings.shape[0] ${r.length} must be equal to [blockShape] ${t.length}`),O(n.shape.reduce((i,a,u)=>u>0&&u<=t.length?i&&(a+r[u-1][0]+r[u-1][1])%t[u-1]===0:i,!0),()=>`input spatial dimensions ${n.shape.slice(1)} with paddings ${r.toString()} must be divisible by blockShapes ${t.toString()}`);let o={x:n},s={blockShape:t,paddings:r};return R.runKernel(b1,o,s)}var _0=_({spaceToBatchND_:aq});function uq(e,t,r,n,o,s,i){o==null&&(o=[1,1]),s==null&&(s=1),n===0&&(n="valid");let a=E(e,"x","maxPool"),u=a,c=!1;a.rank===3&&(c=!0,u=Q(a,[1,a.shape[0],a.shape[1],a.shape[2]])),O(xn(s,o),()=>`Error in pool: Either strides or dilations must be 1. Got strides ${s} and dilations '${o}'`);let p=KT(u.shape,t,s,o,n),m=[p.dilationHeight,p.dilationWidth],h;n==="same"?h=cq([p.filterHeight,p.filterWidth],m):h=[[0,0],[0,0]];let x=m[0]===1&&m[1]===1,[y,v]=lq([p.inHeight,p.inWidth],m,h),w=x?n:"valid",C=x?u:_0(u,m,y),D=(r==="avg"?()=>s0(C,t,s,w,i):()=>C0(C,t,s,w,i))(),P=x?D:i0(D,m,v);return c?Q(P,[P.shape[1],P.shape[2],P.shape[3]]):P}function lq(e,t,r){let n=r.map(p=>p[0]),o=r.map(p=>p[1]),s=e.concat(n,o),i=t.map((p,m)=>(p-s[m]%p)%p),a=o.map((p,m)=>p+i[m]),u=t.map((p,m)=>[n[m],a[m]]),c=t.map((p,m)=>[0,i[m]]);return[u,c]}function cq(e,t){let n=e.map((i,a)=>i+(i-1)*(t[a]-1)).map(i=>i-1),o=n.map(i=>Math.floor(i/2)),s=n.map((i,a)=>i-o[a]);return n.map((i,a)=>[o[a],s[a]])}var c$=_({pool_:uq});function pq(e,t){let r=E(e,"x","prelu"),n=E(t,"alpha","prelu"),o={x:r,alpha:n};return R.runKernel(Yx,o)}var I0=_({prelu_:pq});function fq(e,t=null,r=!1){let n=E(e,"x","prod");n.dtype==="bool"&&(n=it(n,"int32"));let o={x:n},s={axis:t,keepDims:r};return R.runKernel(km,o,s)}var p$=_({prod_:fq});function mq(e,t,r,n){let o=e.map((p,m)=>E(p,`tensors${m}`,"raggedGather","int32")),s=E(t,"paramsDenseValues","raggedGather"),i=E(r,"indices","raggedGather","int32"),a={paramsNestedSplits:o,paramsDenseValues:s,indices:i},u={outputRaggedRank:n},c=R.runKernel(Zx,a,u);return{outputNestedSplits:c.slice(0,c.length-1),outputDenseValues:c[c.length-1]}}var f$=_({raggedGather_:mq});function hq(e,t,r){let n=E(e,"starts","raggedRange"),o=E(t,"limits","raggedRange",n.dtype),s=E(r,"deltas","raggedRange",n.dtype),i={starts:n,limits:o,deltas:s},a=R.runKernel(Qx,i);return{rtNestedSplits:a[0],rtDenseValues:a[1]}}var m$=_({raggedRange_:hq});function dq(e,t,r,n,o){let s=E(e,"shape","raggedTensorToTensor","int32"),i=E(t,"values","raggedTensorToTensor"),a=E(r,"defaultValue","raggedTensorToTensor",i.dtype),u=n.map((m,h)=>E(m,`tensors${h}`,"raggedTensorToTensor","int32")),c={shape:s,values:i,defaultValue:a,rowPartitionTensors:u},p={rowPartitionTypes:o};return R.runKernel(Jx,c,p)}var h$=_({raggedTensorToTensor_:dq});function gq(e,t,r){Zt(e);let n=rt(e),o=null;if(r==null||r==="float32")o=new Float32Array(n);else if(r==="int32")o=new Int32Array(n);else if(r==="bool")o=new Uint8Array(n);else throw new Error(`Unknown data type ${r}`);for(let s=0;s<n;s++)o[s]=t();return R.makeTensor(o,e,r)}var d$=_({rand_:gq});var R0=ks(R$());var pl=class{constructor(t,r,n,o,s){this.mean=t,this.stdDev=r,this.dtype=n,this.nextVal=NaN,this.truncated=o,this.truncated&&(this.upper=this.mean+this.stdDev*2,this.lower=this.mean-this.stdDev*2);let i=s||Math.random();this.random=R0.alea(i.toString())}nextValue(){if(!isNaN(this.nextVal)){let o=this.nextVal;return this.nextVal=NaN,o}let t,r,n=!1;for(;!n;){let o,s,i;do o=2*this.random()-1,s=2*this.random()-1,i=o*o+s*s;while(i>=1||i===0);let a=Math.sqrt(-2*Math.log(i)/i);t=this.mean+this.stdDev*o*a,r=this.mean+this.stdDev*s*a,(!this.truncated||this.isValidTruncated(t))&&(n=!0)}return(!this.truncated||this.isValidTruncated(r))&&(this.nextVal=this.convertValue(r)),this.convertValue(t)}convertValue(t){return this.dtype==null||this.dtype==="float32"?t:Math.round(t)}isValidTruncated(t){return t<=this.upper&&t>=this.lower}},k0=class{constructor(t,r,n,o){this.alpha=t,this.beta=1/r,this.dtype=n;let s=o||Math.random();this.randu=R0.alea(s.toString()),this.randn=new pl(0,1,n,!1,this.randu()),t<1?this.d=t+2/3:this.d=t-1/3,this.c=1/Math.sqrt(9*this.d)}nextValue(){let t,r,n,o,s,i;for(;;){do o=this.randn.nextValue(),i=1+this.c*o;while(i<=0);if(i*=i*i,t=o*o,r=1-.331*t*t,n=.5*t+this.d*(1-i+Math.log(i)),s=this.randu(),s<r||Math.log(s)<n)break}return i=1/this.beta*this.d*i,this.alpha<1&&(i*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(i)}convertValue(t){return this.dtype==="float32"?t:Math.round(t)}},$0=class{constructor(t=0,r=1,n,o){if(this.canReturnFloat=()=>this.dtype==null||this.dtype==="float32",this.min=t,this.range=r-t,this.dtype=n,o==null&&(o=Math.random()),typeof o=="number"&&(o=o.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error(`The difference between ${t} - ${r} <= 1 and dtype is not float`);this.random=R0.alea(o)}convertValue(t){return this.canReturnFloat()?t:Math.round(t)}nextValue(){return this.convertValue(this.min+this.range*this.random())}};function Sq(e,t,r=1,n="float32",o){if(Zt(e),r==null&&(r=1),n==null&&(n="float32"),n!=="float32"&&n!=="int32")throw new Error(`Unsupported data type ${n}`);let s=new k0(t,r,n,o),i=st(e,n);for(let a=0;a<i.values.length;a++)i.values[a]=s.nextValue();return i.toTensor()}var O$=_({randomGamma_:Sq});function Cq(e,t=0,r=1,n,o){if(Zt(e),n!=null&&n==="bool")throw new Error(`Unsupported data type ${n}`);let s=new pl(t,r,n,!1,o),i=st(e,n);for(let a=0;a<i.values.length;a++)i.values[a]=s.nextValue();return i.toTensor()}var O0=_({randomNormal_:Cq});function Eq(e,t,r){if(t!=null&&t==="bool")throw new Error(`Unsupported data type ${t}`);return O0(e,0,1,t,r)}var D$=_({randomStandardNormal_:Eq});function Nq(e,t=0,r=1,n="float32",o){Zt(e);let s=st(e,n),i=new $0(t,r,null,o);for(let a=0;a<s.values.length;a++)s.values[a]=i.nextValue();return s.toTensor()}var vp=_({randomUniform_:Nq});function _q(e,t,r,n){return vp(e,t,r,"int32",n)}var F$=_({randomUniformInt_:_q});function tu(e,t,r=1,n="float32"){if(r===0)throw new Error("Cannot have a step of zero");let o={start:e,stop:t,step:r,dtype:n};return R.runKernel(e1,{},o)}function Iq(e){let r={input:E(e,"input","real")};return R.runKernel($m,r)}var ra=_({real_:Iq});function Aq(e){let r={x:E(e,"x","reciprocal")};return R.runKernel(t1,r)}var P$=_({reciprocal_:Aq});function kq(e){let r={x:E(e,"x","relu")};return R.runKernel(r1,r)}var ru=_({relu_:kq});function $q(e){let r={x:E(e,"x","relu6")};return R.runKernel(i1,r)}var D0=_({relu6_:$q});function Rq(e,t){let n={x:E(e,"x","reverse")},o={dims:t};return R.runKernel(a1,n,o)}var Ko=_({reverse_:Rq});function Oq(e){let t=E(e,"x","reverse");return O(t.rank===1,()=>`Error in reverse1D: x must be rank 1 but got rank ${t.rank}.`),Ko(t,0)}var L$=_({reverse1d_:Oq});function Dq(e,t){let r=E(e,"x","reverse");return O(r.rank===2,()=>`Error in reverse2D: x must be rank 2 but got rank ${r.rank}.`),Ko(r,t)}var B$=_({reverse2d_:Dq});function Fq(e,t){let r=E(e,"x","reverse");return O(r.rank===3,()=>`Error in reverse3D: x must be rank 3 but got rank ${r.rank}.`),Ko(r,t)}var M$=_({reverse3d_:Fq});function Pq(e,t){let r=E(e,"x","reverse");return O(r.rank===4,()=>`Error in reverse4D: x must be rank 4 but got rank ${r.rank}.`),Ko(r,t)}var U$=_({reverse4d_:Pq});function Lq(e){let r={x:E(e,"x","round")};return R.runKernel(u1,r)}var F0=_({round_:Lq});function Bq(e){let r={x:E(e,"x","rsqrt","float32")};return R.runKernel(Qc,r)}var V$=_({rsqrt_:Bq});function Mq(e){let r={x:E(e,"x","selu")};return R.runKernel(m1,r)}var G$=_({selu_:Mq});function Uq(e,t,r,n,o,s=[1,1],i="NHWC"){let a=E(e,"x","separableConv2d"),u=E(t,"depthwiseFilter","separableConv2d"),c=E(r,"pointwiseFilter","separableConv2d"),p=a,m=!1;if(a.rank===3&&(m=!0,p=Q(a,[1,a.shape[0],a.shape[1],a.shape[2]])),i==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");O(p.rank===4,()=>`Error in separableConv2d: input must be rank 4, but got rank ${p.rank}.`),O(u.rank===4,()=>`Error in separableConv2d: depthwise filter must be rank 4, but got rank ${u.rank}.`),O(c.rank===4,()=>`Error in separableConv2d: pointwise filter must be rank 4, but got rank ${u.rank}.`),O(c.shape[0]===1,()=>`Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got ${c.shape[0]}.`),O(c.shape[1]===1,()=>`Error in separableConv2d: the second dimension of pointwise filter must be 1, but got ${c.shape[1]}.`);let h=u.shape[2],x=u.shape[3];O(c.shape[2]===h*x,()=>`Error in separableConv2d: the third dimension of pointwise filter must be ${h*x}, but got ${c.shape[2]}.`);let y=yp(p,u,n,o,i,s),w=Ya(y,c,1,"valid",i);return m?Q(w,[w.shape[1],w.shape[2],w.shape[3]]):w}var W$=_({separableConv2d_:Uq});function Vq(e,t){return ne(this,null,function*(){let r=E(e,"x","setdiff1d"),n=E(t,"y","setdiff1d");O(r.dtype===n.dtype,()=>`x and y should have the same dtype, but got x (${r.dtype}) and y (${n.dtype}).`),O(r.rank===1,()=>`x should be 1D tensor, but got x (${r.shape}).`),O(n.rank===1,()=>`y should be 1D tensor, but got y (${n.shape}).`);let o=yield r.data(),s=yield n.data(),i=new Set(s),a=0;for(let p=0;p<o.length;p++)i.has(o[p])||a++;let u=new zo([a],r.dtype),c=new zo([a],"int32");for(let p=0,m=0;p<o.length;p++)i.has(o[p])||(u.values[m]=o[p],c.values[m]=p,m++);return[u.toTensor(),c.toTensor()]})}var z$=Vq;function Gq(e){let r={x:E(e,"x","sign")};return R.runKernel(g1,r)}var H$=_({sign_:Gq});function Wq(e){let r={x:E(e,"x","sin","float32")};return R.runKernel(h1,r)}var K$=_({sin_:Wq});function zq(e){let r={x:E(e,"x","sinh")};return R.runKernel(d1,r)}var q$=_({sinh_:zq});function Hq(e,t,r){let n=E(e,"x","slice1d");return O(n.rank===1,()=>`slice1d expects a rank-1 tensor, but got a rank-${n.rank} tensor`),Ve(n,[t],[r])}var j$=_({slice1d_:Hq});function Kq(e,t,r){let n=E(e,"x","slice2d");return O(n.rank===2,()=>`slice2d expects a rank-2 tensor, but got a rank-${n.rank} tensor`),Ve(n,t,r)}var X$=_({slice2d_:Kq});function qq(e,t,r){let n=E(e,"x","slice3d");return O(n.rank===3,()=>`slice3d expects a rank-3 tensor, but got a rank-${n.rank} tensor`),Ve(n,t,r)}var Y$=_({slice3d_:qq});function jq(e,t,r){let n=E(e,"x","slice4d");return O(n.rank===4,()=>`slice4d expects a rank-4 tensor, but got a rank-${n.rank} tensor`),Ve(n,t,r)}var Z$=_({slice4d_:jq});function Xq(e,t=-1){let r=E(e,"logits","softmax","float32");if(t===-1&&(t=r.rank-1),t!==r.rank-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${r.rank} and dim was ${t}`);let n={logits:r},o={dim:t};return R.runKernel(w1,n,o)}var Q$=_({softmax_:Xq});function Yq(e){O(e.dtype==="complex64",()=>`The dtype for tf.spectral.fft() must be complex64 but got ${e.dtype}.`);let t={input:e};return R.runKernel(dx,t)}var wp=_({fft_:Yq});function Zq(e){O(e.dtype==="complex64",()=>`The dtype for tf.spectral.ifft() must be complex64 but got ${e.dtype}.`);let t={input:e};return R.runKernel(wx,t)}var fl=_({ifft_:Zq});function Qq(e){let t=e.shape[e.shape.length-1],r=e.size/t,n;if(t<=2){let o=Q(e,[r,t]);n=fl(o)}else{let o=[r,2*(t-1)],s=Q(ra(e),[r,t]),i=Q(eu(e),[r,t]),a=Ko(Ve(s,[0,1],[r,t-2]),1),u=ce(Ko(Ve(i,[0,1],[r,t-2]),1),Be(-1)),c=Rt([s,a],1),p=Rt([i,u],1),m=Q(Hn(c,p),[o[0],o[1]]);n=fl(m)}if(n=ra(n),e.rank===3&&e.shape[0]!==0){let o=n,s=e.shape[0];n=Q(n,[s,n.shape[0]/s,n.shape[1]]),o.dispose()}return n}var P0=_({irfft_:Qq});function Jq(e,t,r=0){let o={x:E(e,"x","split")},s={numOrSizeSplits:t,axis:r};return R.runKernel(v1,o,s)}var na=_({split_:Jq});function ej(e,t){O(e.dtype==="float32",()=>`The dtype for rfft() must be real value but got ${e.dtype}`);let r=e.shape[e.shape.length-1],n=e.size/r,o;if(t!=null&&t<r){let y=e.shape.map(w=>0),v=e.shape.map(w=>w);v[e.shape.length-1]=t,o=Ve(e,y,v),r=t}else if(t!=null&&t>r){let y=e.shape.map(v=>v);y[e.shape.length-1]=t-r,o=Rt([e,ys(y)],e.shape.length-1),r=t}else o=e;let s=Pr(o),i=Q(Hn(o,s),[n,r]),a=wp(i),u=Math.floor(r/2)+1,c=ra(a),p=eu(a),m=na(c,[u,r-u],c.shape.length-1),h=na(p,[u,r-u],p.shape.length-1),x=o.shape.slice();return x[o.shape.length-1]=u,Q(Hn(m[0],h[0]),x)}var Tp=_({rfft_:ej});function tj(e,t){let r=E(e,"a","squaredDifference"),n=E(t,"b","squaredDifference");[r,n]=Je(r,n),ht(r.shape,n.shape);let o={a:r,b:n},s={};return R.runKernel(tp,o,s)}var L0=_({squaredDifference_:tj});function rj(e,t){let r=E(e,"x","squeeze","string_or_numeric");return Q(r,mT(r.shape,t).newShape)}var _r=_({squeeze_:rj});function nj(e,t=0){let r=Qu(e,"tensors","stack","string_or_numeric");O(r.length>=1,()=>"Pass at least one tensor to tf.stack"),r.length>0&&O(t<=r[0].rank,()=>"Axis must be <= rank of the tensor");let n=r,o={axis:t};return R.runKernel(qx,n,o)}var kn=_({stack_:nj});function oj(e,t=0){let n={x:E(e,"x","step")},o={alpha:t};return R.runKernel(M1,n,o)}var B0=_({step_:oj});function sj(e,t,r,n,o=0,s=0,i=0,a=0,u=0){let p={x:E(e,"x","stridedSlice","string_or_numeric")},m={begin:t,end:r,strides:n,beginMask:o,endMask:s,ellipsisMask:i,newAxisMask:a,shrinkAxisMask:u};return R.runKernel(_1,p,m)}var J$=_({stridedSlice_:sj});function ij(e){let r={x:E(e,"x","tan","float32")};return R.runKernel($1,r)}var eR=_({tan_:ij});function ar(e,t){Wo(e);let r=zn(e,t);if(r.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");return In(e,null,r,t)}function Us(e,t,r){if(Wo(e),t!=null&&t.length!==2)throw new Error("tensor2d() requires shape to have two numbers");let n=zn(e,r);if(n.length!==2&&n.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(n.length===1&&t==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return In(e,t,n,r)}function M0(e,t,r){if(Wo(e),t!=null&&t.length!==3)throw new Error("tensor3d() requires shape to have three numbers");let n=zn(e,r);if(n.length!==3&&n.length!==1)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(n.length===1&&t==null)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return In(e,t,n,r)}function tR(e,t,r){if(Wo(e),t!=null&&t.length!==4)throw new Error("tensor4d() requires shape to have four numbers");let n=zn(e,r);if(n.length!==4&&n.length!==1)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(n.length===1&&t==null)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return In(e,t,n,r)}function rR(e,t,r){if(Wo(e),t!=null&&t.length!==5)throw new Error("tensor5d() requires shape to have five numbers");let n=zn(e,r);if(n.length!==5&&n.length!==1)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(n.length===1&&t==null)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return In(e,t,n,r)}function nR(e,t,r){if(Wo(e),t!=null&&t.length!==6)throw new Error("tensor6d() requires shape to have six numbers");let n=zn(e,r);if(n.length!==6&&n.length!==1)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(n.length===1&&t==null)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return t=t||n,In(e,t,n,r)}function oR(e,t,r){let n=t.rank>1?t.shape[t.rank-1]:1,o=t.rank>1?t.rank-1:1,s=`Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: ${r.shape}, indices.shape: ${t.shape}, shape: ${e}, sliceDim: ${n}, and batchDim: ${o}.`;if(r.rank<o)throw new Error(s+` update.rank < ${o}. `);if(e.length<n+(r.rank-o))throw new Error(s+` Output shape length < ${n+(r.rank-o)}`);if(r.rank!==o+e.length-n)throw new Error(s+` update.rank != ${o+e.length-n}`);for(let i=0;i<o;++i)if(r.shape[i]!==t.shape[i])throw new Error(s+` updates.shape[${i}] (${r.shape[i]}) != indices.shape[${i}] (${t.shape[i]}).`);for(let i=0;i<r.rank-o;++i)if(r.shape[i+o]!==e[i+n])throw new Error(s+` updates.shape[${i+o}] (${r.shape[i+o]}) != shape[${i+o}] (${e[i+o]})`)}function jm(e,t,r){if(t.rank<1)throw new Error(`tf.scatterND() expects the indices to be rank 1 or higher, but the rank was ${t.rank}.`);if(e.rank<1)throw new Error(`tf.scatterND() expects the updates to be rank 1 or higher, but the rank was ${e.rank}.`);if(t.dtype!=="int32")throw new Error(`The dtype of 'indices' should be int32, but got dtype: ${t.dtype}`);if(r.length<1)throw new Error(`Output rank must be greater or equal to 1, but got shape: ${r}`);if(r.length===0){if(t.size===0)throw new Error(`Indices specified for empty output. indices shape: ${t.shape}`);if(e.size===0)throw new Error(`Updates specified for empty output. updates shape: ${e.shape}`)}oR(r,t,e)}function aj(e,t,r){let n=t.shape.length,o=n>1?t.shape[n-1]:1,s=r.length,i=1;for(let m=o;m<s;++m)i*=r[m];let a=o<1?1:o,u=rt(t.shape)/a,c=[...gi(r.slice(0,o)),1],p=rt(r);return{sliceRank:o,numUpdates:u,sliceSize:i,strides:c,outputSize:p}}function uj(e,t,r){let n=E(e,"tensor","tensorScatterupdate"),o=E(t,"indices","tensorScatterupdate","int32"),s=E(r,"updates","tensorScatterupdate");if(jm(s,o,n.shape),n.dtype!==s.dtype)throw new Error(`tensor and updates must have the same dtype, instead they are ${n.dtype} and ${s.dtype}.`);let i={tensor:n,indices:o,updates:s},a={};return R.runKernel(c1,i,a)}var iR=_({tensorScatterUpdate_:uj});function lj(e,t=1,r=!0){let n=E(e,"x","topk");if(n.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");let o=n.shape[n.shape.length-1];if(t<0)throw new Error(`'k' passed to topk() must be >= 0 but got ${t}`);if(t>o)throw new Error(`'k' passed to topk() must be <= the last dimension (${o}) but got ${t}`);let s={x:n},i={k:t,sorted:r},[a,u]=R.runKernel(O1,s,i);return{values:a,indices:u}}var aR=_({topk_:lj});function cj(e,t=0,r=1,n,o){if(Zt(e),n!=null&&n==="bool")throw new Error("Unsupported data type $ { dtype }");let s=new pl(t,r,n,!0,o),i=st(e,n);for(let a=0;a<i.values.length;a++)i.values[a]=s.nextValue();return i.toTensor()}var uR=_({truncatedNormal_:cj});function pj(e,t=0){let r=E(e,"x","unique","string_or_numeric");O(r.rank>0,()=>"The input tensor must be at least 1D");let n={x:r},o={axis:t},[s,i]=R.runKernel(F1,n,o);return{values:s,indices:i}}var lR=_({unique_:pj});function fj(e,t,r){let n=E(e,"x","unsortedSegmentSum"),o=E(t,"segmentIds","unsortedSegmentSum","int32");O(qi(r),()=>"numSegments must be of dtype int");let s={x:n,segmentIds:o},i={numSegments:r};return R.runKernel(L1,s,i)}var cR=_({unsortedSegmentSum_:fj});function mj(e,t=0){let r=E(e,"x","unstack","string_or_numeric");O(t>=-r.shape.length&&t<r.shape.length,()=>`Axis = ${t} is not in [-${r.shape.length}, ${r.shape.length})`);let n={value:r},o={axis:t};return R.runKernel(P1,n,o)}var qo=_({unstack_:mj});function pR(e,t){return qm(e,t,"right")}function fR(e,t=!0,r,n){return R.makeVariable(e,t,r,n)}function U0(e,t){let r=[];for(let s=0;s<t.length;s++)t[s]&&r.push(s);let n=st(e,"int32"),o=st([r.length,e.length],"int32");for(let s=0;s<r.length;s++){let i=n.indexToLoc(r[s]),a=s*e.length;o.values.set(i,a)}return o.toTensor()}function hj(e){return ne(this,null,function*(){let t=E(e,"condition","whereAsync","bool"),r=yield t.data(),n=U0(t.shape,r);return e!==t&&t.dispose(),n})}var V0=hj;function dj(e,t,r){return ne(this,null,function*(){let n=E(e,"tensor","boolMask"),o=E(t,"mask","boolMask","bool"),s=r??0,i=o.rank,a=n.shape;O(i>0,()=>"mask cannot be scalar"),ir(a.slice(s,s+i),o.shape,"mask's shape must match the first K dimensions of tensor's shape,");let u=1;for(let v=s;v<s+i;v++)u*=a[v];let c=a.slice(0,s).concat([u],a.slice(s+i)),p=Q(n,c),m=Q(o,[-1]),h=yield V0(m),x=_r(h,[1]),y=d0(p,x,s);return e!==n&&n.dispose(),t!==o&&o.dispose(),x.dispose(),p.dispose(),m.dispose(),h.dispose(),y})}var gj=dj;function xj(e,t,r){let n=E(e,"x","transpose");if(t==null&&(t=n.shape.map((i,a)=>a).reverse()),O(n.rank===t.length,()=>`Error in transpose: rank of input ${n.rank} must match length of perm ${t}.`),t.forEach(i=>{O(i>=0&&i<n.rank,()=>`All entries in 'perm' must be between 0 and ${n.rank-1} but got ${t}`)}),n.rank<=1)return n.clone();let o={x:n},s={perm:t};return n.dtype==="complex64"?Ue(()=>{let i=ra(n),a=eu(n);return i=R.runKernel(sp,{x:i},s),a=R.runKernel(sp,{x:a},s),r&&(a=on(a)),Hn(i,a)}):R.runKernel(sp,o,s)}var G0=_({transpose_:xj});function yj(e,t,r,n,o=!0){let s=E(e,"v","movingAverage"),i=E(t,"x","movingAverage"),a=E(r,"decay","movingAverage");fA(s,i),O(go(s.shape,i.shape),()=>"Shape mismatch in v and x");let u=Be(1),c=Fe(u,a),p=ce(Fe(i,s),c);if(o){O(n!=null,()=>"When using zeroDebias: true, step is required.");let m=E(n,"step","movingAverage");p=ze(p,Fe(u,ea(a,m)))}return Se(s,p)}var bj=_({movingAverage_:yj});function vj(e,t,r){Zt(r);let n=E(e,"indices","scatterND","int32"),o=E(t,"updates","scatterND");jm(o,n,r);let s={indices:n,updates:o},i={shape:r};return R.runKernel(l1,s,i)}var wj=_({scatterND_:vj});function mR(e,t,r,n){if(e.dtype!=="int32")throw new Error(`tf.sparseToDense() expects the indices to be int32 type, but the dtype was ${e.dtype}.`);if(e.rank>2)throw new Error(`sparseIndices should be a scalar, vector, or matrix, but got shape ${e.shape}.`);let o=e.rank>0?e.shape[0]:1,s=e.rank>1?e.shape[1]:1;if(r.length!==s)throw new Error(`outputShape has incorrect number of elements:, ${r.length}, should be: ${s}.`);let i=t.size;if(!(t.rank===0||t.rank===1&&i===o))throw new Error(`sparseValues has incorrect shape ${t.shape}, should be [] or [${o}]`);if(t.dtype!==n.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}function Sj(e,t,r,n=0){Zt(r);let o=E(e,"sparseIndices","sparseToDense","int32"),s=E(t,"sparseValues","sparseToDense","string_or_numeric"),i=E(n,"defaultValue","sparseToDense",s.dtype);mR(o,s,r,i);let a={sparseIndices:o,sparseValues:s,defaultValue:i},u={outputShape:r};return R.runKernel(N1,a,u)}var Cj=_({sparseToDense_:Sj});function Ej(e,t){let r=E(t,"indices","gatherND","int32"),o={params:E(e,"x","gatherND","string_or_numeric"),indices:r};return R.runKernel(vx,o)}var Nj=_({gatherND_:Ej});function hR(e,t){if(t==null)return e.shape.slice();if(go(e.shape,t))return t;if(e.shape.length===t.length){let r=[];for(let n=0;n<e.shape.length;n++)t[n]==null&&e.shape[n]!=null?r.push(e.shape[n]):r.push(t[n]);return r}return t}function _j(e,t,r,n){let o=E(e,"x","dropout");if(O(o.dtype==="float32",()=>`x has to be a floating point tensor since it's going to be scaled, but got a ${o.dtype} tensor instead.`),O(t>=0&&t<1,()=>`rate must be a float in the range [0, 1), but got ${t}.`),t===0)return e instanceof It?o.clone():o;let s=hR(o,r),i=1-t,a=ze(h0(Se(vp(s,0,1,"float32",n),i)),i);return ce(o,a)}var Ij=_({dropout_:_j});function tS(e){return Math.floor(Math.pow(2,Math.ceil(Math.log(e)/Math.log(2))))}function Xm(e,t,r){let n=1-e%2,o=new Float32Array(e);for(let s=0;s<e;++s){let i=2*Math.PI*s/(e+n-1);o[s]=t-r*Math.cos(i)}return ar(o,"float32")}function Aj(e,t,r=1){return ne(this,null,function*(){let n=E(e,"predictions","inTopK"),o=E(t,"targets","inTopK");O(n.rank>1,()=>`inTopK() expects the predictions to be of rank 2 or higher, but got ${n.rank}`),O(n.rank-1===o.rank,()=>`predictions rank should be 1 larger than targets rank, but got predictions rank ${n.rank} and targets rank ${o.rank}`),ir(n.shape.slice(0,n.shape.length-1),o.shape,"predictions's shape should be align with the targets' shape, except the last dimension.");let s=n.shape[n.shape.length-1];O(r>0&&r<=s,()=>`'k' passed to inTopK() must be > 0 && <= the predictions last dimension (${s}), but got ${r}`);let i=yield n.data(),a=yield o.data(),[u,c]=[i.length/s,s],p=hT("bool",u);for(let m=0;m<u;m++){let h=m*c,x=i.subarray(h,h+c),y=[];for(let v=0;v<x.length;v++)y.push({value:x[v],index:v});y.sort((v,w)=>w.value-v.value),p[m]=0;for(let v=0;v<r;v++)if(y[v].index===a[m]){p[m]=1;break}}return e!==n&&n.dispose(),t!==o&&o.dispose(),An(p,o.shape,"bool")})}var kj=Aj;var rS={};$t(rS,{conv2d:()=>gR,depthwiseConv2d:()=>bR,matMul:()=>vR});function $j(e,t,r,n,o,s="NHWC",i){let a=e;e.rank===3&&(a=Q(e,[1,e.shape[0],e.shape[1],e.shape[2]]));let u=t;u.rank===3&&(u=Q(t,[1,t.shape[0],t.shape[1],t.shape[2]])),O(a.rank===4,()=>`Error in conv2dDerFilter: input must be rank 4, but got shape ${a.shape}.`),O(u.rank===4,()=>`Error in conv2dDerFilter: dy must be rank 4, but got shape ${u.shape}.`),O(r.length===4,()=>`Error in conv2dDerFilter: filterShape must be length 4, but got ${r}.`);let c=s==="NHWC"?a.shape[3]:a.shape[1],p=s==="NHWC"?u.shape[3]:u.shape[1];O(c===r[2],()=>`Error in conv2dDerFilter: depth of input ${c}) must match input depth in filter (${r[2]}.`),O(p===r[3],()=>`Error in conv2dDerFilter: depth of dy (${p}) must match output depth for filter (${r[3]}).`),vr("conv2dDerFilter",o,i);let m={x:a,dy:u},h={strides:n,pad:o,dataFormat:s,dimRoundingMode:i,filterShape:r};return R.runKernel(jg,m,h)}var dR=_({conv2DBackpropFilter_:$j});function ml(e,t,r){if(r==null||r==="linear")return e;if(r==="relu")return ce(e,B0(t));throw new Error(`Cannot compute gradient for fused activation ${r}.`)}function hl(e,t){let r=t,n=c0(e.shape,t.shape);return n.length>0&&(r=yt(r,n)),Q(r,e.shape)}function dl(e,t,r,n){if(t==="linear")return e;if(t==="relu")return ru(e);if(t==="elu")return f0(e);if(t==="relu6")return D0(e);if(t==="prelu")return I0(e,r);if(t==="leakyrelu")return x0(e,n);if(t==="sigmoid")return xs(e);throw new Error(`Unknown fused activation ${t}.`)}var gl=(e,t)=>!(e>0)||t==="linear";function Rj({x:e,filter:t,strides:r,pad:n,dataFormat:o="NHWC",dilations:s=[1,1],dimRoundingMode:i,bias:a,activation:u="linear",preluActivationWeights:c,leakyreluAlpha:p}){if(u=u||"linear",gl(R.state.gradientDepth,u)===!1){O(o==="NHWC",()=>`Error in fused conv2d: got dataFormat of ${o} but only NHWC is currently supported for the case of gradient depth is 0 and the activation is not linear.`);let q=Ya(e,t,r,n,o,s,i);return a!=null&&(q=Se(q,a)),dl(q,u,c,p)}let m=E(e,"x","conv2d","float32"),h=E(t,"filter","conv2d","float32"),x=m,y=!1;m.rank===3&&(y=!0,x=Q(m,[1,m.shape[0],m.shape[1],m.shape[2]])),O(x.rank===4,()=>`Error in fused conv2d: input must be rank 4, but got rank ${x.rank}.`),O(h.rank===4,()=>`Error in fused conv2d: filter must be rank 4, but got rank ${h.rank}.`),vr("fused conv2d",n,i);let v=o==="NHWC"?x.shape[3]:x.shape[1];O(h.shape[2]===v,()=>`Error in conv2d: depth of input (${v}) must match input depth for filter ${h.shape[2]}.`),O(xn(r,s),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${r} and dilations '${s}'`);let w=ol(x.shape,h.shape,r,s,n,i),C;a!=null&&(C=E(a,"bias","fused conv2d"),[C]=Je(C,m),o==="NHWC"?ht(w.outShape,C.shape):(O(C.shape.length<=1,()=>`Error in fused conv2d: only supports scalar or 1-D Tensor bias for NCHW format but got the bias of rank-${C.shape.length}.`),O(C.shape.length===0||C.shape[0]===w.outChannels||C.shape[0]===1,()=>`Error in fused conv2d: bias shape (${C.shape}) is not compatible with the number of output channels (${w.outChannels})`)));let I;if(c!=null){let q=c.shape;if(O(q.length<=1||q.length===3,()=>`Error in fused conv2d: only supports scalar, 1-D Tensor or 3-D Tensor PReLU activation weights but got a tensor of rank-${q.length}.`),q.length===1)O(q[0]===1||q[0]===w.outChannels,()=>`Error in fused conv2d: PReLU activation weights (${q}) is not compatible with the number of output channels (${w.outChannels}).`);else if(q.length===3)try{ht(q,w.outShape)}catch{let Y=`Error in fused conv2d: PReLU activation weights (${q}) is not compatible with the output shape of the conv2d (${w.outShape}).`;throw Error(Y)}I=E(c,"prelu weights","fused conv2d")}let D=(q,Z)=>{O(o==="NHWC",()=>`Error in gradient of fused conv2D: got dataFormat of ${o} but only NHWC is currently supported.`);let[Y,te,J,ae]=Z,ge=ml(q,J,u);O(nl(s),()=>`Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${s}'`);let ke=l0(te.shape,ge,Y,r,n),We=dR(te,ge,Y.shape,r,n),Re=[ke,We];if(ae!=null){let ct=hl(ae,ge);Re.push(ct)}return Re},P={x,filter:h,bias:C,preluActivationWeights:I},G={strides:r,pad:n,dataFormat:o,dilations:s,dimRoundingMode:i,activation:u,leakyreluAlpha:p};return a==null?Xn((Z,Y,te)=>{let J=R.runKernel(Fm,P,G);return te([Y,Z,J]),y&&(J=Q(J,[J.shape[1],J.shape[2],J.shape[3]])),{value:J,gradFunc:D}})(x,h):Xn((Z,Y,te,J)=>{let ae=R.runKernel(Fm,P,G);return J([Y,Z,ae,te]),y&&(ae=Q(ae,[ae.shape[1],ae.shape[2],ae.shape[3]])),{value:ae,gradFunc:D}})(x,h,C)}var gR=_({fusedConv2d_:Rj});function Oj(e,t,r,n,o,s=[1,1],i){let a=e;e.rank===3&&(a=Q(e,[1,e.shape[0],e.shape[1],e.shape[2]]));let u=t;u.rank===3&&(u=Q(t,[1,t.shape[0],t.shape[1],t.shape[2]]));let c={x:a,dy:u},p={strides:n,pad:o,dimRoundingMode:i,dilations:s,filterShape:r};return R.runKernel(ix,c,p)}var xR=_({depthwiseConv2dNativeBackpropFilter_:Oj});function Dj(e,t,r,n,o,s=[1,1],i){let a=t,u=!1;t.rank===3&&(u=!0,a=Q(t,[1,t.shape[0],t.shape[1],t.shape[2]]));let c={dy:a,filter:r},p={strides:n,pad:o,dimRoundingMode:i,dilations:s,inputShape:e},m=R.runKernel(ax,c,p);return u?Q(m,[m.shape[1],m.shape[2],m.shape[3]]):m}var yR=_({depthwiseConv2dNativeBackpropInput_:Dj});function Fj({x:e,filter:t,strides:r,pad:n,dataFormat:o="NHWC",dilations:s=[1,1],dimRoundingMode:i,bias:a,activation:u="linear",preluActivationWeights:c,leakyreluAlpha:p}){if(gl(R.state.gradientDepth,u)===!1){let G=yp(e,t,r,n,o,s,i);return a!=null&&(G=Se(G,a)),dl(G,u,c,p)}let m=E(e,"x","depthwiseConv2d","float32"),h=E(t,"filter","depthwiseConv2d","float32"),x=m,y=!1;m.rank===3&&(y=!0,x=Q(m,[1,m.shape[0],m.shape[1],m.shape[2]])),O(x.rank===4,()=>`Error in fused depthwiseConv2d: input must be rank 4, but got rank ${x.rank}.`),O(h.rank===4,()=>`Error in fused depthwiseConv2d: filter must be rank 4, but got rank ${h.rank}.`),O(x.shape[3]===h.shape[2],()=>`Error in fused depthwiseConv2d: number of input channels (${x.shape[3]}) must match the inChannels dimension in filter ${h.shape[2]}.`),s==null&&(s=[1,1]),O(xn(r,s),()=>`Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides ${r} and dilations '${s}'`),vr("fused depthwiseConv2d",n,i);let v=ol(x.shape,h.shape,r,s,n,i,!0),w;a!=null&&(w=E(a,"bias","fused conv2d"),[w]=Je(w,m),ht(v.outShape,w.shape));let C;c!=null&&(C=E(c,"prelu weights","fused depthwiseConv2d"));let I=(G,q)=>{O(nl(s),()=>`Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '${s}'`);let[Z,Y,te,J]=q,ae=ml(G,te,u),ge=yR(Y.shape,ae,Z,r,n,s,i),ke=xR(Y,ae,Z.shape,r,n,s,i);if(J!=null){let We=hl(w,ae);return[ge,ke,We]}return[ge,ke]},D={x,filter:h,bias:w,preluActivationWeights:C},P={strides:r,pad:n,dataFormat:o,dilations:s,dimRoundingMode:i,activation:u,leakyreluAlpha:p};return a==null?Xn((q,Z,Y)=>{let te=R.runKernel(Pm,D,P);return Y([Z,q,te]),y&&(te=Q(te,[te.shape[1],te.shape[2],te.shape[3]])),{value:te,gradFunc:I}})(x,h):Xn((q,Z,Y,te)=>{let J=R.runKernel(Pm,D,P);return te([Z,q,J,Y]),y&&(J=Q(J,[J.shape[1],J.shape[2],J.shape[3]])),{value:J,gradFunc:I}})(x,h,w)}var bR=_({fusedDepthwiseConv2d_:Fj});function Pj({a:e,b:t,transposeA:r=!1,transposeB:n=!1,bias:o,activation:s="linear",preluActivationWeights:i,leakyreluAlpha:a=.2}){if(gl(R.state.gradientDepth,s)===!1){let ae=xt(e,t,r,n);return o!=null&&(ae=Se(ae,o)),dl(ae,s,i,a)}let u=E(e,"a","fused matMul"),c=E(t,"b","fused matMul");[u,c]=Je(u,c);let p=r?u.shape[u.rank-2]:u.shape[u.rank-1],m=n?c.shape[c.rank-1]:c.shape[c.rank-2],h=r?u.shape[u.rank-1]:u.shape[u.rank-2],x=n?c.shape[c.rank-2]:c.shape[c.rank-1],y=u.shape.slice(0,-2),v=c.shape.slice(0,-2),w=rt(y),C=rt(v);O(p===m,()=>`Error in fused matMul: inner shapes (${p}) and (${m}) of Tensors with shapes ${u.shape} and ${c.shape} and transposeA=${r} and transposeB=${n} must match.`);let D=ht(u.shape.slice(0,-2),c.shape.slice(0,-2)).concat([h,x]),P=r?Q(u,[w,p,h]):Q(u,[w,h,p]),G=n?Q(c,[C,x,m]):Q(c,[C,m,x]),q;o!=null&&(q=E(o,"bias","fused matMul"),[q]=Je(q,u),ht(D,q.shape));let Z;i!=null&&(Z=E(i,"prelu weights","fused matMul"));let Y=(ae,ge)=>{let[ke,We,Re,ct]=ge,oe=ml(Q(ae,Re.shape),Re,s),fe,se;if(!r&&!n?(fe=xt(oe,We,!1,!0),se=xt(ke,oe,!0,!1)):!r&&n?(fe=xt(oe,We,!1,!1),se=xt(oe,ke,!0,!1)):r&&!n?(fe=xt(We,oe,!1,!0),se=xt(ke,oe,!1,!1)):(fe=xt(We,oe,!0,!0),se=xt(oe,ke,!0,!0)),o!=null){let we=hl(ct,oe);return[fe,se,we]}else return[fe,se]},te={a:P,b:G,bias:q,preluActivationWeights:Z},J={transposeA:r,transposeB:n,activation:s,leakyreluAlpha:a};return o==null?Xn((ge,ke,We)=>{let Re=R.runKernel(Dm,te,J);return We([ge,ke,Re]),{value:Q(Re,D),gradFunc:Y}})(P,G):Xn((ge,ke,We,Re)=>{let ct=R.runKernel(Dm,te,J);return Re([ge,ke,ct,We]),{value:Q(ct,D),gradFunc:Y}})(P,G,q)}var vR=_({fusedMatMul_:Pj});function Lj(e){return Xm(e,.54,.46)}var wR=_({hammingWindow_:Lj});function Bj(e){return Xm(e,.5,.5)}var W0=_({hannWindow_:Bj});function Mj(e,t,r,n=!1,o=0){let s=0,i=[];for(;s+t<=e.size;)i.push(Ve(e,s,t)),s+=r;if(n)for(;s<e.size;){let a=s+t-e.size,u=Rt([Ve(e,s,t-a),vi([a],o)]);i.push(u),s+=r}return i.length===0?Us([],[0,t]):Q(Rt(i),[i.length,t])}var z0=_({frame_:Mj});function Uj(e,t,r,n,o=W0){n==null&&(n=tS(t));let s=z0(e,t,r),i=ce(s,o(t));return Tp(i,n)}var TR=_({stft_:Uj});function Vj(e,t,r,n,o="bilinear",s=0){let i=E(e,"image","cropAndResize"),a=E(t,"boxes","cropAndResize","float32"),u=E(r,"boxInd","cropAndResize","int32"),c=a.shape[0];O(i.rank===4,()=>`Error in cropAndResize: image must be rank 4,but got rank ${i.rank}.`),O(a.rank===2&&a.shape[1]===4,()=>`Error in cropAndResize: boxes must be have size [${c},4] but had shape ${a.shape}.`),O(u.rank===1&&u.shape[0]===c,()=>`Error in cropAndResize: boxInd must be have size [${c}] but had shape ${a.shape}.`),O(n.length===2,()=>`Error in cropAndResize: cropSize must be of length 2, but got length ${n.length}.`),O(n[0]>=1&&n[1]>=1,()=>`cropSize must be atleast [1,1], but was ${n}`),O(o==="bilinear"||o==="nearest",()=>`method must be bilinear or nearest, but was ${o}`);let p={image:i,boxes:a,boxInd:u},m={method:o,extrapolationValue:s,cropSize:n};return R.runKernel(rx,p,m)}var SR=_({cropAndResize_:Vj});function Gj(e){let t=E(e,"image","flipLeftRight","float32");O(t.rank===4,()=>`Error in flipLeftRight: image must be rank 4,but got rank ${t.rank}.`);let r={image:t};return R.runKernel(xx,r,{})}var CR=_({flipLeftRight_:Gj});function Wj(e){let t=E(e,"image","grayscaleToRGB"),r=t.rank-1,n=t.shape[r];O(t.rank>=2,()=>`Error in grayscaleToRGB: images must be at least rank 2, but got rank ${t.rank}.`),O(n===1,()=>`Error in grayscaleToRGB: last dimension of a grayscale image should be size 1, but got size ${n}.`);let o=new Array(t.rank);return o.fill(1,0,r),o[r]=3,Ja(t,o)}var ER=_({grayscaleToRGB_:Wj});function zj(e){let t=E(e,"image","RGBToGrayscale"),r=t.rank-1,n=t.shape[r];O(t.rank>=2,()=>`Error in RGBToGrayscale: images must be at least rank 2, but got rank ${t.rank}.`),O(n===3,()=>`Error in RGBToGrayscale: last dimension of an RGB image should be size 3, but got size ${n}.`);let o=t.dtype,s=it(t,"float32"),i=ar([.2989,.587,.114]),a;switch(t.rank){case 2:a=Qa("ij,j->i",s,i);break;case 3:a=Qa("ijk,k->ij",s,i);break;case 4:a=Qa("ijkl,l->ijk",s,i);break;case 5:a=Qa("ijklm,m->ijkl",s,i);break;case 6:a=Qa("ijklmn,n->ijklm",s,i);break;default:throw new Error("Not a valid tensor rank.")}return a=vo(a,-1),it(a,o)}var NR=_({rgbToGrayscale_:zj});function Hj(e,t,r=0,n=.5){let o=E(e,"image","rotateWithOffset","float32");O(o.rank===4,()=>`Error in rotateWithOffset: image must be rank 4,but got rank ${o.rank}.`);let s={image:o},i={radians:t,fillValue:r,center:n};return R.runKernel(U1,s,i)}var _R=_({rotateWithOffset_:Hj});function bs(e,t,r,n,o,s){n==null&&(n=.5),o==null&&(o=Number.NEGATIVE_INFINITY),s==null&&(s=0);let i=e.shape[0];return r=Math.min(r,i),O(0<=n&&n<=1,()=>`iouThreshold must be in [0, 1], but was '${n}'`),O(e.rank===2,()=>`boxes must be a 2D tensor, but was of rank '${e.rank}'`),O(e.shape[1]===4,()=>`boxes must have 4 columns, but 2nd dimension was ${e.shape[1]}`),O(t.rank===1,()=>"scores must be a 1D tensor"),O(t.shape[0]===i,()=>`scores has incompatible shape with boxes. Expected ${i}, but was ${t.shape[0]}`),O(0<=s&&s<=1,()=>`softNmsSigma must be in [0, 1], but was '${s}'`),{maxOutputSize:r,iouThreshold:n,scoreThreshold:o,softNmsSigma:s}}function Kj(e,t,r,n=.5,o=Number.NEGATIVE_INFINITY){let s=E(e,"boxes","nonMaxSuppression","float32"),i=E(t,"scores","nonMaxSuppression","float32"),a=bs(s,i,r,n,o);r=a.maxOutputSize,n=a.iouThreshold,o=a.scoreThreshold;let u={maxOutputSize:r,iouThreshold:n,scoreThreshold:o};return R.runKernel(Gx,{boxes:s,scores:i},u)}var IR=_({nonMaxSuppression_:Kj});function AR(e,t,r){let n=qj(e,t,r),o=n<0?-(n+1):n;e.splice(o,0,t)}function qj(e,t,r){return Xj(e,t,r||jj)}function jj(e,t){return e>t?1:e<t?-1:0}function Xj(e,t,r){let n=0,o=e.length,s=0,i=!1;for(;n<o;){s=n+(o-n>>>1);let a=r(t,e[s]);a>0?n=s+1:(o=s,i=!a)}return i?n:-n-1}function H0(e,t,r,n,o){return nS(e,t,r,n,o,0)}function K0(e,t,r,n,o,s){return nS(e,t,r,n,o,0,!1,s,!0)}function q0(e,t,r,n,o,s){return nS(e,t,r,n,o,s,!0)}function nS(e,t,r,n,o,s,i=!1,a=!1,u=!1){let c=[];for(let w=0;w<t.length;w++)t[w]>o&&c.push({score:t[w],boxIndex:w,suppressBeginIndex:0});c.sort(kR);let p=s>0?-.5/s:0,m=[],h=[];for(;m.length<r&&c.length>0;){let w=c.pop(),{score:C,boxIndex:I,suppressBeginIndex:D}=w;if(C<o)break;let P=!1;for(let G=m.length-1;G>=D;--G){let q=Yj(e,I,m[G]);if(q>=n){P=!0;break}if(w.score=w.score*Zj(n,p,q),w.score<=o)break}w.suppressBeginIndex=m.length,P||(w.score===C?(m.push(I),h.push(w.score)):w.score>o&&AR(c,w,kR))}let x=m.length,y=r-x;a&&y>0&&(m.push(...new Array(y).fill(0)),h.push(...new Array(y).fill(0)));let v={selectedIndices:m};return i&&(v.selectedScores=h),u&&(v.validOutputs=x),v}function Yj(e,t,r){let n=e.subarray(t*4,t*4+4),o=e.subarray(r*4,r*4+4),s=Math.min(n[0],n[2]),i=Math.min(n[1],n[3]),a=Math.max(n[0],n[2]),u=Math.max(n[1],n[3]),c=Math.min(o[0],o[2]),p=Math.min(o[1],o[3]),m=Math.max(o[0],o[2]),h=Math.max(o[1],o[3]),x=(a-s)*(u-i),y=(m-c)*(h-p);if(x<=0||y<=0)return 0;let v=Math.max(s,c),w=Math.max(i,p),C=Math.min(a,m),I=Math.min(u,h),D=Math.max(C-v,0)*Math.max(I-w,0);return D/(x+y-D)}function Zj(e,t,r){let n=Math.exp(t*r*r);return r<=e?n:0}function kR(e,t){return e.score-t.score||e.score===t.score&&t.boxIndex-e.boxIndex}function Qj(s,i,a){return ne(this,arguments,function*(e,t,r,n=.5,o=Number.NEGATIVE_INFINITY){let u=E(e,"boxes","nonMaxSuppressionAsync"),c=E(t,"scores","nonMaxSuppressionAsync"),p=bs(u,c,r,n,o);r=p.maxOutputSize,n=p.iouThreshold,o=p.scoreThreshold;let m=yield Promise.all([u.data(),c.data()]),h=m[0],x=m[1],{selectedIndices:y}=H0(h,x,r,n,o);return u!==e&&u.dispose(),c!==t&&c.dispose(),ar(y,"int32")})}var $R=Qj;function Jj(e,t,r,n=.5,o=Number.NEGATIVE_INFINITY,s=0){let i=E(e,"boxes","nonMaxSuppression"),a=E(t,"scores","nonMaxSuppression"),u=bs(i,a,r,n,o,s);r=u.maxOutputSize,n=u.iouThreshold,o=u.scoreThreshold,s=u.softNmsSigma;let c={boxes:i,scores:a},p={maxOutputSize:r,iouThreshold:n,scoreThreshold:o,softNmsSigma:s},m=R.runKernel(zx,c,p);return{selectedIndices:m[0],selectedScores:m[1]}}var RR=_({nonMaxSuppressionWithScore_:Jj});function eX(i,a,u){return ne(this,arguments,function*(e,t,r,n=.5,o=Number.NEGATIVE_INFINITY,s=0){let c=E(e,"boxes","nonMaxSuppressionAsync"),p=E(t,"scores","nonMaxSuppressionAsync"),m=bs(c,p,r,n,o,s);r=m.maxOutputSize,n=m.iouThreshold,o=m.scoreThreshold,s=m.softNmsSigma;let h=yield Promise.all([c.data(),p.data()]),x=h[0],y=h[1],{selectedIndices:v,selectedScores:w}=q0(x,y,r,n,o,s);return c!==e&&c.dispose(),p!==t&&p.dispose(),{selectedIndices:ar(v,"int32"),selectedScores:ar(w)}})}var OR=eX;function tX(e,t,r,n=.5,o=Number.NEGATIVE_INFINITY,s=!1){let i=E(e,"boxes","nonMaxSuppression"),a=E(t,"scores","nonMaxSuppression"),u=bs(i,a,r,n,o,null),c=u.maxOutputSize,p=u.iouThreshold,m=u.scoreThreshold,h={boxes:i,scores:a},x={maxOutputSize:c,iouThreshold:p,scoreThreshold:m,padToMaxOutputSize:s},y=R.runKernel(Wx,h,x);return{selectedIndices:y[0],validOutputs:y[1]}}var DR=_({nonMaxSuppressionPadded_:tX});function rX(i,a,u){return ne(this,arguments,function*(e,t,r,n=.5,o=Number.NEGATIVE_INFINITY,s=!1){let c=E(e,"boxes","nonMaxSuppressionAsync"),p=E(t,"scores","nonMaxSuppressionAsync"),m=bs(c,p,r,n,o,null),h=m.maxOutputSize,x=m.iouThreshold,y=m.scoreThreshold,[v,w]=yield Promise.all([c.data(),p.data()]),{selectedIndices:C,validOutputs:I}=K0(v,w,h,x,y,s);return c!==e&&c.dispose(),p!==t&&p.dispose(),{selectedIndices:ar(C,"int32"),validOutputs:Be(I,"int32")}})}var FR=rX;function nX(e,t,r=!1,n=!1){let o=E(e,"images","resizeBilinear");O(o.rank===3||o.rank===4,()=>`Error in resizeBilinear: x must be rank 3 or 4, but got rank ${o.rank}.`),O(t.length===2,()=>`Error in resizeBilinear: new shape must 2D, but got shape ${t}.`),O(n===!1||r===!1,()=>"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false.");let s=o,i=!1;o.rank===3&&(i=!0,s=Q(o,[1,o.shape[0],o.shape[1],o.shape[2]]));let[]=t,a={images:s},u={alignCorners:r,halfPixelCenters:n,size:t},c=R.runKernel(s1,a,u);return i?Q(c,[c.shape[1],c.shape[2],c.shape[3]]):c}var PR=_({resizeBilinear_:nX});function oX(e,t,r=!1,n=!1){let o=E(e,"images","resizeNearestNeighbor");O(o.rank===3||o.rank===4,()=>`Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank ${o.rank}.`),O(t.length===2,()=>`Error in resizeNearestNeighbor: new shape must 2D, but got shape ${t}.`),O(o.dtype==="float32"||o.dtype==="int32",()=>"`images` must have `int32` or `float32` as dtype"),O(n===!1||r===!1,()=>"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false.");let s=o,i=!1;o.rank===3&&(i=!0,s=Q(o,[1,o.shape[0],o.shape[1],o.shape[2]]));let[]=t,a={images:s},u={alignCorners:r,halfPixelCenters:n,size:t},c=R.runKernel(o1,a,u);return i?Q(c,[c.shape[1],c.shape[2],c.shape[3]]):c}var LR=_({resizeNearestNeighbor_:oX});function sX(e,t="binary",r=!1,n=.5){let o=E(e,"image","threshold"),s=.2989,i=.587,a=.114,u=o.shape[0]*o.shape[1],c=ce(ar([n]),255),p,m,h,x;if(O(o.rank===3,()=>`Error in threshold: image must be rank 3,but got rank ${o.rank}.`),O(o.shape[2]===3||o.shape[2]===1,()=>`Error in threshold: image color channel must be equal to 3 or 1but got ${o.shape[2]}.`),O(o.dtype==="int32"||o.dtype==="float32",()=>`Error in dtype: image dtype must be int32 or float32,but got dtype ${o.dtype}.`),O(t==="otsu"||t==="binary",()=>`Method must be binary or otsu, but was ${t}`),o.shape[2]===3){[p,m,h]=na(o,[1,1,1],-1);let w=ce(p,s),C=ce(m,i),I=ce(h,a);x=Se(Se(w,C),I)}else x=e;if(t==="otsu"){let w=a0(it(F0(x),"int32"),An([]),256);c=iX(w,u)}let y=r?bp(x,c):il(x,c);return it(ce(y,255),"int32")}function iX(e,t){let r=ar([-1]),n=ar([0]),o=ar([0]),s,i,a,u,c,p;for(let m=0;m<e.size-1;m++){s=Ve(e,0,m+1),i=Ve(e,m+1),c=ze(yt(s),t),p=ze(yt(i),t);let h=yt(ce(s,tu(0,s.size)));a=ze(h,yt(s));let x=vi(i.shape,s.size),y=Se(tu(0,i.size),x),v=ce(i,y);u=ze(yt(v),yt(i));let w=Fe(a,u),C=Fe(a,u),I=ce(c,p);o=ce(ce(I,w),C);let D=il(o,n);n=Ho(D,o,n),r=Ho(D,ar([m]),r)}return r}var BR=_({threshold_:sX});function aX(e,t,r="nearest",n="constant",o=0,s){let i=E(e,"image","transform","float32"),a=E(t,"transforms","transform","float32");O(i.rank===4,()=>`Error in transform: image must be rank 4,but got rank ${i.rank}.`),O(a.rank===2&&(a.shape[0]===i.shape[0]||a.shape[0]===1)&&a.shape[1]===8,()=>"Error in transform: Input transform should be batch x 8 or 1 x 8"),O(s==null||s.length===2,()=>`Error in transform: outputShape must be [height, width] or null, but got ${s}.`);let u={image:i,transforms:a},c={interpolation:r,fillMode:n,fillValue:o,outputShape:s};return R.runKernel(D1,u,c)}var MR=_({transform_:aX});function uX(e,t,r){let n=E(e,"a","bandPart");O(n.rank>=2,()=>`bandPart(): Rank must be at least 2, got ${n.rank}.`);let o=n.shape,[s,i]=n.shape.slice(-2),a,u;typeof t=="number"?(O(t%1===0,()=>`bandPart(): numLower must be an integer, got ${t}.`),O(t<=s,()=>`bandPart(): numLower (${t}) must not be greater than the number of rows (${s}).`),a=E(t<0?s:t,"numLower","bandPart")):(O(t.dtype==="int32",()=>"bandPart(): numLower's dtype must be an int32."),a=Ho(Km(t,0),s,ll(t,s))),typeof r=="number"?(O(r%1===0,()=>`bandPart(): numUpper must be an integer, got ${r}.`),O(r<=i,()=>`bandPart(): numUpper (${r}) must not be greater than the number of columns (${i}).`),u=E(r<0?i:r,"numUpper","bandPart")):(O(r.dtype==="int32",()=>"bandPart(): numUpper's dtype must be an int32."),u=Ho(Km(r,0),i,ll(r,i)));let c=Q(tu(0,s,1,"int32"),[-1,1]),p=tu(0,i,1,"int32"),m=Fe(c,p),h=al(bp(m,a),g0(m,on(u))),x=ys([s,i],n.dtype);return Q(kn(qo(Q(n,[-1,s,i])).map(y=>Ho(h,y,x))),o)}var UR=_({bandPart_:uX});function lX(e){let t;if(Array.isArray(e)){t=!1,O(e!=null&&e.length>0,()=>"Gram-Schmidt process: input must not be null, undefined, or empty");let o=e[0].shape[0];for(let s=1;s<e.length;++s)O(e[s].shape[0]===o,()=>`Gram-Schmidt: Non-unique lengths found in the input vectors: (${e[s].shape[0]} vs. ${o})`)}else t=!0,e=na(e,e.shape[0],0).map(o=>_r(o,[0]));O(e.length<=e[0].shape[0],()=>`Gram-Schmidt: Number of vectors (${e.length}) exceeds number of dimensions (${e[0].shape[0]}).`);let r=[],n=e;for(let o=0;o<e.length;++o)r.push(R.tidy(()=>{let s=n[o];if(o>0)for(let i=0;i<o;++i){let a=ce(yt(ce(r[i],s)),r[i]);s=Fe(s,a)}return ze(s,sl(s,"euclidean"))}));return t?kn(r,0):r}var VR=_({gramSchmidt_:lX});function cX(e,t=!1){if(O(e.rank>=2,()=>`qr() requires input tensor to have a rank >= 2, but got rank ${e.rank}`),e.rank===2)return GR(e,t);{let r=e.shape.slice(0,e.shape.length-2).reduce((u,c)=>u*c),n=qo(Q(e,[r,e.shape[e.shape.length-2],e.shape[e.shape.length-1]]),0),o=[],s=[];n.forEach(u=>{let[c,p]=GR(u,t);o.push(c),s.push(p)});let i=Q(kn(o,0),e.shape),a=Q(kn(s,0),e.shape);return[i,a]}}function GR(e,t=!1){return R.tidy(()=>{O(e.shape.length===2,()=>`qr2d() requires a 2D Tensor, but got a ${e.shape.length}D Tensor.`);let r=e.shape[0],n=e.shape[1],o=m0(r),s=bo(e),i=Us([[1]],[1,1]),a=bo(i),u=r>=n?n:r;for(let c=0;c<u;++c){let p=s,m=a,h=o;[a,s,o]=R.tidy(()=>{let x=Ve(s,[c,c],[r-c,1]),y=sl(x),v=Ve(s,[c,c],[1,1]),w=Ho(il(v,0),Us([[-1]]),Us([[1]])),C=Fe(v,ce(w,y)),I=ze(x,C);I.shape[0]===1?a=bo(i):a=Rt([i,Ve(I,[1,0],[I.shape[0]-1,I.shape[1]])],0);let D=on(ze(xt(w,C),y)),P=Ve(s,[c,0],[r-c,n]),G=ce(D,a),q=G0(a);if(c===0)s=Fe(P,xt(G,xt(q,P)));else{let te=Fe(P,xt(G,xt(q,P)));s=Rt([Ve(s,[0,0],[c,n]),te],0)}let Z=G0(G),Y=Ve(o,[0,c],[r,o.shape[1]-c]);if(c===0)o=Fe(Y,xt(xt(Y,a),Z));else{let te=Fe(Y,xt(xt(Y,a),Z));o=Rt([Ve(o,[0,0],[r,c]),te],1)}return[a,s,o]}),St([p,m,h])}return!t&&r>n&&(o=Ve(o,[0,0],[r,n]),s=Ve(s,[0,0],[n,n])),[o,s]})}var WR=_({qr_:cX});var wr=function(e){return e[e.NONE=0]="NONE",e[e.MEAN=1]="MEAN",e[e.SUM=2]="SUM",e[e.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS",e}(wr||{});function pX(e,t,r=wr.SUM_BY_NONZERO_WEIGHTS){let n=E(e,"losses","computeWeightedLoss"),o=null;t!=null&&(o=E(t,"weights","computeWeightedLoss"));let s=o==null?n:ce(n,o);if(r===wr.NONE)return s;if(r===wr.SUM)return yt(s);if(r===wr.MEAN){if(o==null)return ul(s);{let i=n.size/o.size,a=ze(yt(s),yt(o));return i>1?ze(a,Be(i)):a}}if(r===wr.SUM_BY_NONZERO_WEIGHTS){if(o==null)return ze(yt(s),Be(n.size));{let i=ce(o,Ti(n.shape)),a=it(yt(N0(i,Be(0))),"float32");return ze(yt(s),a)}}throw Error(`Unknown reduction: ${r}`)}var sn=_({computeWeightedLoss_:pX});function fX(e,t,r,n=wr.SUM_BY_NONZERO_WEIGHTS){let o=E(e,"labels","absoluteDifference"),s=E(t,"predictions","absoluteDifference"),i=null;r!=null&&(i=E(r,"weights","absoluteDifference")),ir(o.shape,s.shape,"Error in absoluteDifference: ");let a=Yr(Fe(o,s));return sn(a,i,n)}var zR=_({absoluteDifference_:fX});function mX(e,t,r,n,o=wr.SUM_BY_NONZERO_WEIGHTS){let s=E(e,"labels","cosineDistance"),i=E(t,"predictions","cosineDistance"),a=null;n!=null&&(a=E(n,"weights","cosineDistance")),ir(s.shape,i.shape,"Error in cosineDistance: ");let u=Be(1),c=Fe(u,yt(ce(s,i),r,!0));return sn(c,a,o)}var HR=_({cosineDistance_:mX});function hX(e,t,r,n=wr.SUM_BY_NONZERO_WEIGHTS){let o=E(e,"labels","hingeLoss"),s=E(t,"predictions","hingeLoss"),i=null;r!=null&&(i=E(r,"weights","hingeLoss")),ir(o.shape,s.shape,"Error in hingeLoss: ");let a=Be(1);o=Fe(ce(Be(2),o),a);let u=ru(Fe(a,ce(o,s)));return sn(u,i,n)}var KR=_({hingeLoss_:hX});function dX(e,t,r,n=1,o=wr.SUM_BY_NONZERO_WEIGHTS){let s=E(e,"labels","huberLoss"),i=E(t,"predictions","huberLoss"),a=null;r!=null&&(a=E(r,"weights","huberLoss")),ir(s.shape,i.shape,"Error in huberLoss: ");let u=Be(n),c=Yr(Fe(i,s)),p=ll(c,u),m=Fe(c,p),h=Se(ce(Be(.5),Zr(p)),ce(u,m));return sn(h,a,o)}var qR=_({huberLoss_:dX});function gX(e,t,r,n=1e-7,o=wr.SUM_BY_NONZERO_WEIGHTS){let s=E(e,"labels","logLoss"),i=E(t,"predictions","logLoss"),a=null;r!=null&&(a=E(r,"weights","logLoss")),ir(s.shape,i.shape,"Error in logLoss: ");let u=Be(1),c=Be(n),p=on(ce(s,ta(Se(i,c)))),m=ce(Fe(u,s),ta(Se(Fe(u,i),c))),h=Fe(p,m);return sn(h,a,o)}var jR=_({logLoss_:gX});function xX(e,t,r,n=wr.SUM_BY_NONZERO_WEIGHTS){let o=E(e,"labels","meanSquaredError"),s=E(t,"predictions","meanSquaredError"),i=null;r!=null&&(i=E(r,"weights","meanSquaredError")),ir(o.shape,s.shape,"Error in meanSquaredError: ");let a=L0(o,s);return sn(a,i,n)}var XR=_({meanSquaredError_:xX});function yX(e,t){let r=E(e,"labels","sigmoidCrossEntropyWithLogits"),n=E(t,"logits","sigmoidCrossEntropyWithLogits");ir(r.shape,n.shape,"Error in sigmoidCrossEntropyWithLogits: ");let o=ru(n),s=ce(n,r),i=y0(jn(on(Yr(n))));return Se(Fe(o,s),i)}function bX(e,t,r,n=0,o=wr.SUM_BY_NONZERO_WEIGHTS){let s=E(e,"multiClassLabels","sigmoidCrossEntropy"),i=E(t,"logits","sigmoidCrossEntropy"),a=null;if(r!=null&&(a=E(r,"weights","sigmoidCrossEntropy")),ir(s.shape,i.shape,"Error in sigmoidCrossEntropy: "),n>0){let c=Be(n),p=Be(1),m=Be(.5);s=Se(ce(s,Fe(p,c)),ce(m,c))}let u=yX(s,i);return sn(u,a,o)}var YR=_({sigmoidCrossEntropy_:bX});function vX(e,t,r=-1){if(r===-1&&(r=t.rank-1),r!==t.rank-1)throw Error(`Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank ${t.rank} and dim was ${r}`);return Xn((o,s,i)=>{let u=v0(s,[r],!0),c=Fe(it(s,"float32"),u);i([o,c]);let p=on(ce(c,o));return{value:yt(p,[r]),gradFunc:(x,y)=>{let[v,w]=y,C=Ji(x.shape,[r]);return[ce(Q(x,C),Fe(it(v,"float32"),jn(w))),ce(Q(x,C),Fe(jn(w),it(v,"float32")))]}}})(e,t)}function wX(e,t,r,n=0,o=wr.SUM_BY_NONZERO_WEIGHTS){let s=E(e,"onehotLabels","softmaxCrossEntropy"),i=E(t,"logits","softmaxCrossEntropy"),a=null;if(r!=null&&(a=E(r,"weights","softmaxCrossEntropy")),ir(s.shape,i.shape,"Error in softmaxCrossEntropy: "),n>0){let c=Be(n),p=Be(1),m=Be(s.shape[1]);s=Se(ce(s,Fe(p,c)),ze(c,m))}let u=vX(s,i);return sn(u,a,o)}var ZR=_({softmaxCrossEntropy_:wX});function TX(e,t,r,n){let o=E(e,"indices","sparseFillEmptyRows","int32"),s=E(t,"values","sparseFillEmptyRows"),i=E(r,"denseShape","sparseFillEmptyRows","int32"),a=E(n,"defaultValue","sparseFillEmptyRows",s.dtype);if(o.rank!==2)throw new Error(`Indices should be Tensor2D but received shape
        ${o.shape}`);if(s.rank!==1)throw new Error(`Values should be Tensor1D but received shape ${s.shape}`);if(i.rank!==1)throw new Error(`Dense shape should be Tensor1D but received shape ${i.shape}`);if(a.rank!==0)throw new Error(`Default value should be a scalar but received shape ${a.shape}`);let u={indices:o,values:s,denseShape:i,defaultValue:a},c=R.runKernel(T1,u);return{outputIndices:c[0],outputValues:c[1],emptyRowIndicator:c[2],reverseIndexMap:c[3]}}var QR=_({sparseFillEmptyRows_:TX});function SX(e,t,r){let n=E(e,"inputIndices","sparseReshape","int32"),o=E(t,"inputShape","sparseReshape","int32"),s=E(r,"newShape","sparseReshape","int32");if(n.rank!==2)throw new Error(`Input indices should be Tensor2D but received shape
        ${n.shape}`);if(o.rank!==1)throw new Error(`Input shape should be Tensor1D but received shape ${o.shape}`);if(s.rank!==1)throw new Error(`New shape should be Tensor1D but received shape ${s.shape}`);let i={inputIndices:n,inputShape:o,newShape:s},a=R.runKernel(S1,i);return{outputIndices:a[0],outputShape:a[1]}}var JR=_({sparseReshape_:SX});function CX(e,t,r){let n=E(e,"data","sparseSegmentMean"),o=E(t,"indices","sparseSegmentMean","int32"),s=E(r,"segmentIds","sparseSegmentMean","int32");if(n.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(o.rank!==1)throw new Error(`Indices should be Tensor1D but received shape
          ${o.shape}`);if(s.rank!==1)throw new Error(`Segment ids should be Tensor1D but received shape
          ${s.shape}`);let i={data:n,indices:o,segmentIds:s};return R.runKernel(C1,i)}var eO=_({sparseSegmentMean_:CX});function EX(e,t,r){let n=E(e,"data","sparseSegmentSum"),o=E(t,"indices","sparseSegmentSum","int32"),s=E(r,"segmentIds","sparseSegmentSum","int32");if(n.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(o.rank!==1)throw new Error(`Indices should be Tensor1D but received shape
         ${o.shape}`);if(s.rank!==1)throw new Error(`Segment ids should be Tensor1D but received shape
         ${s.shape}`);let i={data:n,indices:o,segmentIds:s};return R.runKernel(E1,i)}var tO=_({sparseSegmentSum_:EX});function NX(e,t,r,n,o,s,i,a){let u=E(e,"data","stringNGrams","string");if(u.dtype!=="string")throw new Error("Data must be of datatype string");if(u.shape.length!==1)throw new Error(`Data must be a vector, saw: ${u.shape}`);let c=E(t,"dataSplits","stringNGrams");if(c.dtype!=="int32")throw new Error("Data splits must be of datatype int32");let p={separator:r,nGramWidths:n,leftPad:o,rightPad:s,padWidth:i,preserveShortSequences:a},m={data:u,dataSplits:c},h=R.runKernel(I1,m,p);return{nGrams:h[0],nGramsSplits:h[1]}}var rO=_({stringNGrams_:NX});function _X(e,t,r=!0){let n=E(e,"input","stringSplit","string"),o=E(t,"delimiter","stringSplit","string");if(n.rank!==1)throw new Error(`Input should be Tensor1D but received shape ${n.shape}`);if(o.rank!==0)throw new Error(`Delimiter should be a scalar but received shape ${o.shape}`);let s={skipEmpty:r},i={input:n,delimiter:o},a=R.runKernel(A1,i,s);return{indices:a[0],values:a[1],shape:a[2]}}var nO=_({stringSplit_:_X});function IX(e,t){let r=E(e,"input","stringToHashBucketFast","string"),n={numBuckets:t};if(t<=0)throw new Error("Number of buckets must be at least 1");let o={input:r};return R.runKernel(k1,o,n)}var oO=_({stringToHashBucketFast_:IX});function AX(e,t,r,n=!0){let o=E(e,"input","staticRegexReplace","string"),s={pattern:t,rewrite:r,replaceGlobal:n};return R.runKernel(rp,{x:o},s)}var sO=_({staticRegexReplace_:AX});var kX={fft:wp,ifft:fl,rfft:Tp,irfft:P0},$X={hammingWindow:wR,hannWindow:W0,frame:z0,stft:TR},Ym={flipLeftRight:CR,grayscaleToRGB:ER,resizeNearestNeighbor:LR,resizeBilinear:PR,rgbToGrayscale:NR,rotateWithOffset:_R,cropAndResize:SR,nonMaxSuppression:IR,nonMaxSuppressionAsync:$R,nonMaxSuppressionWithScore:RR,nonMaxSuppressionWithScoreAsync:OR,nonMaxSuppressionPadded:DR,nonMaxSuppressionPaddedAsync:FR,threshold:BR,transform:MR},RX={bandPart:UR,gramSchmidt:VR,qr:WR},OX={absoluteDifference:zR,computeWeightedLoss:sn,cosineDistance:HR,hingeLoss:KR,huberLoss:qR,logLoss:jR,meanSquaredError:XR,sigmoidCrossEntropy:YR,softmaxCrossEntropy:ZR},DX={sparseFillEmptyRows:QR,sparseReshape:JR,sparseSegmentMean:eO,sparseSegmentSum:tO},FX={stringNGrams:rO,stringSplit:nO,stringToHashBucketFast:oO,staticRegexReplace:sO};var PX=new Map,LX=new Map,j0=class{getClassName(){return this.constructor.className}static fromConfig(t,r){return new t(r)}},oS=class e{constructor(){this.classNameMap={}}static getMap(){return e.instance==null&&(e.instance=new e),e.instance}static register(t){e.getMap().classNameMap[t.className]=[t,t.fromConfig]}};function iO(e,t,r){O(e.className!=null,()=>"Class being registered does not have the static className property defined."),O(typeof e.className=="string",()=>"className is required to be a string, but got type "+typeof e.className),O(e.className.length>0,()=>"Class being registered has an empty-string as its className, which is disallowed."),typeof t>"u"&&(t="Custom"),typeof r>"u"&&(r=e.className);let n=r,o=t+">"+n;return oS.register(e),PX.set(o,e),LX.set(e,o),e}var Yn=class extends j0{minimize(t,r=!1,n){let{value:o,grads:s}=this.computeGradients(t,n);if(n!=null){let i=n.map(a=>({name:a.name,tensor:s[a.name]}));this.applyGradients(i)}else this.applyGradients(s);return St(s),r?o:(o.dispose(),null)}get iterations(){return this.iterations_==null&&(this.iterations_=0),this.iterations_}incrementIterations(){this.iterations_=this.iterations+1}computeGradients(t,r){return zk(t,r)}dispose(){this.iterations_!=null&&St(this.iterations_)}saveIterations(){return ne(this,null,function*(){return this.iterations_==null&&(this.iterations_=0),{name:"iter",tensor:Be(this.iterations_,"int32")}})}getWeights(){return ne(this,null,function*(){throw new Error("getWeights() is not implemented for this optimizer yet.")})}setWeights(t){return ne(this,null,function*(){throw new Error(`setWeights() is not implemented for this optimizer class ${this.getClassName()}`)})}extractIterations(t){return ne(this,null,function*(){return this.iterations_=(yield t[0].tensor.data())[0],t.slice(1)})}};Object.defineProperty(Yn,Symbol.hasInstance,{value:e=>e.minimize!=null&&e.computeGradients!=null&&e.applyGradients!=null});var X0=class extends Yn{static get className(){return"Adadelta"}constructor(t,r,n=null){super(),this.learningRate=t,this.rho=r,this.epsilon=n,this.accumulatedGrads=[],this.accumulatedUpdates=[],n==null&&(this.epsilon=R.backend.epsilon())}applyGradients(t){(Array.isArray(t)?t.map(n=>n.name):Object.keys(t)).forEach((n,o)=>{let s=R.registeredVariables[n],i=!1;this.accumulatedGrads[o]==null&&(this.accumulatedGrads[o]={originalName:`${n}/accum_grad`,variable:Ue(()=>Pr(s).variable(i))}),this.accumulatedUpdates[o]==null&&(this.accumulatedUpdates[o]={originalName:`${n}/accum_var`,variable:Ue(()=>Pr(s).variable(i))});let a=Array.isArray(t)?t[o].tensor:t[n];if(a==null)return;let u=this.accumulatedGrads[o].variable,c=this.accumulatedUpdates[o].variable;Ue(()=>{let p=Se(ce(u,this.rho),ce(Zr(a),1-this.rho)),m=ce(ze(qn(Se(c,this.epsilon)),qn(Se(u,this.epsilon))),a),h=Se(ce(c,this.rho),ce(Zr(m),1-this.rho));u.assign(p),c.assign(h);let x=Se(ce(m,-this.learningRate),s);s.assign(x)})}),this.incrementIterations()}dispose(){this.accumulatedUpdates!=null&&(St(this.accumulatedGrads.map(t=>t.variable)),St(this.accumulatedUpdates.map(t=>t.variable)))}getWeights(){return ne(this,null,function*(){let t=[...this.accumulatedGrads,...this.accumulatedUpdates];return[yield this.saveIterations()].concat(t.map(r=>({name:r.originalName,tensor:r.variable})))})}setWeights(t){return ne(this,null,function*(){t=yield this.extractIterations(t);let r=t.length/2,n=!1;this.accumulatedGrads=t.slice(0,r).map(o=>({originalName:o.name,variable:o.tensor.variable(n)})),this.accumulatedUpdates=t.slice(r,r*2).map(o=>({originalName:o.name,variable:o.tensor.variable(n)}))})}getConfig(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}}static fromConfig(t,r){return new t(r.learningRate,r.rho,r.epsilon)}};var Y0=class extends Yn{static get className(){return"Adagrad"}constructor(t,r=.1){super(),this.learningRate=t,this.initialAccumulatorValue=r,this.accumulatedGrads=[]}applyGradients(t){(Array.isArray(t)?t.map(n=>n.name):Object.keys(t)).forEach((n,o)=>{let s=R.registeredVariables[n];this.accumulatedGrads[o]==null&&(this.accumulatedGrads[o]={originalName:`${n}/accumulator`,variable:Ue(()=>vi(s.shape,this.initialAccumulatorValue).variable(!1))});let i=Array.isArray(t)?t[o].tensor:t[n];if(i==null)return;let a=this.accumulatedGrads[o].variable;Ue(()=>{let u=Se(a,Zr(i));a.assign(u);let c=Se(ce(ze(i,qn(Se(u,R.backend.epsilon()))),-this.learningRate),s);s.assign(c)})}),this.incrementIterations()}dispose(){this.accumulatedGrads!=null&&St(this.accumulatedGrads.map(t=>t.variable))}getWeights(){return ne(this,null,function*(){return[yield this.saveIterations()].concat(this.accumulatedGrads.map(t=>({name:t.originalName,tensor:t.variable})))})}setWeights(t){return ne(this,null,function*(){t=yield this.extractIterations(t);let r=!1;this.accumulatedGrads=t.map(n=>({originalName:n.name,variable:n.tensor.variable(r)}))})}getConfig(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}}static fromConfig(t,r){return new t(r.learningRate,r.initialAccumulatorValue)}};var Z0=class extends Yn{static get className(){return"Adam"}constructor(t,r,n,o=null){super(),this.learningRate=t,this.beta1=r,this.beta2=n,this.epsilon=o,this.accumulatedFirstMoment=[],this.accumulatedSecondMoment=[],Ue(()=>{this.accBeta1=Be(r).variable(),this.accBeta2=Be(n).variable()}),o==null&&(this.epsilon=R.backend.epsilon())}applyGradients(t){let r=Array.isArray(t)?t.map(n=>n.name):Object.keys(t);Ue(()=>{let n=Fe(1,this.accBeta1),o=Fe(1,this.accBeta2);r.forEach((s,i)=>{let a=R.registeredVariables[s],u=!1;this.accumulatedFirstMoment[i]==null&&(this.accumulatedFirstMoment[i]={originalName:`${s}/m`,variable:Ue(()=>Pr(a).variable(u))}),this.accumulatedSecondMoment[i]==null&&(this.accumulatedSecondMoment[i]={originalName:`${s}/v`,variable:Ue(()=>Pr(a).variable(u))});let c=Array.isArray(t)?t[i].tensor:t[s];if(c==null)return;let p=this.accumulatedFirstMoment[i].variable,m=this.accumulatedSecondMoment[i].variable,h=Se(ce(p,this.beta1),ce(c,1-this.beta1)),x=Se(ce(m,this.beta2),ce(Zr(c),1-this.beta2)),y=ze(h,n),v=ze(x,o);p.assign(h),m.assign(x);let w=Se(ce(ze(y,Se(qn(v),this.epsilon)),-this.learningRate),a);a.assign(w)}),this.accBeta1.assign(ce(this.accBeta1,this.beta1)),this.accBeta2.assign(ce(this.accBeta2,this.beta2))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&St(this.accumulatedFirstMoment.map(t=>t.variable)),this.accumulatedSecondMoment!=null&&St(this.accumulatedSecondMoment.map(t=>t.variable))}getWeights(){return ne(this,null,function*(){let t=[...this.accumulatedFirstMoment,...this.accumulatedSecondMoment];return[yield this.saveIterations()].concat(t.map(r=>({name:r.originalName,tensor:r.variable})))})}setWeights(t){return ne(this,null,function*(){t=yield this.extractIterations(t),Ue(()=>{this.accBeta1.assign(ea(this.beta1,this.iterations_+1)),this.accBeta2.assign(ea(this.beta2,this.iterations_+1))});let r=t.length/2,n=!1;this.accumulatedFirstMoment=t.slice(0,r).map(o=>({originalName:o.name,variable:o.tensor.variable(n)})),this.accumulatedSecondMoment=t.slice(r,r*2).map(o=>({originalName:o.name,variable:o.tensor.variable(n)}))})}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}}static fromConfig(t,r){return new t(r.learningRate,r.beta1,r.beta2,r.epsilon)}};var Q0=class extends Yn{static get className(){return"Adamax"}constructor(t,r,n,o=null,s=0){super(),this.learningRate=t,this.beta1=r,this.beta2=n,this.epsilon=o,this.decay=s,this.accumulatedFirstMoment=[],this.accumulatedWeightedInfNorm=[],Ue(()=>{this.iteration=Be(0).variable(),this.accBeta1=Be(r).variable()}),o==null&&(this.epsilon=R.backend.epsilon())}applyGradients(t){let r=Array.isArray(t)?t.map(n=>n.name):Object.keys(t);Ue(()=>{let n=Fe(1,this.accBeta1),o=ze(-this.learningRate,Se(ce(this.iteration,this.decay),1));r.forEach((s,i)=>{let a=R.registeredVariables[s],u=!1;this.accumulatedFirstMoment[i]==null&&(this.accumulatedFirstMoment[i]={originalName:`${s}/m`,variable:Pr(a).variable(u)}),this.accumulatedWeightedInfNorm[i]==null&&(this.accumulatedWeightedInfNorm[i]={originalName:`${s}/v`,variable:Pr(a).variable(u)});let c=Array.isArray(t)?t[i].tensor:t[s];if(c==null)return;let p=this.accumulatedFirstMoment[i].variable,m=this.accumulatedWeightedInfNorm[i].variable,h=Se(ce(p,this.beta1),ce(c,1-this.beta1)),x=ce(m,this.beta2),y=Yr(c),v=E0(x,y);p.assign(h),m.assign(v);let w=Se(ce(ze(o,n),ze(h,Se(v,this.epsilon))),a);a.assign(w)}),this.iteration.assign(Se(this.iteration,1)),this.accBeta1.assign(ce(this.accBeta1,this.beta1))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&St(this.accumulatedFirstMoment.map(t=>t.variable)),this.accumulatedWeightedInfNorm!=null&&St(this.accumulatedWeightedInfNorm.map(t=>t.variable))}getWeights(){return ne(this,null,function*(){throw new Error("getWeights() is not implemented for Adamax yet.")})}setWeights(t){return ne(this,null,function*(){throw new Error("setWeights() is not implemented for Adamax yet.")})}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}}static fromConfig(t,r){return new t(r.learningRate,r.beta1,r.beta2,r.epsilon,r.decay)}};var Sp=class extends Yn{static get className(){return"SGD"}constructor(t){super(),this.learningRate=t,this.setLearningRate(t)}applyGradients(t){(Array.isArray(t)?t.map(n=>n.name):Object.keys(t)).forEach((n,o)=>{let s=Array.isArray(t)?t[o].tensor:t[n];if(s==null)return;let i=R.registeredVariables[n];Ue(()=>{let a=Se(ce(this.c,s),i);i.assign(a)})}),this.incrementIterations()}setLearningRate(t){this.learningRate=t,this.c!=null&&this.c.dispose(),this.c=Kn(Be(-t))}dispose(){this.c.dispose()}getWeights(){return ne(this,null,function*(){return[yield this.saveIterations()]})}setWeights(t){return ne(this,null,function*(){if(t=yield this.extractIterations(t),t.length!==0)throw new Error("SGD optimizer does not have settable weights.")})}getConfig(){return{learningRate:this.learningRate}}static fromConfig(t,r){return new t(r.learningRate)}};var J0=class extends Sp{static get className(){return"Momentum"}constructor(t,r,n=!1){super(t),this.learningRate=t,this.momentum=r,this.useNesterov=n,this.accumulations=[],this.m=Be(this.momentum)}applyGradients(t){(Array.isArray(t)?t.map(n=>n.name):Object.keys(t)).forEach((n,o)=>{let s=R.registeredVariables[n];this.accumulations[o]==null&&(this.accumulations[o]={originalName:`${n}/momentum`,variable:Ue(()=>Pr(s).variable(!1))});let i=this.accumulations[o].variable,a=Array.isArray(t)?t[o].tensor:t[n];a!=null&&Ue(()=>{let u,c=Se(ce(this.m,i),a);this.useNesterov?u=Se(ce(this.c,Se(a,ce(c,this.m))),s):u=Se(ce(this.c,c),s),i.assign(c),s.assign(u)})}),this.incrementIterations()}dispose(){this.m.dispose(),this.accumulations!=null&&St(this.accumulations.map(t=>t.variable))}setMomentum(t){this.momentum=t}getWeights(){return ne(this,null,function*(){return[yield this.saveIterations()].concat(this.accumulations.map(t=>({name:t.originalName,tensor:t.variable})))})}setWeights(t){return ne(this,null,function*(){t=yield this.extractIterations(t);let r=!1;this.accumulations=t.map(n=>({originalName:n.name,variable:n.tensor.variable(r)}))})}getConfig(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}}static fromConfig(t,r){return new t(r.learningRate,r.momentum,r.useNesterov)}};var ey=class extends Yn{static get className(){return"RMSProp"}constructor(t,r=.9,n=0,o=null,s=!1){if(super(),this.learningRate=t,this.decay=r,this.momentum=n,this.epsilon=o,this.accumulatedMeanSquares=[],this.accumulatedMoments=[],this.accumulatedMeanGrads=[],this.centered=s,o==null&&(this.epsilon=R.backend.epsilon()),t==null)throw new Error("learningRate for RMSPropOptimizer must be defined.")}applyGradients(t){(Array.isArray(t)?t.map(n=>n.name):Object.keys(t)).forEach((n,o)=>{let s=R.registeredVariables[n],i=!1;this.accumulatedMeanSquares[o]==null&&(this.accumulatedMeanSquares[o]={originalName:`${n}/rms`,variable:Ue(()=>Pr(s).variable(i))}),this.accumulatedMoments[o]==null&&(this.accumulatedMoments[o]={originalName:`${n}/momentum`,variable:Ue(()=>Pr(s).variable(i))}),this.accumulatedMeanGrads[o]==null&&this.centered&&(this.accumulatedMeanGrads[o]={originalName:`${n}/mg`,variable:Ue(()=>Pr(s).variable(i))});let a=Array.isArray(t)?t[o].tensor:t[n];if(a==null)return;let u=this.accumulatedMeanSquares[o].variable,c=this.accumulatedMoments[o].variable;Ue(()=>{let p=Se(ce(u,this.decay),ce(Zr(a),1-this.decay));if(this.centered){let m=this.accumulatedMeanGrads[o].variable,h=Se(ce(m,this.decay),ce(a,1-this.decay)),x=ze(ce(a,this.learningRate),qn(Fe(p,Se(Zr(h),this.epsilon)))),y=Se(ce(c,this.momentum),x);u.assign(p),m.assign(h),c.assign(y);let v=Fe(s,y);s.assign(v)}else{let m=Se(ce(u,this.decay),ce(Zr(a),1-this.decay)),h=Se(ce(c,this.momentum),ze(ce(a,this.learningRate),qn(Se(m,this.epsilon))));u.assign(m),c.assign(h);let x=Fe(s,h);s.assign(x)}})}),this.incrementIterations()}dispose(){this.accumulatedMeanSquares!=null&&St(this.accumulatedMeanSquares.map(t=>t.variable)),this.accumulatedMeanGrads!=null&&this.centered&&St(this.accumulatedMeanGrads.map(t=>t.variable)),this.accumulatedMoments!=null&&St(this.accumulatedMoments.map(t=>t.variable))}getWeights(){return ne(this,null,function*(){let t=[...this.accumulatedMeanSquares,...this.accumulatedMoments];return this.centered&&t.push(...this.accumulatedMeanGrads),[yield this.saveIterations()].concat(t.map(r=>({name:r.originalName,tensor:r.variable})))})}setWeights(t){return ne(this,null,function*(){t=yield this.extractIterations(t);let r=this.centered?t.length/3:t.length/2,n=!1;this.accumulatedMeanSquares=t.slice(0,r).map(o=>({originalName:o.name,variable:o.tensor.variable(n)})),this.accumulatedMoments=t.slice(r,r*2).map(o=>({originalName:o.name,variable:o.tensor.variable(n)})),this.centered&&(this.accumulatedMeanGrads=t.slice(r*2,r*3).map(o=>({originalName:o.name,variable:o.tensor.variable(n)})))})}getConfig(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}}static fromConfig(t,r){return new t(r.learningRate,r.decay,r.momentum,r.epsilon,r.centered)}};var BX=[X0,Y0,Z0,Q0,J0,ey,Sp];function aO(){for(let e of BX)iO(e)}var Qm={};$t(Qm,{CompositeArrayBuffer:()=>nn,browserFiles:()=>lO,browserHTTPRequest:()=>hO,concatenateArrayBuffers:()=>EA,copyModel:()=>MA,decodeWeights:()=>Z1,decodeWeightsStream:()=>Q1,encodeWeights:()=>wA,fromMemory:()=>dO,fromMemorySync:()=>pS,getLoadHandlers:()=>AA,getModelArtifactsForJSON:()=>mp,getModelArtifactsForJSONSync:()=>BT,getModelArtifactsInfoForJSON:()=>xi,getSaveHandlers:()=>IA,getWeightSpecs:()=>Vm,http:()=>ry,isHTTPScheme:()=>ty,listModels:()=>LA,loadWeights:()=>pO,moveModel:()=>UA,registerLoadRouter:()=>_A,registerSaveRouter:()=>NA,removeModel:()=>BA,weightsLoaderFactory:()=>lS,withSaveHandler:()=>gO,withSaveHandlerSync:()=>xO});var MX="model",UX=".json",VX=".weights.bin";function uO(e){return new Promise(t=>setTimeout(t)).then(e)}var sS=(()=>{class e{constructor(r){if(!z().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");r.startsWith(e.URL_SCHEME)&&(r=r.slice(e.URL_SCHEME.length)),(r==null||r.length===0)&&(r=MX),this.modelJsonFileName=r+UX,this.weightDataFileName=r+VX}save(r){return ne(this,null,function*(){if(typeof document>"u")throw new Error("Browser downloads are not supported in this environment since `document` is not present");let n=nn.join(r.weightData),o=window.URL.createObjectURL(new Blob([n],{type:"application/octet-stream"}));if(r.modelTopology instanceof ArrayBuffer)throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");{let s=[{paths:["./"+this.weightDataFileName],weights:r.weightSpecs}],i=J1(r,s),a=window.URL.createObjectURL(new Blob([JSON.stringify(i)],{type:"application/json"})),u=this.modelJsonAnchor==null?document.createElement("a"):this.modelJsonAnchor;if(u.download=this.modelJsonFileName,u.href=a,yield uO(()=>u.dispatchEvent(new MouseEvent("click"))),r.weightData!=null){let c=this.weightDataAnchor==null?document.createElement("a"):this.weightDataAnchor;c.download=this.weightDataFileName,c.href=o,yield uO(()=>c.dispatchEvent(new MouseEvent("click")))}return{modelArtifactsInfo:xi(r)}}})}}return e.URL_SCHEME="downloads://",e})();var iS=class{constructor(t){if(t==null||t.length<1)throw new Error(`When calling browserFiles, at least 1 file is required, but received ${t}`);this.jsonFile=t[0],this.weightsFiles=t.slice(1)}load(){return ne(this,null,function*(){return new Promise((t,r)=>{let n=new FileReader;n.onload=o=>{let s=JSON.parse(o.target.result),i=s.modelTopology;if(i==null){r(new Error(`modelTopology field is missing from file ${this.jsonFile.name}`));return}if(s.weightsManifest==null){r(new Error(`weightManifest field is missing from file ${this.jsonFile.name}`));return}if(this.weightsFiles.length===0){t({modelTopology:i});return}let u=mp(s,c=>this.loadWeights(c));t(u)},n.onerror=o=>r(`Failed to read model topology and weights manifest JSON from file '${this.jsonFile.name}'. BrowserFiles supports loading Keras-style tf.Model artifacts only.`),n.readAsText(this.jsonFile)})})}loadWeights(t){let r=[],n=[];for(let i of t)r.push(...i.weights),n.push(...i.paths);let o=this.checkManifestAndWeightFiles(t),s=n.map(i=>this.loadWeightsFile(i,o[i]));return Promise.all(s).then(i=>[r,i])}loadWeightsFile(t,r){return new Promise((n,o)=>{let s=new FileReader;s.onload=i=>{let a=i.target.result;n(a)},s.onerror=i=>o(`Failed to weights data from file of path '${t}'.`),s.readAsArrayBuffer(r)})}checkManifestAndWeightFiles(t){let r=[],n=this.weightsFiles.map(s=>LT(s.name)),o={};for(let s of t)s.paths.forEach(i=>{let a=LT(i);if(r.indexOf(a)!==-1)throw new Error(`Duplicate file basename found in weights manifest: '${a}'`);if(r.push(a),n.indexOf(a)===-1)throw new Error(`Weight file with basename '${a}' is not provided.`);o[i]=this.weightsFiles[n.indexOf(a)]});if(r.length!==this.weightsFiles.length)throw new Error(`Mismatch in the number of files in weights manifest (${r.length}) and the number of weight files provided (${this.weightsFiles.length}).`);return o}},GX=e=>z().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(sS.URL_SCHEME)?WX(e.slice(sS.URL_SCHEME.length)):null;Mr.registerSaveRouter(GX);function WX(e="model"){return new sS(e)}function lO(e){return new iS(e)}function aS(e,t,r,n){i(e),r=r??0,n=n??1,a(r,n);let o=0,s=u=>(u.then(c=>{let p=r+ ++o/e.length*(n-r);return t(p),c}),u);function i(u){O(u!=null&&Array.isArray(u)&&u.length>0,()=>"promises must be a none empty array")}function a(u,c){O(u>=0&&u<=1,()=>`Progress fraction must be in range [0, 1], but got startFraction ${u}`),O(c>=0&&c<=1,()=>`Progress fraction must be in range [0, 1], but got endFraction ${c}`),O(c>=u,()=>`startFraction must be no more than endFraction, but got startFraction ${u} and endFraction ${c}`)}return Promise.all(e.map(s))}function uS(e,t){return ne(this,null,function*(){t==null&&(t={});let r=t.fetchFunc==null?z().platform.fetch:t.fetchFunc,n=e.map(m=>r(m,t.requestInit,{isBinary:!0})),a=(t.onProgress==null?yield Promise.all(n):yield aS(n,t.onProgress,0,.5)).map(m=>m.arrayBuffer());return t.onProgress==null?yield Promise.all(a):yield aS(a,t.onProgress,.5,1)})}function cO(e,t){var r;let n=t.fetchFunc==null?z().platform.fetch:t.fetchFunc,o=0,s;return(r=t.onProgress)===null||r===void 0||r.call(t,0),new ReadableStream({pull:i=>ne(this,null,function*(){for(var a;o<e.length;){s||(s=(yield n(e[o],t.requestInit,{isBinary:!0})).body.getReader());let{done:u,value:c}=yield s.read();if(u){o++,s=void 0,(a=t.onProgress)===null||a===void 0||a.call(t,o/e.length);continue}i.enqueue(c);return}i.close()})})}function pO(e,t="",r,n){return ne(this,null,function*(){return lS(i=>uS(i,{requestInit:n}))(e,t,r)})}function lS(e){return(t,r="",n)=>ne(this,null,function*(){let o=t.map(()=>!1),s={},i=n!=null?n.map(()=>!1):[],a=[];if(t.forEach((x,y)=>{let v=0;x.weights.forEach(w=>{let C="quantization"in w?w.quantization.dtype:w.dtype,I=Yi[C]*rt(w.shape),D=()=>{o[y]=!0,s[y]==null&&(s[y]=[]),s[y].push({manifestEntry:w,groupOffset:v,sizeBytes:I})};n!=null?n.forEach((P,G)=>{P===w.name&&(D(),i[G]=!0)}):D(),a.push(w.name),v+=I})}),!i.every(x=>x)){let x=n.filter((y,v)=>!i[v]);throw new Error(`Could not find weights in manifest with names: ${x.join(", ")}. 
Manifest JSON has weights with names: ${a.join(", ")}.`)}let u=o.reduce((x,y,v)=>(y&&x.push(v),x),[]),c=[];u.forEach(x=>{t[x].paths.forEach(y=>{let v=r+(r.endsWith("/")?"":"/")+y;c.push(v)})});let p=yield e(c),m={},h=0;return u.forEach(x=>{let y=t[x].paths.length,v=new nn(p.slice(h,h+y));s[x].forEach(C=>{let I=v.slice(C.groupOffset,C.groupOffset+C.sizeBytes),D=Z1(I,[C.manifestEntry]);for(let P in D)m[P]=D[P]}),h+=y}),m})}var zX="application/octet-stream",HX="application/json",fO=(()=>{class e{constructor(r,n){if(this.DEFAULT_METHOD="POST",n==null&&(n={}),this.weightPathPrefix=n.weightPathPrefix,this.weightUrlConverter=n.weightUrlConverter,n.fetchFunc!=null?(O(typeof n.fetchFunc=="function",()=>"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"),this.fetch=n.fetchFunc):this.fetch=z().platform.fetch,O(r!=null&&r.length>0,()=>"URL path for http must not be null, undefined or empty."),Array.isArray(r)&&O(r.length===2,()=>`URL paths for http must have a length of 2, (actual length is ${r.length}).`),this.path=r,n.requestInit!=null&&n.requestInit.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=n.requestInit||{},this.loadOptions=n}save(r){return ne(this,null,function*(){if(r.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");let n=Object.assign({method:this.DEFAULT_METHOD},this.requestInit);n.body=new FormData;let o=[{paths:["./model.weights.bin"],weights:r.weightSpecs}],s=J1(r,o);if(n.body.append("model.json",new Blob([JSON.stringify(s)],{type:HX}),"model.json"),r.weightData!=null){let a=nn.join(r.weightData);n.body.append("model.weights.bin",new Blob([a],{type:zX}),"model.weights.bin")}let i=yield this.fetch(this.path,n);if(i.ok)return{modelArtifactsInfo:xi(r),responses:[i]};throw new Error(`BrowserHTTPRequest.save() failed due to HTTP response status ${i.status}.`)})}loadModelJSON(){return ne(this,null,function*(){let r=yield this.fetch(this.path,this.requestInit);if(!r.ok)throw new Error(`Request to ${this.path} failed with status code ${r.status}. Please verify this URL points to the model JSON of the model to load.`);let n;try{n=yield r.json()}catch{let a=`Failed to parse model JSON of response from ${this.path}.`;throw this.path.endsWith(".pb")?a+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":a+=" Please make sure the server is serving valid JSON for this request.",new Error(a)}let o=n.modelTopology,s=n.weightsManifest;if(o==null&&s==null)throw new Error(`The JSON from HTTP path ${this.path} contains neither model topology or manifest for weights.`);return n})}load(){return ne(this,null,function*(){if(this.loadOptions.streamWeights)return this.loadStream();let r=yield this.loadModelJSON();return mp(r,n=>this.loadWeights(n))})}loadStream(){return ne(this,null,function*(){let r=yield this.loadModelJSON(),n=yield this.getWeightUrls(r.weightsManifest),o=Vm(r.weightsManifest),s=()=>cO(n,this.loadOptions);return Object.assign(Object.assign({},r),{weightSpecs:o,getWeightStream:s})})}getWeightUrls(r){return ne(this,null,function*(){let n=Array.isArray(this.path)?this.path[1]:this.path,[o,s]=KX(n),i=this.weightPathPrefix||o,a=[],u=[];for(let c of r)for(let p of c.paths)this.weightUrlConverter!=null?u.push(this.weightUrlConverter(p)):a.push(i+p+s);return this.weightUrlConverter&&a.push(...yield Promise.all(u)),a})}loadWeights(r){return ne(this,null,function*(){let n=yield this.getWeightUrls(r),o=Vm(r),s=yield uS(n,this.loadOptions);return[o,s]})}}return e.URL_SCHEME_REGEX=/^https?:\/\//,e})();function KX(e){let t=e.lastIndexOf("/"),r=e.lastIndexOf("?"),n=e.substring(0,t),o=r>t?e.substring(r):"";return[n+"/",o]}function ty(e){return e.match(fO.URL_SCHEME_REGEX)!=null}var mO=(e,t)=>{if(typeof fetch>"u"&&(t==null||t.fetchFunc==null))return null;{let r=!0;if(Array.isArray(e)?r=e.every(n=>ty(n)):r=ty(e),r)return ry(e,t)}return null};Mr.registerSaveRouter(mO);Mr.registerLoadRouter(mO);function ry(e,t){return new fO(e,t)}function hO(e,t){return ry(e,t)}var Zm=class{constructor(t){this.modelArtifacts=t}load(){return this.modelArtifacts}},ny=class{constructor(t){this.saveHandler=t}save(t){return this.saveHandler(t)}},cS=class{constructor(t){t.load&&(this.load=()=>Promise.resolve(t.load())),t.save&&(this.save=r=>Promise.resolve(t.save(r)))}};function dO(e,t,r,n){let o=arguments;return new cS(pS(...o))}function pS(e,t,r,n){return arguments.length===1?e.modelTopology!=null||e.weightSpecs!=null?new Zm(e):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new Zm({modelTopology:e})):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new Zm({modelTopology:e,weightSpecs:t,weightData:r,trainingConfig:n}))}function gO(e){return new ny(e)}function xO(e){return new ny(e)}var Jm={};$t(Jm,{draw:()=>eY,fromPixels:()=>tY,fromPixelsAsync:()=>ZX,toPixels:()=>JX});var xl,yO=!1;function bO(e,t=3){if(t>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(e==null)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");let r=!1,n=!1,o=!1,s=!1,i=!1,a=!1;if(e.data instanceof Uint8Array)r=!0;else if(typeof ImageData<"u"&&e instanceof ImageData)n=!0;else if(typeof HTMLVideoElement<"u"&&e instanceof HTMLVideoElement)o=!0;else if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement)s=!0;else if(e.getContext!=null)i=!0;else if(typeof ImageBitmap<"u"&&e instanceof ImageBitmap)a=!0;else throw new Error(`pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was ${e.constructor.name}`);if(ip(Om,R.backendName)!=null){let y={pixels:e},v={numChannels:t};return R.runKernel(Om,y,v)}let[c,p]=o?[e.videoWidth,e.videoHeight]:[e.width,e.height],m;if(i)m=e.getContext("2d").getImageData(0,0,c,p).data;else if(n||r)m=e.data;else if(s||o||a){if(xl==null)if(typeof document>"u")if(typeof OffscreenCanvas<"u"&&typeof OffscreenCanvasRenderingContext2D<"u")xl=new OffscreenCanvas(1,1).getContext("2d");else throw new Error("Cannot parse input in current context. Reason: OffscreenCanvas Context2D rendering is not supported.");else xl=document.createElement("canvas").getContext("2d",{willReadFrequently:!0});xl.canvas.width=c,xl.canvas.height=p,xl.drawImage(e,0,0,c,p),m=xl.getImageData(0,0,c,p).data}let h;if(t===4)h=new Int32Array(m);else{let y=c*p;h=new Int32Array(y*t);for(let v=0;v<y;v++)for(let w=0;w<t;++w)h[v*t+w]=m[v*4+w]}return M0(h,[p,c,t],"int32")}function qX(e){return e!=null&&e.data instanceof Uint8Array}function jX(){return typeof window<"u"&&typeof ImageBitmap<"u"&&window.hasOwnProperty("createImageBitmap")}function XX(e){return e!=null&&e.width!==0&&e.height!==0}function YX(e){return jX()&&!(e instanceof ImageBitmap)&&XX(e)&&!qX(e)}function ZX(e,t=3){return ne(this,null,function*(){let r=null;if(z().getBool("WRAP_TO_IMAGEBITMAP")&&YX(e)){let n;try{n=yield createImageBitmap(e,{premultiplyAlpha:"none"})}catch{n=null}n!=null&&n.width===e.width&&n.height===e.height?r=n:r=e}else r=e;return bO(r,t)})}function vO(e){if(e.rank!==2&&e.rank!==3)throw new Error(`toPixels only supports rank 2 or 3 tensors, got rank ${e.rank}.`);let t=e.rank===2?1:e.shape[2];if(t>4||t===2)throw new Error(`toPixels only supports depth of size 1, 3 or 4 but got ${t}`);if(e.dtype!=="float32"&&e.dtype!=="int32")throw new Error(`Unsupported type for toPixels: ${e.dtype}. Please use float32 or int32 tensors.`)}function QX(e){let t=e?.alpha||1;if(t>1||t<0)throw new Error(`Alpha value ${t} is suppoed to be in range [0 - 1].`)}function JX(e,t){return ne(this,null,function*(){let r=E(e,"img","toPixels");if(!(e instanceof It)){let c=r;r=it(c,"int32"),c.dispose()}vO(r);let[n,o]=r.shape.slice(0,2),s=r.rank===2?1:r.shape[2],i=yield r.data(),a=r.dtype==="float32"?255:1,u=new Uint8ClampedArray(o*n*4);for(let c=0;c<n*o;++c){let p=[0,0,0,255];for(let h=0;h<s;h++){let x=i[c*s+h];if(r.dtype==="float32"){if(x<0||x>1)throw new Error(`Tensor values for a float32 Tensor must be in the range [0 - 1] but encountered ${x}.`)}else if(r.dtype==="int32"&&(x<0||x>255))throw new Error(`Tensor values for a int32 Tensor must be in the range [0 - 255] but encountered ${x}.`);s===1?(p[0]=x*a,p[1]=x*a,p[2]=x*a):p[h]=x*a}let m=c*4;u[m+0]=Math.round(p[0]),u[m+1]=Math.round(p[1]),u[m+2]=Math.round(p[2]),u[m+3]=Math.round(p[3])}if(t!=null){yO||ip(wT,R.backendName)!=null&&(console.warn("tf.browser.toPixels is not efficient to draw tensor on canvas. Please try tf.browser.draw instead."),yO=!0),t.width=o,t.height=n;let c=t.getContext("2d"),p=new ImageData(u,o,n);c.putImageData(p,0,0)}return r!==e&&r.dispose(),u})}function eY(e,t,r){let n=E(e,"img","draw");if(!(e instanceof It)){let i=n;n=it(i,"int32"),i.dispose()}vO(n),QX(r?.imageOptions);let o={image:n},s={canvas:t,options:r};R.runKernel(wT,o,s)}var tY=_({fromPixels_:bO});function rY(e,t){let r=e.shape.length,n=t.shape.length;if(r<1)throw new Error(`tf.gatherND() expects the input to be rank 1 or higher, but the rank was ${r}.`);if(n<1)throw new Error(`tf.gatherND() expects the indices to be rank 1 or higher, but the rank was ${n}.`);if(t.dtype!=="int32")throw new Error(`tf.gatherND() expects the indices to be int32 type, but the dtype was ${t.dtype}.`);if(t.shape[n-1]>r)throw new Error(`index innermost dimension length must be <= tensor rank; saw: ${t.shape[n-1]} vs. ${r}`);if(rt(e.shape)===0)throw new Error(`Requested more than 0 entries, but input is empty. Input shape: ${e.shape}.`);let o=t.shape,s=o[o.length-1],i=1;for(let m=0;m<o.length-1;++m)i*=o[m];let a=e.shape,u=o.slice();u.pop();let c=1;for(let m=s;m<r;++m)c*=a[m],u.push(a[m]);let p=[...gi(e.shape).map(m=>m/c),1].slice(0,s);return[u,i,c,p]}var Zn={};$t(Zn,{assertParamsValid:()=>oY,computeFlatOffset:()=>lY,computeOutShape:()=>iY,getNormalizedAxes:()=>aY,isSliceContinous:()=>uY,maskToAxes:()=>sY,parseSliceParams:()=>cY,sliceInfo:()=>pY,startForAxis:()=>IO,startIndicesWithElidedDims:()=>EO,stopForAxis:()=>AO,stopIndicesWithElidedDims:()=>NO,stridesForAxis:()=>_O,stridesWithElidedDims:()=>TO});var fS=-2,nY=-1;function oY(e,t,r){let n=e.shape.length;O(n===t.length,()=>`Error in slice${n}D: Length of begin ${t} must match the rank of the array (${n}).`),O(n===r.length,()=>`Error in slice${n}D: Length of size ${r} must match the rank of the array (${n}).`);for(let o=0;o<n;++o)O(t[o]+r[o]<=e.shape[o],()=>`Error in slice${n}D: begin[${o}] + size[${o}] (${t[o]+r[o]}) would overflow input.shape[${o}] (${e.shape[o]})`)}function sY(e){let t=[],r=0;for(;e>0;)e&1&&t.push(r),e/=2,r++;return t}function iY(e,t,r){let n=[];for(let o=0;o<e.length;o++)n[o]=Math.ceil((t[o]-e[o])/r[o]);return n}function TO(e,t,r,n){let o=[...e];for(let s=o.length;s<n.length;s++)o.push(1);for(let s=0;s<r;s++)s===0?o[t]=1:(o.splice(t,0,1),o.pop());return o}function SO(e,t,r){return r<=e?r:r-(t-1)}function CO(e,t){let r=[];for(let n=0;n<e;n++)r.push(t+n);return r}function aY(e,t,r,n,o,s,i,a,u){let c=e.length,p=new Array(c),m=new Array(c),h=new Array(c);if(t.length&&r>0){let x=t[0],y=r+1;p=EO(i,x,y,n,e),m=NO(a,x,y,o,e),h=TO(s,x,y,e)}else for(let x=0;x<c;x++)p[x]=IO(i,n,s,e,x,u),m[x]=AO(a,o,s,e,x,u),h[x]=_O(s,x,u);return{begin:p,end:m,strides:h}}function EO(e,t,r,n,o){let s=[...o],i=CO(r,t);for(let a=0;a<s.length;a++)if(i.indexOf(a)>-1)s[a]=0;else{let u=SO(t,r,a),c=n[u];e&1<<u&&(c=0),s[a]=c}return s}function NO(e,t,r,n,o){let s=[...o],i=CO(r,t);for(let a=0;a<s.length;a++)if(i.indexOf(a)>-1)s[a]=Number.MAX_SAFE_INTEGER;else{let u=SO(t,r,a),c=n[u];e&1<<u&&(c=Number.MAX_SAFE_INTEGER),s[a]=c}for(let a=0;a<s.length;a++){let u=o[a];s[a]<0&&(s[a]+=u),s[a]=kc(0,s[a],o[a])}return s}function _O(e,t,r){let n=e[t];return(r&1<<t||n==null)&&(n=1),n}function IO(e,t,r,n,o,s){let i=t[o],a=r[o]||1;(e&1<<o||s&1<<o||i==null)&&(a>0?i=Number.MIN_SAFE_INTEGER:i=Number.MAX_SAFE_INTEGER);let u=n[o];return i<0&&(i+=u),i=kc(0,i,u-1),i}function AO(e,t,r,n,o,s){let i=t[o],a=r[o]||1;(e&1<<o||s&1<<o||i==null)&&(a>0?i=Number.MAX_SAFE_INTEGER:i=Number.MIN_SAFE_INTEGER);let u=n[o];return i<0&&(i+=u),a>0?i=kc(0,i,u):i=kc(-1,i,u-1),i}function uY(e,t,r){let n=r.length;for(let o=0;o<r.length;o++)if(r[o]>1){n=o;break}for(let o=n+1;o<r.length;o++)if(t[o]>0||r[o]!==e[o])return!1;return!0}function lY(e,t){let r=e.length>0?e[e.length-1]:1;for(let n=0;n<e.length-1;n++)r+=e[n]*t[n];return r}function cY(e,t,r){let n,o=e.shape.length;typeof t=="number"?n=[t,...new Array(o-1).fill(0)]:t.length<o?n=t.concat(new Array(o-t.length).fill(0)):n=t.slice(),n.forEach(i=>{O(i!==-1,()=>"slice() does not support negative begin indexing.")});let s;return r==null?s=new Array(o).fill(-1):typeof r=="number"?s=[r,...new Array(o-1).fill(-1)]:r.length<o?s=r.concat(new Array(o-r.length).fill(-1)):s=r,s=s.map((i,a)=>i>=0?i:(O(i===-1,()=>`Negative size values should be exactly -1 but got ${i} for the slice() size at index ${a}.`),e.shape[a]-n[a])),[n,s]}function pY(e,t,r,n,o,s,i,a,u){let c;if(n==null?(c=new Array(t.length),c.fill(1)):c=n,i!=null&&i&i-1)throw new Error("Multiple ellipses in slice is not allowed.");let p=!1,m={dims:c.length,numAddAxisAfterEllipsis:0,begin:t.slice(),end:r.slice(),strides:c.slice(),beginMask:o,endMask:s,ellipsisMask:i,newAxisMask:a,shrinkAxisMask:u};for(let D=0;D<m.dims;D++)p&&1<<D&a&&m.numAddAxisAfterEllipsis++,1<<D&i&&(p=!0);p||(m.ellipsisMask|=1<<m.dims,m.dims++);let h={dims:e.length,beginMask:0,endMask:0,beginValid:!1,endValid:!1};fY(m,h);let x=!0,y=!0,v=!0,w=[],C=[];for(let D=0;D<e.length;++D){if(h.strides[D]===0)throw Error(`strides[${D}] must be non-zero`);let P=!!(h.shrinkAxisMask&1<<D),G=e[D];if(G===-1){w.push(P?1:-1);continue}let q=[h.beginMask&1<<D,h.endMask&1<<D],Z=[h.strides[D]>0?0:-1,h.strides[D]>0?G:G-1];if(P&&h.strides[D]<=0)throw Error("only stride 1 allowed on non-range indexing.");v=v&&h.strides[D]===1;let Y=!!(h.beginMask&1<<D&&h.endMask&1<<D);if(h.beginValid&&h.endValid){if(P){let ge=h.begin[D]<0?G+h.begin[D]:h.begin[D];if(h.begin[D]=ge,h.end[D]=h.begin[D]+1,ge<0||ge>=G)throw Error(`slice index ${h.begin[D]} of dimension ${D} out of bounds.`)}else h.begin[D]=wO(h.begin[D],0,h.strides[D],G,q,Z),h.end[D]=wO(h.end[D],1,h.strides[D],G,q,Z);let ae=h.strides[D]===1&&h.begin[D]===0&&h.end[D]===G;x=x&&ae,y=y&&(D===0&&h.strides[D]===1||ae)}else x=x&&h.strides[D]===1&&Y,y=y&&(D===0&&h.strides[D]===1||Y);let te,J=!1;if(h.beginValid&&h.endValid?(te=h.end[D]-h.begin[D],J=!0):P?(te=1,J=!0):Y&&G>=0&&(h.strides[D]<0?te=-G:te=G,J=!0),J){let ae;te===0||te<0!=h.strides[D]<0?ae=0:ae=Math.trunc(te/h.strides[D])+(te%h.strides[D]!==0?1:0),w.push(ae)}else w.push(-1)}for(let D=0;D<h.finalShapeGatherIndices.length;++D){let P=h.finalShapeGatherIndices[D];P>=0?C.push(w[P]):P===fS&&C.push(1)}return{finalShapeSparse:C.filter((D,P)=>h.finalShapeGatherIndices[P]!==fS),finalShape:C,isIdentity:x,sliceDim0:y,isSimpleSlice:v,begin:h.begin,end:h.end,strides:h.strides}}function fY(e,t){t.beginMask=0,t.endMask=0,t.shrinkAxisMask=0;let r=0;t.beginValid=e.begin!=null,t.endValid=e.end!=null,t.begin=new Array(t.dims),t.end=new Array(t.dims),t.strides=new Array(t.dims),t.finalShapeGatherIndices=[],t.finalShapeGatherIndicesSparse=[],t.inputShapeGatherIndicesSparse=new Array(t.dims);for(let n=0;n<e.dims;n++)if(1<<n&e.ellipsisMask){let o=Math.min(t.dims-(e.dims-n)+1+e.numAddAxisAfterEllipsis,t.dims);for(;r<o;r++)t.begin[r]=0,t.end[r]=0,t.strides[r]=1,t.beginMask|=1<<r,t.endMask|=1<<r,t.finalShapeGatherIndices.push(r),t.finalShapeGatherIndicesSparse.push(-1),t.inputShapeGatherIndicesSparse[r]=n}else if(1<<n&e.newAxisMask)t.finalShapeGatherIndices.push(fS),t.finalShapeGatherIndicesSparse.push(-1);else{if(r===t.begin.length)throw Error(`Index out of range using input dim ${r}; input has only ${t.dims} dims, ${t.begin.length}.`);e.begin!=null&&(t.begin[r]=e.begin[n]),e.end!=null&&(t.end[r]=e.end[n]),t.strides[r]=e.strides[n],e.beginMask&1<<n&&(t.beginMask|=1<<r),e.endMask&1<<n&&(t.endMask|=1<<r),e.shrinkAxisMask&1<<n?(t.finalShapeGatherIndices.push(nY),t.finalShapeGatherIndicesSparse.push(-1),t.shrinkAxisMask|=1<<r):(t.finalShapeGatherIndices.push(r),t.finalShapeGatherIndicesSparse.push(n)),t.inputShapeGatherIndicesSparse[r]=n,r++}}function wO(e,t,r,n,o,s){if(o[t])return r>0?s[t]:s[t+1&1];{let i=e<0?n+e:e;return i<s[0]?s[0]:i>s[1]?s[1]:i}}var mY=typeof requestAnimationFrame<"u"?requestAnimationFrame:typeof setImmediate<"u"?setImmediate:e=>e();function mS(){return new Promise(e=>mY(()=>e()))}var U={};$t(U,{ERF_A1:()=>kY,ERF_A2:()=>$Y,ERF_A3:()=>RY,ERF_A4:()=>OY,ERF_A5:()=>DY,ERF_P:()=>AY,PARALLELIZE_THRESHOLD:()=>oy,RowPartitionType:()=>oa,SELU_SCALE:()=>IY,SELU_SCALEALPHA:()=>_Y,applyActivation:()=>dl,assertAndGetBroadcastShape:()=>ht,assertAxesAreInnerMostDims:()=>QH,assertParamsConsistent:()=>hY,assignToTypedArray:()=>UY,axesAreInnerMostDims:()=>jT,calculateShapes:()=>aj,checkEinsumDimSizes:()=>KY,checkPadOnDimRoundingMode:()=>vr,combineLocations:()=>Fk,combineRaggedTensorToTensorShapes:()=>gY,complexWithEvenIndex:()=>LY,complexWithOddIndex:()=>BY,computeConv2DInfo:()=>ol,computeConv3DInfo:()=>rk,computeDefaultPad:()=>qT,computeDilation2DInfo:()=>Yz,computeOptimalWindowSize:()=>vY,computeOutAndReduceShapes:()=>ZH,computeOutShape:()=>dY,computePool2DInfo:()=>KT,computePool3DInfo:()=>Zz,convertConv2DDataFormat:()=>nk,decodeEinsumEquation:()=>zY,eitherStridesOrDilationsAreOne:()=>xn,expandShapeToKeepDim:()=>Ji,exponent:()=>GY,exponents:()=>VY,fromStringArrayToUint8:()=>mZ,fromUint8ToStringArray:()=>fZ,getAxesPermutation:()=>JH,getBroadcastDims:()=>kk,getComplexWithIndex:()=>MY,getEinsumComputePath:()=>qY,getEinsumPermutation:()=>HY,getFusedBiasGradient:()=>hl,getFusedDyActivation:()=>ml,getImageCenter:()=>wY,getInnerMostAxes:()=>tK,getPermuted:()=>SY,getRaggedRank:()=>yY,getReductionAxes:()=>c0,getReshaped:()=>TY,getReshapedPermuted:()=>CY,getRowPartitionTypesHelper:()=>xY,getSliceBeginCoords:()=>EY,getSliceSize:()=>NY,getSparseFillEmptyRowsIndicesDenseShapeMismatch:()=>ZY,getSparseFillEmptyRowsNegativeIndexErrorMessage:()=>QY,getSparseFillEmptyRowsOutOfRangeIndexErrorMessage:()=>JY,getSparseReshapeEmptyTensorZeroOutputDimErrorMessage:()=>rZ,getSparseReshapeInputOutputMismatchErrorMessage:()=>oZ,getSparseReshapeInputOutputMultipleErrorMessage:()=>nZ,getSparseReshapeMultipleNegativeOneOutputDimErrorMessage:()=>eZ,getSparseReshapeNegativeOutputDimErrorMessage:()=>tZ,getSparseSegmentReductionIndicesOutOfRangeErrorMessage:()=>uZ,getSparseSegmentReductionNegativeSegmentIdsErrorMessage:()=>sZ,getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage:()=>iZ,getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage:()=>aZ,getUndoAxesPermutation:()=>eK,isIdentityPermutation:()=>jY,log:()=>VW,mergeRealAndImagArrays:()=>FY,prepareAndValidate:()=>rY,prepareSplitSize:()=>YY,segment_util:()=>dS,shouldFuse:()=>gl,slice_util:()=>Zn,splitRealAndImagArrays:()=>PY,stridesOrDilationsArePositive:()=>yi,tupleValuesAreOne:()=>nl,upcastType:()=>gn,validateDefaultValueShape:()=>bY,validateInput:()=>jm,validateUpdateShape:()=>oR,warn:()=>ji});function hY(e,t){let r=e[0].length;e.forEach((o,s)=>{O(o.length===r,()=>`Error in concat${r}D: rank of tensors[${s}] must be the same as the rank of the rest (${r})`)}),O(t>=0&&t<r,()=>`Error in concat${r}D: axis must be between 0 and ${r-1}.`);let n=e[0];e.forEach((o,s)=>{for(let i=0;i<r;i++)O(i===t||o[i]===n[i],()=>`Error in concat${r}D: Shape of tensors[${s}] (${o}) does not match the shape of the rest (${n}) along the non-concatenated axis ${s}.`)})}function dY(e,t){let r=e[0].slice();for(let n=1;n<e.length;n++)r[t]+=e[n][t];return r}var oa=function(e){return e[e.FIRST_DIM_SIZE=0]="FIRST_DIM_SIZE",e[e.VALUE_ROWIDS=1]="VALUE_ROWIDS",e[e.ROW_LENGTHS=2]="ROW_LENGTHS",e[e.ROW_SPLITS=3]="ROW_SPLITS",e[e.ROW_LIMITS=4]="ROW_LIMITS",e[e.ROW_STARTS=5]="ROW_STARTS",e}(oa||{});function gY(e,t,r){let n=new Array;if(r==null&&t==null)return n;if(t==null)for(;n.length<e+r.length;)n.push(-1);else n=t.slice();if(r==null)return n;if(e+r.length!==n.length)throw new Error(`rt input.shape and shape=${t} are incompatible: rt input.rank = ${e+r.length}, but shape.rank = ${n.length}`);for(let o=1;o<r.length;++o){let s=r[o],i=n[n.length-r.length+o],a=n[i];if(s>=0)if(a>=0){if(a!==s)throw new Error(`rt input.shape and shape=${t} are incompatible: rt input.shape[${o+e}] = ${s} but shape[${o+e}] = ${a}`)}else n[i]=s}return n}function xY(e){let t={FIRST_DIM_SIZE:oa.FIRST_DIM_SIZE,VALUE_ROWIDS:oa.VALUE_ROWIDS,ROW_LENGTHS:oa.ROW_LENGTHS,ROW_SPLITS:oa.ROW_SPLITS,ROW_LIMITS:oa.ROW_LIMITS,ROW_STARTS:oa.ROW_STARTS},r=[];for(let n of e)if(n in t)r.push(t[n]);else break;return r}function yY(e){return e.length===0?0:e[0]===oa.FIRST_DIM_SIZE?e.length-1:e.length}function bY(e,t){if(e==null||t==null)return;let r=e.length,n=t.length;if(r>=n)throw new Error(`defaultValue.shape=${e} and ragged tensor flatValues.shape=${t}, are incompatible: defaultValue.rank = ${r} must be less than ragged tensor input flatValues.rank = ${n})`);for(let o=0;o<Math.min(r,n-1);++o){let s=e[o],i=t[o+1];if(s>=0&&i>=0&&s!==1&&s!==i)throw new Error(`defaultValue.shape=${e}, and ragged tensor input flatValues.shape=${t} are incompatible: defaultValue.shape[${o-e.length}] = ${s} but ragged tensor input.flatValues.shape[${o-e.length}] = ${i}`)}}var oy=30;function vY(e){return e<=oy?e:Dc(e,Math.floor(Math.sqrt(e)))}function wY(e,t,r){let n=r*(typeof e=="number"?e:e[0]),o=t*(typeof e=="number"?e:e[1]);return[n,o]}function TY(e,t,r,n=!0){let o=[];if(n)o=o.concat(t.slice(0)),o.push(e[0]/r),o=o.concat(e.slice(1));else{o=o.concat(e[0]);let s=t.length;for(let i=0;i<s;++i)o=o.concat([e[i+1]/t[i],t[i]]);o=o.concat(e.slice(s+1))}return o}function SY(e,t,r=!0){let n=[];if(r){n.push(t);for(let o=t+1;o<e;++o)o<=2*t?(n.push(o),n.push(o-(t+1))):n.push(o)}else{let o=[],s=[];for(let i=1;i<e;++i)i>=t*2+1||i%2===1?s.push(i):o.push(i);n.push(...o),n.push(0),n.push(...s)}return n}function CY(e,t,r,n=!0){let o=[];n?o.push(e[0]/r):o.push(e[0]*r);for(let s=1;s<e.length;++s)s<=t.length?n?o.push(t[s-1]*e[s]):o.push(e[s]/t[s-1]):o.push(e[s]);return o}function EY(e,t){let r=[0];for(let n=0;n<t;++n)r.push(e[n][0]);return r}function NY(e,t,r){let n=e.slice(0,1);for(let o=0;o<r;++o)n.push(e[o+1]-t[o][0]-t[o][1]);return n}var _Y=1.7580993408473768,IY=1.0507009873554805;var AY=.3275911,kY=.254829592,$Y=-.284496736,RY=1.421413741,OY=-1.453152027,DY=1.061405429;function FY(e,t){if(e.length!==t.length)throw new Error(`Cannot merge real and imag arrays of different lengths. real:${e.length}, imag: ${t.length}.`);let r=new Float32Array(e.length*2);for(let n=0;n<r.length;n+=2)r[n]=e[n/2],r[n+1]=t[n/2];return r}function PY(e){let t=new Float32Array(e.length/2),r=new Float32Array(e.length/2);for(let n=0;n<e.length;n+=2)t[n/2]=e[n],r[n/2]=e[n+1];return{real:t,imag:r}}function LY(e){let t=Math.ceil(e.length/4),r=new Float32Array(t),n=new Float32Array(t);for(let o=0;o<e.length;o+=4)r[Math.floor(o/4)]=e[o],n[Math.floor(o/4)]=e[o+1];return{real:r,imag:n}}function BY(e){let t=Math.floor(e.length/4),r=new Float32Array(t),n=new Float32Array(t);for(let o=2;o<e.length;o+=4)r[Math.floor(o/4)]=e[o],n[Math.floor(o/4)]=e[o+1];return{real:r,imag:n}}function MY(e,t){let r=e[t*2],n=e[t*2+1];return{real:r,imag:n}}function UY(e,t,r,n){e[n*2]=t,e[n*2+1]=r}function VY(e,t){let r=new Float32Array(e/2),n=new Float32Array(e/2);for(let o=0;o<Math.ceil(e/2);o++){let s=(t?2:-2)*Math.PI*(o/e);r[o]=Math.cos(s),n[o]=Math.sin(s)}return{real:r,imag:n}}function GY(e,t,r){let n=(r?2:-2)*Math.PI*(e/t),o=Math.cos(n),s=Math.sin(n);return{real:o,imag:s}}var hS="->",WY=/->/g,kO=",",$O="...";function zY(e,t){e=e.replace(/\s/g,"");let r=(e.length-e.replace(WY,"").length)/hS.length;if(r<1)throw new Error("Equations without an arrow are not supported.");if(r>1)throw new Error(`Equation must contain exactly one arrow ("${hS}").`);let[n,o]=e.split(hS);O(n.indexOf($O)===-1,()=>`The ellipsis notation ("${$O}") is not supported yet.`);let s=n.split(kO),i=s.length;if(t!==i)throw new Error(`Expected ${i} input tensors, received ${t}`);if(i>2)throw new Error("Support for more than 2 input tensors is not implemented yet.");let a=[];for(let h=0;h<o.length;++h){let x=o[h];if(!s.some(y=>y.indexOf(x)!==-1))throw new Error(`Output subscripts contain the label ${x} not present in the input subscripts.`);a.indexOf(x)===-1&&a.push(x)}for(let h=0;h<n.length;++h){let x=n[h];a.indexOf(x)===-1&&x!==kO&&a.push(x)}let u=new Array(s.length);for(let h=0;h<i;++h){if(new Set(s[h].split("")).size!==s[h].length)throw new Error(`Found duplicate axes in input component ${s[h]}. Support for duplicate axes in input is not implemented yet.`);u[h]=[];for(let x=0;x<s[h].length;++x)u[h].push(a.indexOf(s[h][x]))}let c=a.length,p=o.length,m=[];for(let h=p;h<c;++h)m.push(h);return{allDims:a,summedDims:m,idDims:u}}function HY(e,t){let r=new Array(e);r.fill(-1);for(let o=0;o<t.length;++o)r[t[o]]=o;let n=[];for(let o=0;o<e;++o)r[o]===-1&&n.push(o);return r=r.filter(o=>o!==-1),{permutationIndices:r,expandDims:n}}function KY(e,t,r){let n=new Array(e);for(let o=0;o<r.length;++o){let s=r[o].shape;for(let i=0;i<t[o].length;++i)n[t[o][i]]===void 0?n[t[o][i]]=s[i]:O(n[t[o][i]]===s[i],()=>`Expected dimension ${n[t[o][i]]} at axis ${i} of input shaped ${JSON.stringify(s)}, but got dimension ${s[i]}`)}}function qY(e,t){let r=e,n=[],o=0;e.length===0&&r.push(-1),o=e.length+1;for(let i=0;i<o;++i)n.push([]);let s=[];for(let i=0;i<r.length;++i){let a=r[i],u=XY(t,a);for(let c of u)s.indexOf(c)===-1&&(n[i].push(c),s.push(c))}return{path:r,steps:n}}function jY(e){return e.every((t,r)=>t===r)}function XY(e,t){let r=[];for(let n=0;n<e.length;++n)(e[n].length===0||e[n].indexOf(t)!==-1||t===-1)&&r.push(n);return r}function YY(e,t,r=0){let n=[];if(typeof t=="number")O(e.shape[r]%t===0,()=>"Number of splits must evenly divide the axis."),n=new Array(t).fill(e.shape[r]/t);else{let o=t.reduce((i,a)=>(a===-1&&(i+=1),i),0);O(o<=1,()=>"There should be only one negative value in split array.");let s=t.indexOf(-1);if(s!==-1){let i=t.reduce((a,u)=>u>0?a+u:a);t[s]=e.shape[r]-i}O(e.shape[r]===t.reduce((i,a)=>i+a),()=>"The sum of sizes must match the size of the axis dimension."),n=t}return n}function ZY(e){return`Received SparseTensor with denseShape[0] = 0 but
  indices.shape[0] = ${e}`}function QY(e,t){return`indices(${e}, 0) is invalid: ${t} < 0`}function JY(e,t,r){return`indices(${e}, 0) is invalid: ${t} >= ${r}`}function eZ(e,t){return`only one output dimension may be -1, not both ${e} and ${t}`}function tZ(e,t){return`size ${e} must be non-negative, not ${t}`}function rZ(){return"reshape cannot infer the missing input size for an empty tensor unless all specified input sizes are non-zero"}function nZ(e,t){let r=rt(e),n=rt(t);return`Input to reshape is a SparseTensor with ${r}
  dense values, but the requested shape requires a multiple of ${n}. inputShape=${e} outputShape= ${t}`}function oZ(e,t){let r=rt(e),n=rt(t);return`Input to reshape is a tensor with ${r} dense values, but the requested shape has ${n}. inputShape=${e} outputShape=${t}`}function sZ(){return"segment ids must be >= 0"}function iZ(){return"segment ids are not increasing"}function aZ(e,t){return`Segment id ${e} out of range [0, ${t}), possibly because segmentIds input is not sorted.`}function uZ(e,t,r){return`Bad: indices[${e}] == ${t} out of range [0, ${r})`}var dS={};$t(dS,{collectGatherOpShapeInfo:()=>pZ,computeOutShape:()=>cZ,segOpComputeOptimalWindowSize:()=>lZ});function lZ(e,t){let r=!1,n;for(e<=oy?(n=e,r=!0):n=Dc(e,Math.floor(Math.sqrt(e)));!r;)n>t||n===e?r=!0:n=Dc(e,n+1);return n}function cZ(e,t,r){let n=[],o=e.length;for(let s=0;s<o;s++)s!==t?n.push(e[s]):n.push(r);return n}function pZ(e,t,r,n){let o=t.shape.length,s=e.shape.length;if(n!==0&&(n<-o||n>o))throw new Error(`Expect batchDims in the range of [-${o}, ${o}], but got ${n}`);if(n<0&&(n+=o),n>s)throw new Error(`batchDims (${n}) must be less than rank(x) (
    ${s}).`);if(r<n)throw new Error(`batchDims (${n}) must be less than or equal to axis (${r}).`);for(let m=0;m<n;++m)if(e.shape[m]!==t.shape[m])throw new Error(`x.shape[${m}]: ${e.shape[m]} should be equal to indices.shape[${m}]: ${t.shape[m]}.`);let i=e.shape[r],a=[],u=1,c=1,p=1;for(let m=0;m<n;++m)a.push(e.shape[m]),u*=e.shape[m];for(let m=n;m<r;m++)a.push(e.shape[m]),c*=e.shape[m];for(let m=n;m<o;m++)a.push(t.shape[m]);for(let m=r+1;m<s;m++)a.push(e.shape[m]),p*=e.shape[m];return{batchSize:u,sliceSize:p,outerSize:c,dimSize:i,outputShape:a}}function fZ(e){try{return e.map(t=>pp(t))}catch(t){throw new Error(`Failed to decode encoded string bytes into utf-8, error: ${t}`)}}function mZ(e){return e.map(t=>cp(t))}var Ci={};$t(Ci,{nonMaxSuppressionV3Impl:()=>H0,nonMaxSuppressionV4Impl:()=>K0,nonMaxSuppressionV5Impl:()=>q0,whereImpl:()=>U0});aO();var hZ=z();hZ.registerFlag("KEEP_INTERMEDIATE_TENSORS",()=>!1,e=>{e&&console.warn("Keep intermediate tensors is ON. This will print the values of all intermediate tensors during model inference. Not all models support this mode. For details, check e2e/benchmarks/ model_config.js. This significantly impacts performance.")});var wo=function(e){return e[e.DT_INVALID=0]="DT_INVALID",e[e.DT_FLOAT=1]="DT_FLOAT",e[e.DT_DOUBLE=2]="DT_DOUBLE",e[e.DT_INT32=3]="DT_INT32",e[e.DT_UINT8=4]="DT_UINT8",e[e.DT_INT16=5]="DT_INT16",e[e.DT_INT8=6]="DT_INT8",e[e.DT_STRING=7]="DT_STRING",e[e.DT_COMPLEX64=8]="DT_COMPLEX64",e[e.DT_INT64=9]="DT_INT64",e[e.DT_BOOL=10]="DT_BOOL",e[e.DT_QINT8=11]="DT_QINT8",e[e.DT_QUINT8=12]="DT_QUINT8",e[e.DT_QINT32=13]="DT_QINT32",e[e.DT_BFLOAT16=14]="DT_BFLOAT16",e[e.DT_QINT16=15]="DT_QINT16",e[e.DT_QUINT16=16]="DT_QUINT16",e[e.DT_UINT16=17]="DT_UINT16",e[e.DT_COMPLEX128=18]="DT_COMPLEX128",e[e.DT_HALF=19]="DT_HALF",e[e.DT_RESOURCE=20]="DT_RESOURCE",e[e.DT_VARIANT=21]="DT_VARIANT",e[e.DT_UINT32=22]="DT_UINT32",e[e.DT_UINT64=23]="DT_UINT64",e[e.DT_FLOAT_REF=101]="DT_FLOAT_REF",e[e.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",e[e.DT_INT32_REF=103]="DT_INT32_REF",e[e.DT_UINT8_REF=104]="DT_UINT8_REF",e[e.DT_INT16_REF=105]="DT_INT16_REF",e[e.DT_INT8_REF=106]="DT_INT8_REF",e[e.DT_STRING_REF=107]="DT_STRING_REF",e[e.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",e[e.DT_INT64_REF=109]="DT_INT64_REF",e[e.DT_BOOL_REF=110]="DT_BOOL_REF",e[e.DT_QINT8_REF=111]="DT_QINT8_REF",e[e.DT_QUINT8_REF=112]="DT_QUINT8_REF",e[e.DT_QINT32_REF=113]="DT_QINT32_REF",e[e.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF",e[e.DT_QINT16_REF=115]="DT_QINT16_REF",e[e.DT_QUINT16_REF=116]="DT_QUINT16_REF",e[e.DT_UINT16_REF=117]="DT_UINT16_REF",e[e.DT_COMPLEX128_REF=118]="DT_COMPLEX128_REF",e[e.DT_HALF_REF=119]="DT_HALF_REF",e[e.DT_RESOURCE_REF=120]="DT_RESOURCE_REF",e[e.DT_VARIANT_REF=121]="DT_VARIANT_REF",e[e.DT_UINT32_REF=122]="DT_UINT32_REF",e[e.DT_UINT64_REF=123]="DT_UINT64_REF",e}(wo||{}),OO;(function(e){let t;(function(r){r[r.LEGACY=0]="LEGACY",r[r.V1=1]="V1",r[r.V2=2]="V2"})(t=e.CheckpointFormatVersion||(e.CheckpointFormatVersion={}))})(OO||(OO={}));var gZ={};function sy(e){return gZ[e]}function S(e,t,r,n,o){let s=t.inputParams[e];if(s&&s.inputIndexStart!==void 0){let a=s.inputIndexStart,u=s.inputIndexEnd===0?void 0:s.inputIndexEnd===void 0?a+1:s.inputIndexEnd,c=a<0?t.inputNames.length+a:a;if(s.type==="tensor")return Tr(t.inputNames[c],r,n,o);if(s.type==="tensors"){let h=t.inputs.slice(a,u);return t.inputNames.slice(a,u).filter((y,v)=>{var w;return((w=h[v])===null||w===void 0?void 0:w.op)!=="NoOp"}).map(y=>Tr(y,r,n,o))}let p=Tr(t.inputNames[c],r,n,o),m=p.dataSync();return s.type==="number"?m[0]:A.toNestedArray(p.shape,m)}let i=t.attrParams[e];return i&&i.value}function Tr(e,t,r,n){let[o,s]=$n(e,r);if(n!=null){let a=n.getHashTableHandleByName(o);if(a!=null)return a}let i=r.currentContextIds.find(a=>!!t[iy(o,a)]);return i!==void 0?t[iy(o,i)][s]:void 0}function gS(e,t,r){return t[iy(e,r.currentContextId)]}function Vs(e,t){let[r,n,o]=$n(e,t);return[iy(r,t&&t.currentContextId),n,o]}function iy(e,t){return t?`${e}-${t}`:e}function $n(e,t){if(e==="")return["",0,void 0];let r=t!=null&&t.parseNodeNameCache!=null;if(r){let s=t.parseNodeNameCache.get(e);if(s!=null)return s}let n=e.split(":"),o;if(n.length===1)o=[e,0,void 0];else{let s=n[0],i=n.length===3?n[1]:void 0,a=Number(n[n.length-1]);o=[s,a,i]}return r&&t.parseNodeNameCache.set(e,o),o}function eh(e,t,r){let n=S("pad",e,t,r);if(n==="explicit"){n=S("explicitPaddings",e,t,r);let o=[[0,0],[0,0],[0,0],[0,0]];for(let s=0;s<4;s++)o[s][0]=n[s*2],o[s][1]=n[s*2+1];return o}return n}function Gs(e){return e.kept?e:bo(e)}var xS={};$t(xS,{json:()=>xZ});var xZ=[{tfOpName:"Add",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddV2",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddN",category:"arithmetic",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"BiasAdd",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"Sub",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"RealDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Div",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"DivNoNan",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mul",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Maximum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Minimum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Pow",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SquaredDifference",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorMod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}];var yS={};$t(yS,{json:()=>yZ});var yZ=[{tfOpName:"Abs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan2",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Ceil",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ClipByValue",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"clipValueMin",type:"number"},{start:2,name:"clipValueMax",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Complex",category:"basic_math",inputs:[{start:0,name:"real",type:"tensor"},{start:1,name:"imag",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ComplexAbs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Elu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Exp",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Floor",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Imag",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Neg",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Real",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Prelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"alpha",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu6",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Selu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sigmoid",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Rsqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Square",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sign",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Round",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Expm1",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log1p",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Reciprocal",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Softplus",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Erf",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LeakyRelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"alpha",name:"alpha",type:"number",defaultValue:.2},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"IsNan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"IsFinite",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"IsInf",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}];var bS={};$t(bS,{json:()=>bZ});var bZ=[{tfOpName:"EmptyTensorList",category:"control",inputs:[{start:0,name:"elementShape",type:"shape"},{start:1,name:"maxNumElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"LoopCond",category:"control",inputs:[{start:0,name:"pred",type:"tensor"}]},{tfOpName:"Switch",category:"control",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"pred",type:"tensor"}]},{tfOpName:"Merge",category:"control",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"Enter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"frame_name",name:"frameName",type:"string"},{tfName:"is_constant",name:"isConstant",type:"bool"}]},{tfOpName:"Exit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NextIteration",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayV3",category:"control",inputs:[{start:0,name:"size",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"dynamic_size",name:"dynamicSize",type:"bool"},{tfName:"clear_after_read",name:"clearAfterRead",type:"bool"},{tfName:"identical_element_shapes",name:"identicalElementShapes",type:"bool"},{tfName:"tensor_array_name",name:"name",type:"string"}]},{tfOpName:"TensorArrayWriteV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayReadV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayGatherV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"}]},{tfOpName:"TensorArrayScatterV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArrayConcatV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape_except0",name:"elementShapeExcept0",type:"shape",notSupported:!0}]},{tfOpName:"TensorArraySplitV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"tensor",type:"tensor"},{start:2,name:"lengths",type:"number[]"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArraySizeV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"flowIn",type:"number"}]},{tfOpName:"TensorArrayCloseV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"}]},{tfOpName:"StatelessIf",category:"control",inputs:[{start:0,name:"cond",type:"tensor"},{start:1,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"then_branch",name:"thenBranch",type:"func"},{tfName:"else_branch",name:"elseBranch",type:"func"}]},{tfOpName:"If",category:"control",inputs:[{start:0,name:"cond",type:"tensor"},{start:1,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"then_branch",name:"thenBranch",type:"func"},{tfName:"else_branch",name:"elseBranch",type:"func"}]},{tfOpName:"StatelessWhile",category:"control",inputs:[{start:0,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"cond",name:"cond",type:"func"},{tfName:"body",name:"body",type:"func"}]},{tfOpName:"While",category:"control",inputs:[{start:0,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"cond",name:"cond",type:"func"},{tfName:"body",name:"body",type:"func"}]},{tfOpName:"TensorListScatter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListScatterV2",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"},{start:3,name:"numElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListGather",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListGetItem",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListSetItem",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListReserve",category:"control",inputs:[{start:0,name:"elementShape",type:"shape"},{start:1,name:"numElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListFromTensor",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListStack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"},{tfName:"num_elements",name:"numElements",type:"dtype"}]},{tfOpName:"TensorListSplit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"elementShape",type:"shape"},{start:2,name:"lengths",type:"number[]"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListConcat",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}],attrs:[{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListConcatV2",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}],attrs:[{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListPopBack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListPushBack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"tensor",type:"tensor"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListLength",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}]},{tfOpName:"TensorListResize",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"size",type:"number"}]}];var vS={};$t(vS,{json:()=>vZ});var vZ=[{tfOpName:"AvgPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[],notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPoolWithArgmax",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"include_batch_in_index",name:"includeBatchInIndex",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AvgPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Conv1D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"stride",name:"stride",type:"number"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NWC"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"dilation",name:"dilation",type:"number",defaultValue:1}]},{tfOpName:"Conv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"useCudnnOnGpu",name:"useCudnnOnGpu",type:"bool"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"_FusedConv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"use_cudnn_on_gpu",name:"useCudnnOnGpu",type:"bool",defaultValue:!0},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"leakyrelu_alpha",name:"leakyreluAlpha",type:"number",defaultValue:.2}]},{tfOpName:"Conv2DBackpropInput",category:"convolution",inputs:[{start:2,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:0,name:"outputShape",type:"number[]"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]",notSupported:!0}]},{tfOpName:"DepthwiseConv2d",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"DepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"FusedDepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]}]},{tfOpName:"Conv3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"Dilation2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"rates",name:"dilations",type:"number[]"},{tfName:"padding",name:"pad",type:"string"}]}];var wS={};$t(wS,{json:()=>wZ});var wZ=[{tfOpName:"Fill",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"},{start:1,name:"value",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"LinSpace",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"num",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"OneHot",category:"creation",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"depth",type:"number"},{start:2,name:"onValue",type:"number",defaultValue:1},{start:3,name:"offValue",type:"number",defaultValue:0}],attrs:[{tfName:"axis",name:"axis",type:"number",notSupported:!0},{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"Ones",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"OnesLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"RandomStandardNormal",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"RandomUniform",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"minval",name:"minval",type:"number",defaultValue:0},{tfName:"maxval",name:"maxval",type:"number",defaultValue:1},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"RandomUniformInt",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"minval",name:"minval",type:"number"},{tfName:"maxval",name:"maxval",type:"number"},{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0}]},{tfOpName:"Range",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"step",type:"number",defaultValue:0}],attrs:[{tfName:"Tidx",name:"dtype",type:"dtype"}]},{tfOpName:"TruncatedNormal",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"means",name:"mean",type:"number",defaultValue:0},{tfName:"stddev",name:"stdDev",type:"number",defaultValue:1},{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"Zeros",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"ZerosLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"Multinomial",category:"creation",inputs:[{start:0,name:"logits",type:"tensor"},{start:1,name:"numSamples",type:"number"}],attrs:[{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number"},{tfName:"T",name:"dtype",type:"dtype"},{tfName:"output_dtype",name:"output_dtype",type:"dtype"}]}];var TS={};$t(TS,{json:()=>TZ});var TZ=[{tfOpName:"NonMaxSuppressionV2",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV3",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV4",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"T_threshold",name:"threshold",type:"dtype",notSupported:!0},{tfName:"pad_to_max_output_size",name:"padToMaxOutputSize",type:"bool"}]},{tfOpName:"NonMaxSuppressionV5",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"},{start:5,name:"softNmsSigma",type:"number"}]},{tfOpName:"Where",category:"dynamic",inputs:[{start:0,name:"condition",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ListDiff",category:"dynamic",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}];var SS={};$t(SS,{json:()=>SZ});var SZ=[{tfOpName:"LowerBound",category:"evaluation",inputs:[{start:0,name:"sortedSequence",type:"tensor"},{start:1,name:"values",type:"tensor"}]},{tfOpName:"TopKV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"k",type:"number"}],attrs:[{tfName:"sorted",name:"sorted",type:"bool"}]},{tfOpName:"UpperBound",category:"evaluation",inputs:[{start:0,name:"sortedSequence",type:"tensor"},{start:1,name:"values",type:"tensor"}]},{tfOpName:"Unique",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"UniqueV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]}];var CS={};$t(CS,{json:()=>CZ});var CZ=[{tfOpName:"PlaceholderWithDefault",category:"graph",inputs:[{start:0,name:"default",type:"tensor"}],attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Placeholder",category:"graph",attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Const",category:"graph"},{tfOpName:"Identity",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IdentityN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Snapshot",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Rank",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Size",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Shape",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"ShapeN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Print",category:"graph",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"data",type:"tensors"}],attrs:[{tfName:"message",name:"message",type:"string"},{tfName:"first_n",name:"firstN",type:"number",notSupported:!0},{tfName:"summarize",name:"summarize",type:"number",defaultValue:3}]},{tfOpName:"NoOp",category:"graph",inputs:[]},{tfOpName:"StopGradient",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"FakeQuantWithMinMaxVars",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"min",name:"min",type:"number"},{tfName:"max",name:"max",type:"number"}]}];var ES={};$t(ES,{json:()=>EZ});var EZ=[{tfOpName:"HashTable",category:"hash_table",inputs:[],attrs:[{tfName:"shared_name",name:"sharedName",type:"string"},{tfName:"use_node_name_sharing",name:"useNodeNameSharing",type:"bool"},{tfName:"key_dtype",name:"keyDType",type:"dtype"},{tfName:"value_dtype",name:"valueDType",type:"dtype"}]},{tfOpName:"HashTableV2",category:"hash_table",inputs:[],attrs:[{tfName:"shared_name",name:"sharedName",type:"string"},{tfName:"use_node_name_sharing",name:"useNodeNameSharing",type:"bool"},{tfName:"key_dtype",name:"keyDType",type:"dtype"},{tfName:"value_dtype",name:"valueDType",type:"dtype"}]},{tfOpName:"LookupTableImport",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableImportV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableFind",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableFindV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableSize",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"}]},{tfOpName:"LookupTableSizeV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"}]},{tfOpName:"InitializeTable",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}]},{tfOpName:"InitializeTableV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}]}];var NS={};$t(NS,{json:()=>NZ});var NZ=[{tfOpName:"ResizeBilinear",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"half_pixel_centers",name:"halfPixelCenters",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ResizeNearestNeighbor",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"half_pixel_centers",name:"halfPixelCenters",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"CropAndResize",category:"image",inputs:[{start:0,name:"image",type:"tensor"},{start:1,name:"boxes",type:"tensor"},{start:2,name:"boxInd",type:"tensor"},{start:3,name:"cropSize",type:"number[]"}],attrs:[{tfName:"method",name:"method",type:"string"},{tfName:"extrapolation_value",name:"extrapolationValue",type:"number"}]},{tfOpName:"ImageProjectiveTransformV3",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"transforms",type:"tensor"},{start:2,name:"outputShape",type:"number[]"},{start:3,name:"fillValue",type:"number"}],attrs:[{tfName:"interpolation",name:"interpolation",type:"string"},{tfName:"fill_mode",name:"fillMode",type:"string"}]}];var _S={};$t(_S,{json:()=>_Z});var _Z=[{tfOpName:"Equal",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NotEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Greater",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"GreaterEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Less",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LessEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalAnd",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalNot",category:"logical",inputs:[{start:0,name:"a",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalOr",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Select",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SelectV2",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BitwiseAnd",category:"logical",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}]}];var IS={};$t(IS,{json:()=>IZ});var IZ=[{tfOpName:"_FusedMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"leakyrelu_alpha",name:"leakyreluAlpha",type:"number",defaultValue:.2},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMulV2",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Transpose",category:"matrices",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"perm",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Einsum",category:"matrices",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"equation",name:"equation",type:"string"},{tfName:"N",name:"n",type:"number",defaultValue:2},{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"MatrixBandPart",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"numLower",type:"tensor"},{start:1,name:"numUpper",type:"tensor"}]}];var AS={};$t(AS,{json:()=>AZ});var AZ=[{tfOpName:"EuclideanNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool",defaultValue:!1}]},{tfOpName:"FusedBatchNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV2",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV3",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"LRN",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"depth_radius",name:"radius",type:"number",defaultValue:5},{tfName:"bias",name:"bias",type:"number",defaultValue:1},{tfName:"alpha",name:"alpha",type:"number",defaultValue:1},{tfName:"beta",name:"beta",type:"number",defaultValue:.5}]},{tfOpName:"Softmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"LogSoftmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]}];var kS={};$t(kS,{json:()=>kZ});var kZ=[{tfOpName:"Bincount",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"size",type:"number"},{start:2,name:"weights",type:"tensor"}]},{tfOpName:"DenseBincount",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"size",type:"number"},{start:2,name:"weights",type:"tensor"}],attrs:[{tfName:"binary_output",name:"binaryOutput",type:"bool"}]},{tfOpName:"Max",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Mean",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Min",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Sum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"All",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Any",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"ArgMax",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"ArgMin",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"Prod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cumprod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}],attrs:[{tfName:"exclusive",name:"exclusive",type:"bool"},{tfName:"reverse",name:"reverse",type:"bool"}]},{tfOpName:"Cumsum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}],attrs:[{tfName:"exclusive",name:"exclusive",type:"bool"},{tfName:"reverse",name:"reverse",type:"bool"}]}];var $S={};$t($S,{json:()=>$Z});var $Z=[{tfOpName:"ConcatV2",category:"slice_join",inputs:[{start:0,end:-1,name:"tensors",type:"tensors"},{start:-1,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"Concat",category:"slice_join",inputs:[{start:1,end:0,name:"tensors",type:"tensors"},{start:0,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"GatherV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"axis",type:"number",defaultValue:0}],attrs:[{tfName:"batch_dims",name:"batchDims",type:"number",defaultValue:0}]},{tfOpName:"Gather",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",notSupported:!0}]},{tfOpName:"Reverse",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"dims",type:"bool[]"}]},{tfOpName:"ReverseV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}]},{tfOpName:"Slice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"size",type:"number[]"}]},{tfOpName:"StridedSlice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"end",type:"number[]"},{start:3,name:"strides",type:"number[]"}],attrs:[{tfName:"begin_mask",name:"beginMask",type:"number",defaultValue:0},{tfName:"end_mask",name:"endMask",type:"number",defaultValue:0},{tfName:"new_axis_mask",name:"newAxisMask",type:"number",defaultValue:0},{tfName:"ellipsis_mask",name:"ellipsisMask",type:"number",defaultValue:0},{tfName:"shrink_axis_mask",name:"shrinkAxisMask",type:"number",defaultValue:0}]},{tfOpName:"Pack",category:"slice_join",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0}]},{tfOpName:"Unpack",category:"slice_join",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0},{tfName:"num",name:"num",type:"number",defaultValue:0,notSupported:!0}]},{tfOpName:"Tile",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"reps",type:"number[]"}]},{tfOpName:"Split",category:"slice_join",inputs:[{start:0,name:"axis",type:"number",defaultValue:0},{start:1,name:"x",type:"tensor"}],attrs:[{tfName:"num_split",name:"numOrSizeSplits",type:"number",defaultValue:1}]},{tfOpName:"SplitV",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"numOrSizeSplits",type:"number[]"},{start:2,name:"axis",type:"number",defaultValue:0}]},{tfOpName:"ScatterNd",category:"slice_join",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"shape",type:"number[]"}]},{tfOpName:"GatherNd",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}]},{tfOpName:"SparseToDense",category:"slice_join",inputs:[{start:0,name:"sparseIndices",type:"tensor"},{start:1,name:"outputShape",type:"number[]"},{start:2,name:"sparseValues",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",defaultValue:!1,notSupported:!0}]},{tfOpName:"TensorScatterUpdate",category:"slice_join",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"values",type:"tensor"}]}];var RS={};$t(RS,{json:()=>RZ});var RZ=[{tfOpName:"SparseFillEmptyRows",category:"sparse",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"denseShape",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}]},{tfOpName:"SparseReshape",category:"sparse",inputs:[{start:0,name:"inputIndices",type:"tensor"},{start:1,name:"inputShape",type:"tensor"},{start:2,name:"newShape",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SparseSegmentMean",category:"sparse",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"segmentIds",type:"tensor"}]},{tfOpName:"SparseSegmentSum",category:"sparse",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"segmentIds",type:"tensor"}]}];var OS={};$t(OS,{json:()=>OZ});var OZ=[{tfOpName:"FFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"RFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]},{tfOpName:"IRFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]}];var DS={};$t(DS,{json:()=>DZ});var DZ=[{tfOpName:"StaticRegexReplace",category:"string",inputs:[{start:0,name:"input",type:"tensor"}],attrs:[{tfName:"pattern",name:"pattern",type:"string"},{tfName:"rewrite",name:"rewrite",type:"string"},{tfName:"replace_global",name:"replaceGlobal",type:"bool"}]},{tfOpName:"StringNGrams",category:"string",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"dataSplits",type:"tensor"}],attrs:[{tfName:"separator",name:"separator",type:"string"},{tfName:"ngram_widths",name:"nGramWidths",type:"number[]"},{tfName:"left_pad",name:"leftPad",type:"string"},{tfName:"right_pad",name:"rightPad",type:"string"},{tfName:"pad_width",name:"padWidth",type:"number"},{tfName:"preserve_short_sequences",name:"preserveShortSequences",type:"bool"}],outputs:["ngrams","ngrams_splits"]},{tfOpName:"StringSplit",category:"string",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"delimiter",type:"tensor"}],attrs:[{tfName:"skip_empty",name:"skipEmpty",type:"bool"}],outputs:["indices","values","shape"]},{tfOpName:"StringToHashBucketFast",category:"string",inputs:[{start:0,name:"input",type:"tensor"}],attrs:[{tfName:"num_buckets",name:"numBuckets",type:"number"}]}];var FS={};$t(FS,{json:()=>FZ});var FZ=[{tfOpName:"Cast",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"SrcT",name:"sdtype",type:"dtype",notSupported:!0},{tfName:"DstT",name:"dtype",type:"dtype"}]},{tfOpName:"ExpandDims",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"MirrorPad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"mode",name:"mode",type:"string"}]},{tfOpName:"Pad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"constant_value",name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"PadV2",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"},{start:2,name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"Reshape",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}]},{tfOpName:"EnsureShape",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}]},{tfOpName:"Squeeze",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"axis",tfDeprecatedName:"squeeze_dims",name:"axis",type:"number[]"}]},{tfOpName:"SpaceToBatchND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"paddings",type:"number[]"}]},{tfOpName:"BatchToSpaceND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"crops",type:"number[]"}]},{tfOpName:"DepthToSpace",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"block_size",name:"blockSize",type:"number"},{tfName:"data_format",name:"dataFormat",type:"string"}]},{tfOpName:"BroadcastTo",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}],attrs:[]},{tfOpName:"BroadcastArgs",category:"transformation",inputs:[{start:0,name:"s0",type:"tensor"},{start:1,name:"s1",type:"tensor"}],attrs:[]}];var th=class{static get Instance(){return this._instance||(this._instance=new this)}constructor(){let t=[xS,yS,bS,vS,wS,TS,SS,CS,ES,NS,_S,IS,AS,kS,$S,RS,OS,DS,FS],r=[].concat(...t.map(n=>n.json));this.opMappers=r.reduce((n,o)=>(n[o.tfOpName]=o,n),{})}transformGraph(t,r={}){let n=t.node,o=[],s=[],i=[],a=n.reduce((v,w)=>(v[w.name]=this.mapNode(w),w.op.startsWith("Placeholder")?o.push(v[w.name]):w.op==="Const"?s.push(v[w.name]):(w.input==null||w.input.length===0)&&i.push(v[w.name]),v),{}),u=[],c=[],p={},m={};r!=null&&(p=this.mapSignatureEntries(r.inputs),m=this.mapSignatureEntries(r.outputs));let h=Object.keys(a);h.forEach(v=>{let w=a[v];w.inputNames.forEach((C,I)=>{let[D,,P]=Vs(C),G=a[D];if(G.outputs!=null){let q=G.outputs.indexOf(P);if(q!==-1){let Z=`${D}:${q}`;w.inputNames[I]=Z}}w.inputs.push(G),G.children.push(w)})}),Object.keys(m).length===0?h.forEach(v=>{let w=a[v];w.children.length===0&&c.push(w)}):Object.keys(m).forEach(v=>{let[w]=Vs(v),C=a[w];C!=null&&(C.signatureKey=m[v],c.push(C))}),Object.keys(p).length>0?Object.keys(p).forEach(v=>{let[w]=Vs(v),C=a[w];C&&(C.signatureKey=p[v],u.push(C))}):u=o;let x={};t.library!=null&&t.library.function!=null&&(x=t.library.function.reduce((v,w)=>(v[w.signature.name]=this.mapFunction(w),v),{}));let y={nodes:a,inputs:u,outputs:c,weights:s,placeholders:o,signature:r,functions:x};return i.length>0&&(y.initNodes=i),y}mapSignatureEntries(t){return Object.keys(t||{}).reduce((r,n)=>(r[t[n].name]=n,r),{})}mapNode(t){let r=sy(t.op)||this.opMappers[t.op]||{};t.attr==null&&(t.attr={});let n={name:t.name,op:t.op,category:r.category,inputNames:(t.input||[]).map(o=>o.startsWith("^")?o.slice(1):o),inputs:[],children:[],inputParams:{},attrParams:{},rawAttrs:t.attr,outputs:r.outputs};return r.inputs!=null&&(n.inputParams=r.inputs.reduce((o,s)=>(o[s.name]={type:s.type,inputIndexStart:s.start,inputIndexEnd:s.end},o),{})),r.attrs!=null&&(n.attrParams=r.attrs.reduce((o,s)=>{let i=s.type,a;switch(s.type){case"string":a=ay(t.attr,s.tfName,s.defaultValue),a===void 0&&s.tfDeprecatedName&&(a=ay(t.attr,s.tfDeprecatedName,s.defaultValue));break;case"string[]":a=hy(t.attr,s.tfName,s.defaultValue),a===void 0&&s.tfDeprecatedName&&(a=hy(t.attr,s.tfDeprecatedName,s.defaultValue));break;case"number":a=ly(t.attr,s.tfName,s.defaultValue||0),a===void 0&&s.tfDeprecatedName&&(a=ly(t.attr,s.tfDeprecatedName,s.defaultValue));break;case"number[]":a=my(t.attr,s.tfName,s.defaultValue),a===void 0&&s.tfDeprecatedName&&(a=my(t.attr,s.tfDeprecatedName,s.defaultValue));break;case"bool":a=uy(t.attr,s.tfName,s.defaultValue),a===void 0&&s.tfDeprecatedName&&(a=uy(t.attr,s.tfDeprecatedName,s.defaultValue));break;case"bool[]":a=gy(t.attr,s.tfName,s.defaultValue),a===void 0&&s.tfDeprecatedName&&(a=gy(t.attr,s.tfDeprecatedName,s.defaultValue));break;case"shape":a=fy(t.attr,s.tfName,s.defaultValue),a===void 0&&s.tfDeprecatedName&&(a=fy(t.attr,s.tfDeprecatedName,s.defaultValue));break;case"shape[]":a=dy(t.attr,s.tfName,s.defaultValue),a===void 0&&s.tfDeprecatedName&&(a=dy(t.attr,s.tfDeprecatedName,s.defaultValue));break;case"dtype":a=cy(t.attr,s.tfName,s.defaultValue),a===void 0&&s.tfDeprecatedName&&(a=cy(t.attr,s.tfDeprecatedName,s.defaultValue));break;case"dtype[]":a=py(t.attr,s.tfName,s.defaultValue),a===void 0&&s.tfDeprecatedName&&(a=py(t.attr,s.tfDeprecatedName,s.defaultValue));break;case"func":a=DO(t.attr,s.tfName,s.defaultValue),a===void 0&&s.tfDeprecatedName&&(a=DO(t.attr,s.tfDeprecatedName,s.defaultValue));break;case"tensor":case"tensors":break;default:throw new Error(`Unsupported param type: ${s.type} for op: ${t.op}`)}return o[s.name]={value:a,type:i},o},{})),n}mapFunction(t){let r=t.nodeDef,n=[],o=[],s={};r!=null&&(s=r.reduce((m,h)=>(m[h.name]=this.mapNode(h),h.op==="Const"&&o.push(m[h.name]),m),{}));let i=[],a=[];t.signature.inputArg.forEach(m=>{let[h]=Vs(m.name),x={name:h,op:"Placeholder",inputs:[],inputNames:[],category:"graph",inputParams:{},attrParams:{dtype:{value:PS(m.type),type:"dtype"}},children:[]};x.signatureKey=m.name,i.push(x),s[h]=x}),Object.keys(s).forEach(m=>{let h=s[m];h.inputNames.forEach((x,y)=>{let[v,,w]=Vs(x),C=s[v];if(C.outputs!=null){let I=C.outputs.indexOf(w);if(I!==-1){let D=`${v}:${I}`;h.inputNames[y]=D}}h.inputs.push(C),C.children.push(h)})});let c=t.ret;t.signature.outputArg.forEach(m=>{let[h,x]=Vs(c[m.name]),y=s[h];y!=null&&(y.defaultOutput=x,a.push(y))});let p=this.mapArgsToSignature(t);return{nodes:s,inputs:i,outputs:a,weights:o,placeholders:n,signature:p}}mapArgsToSignature(t){return{methodName:t.signature.name,inputs:t.signature.inputArg.reduce((r,n)=>(r[n.name]=this.mapArgToTensorInfo(n),r),{}),outputs:t.signature.outputArg.reduce((r,n)=>(r[n.name]=this.mapArgToTensorInfo(n,t.ret),r),{})}}mapArgToTensorInfo(t,r){let n=t.name;return r!=null&&(n=r[n]),{name:n,dtype:t.type}}};function PZ(e){let t=z().global;if(typeof t.atob<"u")return t.atob(e);if(typeof Buffer<"u")return new Buffer(e,"base64").toString();throw new Error("Unable to decode base64 in this environment. Missing built-in atob() or Buffer()")}function FO(e,t){let r=Array.isArray(e)?String.fromCharCode.apply(null,e):PZ(e);return t?r:r.toLowerCase()}function ay(e,t,r,n=!1){let o=e[t];return o!=null?FO(o.s,n):r}function uy(e,t,r){let n=e[t];return n?n.b:r}function ly(e,t,r){let n=e[t]||{},o=n.i!=null?n.i:n.f!=null?n.f:r;return typeof o=="number"?o:parseInt(o,10)}function PS(e){switch(typeof e=="string"&&(e=wo[e]),e){case wo.DT_FLOAT:case wo.DT_HALF:return"float32";case wo.DT_INT32:case wo.DT_INT64:case wo.DT_INT8:case wo.DT_UINT8:return"int32";case wo.DT_BOOL:return"bool";case wo.DT_DOUBLE:return"float32";case wo.DT_STRING:return"string";case wo.DT_COMPLEX64:case wo.DT_COMPLEX128:return"complex64";default:return null}}function DO(e,t,r){let n=e[t];return n&&n.func?n.func.name:r}function cy(e,t,r){let n=e[t];return n&&n.type?PS(n.type):r}function py(e,t,r){let n=e[t];return n&&n.list&&n.list.type?n.list.type.map(o=>PS(o)):r}function PO(e){if(!e.unknownRank)return e.dim!=null?e.dim.map(t=>typeof t.size=="number"?t.size:parseInt(t.size,10)):[]}function fy(e,t,r){let n=e[t];return n&&n.shape?PO(n.shape):r}function my(e,t,r){let n=e[t];return n?((n.list.f&&n.list.f.length?n.list.f:n.list.i)||[]).map(o=>typeof o=="number"?o:parseInt(o,10)):r}function hy(e,t,r,n=!1){let o=e[t];return o&&o.list&&o.list.s?o.list.s.map(s=>FO(s,n)):r}function dy(e,t,r){let n=e[t];return n&&n.list&&n.list.shape?n.list.shape.map(o=>PO(o)):r}function gy(e,t,r){let n=e[t];return n&&n.list&&n.list.b?n.list.b:r}var xy=class{constructor(t,r,n){this.node=t,this.tensorMap=r,this.context=n,this.inputs=[],this.attrs={},this.inputs=t.inputNames.map(o=>this.getInput(o)),t.rawAttrs!=null&&(this.attrs=Object.keys(t.rawAttrs).reduce((o,s)=>(o[s]=this.getAttr(s),o),{}))}getInput(t){return Tr(t,this.tensorMap,this.context)}getAttr(t,r){let n=this.node.rawAttrs[t];if(n.tensor!=null)return Tr(t,this.tensorMap,this.context);if(n.i!=null||n.f!=null)return ly(this.node.rawAttrs,t,r);if(n.s!=null)return ay(this.node.rawAttrs,t,r);if(n.b!=null)return uy(this.node.rawAttrs,t,r);if(n.shape!=null)return fy(this.node.rawAttrs,t,r);if(n.type!=null)return cy(this.node.rawAttrs,t,r);if(n.list!=null){if(n.list.i!=null||n.list.f!=null)return my(this.node.rawAttrs,t,r);if(n.list.s!=null)return hy(this.node.rawAttrs,t,r);if(n.list.shape!=null)return dy(this.node.rawAttrs,t,r);if(n.list.b!=null)return gy(this.node.rawAttrs,t,r);if(n.list.type!=null)return py(this.node.rawAttrs,t,r)}return r}};var ft={};$t(ft,{OP_SCOPE_SUFFIX:()=>FT,abs:()=>Yr,acos:()=>zA,acosh:()=>HA,add:()=>Se,addN:()=>KA,all:()=>qA,any:()=>jA,argMax:()=>XA,argMin:()=>YA,asin:()=>ZA,asinh:()=>QA,atan:()=>JA,atan2:()=>ek,atanh:()=>tk,avgPool:()=>s0,avgPool3d:()=>ok,basicLSTMCell:()=>sk,batchNorm:()=>ja,batchNorm2d:()=>ak,batchNorm3d:()=>uk,batchNorm4d:()=>lk,batchToSpaceND:()=>i0,bincount:()=>a0,bitwiseAnd:()=>ck,booleanMaskAsync:()=>gj,broadcastArgs:()=>pk,broadcastTo:()=>Xa,buffer:()=>st,cast:()=>it,ceil:()=>fk,clipByValue:()=>u0,clone:()=>bo,complex:()=>Hn,concat:()=>Rt,concat1d:()=>mk,concat2d:()=>hk,concat3d:()=>dk,concat4d:()=>gk,conv1d:()=>xk,conv2d:()=>Ya,conv2dTranspose:()=>yk,conv3d:()=>bk,conv3dTranspose:()=>wk,cos:()=>Tk,cosh:()=>Sk,cosineWindow:()=>Xm,cumprod:()=>Ck,cumsum:()=>Ek,denseBincount:()=>Nk,depthToSpace:()=>_k,depthwiseConv2d:()=>yp,diag:()=>Ik,dilation2d:()=>Ak,div:()=>ze,divNoNan:()=>$k,dot:()=>Rk,dropout:()=>Ij,einsum:()=>Qa,elu:()=>f0,enclosingPowerOfTwo:()=>tS,ensureShape:()=>Ok,equal:()=>p0,erf:()=>Dk,euclideanNorm:()=>Lk,exp:()=>jn,expandDims:()=>vo,expm1:()=>Bk,eye:()=>m0,fft:()=>wp,fill:()=>vi,floor:()=>h0,floorDiv:()=>o0,fused:()=>rS,gather:()=>d0,gatherND:()=>Nj,greater:()=>il,greaterEqual:()=>g0,ifft:()=>fl,imag:()=>eu,image:()=>Ym,inTopKAsync:()=>kj,irfft:()=>P0,isFinite:()=>Mk,isInf:()=>Uk,isNaN:()=>Vk,leakyRelu:()=>x0,less:()=>Km,lessEqual:()=>bp,linalg:()=>RX,linspace:()=>Gk,localResponseNormalization:()=>Wk,log:()=>ta,log1p:()=>y0,logSigmoid:()=>Hk,logSoftmax:()=>Kk,logSumExp:()=>v0,logicalAnd:()=>al,logicalNot:()=>w0,logicalOr:()=>T0,logicalXor:()=>qk,losses:()=>OX,lowerBound:()=>jk,matMul:()=>xt,max:()=>wi,maxPool:()=>C0,maxPool3d:()=>Xk,maxPoolWithArgmax:()=>Yk,maximum:()=>E0,mean:()=>ul,meshgrid:()=>Zk,min:()=>Hm,minimum:()=>ll,mirrorPad:()=>Qk,mod:()=>Jk,moments:()=>e$,movingAverage:()=>bj,mul:()=>ce,multiRNNCell:()=>t$,multinomial:()=>r$,neg:()=>on,norm:()=>sl,notEqual:()=>N0,oneHot:()=>n$,ones:()=>Ti,onesLike:()=>o$,op:()=>_,outerProduct:()=>s$,pad:()=>Si,pad1d:()=>i$,pad2d:()=>a$,pad3d:()=>u$,pad4d:()=>l$,pool:()=>c$,pow:()=>ea,prelu:()=>I0,print:()=>n0,prod:()=>p$,raggedGather:()=>f$,raggedRange:()=>m$,raggedTensorToTensor:()=>h$,rand:()=>d$,randomGamma:()=>O$,randomNormal:()=>O0,randomStandardNormal:()=>D$,randomUniform:()=>vp,randomUniformInt:()=>F$,range:()=>tu,real:()=>ra,reciprocal:()=>P$,relu:()=>ru,relu6:()=>D0,reshape:()=>Q,reverse:()=>Ko,reverse1d:()=>L$,reverse2d:()=>B$,reverse3d:()=>M$,reverse4d:()=>U$,rfft:()=>Tp,round:()=>F0,rsqrt:()=>V$,scalar:()=>Be,scatterND:()=>wj,searchSorted:()=>qm,selu:()=>G$,separableConv2d:()=>W$,setdiff1dAsync:()=>z$,sigmoid:()=>xs,sign:()=>H$,signal:()=>$X,sin:()=>K$,sinh:()=>q$,slice:()=>Ve,slice1d:()=>j$,slice2d:()=>X$,slice3d:()=>Y$,slice4d:()=>Z$,softmax:()=>Q$,softplus:()=>b0,spaceToBatchND:()=>_0,sparse:()=>DX,sparseToDense:()=>Cj,spectral:()=>kX,split:()=>na,sqrt:()=>qn,square:()=>Zr,squaredDifference:()=>L0,squeeze:()=>_r,stack:()=>kn,step:()=>B0,stridedSlice:()=>J$,string:()=>FX,sub:()=>Fe,sum:()=>yt,tan:()=>eR,tanh:()=>zm,tensor:()=>An,tensor1d:()=>ar,tensor2d:()=>Us,tensor3d:()=>M0,tensor4d:()=>tR,tensor5d:()=>rR,tensor6d:()=>nR,tensorScatterUpdate:()=>iR,tile:()=>Ja,topk:()=>aR,transpose:()=>G0,truncatedNormal:()=>uR,unique:()=>lR,unsortedSegmentSum:()=>cR,unstack:()=>qo,upperBound:()=>pR,variable:()=>fR,where:()=>Ho,whereAsync:()=>V0,zeros:()=>ys,zerosLike:()=>Pr});var LO=(e,t,r,n=ft)=>{switch(e.op){case"BiasAdd":case"AddV2":case"Add":return[n.add(S("a",e,t,r),S("b",e,t,r))];case"AddN":return[n.addN(S("tensors",e,t,r))];case"FloorMod":case"Mod":return[n.mod(S("a",e,t,r),S("b",e,t,r))];case"Mul":return[n.mul(S("a",e,t,r),S("b",e,t,r))];case"RealDiv":case"Div":return[n.div(S("a",e,t,r),S("b",e,t,r))];case"DivNoNan":return[n.divNoNan(S("a",e,t,r),S("b",e,t,r))];case"FloorDiv":return[n.floorDiv(S("a",e,t,r),S("b",e,t,r))];case"Sub":return[n.sub(S("a",e,t,r),S("b",e,t,r))];case"Minimum":return[n.minimum(S("a",e,t,r),S("b",e,t,r))];case"Maximum":return[n.maximum(S("a",e,t,r),S("b",e,t,r))];case"Pow":return[n.pow(S("a",e,t,r),S("b",e,t,r))];case"SquaredDifference":return[n.squaredDifference(S("a",e,t,r),S("b",e,t,r))];default:throw TypeError(`Node type ${e.op} is not implemented`)}};var BO=(e,t,r,n=ft)=>{switch(e.op){case"Abs":case"ComplexAbs":return[n.abs(S("x",e,t,r))];case"Acos":return[n.acos(S("x",e,t,r))];case"Acosh":return[n.acosh(S("x",e,t,r))];case"Asin":return[n.asin(S("x",e,t,r))];case"Asinh":return[n.asinh(S("x",e,t,r))];case"Atan":return[n.atan(S("x",e,t,r))];case"Atan2":return[n.atan2(S("x",e,t,r),S("y",e,t,r))];case"Atanh":return[n.atanh(S("x",e,t,r))];case"Ceil":return[n.ceil(S("x",e,t,r))];case"Complex":return[n.complex(S("real",e,t,r),S("imag",e,t,r))];case"Cos":return[n.cos(S("x",e,t,r))];case"Cosh":return[n.cosh(S("x",e,t,r))];case"Elu":return[n.elu(S("x",e,t,r))];case"Erf":return[n.erf(S("x",e,t,r))];case"Exp":return[n.exp(S("x",e,t,r))];case"Expm1":return[n.expm1(S("x",e,t,r))];case"Floor":return[n.floor(S("x",e,t,r))];case"Log":return[n.log(S("x",e,t,r))];case"Log1p":return[n.log1p(S("x",e,t,r))];case"Imag":return[n.imag(S("x",e,t,r))];case"Neg":return[n.neg(S("x",e,t,r))];case"Reciprocal":return[n.reciprocal(S("x",e,t,r))];case"Real":return[n.real(S("x",e,t,r))];case"Relu":return[n.relu(S("x",e,t,r))];case"Round":return[n.round(S("x",e,t,r))];case"Selu":return[n.selu(S("x",e,t,r))];case"Sigmoid":return[n.sigmoid(S("x",e,t,r))];case"Sin":return[n.sin(S("x",e,t,r))];case"Sign":return[n.sign(S("x",e,t,r))];case"Sinh":return[n.sinh(S("x",e,t,r))];case"Softplus":return[n.softplus(S("x",e,t,r))];case"Sqrt":return[n.sqrt(S("x",e,t,r))];case"Square":return[n.square(S("x",e,t,r))];case"Tanh":return[n.tanh(S("x",e,t,r))];case"Tan":return[n.tan(S("x",e,t,r))];case"ClipByValue":return[n.clipByValue(S("x",e,t,r),S("clipValueMin",e,t,r),S("clipValueMax",e,t,r))];case"Relu6":return[n.relu6(S("x",e,t,r))];case"Rsqrt":return[n.rsqrt(Tr(e.inputNames[0],t,r))];case"LeakyRelu":return[n.leakyRelu(S("x",e,t,r),S("alpha",e,t,r))];case"Prelu":return[n.prelu(S("x",e,t,r),S("alpha",e,t,r))];case"IsNan":return[n.isNaN(Tr(e.inputNames[0],t,r))];case"IsInf":return[n.isInf(Tr(e.inputNames[0],t,r))];case"IsFinite":return[n.isFinite(Tr(e.inputNames[0],t,r))];default:throw TypeError(`Node type ${e.op} is not implemented`)}};function To(e,t,r=""){if(!(typeof e=="number"||typeof t=="number")){A.assert(e.length===t.length,()=>r+` Shapes ${e} and ${t} must match`);for(let n=0;n<e.length;n++){let o=e[n],s=t[n];A.assert(o<0||s<0||o===s,()=>r+` Shapes ${e} and ${t} must match`)}}}function MO(e){return!(typeof e=="number"||e.some(t=>t<0))}function Cp(e,t,r){let n=yy(e,r),o=!MO(n);if(o&&t.length===0)throw new Error(`Tried to calculate elements of an empty list with non-fully-defined elementShape: ${n}`);if(o&&t.forEach(s=>{n=yy(s.shape,n)}),!MO(n))throw new Error(`Non-fully-defined elementShape: ${n}`);return n}function yy(e,t){if(typeof e=="number")return t;if(typeof t=="number")return e;if(e.length!==t.length)throw new Error(`Incompatible ranks during merge: ${e} vs. ${t}`);let r=[];for(let n=0;n<e.length;++n){let o=e[n],s=t[n];if(o>=0&&s>=0&&o!==s)throw new Error(`Incompatible shape during merge: ${e} vs. ${t}`);r[n]=o>=0?o:s}return r}var by=class{constructor(t,r,n,o,s,i,a){this.name=t,this.dtype=r,this.maxSize=n,this.elementShape=o,this.identicalElementShapes=s,this.dynamicSize=i,this.clearAfterRead=a,this.tensors=[],this.closed_=!1,this.idTensor=Be(0),Kn(this.idTensor)}get id(){return this.idTensor.id}get closed(){return this.closed_}clearAndClose(t){this.tensors.forEach(r=>{(t==null||!t.has(r.tensor.id))&&r.tensor.dispose()}),this.tensors=[],this.closed_=!0,this.idTensor.dispose()}size(){return this.tensors.length}read(t){if(this.closed_)throw new Error(`TensorArray ${this.name} has already been closed.`);if(t<0||t>=this.size())throw new Error(`Tried to read from index ${t}, but array size is: ${this.size()}`);let r=this.tensors[t];if(r.cleared)throw new Error(`TensorArray ${this.name}: Could not read index ${t} twice because it was cleared after a previous read (perhaps try setting clear_after_read = false?).`);return this.clearAfterRead&&(r.cleared=!0),r.read=!0,r.tensor}readMany(t){return t.map(r=>this.read(r))}write(t,r){if(this.closed_)throw new Error(`TensorArray ${this.name} has already been closed.`);if(t<0||!this.dynamicSize&&t>=this.maxSize)throw new Error(`Tried to write to index ${t}, but array is not resizeable and size is: ${this.maxSize}`);let n=this.tensors[t]||{};if(r.dtype!==this.dtype)throw new Error(`TensorArray ${this.name}: Could not write to TensorArray index ${t},
          because the value dtype is ${r.dtype}, but TensorArray dtype is ${this.dtype}.`);if(this.size()===0&&(this.elementShape==null||this.elementShape.length===0)&&(this.elementShape=r.shape),To(this.elementShape,r.shape,`TensorArray ${this.name}: Could not write to TensorArray index ${t}.`),n.read)throw new Error(`TensorArray ${this.name}: Could not write to TensorArray index ${t}, because it has already been read.`);if(n.written)throw new Error(`TensorArray ${this.name}: Could not write to TensorArray index ${t}, because it has already been written.`);n.tensor=r,Kn(r),n.written=!0,this.tensors[t]=n}writeMany(t,r){if(t.length!==r.length)throw new Error(`TensorArray ${this.name}: could not write multiple tensors,because the index size: ${t.length} is not the same as tensors size: ${r.length}.`);t.forEach((n,o)=>this.write(n,r[o]))}gather(t,r){if(r&&r!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but gather requested dtype ${r}`);if(t)t=t.slice(0,this.size());else{t=[];for(let o=0;o<this.size();o++)t.push(o)}if(t.length===0)return An([],[0].concat(this.elementShape));let n=this.readMany(t);return To(this.elementShape,n[0].shape,"TensorArray shape mismatch: "),kn(n,0)}concat(t){if(t&&t!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but concat requested dtype ${t}`);if(this.size()===0)return An([],[0].concat(this.elementShape));let r=[];for(let o=0;o<this.size();o++)r.push(o);let n=this.readMany(r);return To(this.elementShape,n[0].shape,`TensorArray shape mismatch: tensor array shape (${this.elementShape}) vs first tensor shape (${n[0].shape})`),Rt(n,0)}scatter(t,r){if(r.dtype!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but tensor has dtype ${r.dtype}`);if(t.length!==r.shape[0])throw new Error(`Expected len(indices) == tensor.shape[0], but saw: ${t.length} vs. ${r.shape[0]}`);let n=Math.max(...t);if(!this.dynamicSize&&n>=this.maxSize)throw new Error(`Max index must be < array size (${n}  vs. ${this.maxSize})`);this.writeMany(t,qo(r,0))}split(t,r){if(r.dtype!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but tensor has dtype ${r.dtype}`);let n=0,o=t.map(u=>(n+=u,n));if(n!==r.shape[0])throw new Error(`Expected sum of lengths to be equal to
          tensor.shape[0], but sum of lengths is
        ${n}, and tensor's shape is: ${r.shape}`);if(!this.dynamicSize&&t.length!==this.maxSize)throw new Error(`TensorArray's size is not equal to the size of lengths (${this.maxSize} vs. ${t.length}), and the TensorArray is not marked as dynamically resizeable`);let s=n===0?0:r.size/n,i=[];Ue(()=>{r=Q(r,[1,n,s]);for(let u=0;u<t.length;++u){let p=[0,u===0?0:o[u-1],0],m=[1,t[u],s];i[u]=Q(Ve(r,p,m),this.elementShape)}return i});let a=[];for(let u=0;u<t.length;u++)a[u]=u;this.writeMany(a,i)}};var Ep=class e{get id(){return this.idTensor.id}constructor(t,r,n,o=-1){this.tensors=t,this.elementShape=r,this.elementDtype=n,t?.forEach(s=>{if(n!==s.dtype)throw new Error(`Invalid data types; op elements ${n}, but list elements ${s.dtype}`);To(r,s.shape,"TensorList shape mismatch: "),Kn(s)}),this.idTensor=Be(0),this.maxNumElements=o,Kn(this.idTensor)}copy(){return new e([...this.tensors],this.elementShape,this.elementDtype)}clearAndClose(t){this.tensors.forEach(r=>{(t==null||!t.has(r.id))&&r.dispose()}),this.tensors.length=0,this.idTensor.dispose()}size(){return this.tensors.length}stack(t,r,n=-1){if(r!==this.elementDtype)throw new Error(`Invalid data types; op elements ${r}, but list elements ${this.elementDtype}`);if(n!==-1&&this.tensors.length!==n)throw new Error(`Operation expected a list with ${n} elements but got a list with ${this.tensors.length} elements.`);To(t,this.elementShape,"TensorList shape mismatch: ");let o=Cp(this.elementShape,this.tensors,t);return Ue(()=>{let s=this.tensors.map(i=>Q(i,o));return kn(s,0)})}popBack(t,r){if(r!==this.elementDtype)throw new Error(`Invalid data types; op elements ${r}, but list elements ${this.elementDtype}`);if(this.size()===0)throw new Error("Trying to pop from an empty list.");let n=Cp(this.elementShape,this.tensors,t),o=this.tensors.pop();return o.kept=!1,To(o.shape,t,"TensorList shape mismatch: "),Q(o,n)}pushBack(t){if(t.dtype!==this.elementDtype)throw new Error(`Invalid data types; op elements ${t.dtype}, but list elements ${this.elementDtype}`);if(To(t.shape,this.elementShape,"TensorList shape mismatch: "),this.maxNumElements===this.size())throw new Error("Trying to push element into a full list.");Kn(t),this.tensors.push(t)}resize(t){if(t<0)throw new Error(`TensorListResize expects size to be non-negative. Got: ${t}`);if(this.maxNumElements!==-1&&t>this.maxNumElements)throw new Error(`TensorListResize input size ${t} is greater maxNumElement ${this.maxNumElements}.`);let r=new e([],this.elementShape,this.elementDtype,this.maxNumElements);r.tensors.length=t;for(let n=0;n<Math.min(this.tensors.length,t);++n)r.tensors[n]=this.tensors[n];return r}getItem(t,r,n){if(n!==this.elementDtype)throw new Error(`Invalid data types; op elements ${n}, but list elements ${this.elementDtype}`);if(t<0||t>this.tensors.length)throw new Error(`Trying to access element ${t} in a list with ${this.tensors.length} elements.`);if(this.tensors[t]==null)throw new Error(`element at index ${t} is null.`);To(this.tensors[t].shape,r,"TensorList shape mismatch: ");let o=Cp(this.elementShape,this.tensors,r);return Q(this.tensors[t],o)}setItem(t,r){if(r.dtype!==this.elementDtype)throw new Error(`Invalid data types; op elements ${r.dtype}, but list elements ${this.elementDtype}`);if(t<0||this.maxNumElements!==-1&&t>=this.maxNumElements)throw new Error(`Trying to set element ${t} in a list with max ${this.maxNumElements} elements.`);To(this.elementShape,r.shape,"TensorList shape mismatch: "),Kn(r),this.tensors[t]!=null&&(this.tensors[t].kept=!1),this.tensors[t]=r}gather(t,r,n){if(r!==this.elementDtype)throw new Error(`Invalid data types; op elements ${r}, but list elements ${this.elementDtype}`);To(this.elementShape,n,"TensorList shape mismatch: "),t=t.slice(0,this.size());let o=Cp(this.elementShape,this.tensors,n);return t.length===0?An([],[0].concat(o)):Ue(()=>{let s=t.map(i=>Q(this.tensors[i],o));return kn(s,0)})}concat(t,r){if(t&&t!==this.elementDtype)throw new Error(`TensorList dtype is ${this.elementDtype} but concat requested dtype ${t}`);To(this.elementShape,r,"TensorList shape mismatch: ");let n=Cp(this.elementShape,this.tensors,r);return this.size()===0?An([],[0].concat(n)):Ue(()=>{let o=this.tensors.map(s=>Q(s,n));return Rt(o,0)})}};function UO(e,t,r){let n=e.dtype;if(e.shape.length<1)throw new Error(`Tensor must be at least a vector, but saw shape: ${e.shape}`);if(e.dtype!==r)throw new Error(`Invalid data types; op elements ${e.dtype}, but list elements ${r}`);let o=e.shape.slice(1);To(o,t,"TensorList shape mismatch: ");let s=qo(e);return new Ep(s,t,n)}function VO(e,t,r,n){return new Ep([],e,t,n)}function GO(e,t,r,n){if(t.length!==e.shape[0])throw new Error(`Expected len(indices) == tensor.shape[0], but saw: ${t.length} vs. ${e.shape[0]}`);let o=Math.max(...t);if(n!=null&&n!==-1&&o>=n)throw new Error(`Max index must be < array size (${o}  vs. ${n})`);let s=new Ep([],r,e.dtype,n),i=qo(e,0);return t.forEach((a,u)=>{s.setItem(a,i[u])}),s}function WO(e,t,r){let n=0,o=t.map(p=>(n+=p,n));if(n!==e.shape[0])throw new Error(`Expected sum of lengths to be equal to
          tensor.shape[0], but sum of lengths is
        ${n}, and tensor's shape is: ${e.shape}`);let s=e.shape.slice(1),i=yy(s,r),a=n===0?0:e.size/n,u=Ue(()=>{let p=[];e=Q(e,[1,n,a]);for(let m=0;m<t.length;++m){let x=[0,m===0?0:o[m-1],0],y=[1,t[m],a];p[m]=Q(Ve(e,x,y),i)}return e.dispose(),p}),c=new Ep([],r,e.dtype,t.length);for(let p=0;p<u.length;p++)c.setItem(p,u[p]);return c}var zO=(e,t,r)=>ne(void 0,null,function*(){switch(e.op){case"If":case"StatelessIf":{let n=S("thenBranch",e,t,r),o=S("elseBranch",e,t,r),s=S("cond",e,t,r),i=S("args",e,t,r);return(yield s.data())[0]?r.functionMap[n].executeFunctionAsync(i,r.tensorArrayMap,r.tensorListMap):r.functionMap[o].executeFunctionAsync(i,r.tensorArrayMap,r.tensorListMap)}case"While":case"StatelessWhile":{let n=S("body",e,t,r),o=S("cond",e,t,r),s=S("args",e,t,r),i=yield r.functionMap[o].executeFunctionAsync(s,r.tensorArrayMap,r.tensorListMap),a=s.map(p=>p.id),u=yield i[0].data();i.forEach(p=>{!p.kept&&a.indexOf(p.id)===-1&&p.dispose()});let c=s;for(;u[0];){let p=c;c=yield r.functionMap[n].executeFunctionAsync(c,r.tensorArrayMap,r.tensorListMap);let m=c.map(x=>x.id);p.forEach(x=>{!x.kept&&a.indexOf(x.id)===-1&&m.indexOf(x.id)===-1&&x.dispose()});let h=yield r.functionMap[o].executeFunctionAsync(c,r.tensorArrayMap,r.tensorListMap);u=yield h[0].data(),h.forEach(x=>{!x.kept&&a.indexOf(x.id)===-1&&m.indexOf(x.id)===-1&&x.dispose()})}return c}case"LoopCond":{let n=S("pred",e,t,r);return[Gs(n)]}case"Switch":{let n=S("pred",e,t,r),o=S("data",e,t,r);return o.kept||(o=Gs(o)),(yield n.data())[0]?[void 0,o]:[o,void 0]}case"Merge":{let n=e.inputNames.find(o=>Tr(o,t,r)!==void 0);if(n){let o=Tr(n,t,r);return[Gs(o)]}return}case"Enter":{let n=S("frameName",e,t,r),o=S("tensor",e,t,r);return r.enterFrame(n),[Gs(o)]}case"Exit":{let n=S("tensor",e,t,r);return r.exitFrame(),[Gs(n)]}case"NextIteration":{let n=S("tensor",e,t,r);return r.nextIteration(),[Gs(n)]}case"TensorArrayV3":{let n=S("size",e,t,r),o=S("dtype",e,t,r),s=S("elementShape",e,t,r),i=S("dynamicSize",e,t,r),a=S("clearAfterRead",e,t,r),u=S("identicalElementShapes",e,t,r),c=S("name",e,t,r),p=new by(c,o,n,s,u,i,a);return r.addTensorArray(p),[p.idTensor,Be(1)]}case"TensorArrayWriteV3":{let n=S("tensorArrayId",e,t,r),o=S("index",e,t,r),s=S("tensor",e,t,r),i=r.getTensorArray(n.id);return i.write(o,s),[i.idTensor]}case"TensorArrayReadV3":{let n=S("tensorArrayId",e,t,r),o=S("index",e,t,r);return[r.getTensorArray(n.id).read(o)]}case"TensorArrayGatherV3":{let n=S("tensorArrayId",e,t,r),o=S("indices",e,t,r),s=S("dtype",e,t,r);return[r.getTensorArray(n.id).gather(o,s)]}case"TensorArrayScatterV3":{let n=S("tensorArrayId",e,t,r),o=S("indices",e,t,r),s=S("tensor",e,t,r),i=r.getTensorArray(n.id);return i.scatter(o,s),[i.idTensor]}case"TensorArrayConcatV3":{let n=S("tensorArrayId",e,t,r),o=r.getTensorArray(n.id),s=S("dtype",e,t,r);return[o.concat(s)]}case"TensorArraySplitV3":{let n=S("tensorArrayId",e,t,r),o=S("tensor",e,t,r),s=S("lengths",e,t,r),i=r.getTensorArray(n.id);return i.split(s,o),[i.idTensor]}case"TensorArraySizeV3":{let n=S("tensorArrayId",e,t,r),o=r.getTensorArray(n.id);return[Be(o.size(),"int32")]}case"TensorArrayCloseV3":{let n=S("tensorArrayId",e,t,r),o=r.getTensorArray(n.id);return o.clearAndClose(),[o.idTensor]}case"TensorListSetItem":{let n=S("tensorListId",e,t,r),o=S("index",e,t,r),s=S("tensor",e,t,r),i=r.getTensorList(n.id);return i.setItem(o,s),[i.idTensor]}case"TensorListGetItem":{let n=S("tensorListId",e,t,r),o=S("index",e,t,r),s=S("elementShape",e,t,r),i=S("elementDType",e,t,r);return[r.getTensorList(n.id).getItem(o,s,i)]}case"TensorListScatterV2":case"TensorListScatter":{let n=S("indices",e,t,r),o=S("tensor",e,t,r),s=S("elementShape",e,t,r),i=S("numElements",e,t,r),a=GO(o,n,s,i);return r.addTensorList(a),[a.idTensor]}case"TensorListReserve":case"EmptyTensorList":{let n=S("elementShape",e,t,r),o=S("elementDType",e,t,r),s;e.op==="TensorListReserve"?s="numElements":s="maxNumElements";let i=S(s,e,t,r),a=e.op==="TensorListReserve"?-1:i,u=VO(n,o,i,a);return r.addTensorList(u),[u.idTensor]}case"TensorListGather":{let n=S("tensorListId",e,t,r),o=S("indices",e,t,r),s=S("elementShape",e,t,r),i=S("elementDType",e,t,r);return[r.getTensorList(n.id).gather(o,i,s)]}case"TensorListStack":{let n=S("tensorListId",e,t,r),o=S("elementShape",e,t,r),s=S("elementDType",e,t,r),i=S("numElements",e,t,r);return[r.getTensorList(n.id).stack(o,s,i)]}case"TensorListFromTensor":{let n=S("tensor",e,t,r),o=S("elementShape",e,t,r),s=S("elementDType",e,t,r),i=UO(n,o,s);return r.addTensorList(i),[i.idTensor]}case"TensorListConcat":case"TensorListConcatV2":{let n=S("tensorListId",e,t,r),o=r.getTensorList(n.id),s=S("dtype",e,t,r),i=S("elementShape",e,t,r);return[o.concat(s,i)]}case"TensorListPushBack":{let n=S("tensorListId",e,t,r),o=S("tensor",e,t,r),s=r.getTensorList(n.id);return s.pushBack(o),[s.idTensor]}case"TensorListPopBack":{let n=S("tensorListId",e,t,r),o=S("elementShape",e,t,r),s=S("elementDType",e,t,r);return[r.getTensorList(n.id).popBack(o,s)]}case"TensorListSplit":{let n=S("tensor",e,t,r),o=S("elementShape",e,t,r),s=S("lengths",e,t,r),i=WO(n,s,o);return r.addTensorList(i),[i.idTensor]}case"TensorListLength":{let n=S("tensorListId",e,t,r),o=r.getTensorList(n.id);return[Be(o.size(),"int32")]}case"TensorListResize":{let n=S("tensorListId",e,t,r),o=S("size",e,t,r),i=r.getTensorList(n.id).resize(o);return r.addTensorList(i),[i.idTensor]}default:throw TypeError(`Node type ${e.op} is not implemented`)}});function HO(e,t,r){let[n,o]=S("fusedOps",e,t,r),s=n==="biasadd",i=!s,a=o==="prelu",u=n==="fusedbatchnorm",c=S("numArgs",e,t,r);if(s){if(a&&c!==2)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!a&&s&&c!==1)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd must have one extra argument: bias.")}if(u)throw new Error("FusedConv2d and DepthwiseConv2d with FusedBatchNorm is not supported");let p=S("strides",e,t,r),m=eh(e,t,r),h=S("dataFormat",e,t,r).toUpperCase(),x=S("dilations",e,t,r),[y,v]=S("args",e,t,r);i&&(v=y,y=void 0);let w=S("leakyreluAlpha",e,t,r);return{stride:p,pad:m,dataFormat:h,dilations:x,biasArg:y,preluArg:v,activationFunc:o,leakyreluAlpha:w}}var KO=(e,t,r,n=ft)=>{switch(e.op){case"Conv1D":{let o=S("stride",e,t,r),s=S("pad",e,t,r),i=S("dataFormat",e,t,r).toUpperCase(),a=S("dilation",e,t,r);return[n.conv1d(S("x",e,t,r),S("filter",e,t,r),o,s,i,a)]}case"Conv2D":{let o=S("strides",e,t,r),s=eh(e,t,r),i=S("dataFormat",e,t,r).toUpperCase(),a=S("dilations",e,t,r);return[n.conv2d(S("x",e,t,r),S("filter",e,t,r),[o[1],o[2]],s,i,[a[1],a[2]])]}case"_FusedConv2D":{let{stride:o,pad:s,dataFormat:i,dilations:a,biasArg:u,preluArg:c,activationFunc:p,leakyreluAlpha:m}=HO(e,t,r);return[n.fused.conv2d({x:S("x",e,t,r),filter:S("filter",e,t,r),strides:[o[1],o[2]],pad:s,dataFormat:i,dilations:[a[1],a[2]],bias:u,activation:p,preluActivationWeights:c,leakyreluAlpha:m})]}case"FusedDepthwiseConv2dNative":{let{stride:o,pad:s,dataFormat:i,dilations:a,biasArg:u,preluArg:c,activationFunc:p,leakyreluAlpha:m}=HO(e,t,r);return[n.fused.depthwiseConv2d({x:S("x",e,t,r),filter:S("filter",e,t,r),strides:[o[1],o[2]],pad:s,dataFormat:i,dilations:[a[1],a[2]],bias:u,activation:p,preluActivationWeights:c,leakyreluAlpha:m})]}case"Conv2DBackpropInput":case"Conv2dTranspose":{let o=S("outputShape",e,t,r),s=S("strides",e,t,r),i=eh(e,t,r);return[n.conv2dTranspose(S("x",e,t,r),S("filter",e,t,r),o,[s[1],s[2]],i)]}case"DepthwiseConv2dNative":case"DepthwiseConv2d":{let o=S("strides",e,t,r),s=eh(e,t,r),i=S("dilations",e,t,r),a=S("dataFormat",e,t,r).toUpperCase();return[n.depthwiseConv2d(S("input",e,t,r),S("filter",e,t,r),[o[1],o[2]],s,a,[i[1],i[2]])]}case"Conv3D":{let o=S("strides",e,t,r),s=S("pad",e,t,r),i=S("dataFormat",e,t,r).toUpperCase(),a=S("dilations",e,t,r);return[n.conv3d(S("x",e,t,r),S("filter",e,t,r),[o[1],o[2],o[3]],s,i,[a[1],a[2],a[3]])]}case"AvgPool":{let o=S("strides",e,t,r),s=S("pad",e,t,r),i=S("kernelSize",e,t,r);return[n.avgPool(S("x",e,t,r),[i[1],i[2]],[o[1],o[2]],s)]}case"MaxPool":{let o=S("strides",e,t,r),s=S("pad",e,t,r),i=S("kernelSize",e,t,r);return[n.maxPool(S("x",e,t,r),[i[1],i[2]],[o[1],o[2]],s)]}case"MaxPoolWithArgmax":{let o=S("strides",e,t,r),s=S("pad",e,t,r),i=S("kernelSize",e,t,r),a=S("includeBatchInIndex",e,t,r),{result:u,indexes:c}=n.maxPoolWithArgmax(S("x",e,t,r),[i[1],i[2]],[o[1],o[2]],s,a);return[u,c]}case"AvgPool3D":{let o=S("strides",e,t,r),s=S("pad",e,t,r),i=S("kernelSize",e,t,r);return[n.avgPool3d(S("x",e,t,r),[i[1],i[2],i[3]],[o[1],o[2],o[3]],s)]}case"MaxPool3D":{let o=S("strides",e,t,r),s=S("pad",e,t,r),i=S("kernelSize",e,t,r);return[n.maxPool3d(S("x",e,t,r),[i[1],i[2],i[3]],[o[1],o[2],o[3]],s)]}case"Dilation2D":{let o=S("strides",e,t,r),s=S("pad",e,t,r),i=S("dilations",e,t,r),a=o[1],u=o[2],c=i[1],p=i[2];return[n.dilation2d(S("x",e,t,r),S("filter",e,t,r),[a,u],s,[c,p],"NHWC")]}default:throw TypeError(`Node type ${e.op} is not implemented`)}};var qO=(e,t,r,n=ft)=>{switch(e.op){case"Fill":{let o=S("shape",e,t,r),s=S("dtype",e,t,r),i=S("value",e,t,r);return[n.fill(o,i,s)]}case"LinSpace":{let o=S("start",e,t,r),s=S("stop",e,t,r),i=S("num",e,t,r);return[n.linspace(o,s,i)]}case"Multinomial":{let o=S("logits",e,t,r),s=S("numSamples",e,t,r),i=S("seed",e,t,r);return[n.multinomial(o,s,i)]}case"OneHot":{let o=S("indices",e,t,r),s=S("depth",e,t,r),i=S("onValue",e,t,r),a=S("offValue",e,t,r),u=S("dtype",e,t,r);return[n.oneHot(o,s,i,a,u)]}case"Ones":return[n.ones(S("shape",e,t,r),S("dtype",e,t,r))];case"OnesLike":return[n.onesLike(S("x",e,t,r))];case"RandomStandardNormal":return[n.randomStandardNormal(S("shape",e,t,r),S("dtype",e,t,r),S("seed",e,t,r))];case"RandomUniform":return[n.randomUniform(S("shape",e,t,r),S("minval",e,t,r),S("maxval",e,t,r),S("dtype",e,t,r))];case"RandomUniformInt":return[n.randomUniformInt(S("shape",e,t,r),S("minval",e,t,r),S("maxval",e,t,r),S("seed",e,t,r))];case"Range":{let o=S("start",e,t,r),s=S("stop",e,t,r),i=S("step",e,t,r);return[n.range(o,s,i,S("dtype",e,t,r))]}case"TruncatedNormal":{let o=S("shape",e,t,r),s=S("mean",e,t,r),i=S("stdDev",e,t,r),a=S("seed",e,t,r);return[n.truncatedNormal(o,s,i,S("dtype",e,t,r),a)]}case"Zeros":return[n.zeros(S("shape",e,t,r),S("dtype",e,t,r))];case"ZerosLike":return[n.zerosLike(S("x",e,t,r))];default:throw TypeError(`Node type ${e.op} is not implemented`)}};function LS(e,t,r){let n=S("boxes",e,t,r),o=S("scores",e,t,r),s=S("maxOutputSize",e,t,r),i=S("iouThreshold",e,t,r),a=S("scoreThreshold",e,t,r),u=S("softNmsSigma",e,t,r);return{boxes:n,scores:o,maxOutputSize:s,iouThreshold:i,scoreThreshold:a,softNmsSigma:u}}var jO=(s,i,a,u,...c)=>ne(void 0,[s,i,a,u,...c],function*(e,t,r,n,o=ft){switch(e.op){case"NonMaxSuppressionV5":{let{boxes:p,scores:m,maxOutputSize:h,iouThreshold:x,scoreThreshold:y,softNmsSigma:v}=LS(e,t,r),w=yield o.image.nonMaxSuppressionWithScoreAsync(p,m,h,x,y,v);return[w.selectedIndices,w.selectedScores]}case"NonMaxSuppressionV4":{let{boxes:p,scores:m,maxOutputSize:h,iouThreshold:x,scoreThreshold:y}=LS(e,t,r),v=S("padToMaxOutputSize",e,t,r),w=yield o.image.nonMaxSuppressionPaddedAsync(p,m,h,x,y,v);return[w.selectedIndices,w.validOutputs]}case"NonMaxSuppressionV3":case"NonMaxSuppressionV2":{let{boxes:p,scores:m,maxOutputSize:h,iouThreshold:x,scoreThreshold:y}=LS(e,t,r);return[yield o.image.nonMaxSuppressionAsync(p,m,h,x,y)]}case"Where":{let p=o.cast(S("condition",e,t,r),"bool"),m=[yield o.whereAsync(p)];return p.dispose(),m}case"ListDiff":return o.setdiff1dAsync(S("x",e,t,r),S("y",e,t,r));default:throw TypeError(`Node type ${e.op} is not implemented`)}});var XO=(e,t,r,n=ft)=>{switch(e.op){case"LowerBound":{let o=S("sortedSequence",e,t,r),s=S("values",e,t,r);return[n.lowerBound(o,s)]}case"TopKV2":{let o=S("x",e,t,r),s=S("k",e,t,r),i=S("sorted",e,t,r),a=n.topk(o,s,i);return[a.values,a.indices]}case"UpperBound":{let o=S("sortedSequence",e,t,r),s=S("values",e,t,r);return[n.upperBound(o,s)]}case"Unique":{let o=S("x",e,t,r),s=n.unique(o);return[s.values,s.indices]}case"UniqueV2":{let o=S("x",e,t,r),s=S("axis",e,t,r),i=n.unique(o,s);return[i.values,i.indices]}default:throw TypeError(`Node type ${e.op} is not implemented`)}};var YO=(e,t,r,n=ft)=>{switch(e.op){case"Const":return t[e.name];case"PlaceholderWithDefault":let o=S("default",e,t,r);return[Tr(e.name,t,r)||o];case"Placeholder":return[Tr(e.name,t,r)];case"Identity":case"StopGradient":case"FakeQuantWithMinMaxVars":{let p=S("x",e,t,r);return[Gs(p)]}case"IdentityN":return S("x",e,t,r).map(p=>Gs(p));case"Snapshot":let s=S("x",e,t,r);return[Gs(s)];case"Shape":return[n.tensor1d(S("x",e,t,r).shape,"int32")];case"ShapeN":return S("x",e,t,r).map(p=>n.tensor1d(p.shape));case"Size":return[n.scalar(S("x",e,t,r).size,"int32")];case"Rank":return[n.scalar(S("x",e,t,r).rank,"int32")];case"NoOp":return[n.scalar(1)];case"Print":let i=S("x",e,t,r),a=S("data",e,t,r),u=S("message",e,t,r),c=S("summarize",e,t,r);console.warn("The graph has a tf.print() operation,usually used for debugging, which slows down performance."),console.log(u);for(let p=0;p<a.length;p++)console.log(Array.prototype.slice.call(a[p].dataSync()).slice(0,c));return[i];default:throw TypeError(`Node type ${e.op} is not implemented`)}};var vy=class{get id(){return this.handle.id}constructor(t,r){this.keyDType=t,this.valueDType=r,this.handle=Be(0),this.tensorMap=new Map,Kn(this.handle)}clearAndClose(){this.tensorMap.forEach(t=>t.dispose()),this.tensorMap.clear(),this.handle.dispose()}size(){return this.tensorMap.size}tensorSize(){return Be(this.size(),"int32")}import(t,r){return ne(this,null,function*(){this.checkKeyAndValueTensor(t,r);let n=yield t.data();return this.tensorMap.forEach(o=>o.dispose()),this.tensorMap.clear(),Ue(()=>{let o=qo(r),s=n.length,i=o.length;A.assert(s===i,()=>`The number of elements doesn't match, keys has ${s} elements, the values has ${i} elements.`);for(let a=0;a<s;a++){let u=n[a],c=o[a];Kn(c),this.tensorMap.set(u,c)}return this.handle})})}find(t,r){return ne(this,null,function*(){this.checkKeyAndValueTensor(t,r);let n=yield t.data();return Ue(()=>{let o=[];for(let s=0;s<n.length;s++){let i=n[s],a=this.findWithDefault(i,r);o.push(a)}return kn(o)})})}findWithDefault(t,r){let n=this.tensorMap.get(t);return n??r}checkKeyAndValueTensor(t,r){if(t.dtype!==this.keyDType)throw new Error(`Expect key dtype ${this.keyDType}, but got ${t.dtype}`);if(r.dtype!==this.valueDType)throw new Error(`Expect value dtype ${this.valueDType}, but got ${r.dtype}`)}};var ZO=(e,t,r,n)=>ne(void 0,null,function*(){switch(e.op){case"HashTable":case"HashTableV2":{let o=n.getHashTableHandleByName(e.name);if(o!=null)return[o];{let s=S("keyDType",e,t,r),i=S("valueDType",e,t,r),a=new vy(s,i);return n.addHashTable(e.name,a),[a.handle]}}case"InitializeTable":case"InitializeTableV2":case"LookupTableImport":case"LookupTableImportV2":{let o=S("tableHandle",e,t,r,n),s=S("keys",e,t,r),i=S("values",e,t,r);return[yield n.getHashTableById(o.id).import(s,i)]}case"LookupTableFind":case"LookupTableFindV2":{let o=S("tableHandle",e,t,r,n),s=S("keys",e,t,r),i=S("defaultValue",e,t,r);return[yield n.getHashTableById(o.id).find(s,i)]}case"LookupTableSize":case"LookupTableSizeV2":{let o=S("tableHandle",e,t,r,n);return[n.getHashTableById(o.id).tensorSize()]}default:throw TypeError(`Node type ${e.op} is not implemented`)}});var QO=(e,t,r,n=ft)=>{switch(e.op){case"ResizeBilinear":{let o=S("images",e,t,r),s=S("size",e,t,r),i=S("alignCorners",e,t,r),a=S("halfPixelCenters",e,t,r);return[n.image.resizeBilinear(o,[s[0],s[1]],i,a)]}case"ResizeNearestNeighbor":{let o=S("images",e,t,r),s=S("size",e,t,r),i=S("alignCorners",e,t,r),a=S("halfPixelCenters",e,t,r);return[n.image.resizeNearestNeighbor(o,[s[0],s[1]],i,a)]}case"CropAndResize":{let o=S("image",e,t,r),s=S("boxes",e,t,r),i=S("boxInd",e,t,r),a=S("cropSize",e,t,r),u=S("method",e,t,r),c=S("extrapolationValue",e,t,r);return[n.image.cropAndResize(o,s,i,a,u,c)]}case"ImageProjectiveTransformV3":{let o=S("images",e,t,r),s=S("transforms",e,t,r),i=S("outputShape",e,t,r),a=S("fillValue",e,t,r),u=S("interpolation",e,t,r),c=S("fillMode",e,t,r);return[n.image.transform(o,s,u.toLowerCase(),c.toLowerCase(),a,i)]}default:throw TypeError(`Node type ${e.op} is not implemented`)}};var JO=(e,t,r,n=ft)=>{switch(e.op){case"Equal":return[n.equal(S("a",e,t,r),S("b",e,t,r))];case"NotEqual":return[n.notEqual(S("a",e,t,r),S("b",e,t,r))];case"Greater":return[n.greater(S("a",e,t,r),S("b",e,t,r))];case"GreaterEqual":return[n.greaterEqual(S("a",e,t,r),S("b",e,t,r))];case"Less":return[n.less(S("a",e,t,r),S("b",e,t,r))];case"LessEqual":return[n.lessEqual(S("a",e,t,r),S("b",e,t,r))];case"LogicalAnd":return[n.logicalAnd(S("a",e,t,r),S("b",e,t,r))];case"LogicalNot":return[n.logicalNot(S("a",e,t,r))];case"LogicalOr":return[n.logicalOr(S("a",e,t,r),S("b",e,t,r))];case"Select":case"SelectV2":return[n.where(S("condition",e,t,r),S("a",e,t,r),S("b",e,t,r))];case"BitwiseAnd":return[n.bitwiseAnd(S("a",e,t,r),S("b",e,t,r))];default:throw TypeError(`Node type ${e.op} is not implemented`)}};var eD=(e,t,r,n=ft)=>{switch(e.op){case"BatchMatMul":case"BatchMatMulV2":case"MatMul":return[n.matMul(S("a",e,t,r),S("b",e,t,r),S("transposeA",e,t,r),S("transposeB",e,t,r))];case"Einsum":return[n.einsum(S("equation",e,t,r),...S("tensors",e,t,r))];case"Transpose":return[n.transpose(S("x",e,t,r),S("perm",e,t,r))];case"_FusedMatMul":let[o,s]=S("fusedOps",e,t,r),i=o==="biasadd",a=s==="prelu",u=S("numArgs",e,t,r),c=S("leakyreluAlpha",e,t,r);if(i){if(a&&u!==2)throw new Error("Fused MatMul with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!a&&u!==1)throw new Error("Fused MatMul with BiasAdd must have one extra argument: bias.")}let[p,m]=S("args",e,t,r);return[n.fused.matMul({a:S("a",e,t,r),b:S("b",e,t,r),transposeA:S("transposeA",e,t,r),transposeB:S("transposeB",e,t,r),bias:p,activation:s,preluActivationWeights:m,leakyreluAlpha:c})];case"MatrixBandPart":return[n.linalg.bandPart(S("a",e,t,r),S("numLower",e,t,r),S("numUpper",e,t,r))];default:throw TypeError(`Node type ${e.op} is not implemented`)}};var tD=(e,t,r,n=ft)=>{switch(e.op){case"EuclideanNorm":return[n.euclideanNorm(S("x",e,t,r),S("axis",e,t,r),S("keepDims",e,t,r))];case"FusedBatchNorm":case"FusedBatchNormV2":return[n.batchNorm(S("x",e,t,r),S("mean",e,t,r),S("variance",e,t,r),S("offset",e,t,r),S("scale",e,t,r),S("epsilon",e,t,r))];case"FusedBatchNormV3":return[n.batchNorm(S("x",e,t,r),S("mean",e,t,r),S("variance",e,t,r),S("offset",e,t,r),S("scale",e,t,r),S("epsilon",e,t,r))];case"LRN":return[n.localResponseNormalization(S("x",e,t,r),S("radius",e,t,r),S("bias",e,t,r),S("alpha",e,t,r),S("beta",e,t,r))];case"Softmax":return[n.softmax(S("x",e,t,r))];case"LogSoftmax":return[n.logSoftmax(S("x",e,t,r))];default:throw TypeError(`Node type ${e.op} is not implemented`)}};var rD=(e,t,r,n=ft)=>{switch(e.op){case"RaggedGather":{let{outputNestedSplits:o,outputDenseValues:s}=n.raggedGather(S("paramsNestedSplits",e,t,r),S("paramsDenseValues",e,t,r),S("indices",e,t,r),S("outputRaggedRank",e,t,r));return o.concat(s)}case"RaggedRange":{let{rtNestedSplits:o,rtDenseValues:s}=n.raggedRange(S("starts",e,t,r),S("limits",e,t,r),S("splits",e,t,r));return[o,s]}case"RaggedTensorToTensor":return[n.raggedTensorToTensor(S("shape",e,t,r),S("values",e,t,r),S("defaultValue",e,t,r),S("rowPartitionTensors",e,t,r),S("rowPartitionTypes",e,t,r))];default:throw TypeError(`Node type ${e.op} is not implemented`)}};var nD=(e,t,r,n=ft)=>{switch(e.op){case"Max":{let a=S("axis",e,t,r),u=S("keepDims",e,t,r);return[n.max(S("x",e,t,r),a,u)]}case"Mean":{let a=S("axis",e,t,r),u=S("keepDims",e,t,r);return[n.mean(S("x",e,t,r),a,u)]}case"Min":{let a=S("axis",e,t,r),u=S("keepDims",e,t,r);return[n.min(S("x",e,t,r),a,u)]}case"Sum":{let a=S("axis",e,t,r),u=S("keepDims",e,t,r);return[n.sum(S("x",e,t,r),a,u)]}case"All":{let a=S("axis",e,t,r),u=S("keepDims",e,t,r);return[n.all(S("x",e,t,r),a,u)]}case"Any":{let a=S("axis",e,t,r),u=S("keepDims",e,t,r);return[n.any(S("x",e,t,r),a,u)]}case"ArgMax":{let a=S("axis",e,t,r);return[n.argMax(S("x",e,t,r),a)]}case"ArgMin":{let a=S("axis",e,t,r);return[n.argMin(S("x",e,t,r),a)]}case"Prod":{let a=S("axis",e,t,r),u=S("keepDims",e,t,r);return[n.prod(S("x",e,t,r),a,u)]}case"Cumprod":{let a=S("axis",e,t,r),u=S("exclusive",e,t,r),c=S("reverse",e,t,r);return[n.cumprod(S("x",e,t,r),a,u,c)]}case"Cumsum":{let a=S("axis",e,t,r),u=S("exclusive",e,t,r),c=S("reverse",e,t,r);return[n.cumsum(S("x",e,t,r),a,u,c)]}case"Bincount":let o=S("x",e,t,r),s=S("weights",e,t,r),i=S("size",e,t,r);return[n.bincount(o,s,i)];case"DenseBincount":{let a=S("x",e,t,r),u=S("weights",e,t,r),c=S("size",e,t,r),p=S("binaryOutput",e,t,r);return[n.denseBincount(a,u,c,p)]}default:throw TypeError(`Node type ${e.op} is not implemented`)}};var oD=(e,t,r,n=ft)=>{switch(e.op){case"ConcatV2":case"Concat":{let o=S("n",e,t,r),s=S("axis",e,t,r),i=S("tensors",e,t,r);return i=i.slice(0,o),[n.concat(i,s)]}case"Gather":{let o=S("x",e,t,r),s=S("indices",e,t,r);return[n.gather(o,n.cast(s,"int32"),0)]}case"GatherV2":{let o=S("axis",e,t,r),s=S("batchDims",e,t,r),i=S("x",e,t,r),a=S("indices",e,t,r);return[n.gather(i,n.cast(a,"int32"),o,s)]}case"Reverse":{let o=S("dims",e,t,r),s=[];for(let a=0;a<o.length;a++)o[a]&&s.push(a);let i=S("x",e,t,r);return[n.reverse(i,s)]}case"ReverseV2":{let o=S("axis",e,t,r),s=S("x",e,t,r);return[n.reverse(s,o)]}case"Slice":{let o=S("begin",e,t,r),s=S("size",e,t,r);return[n.slice(S("x",e,t,r),o,s)]}case"StridedSlice":{let o=S("begin",e,t,r),s=S("end",e,t,r),i=S("strides",e,t,r),a=S("beginMask",e,t,r),u=S("endMask",e,t,r),c=S("ellipsisMask",e,t,r),p=S("newAxisMask",e,t,r),m=S("shrinkAxisMask",e,t,r),h=S("x",e,t,r);return[n.stridedSlice(h,o,s,i,a,u,c,p,m)]}case"Pack":return Ue(()=>{let o=S("axis",e,t,r),s=S("tensors",e,t,r),i=s[0].shape,a=n.squeeze(s[0]).shape,u=s.map(c=>{let p=A.arraysEqual(c.shape,i);if(!p&&!A.arraysEqual(n.squeeze(c).shape,a))throw new Error("the input tensors shape does not match");return p?c:n.reshape(c,i)});return[n.stack(u,o)]});case"Unpack":{let o=S("axis",e,t,r),s=S("tensor",e,t,r);return n.unstack(s,o)}case"Tile":{let o=S("reps",e,t,r);return[n.tile(S("x",e,t,r),o)]}case"Split":case"SplitV":{let o=S("axis",e,t,r),s=S("numOrSizeSplits",e,t,r),i=S("x",e,t,r);return n.split(i,s,o)}case"ScatterNd":{let o=S("indices",e,t,r),s=S("values",e,t,r),i=S("shape",e,t,r);return[n.scatterND(o,s,i)]}case"GatherNd":{let o=S("x",e,t,r),s=S("indices",e,t,r);return[n.gatherND(o,s)]}case"SparseToDense":{let o=S("sparseIndices",e,t,r),s=S("outputShape",e,t,r),i=S("sparseValues",e,t,r),a=S("defaultValue",e,t,r);return[n.sparseToDense(o,i,s,i.dtype===a.dtype?a:n.cast(a,i.dtype))]}case"TensorScatterUpdate":{let o=S("indices",e,t,r),s=S("values",e,t,r),i=S("tensor",e,t,r);return[n.tensorScatterUpdate(i,o,s)]}default:throw TypeError(`Node type ${e.op} is not implemented`)}};var sD=(e,t,r,n=ft)=>{switch(e.op){case"SparseFillEmptyRows":{let{outputIndices:o,outputValues:s,emptyRowIndicator:i,reverseIndexMap:a}=n.sparse.sparseFillEmptyRows(S("indices",e,t,r),S("values",e,t,r),S("denseShape",e,t,r),S("defaultValue",e,t,r));return[o,s,i,a]}case"SparseReshape":{let{outputIndices:o,outputShape:s}=n.sparse.sparseReshape(S("inputIndices",e,t,r),S("inputShape",e,t,r),S("newShape",e,t,r));return[o,s]}case"SparseSegmentMean":return[n.sparse.sparseSegmentMean(S("data",e,t,r),S("indices",e,t,r),S("segmentIds",e,t,r))];case"SparseSegmentSum":return[n.sparse.sparseSegmentSum(S("data",e,t,r),S("indices",e,t,r),S("segmentIds",e,t,r))];default:throw TypeError(`Node type ${e.op} is not implemented`)}};var iD=(e,t,r,n=ft)=>{switch(e.op){case"FFT":return[n.fft(S("x",e,t,r))];case"IFFT":return[n.ifft(S("x",e,t,r))];case"RFFT":return[n.rfft(S("x",e,t,r))];case"IRFFT":return[n.irfft(S("x",e,t,r))];default:throw TypeError(`Node type ${e.op} is not implemented`)}};var aD=(e,t,r,n=ft)=>{switch(e.op){case"StaticRegexReplace":return[n.string.staticRegexReplace(S("input",e,t,r),S("pattern",e,t,r),S("rewrite",e,t,r),S("replaceGlobal",e,t,r))];case"StringNGrams":{let{nGrams:o,nGramsSplits:s}=n.string.stringNGrams(S("data",e,t,r),S("dataSplits",e,t,r),S("separator",e,t,r),S("nGramWidths",e,t,r),S("leftPad",e,t,r),S("rightPad",e,t,r),S("padWidth",e,t,r),S("preserveShortSequences",e,t,r));return[o,s]}case"StringSplit":{let{indices:o,values:s,shape:i}=n.string.stringSplit(S("input",e,t,r),S("delimiter",e,t,r),S("skipEmpty",e,t,r));return[o,s,i]}case"StringToHashBucketFast":return[n.string.stringToHashBucketFast(S("input",e,t,r),S("numBuckets",e,t,r))];default:throw TypeError(`Node type ${e.op} is not implemented`)}};var uD=(e,t,r,n=ft)=>{switch(e.op){case"Cast":return[n.cast(S("x",e,t,r),S("dtype",e,t,r))];case"ExpandDims":{let o=S("axis",e,t,r);return[n.expandDims(S("x",e,t,r),o)]}case"Squeeze":{let o=S("axis",e,t,r);return[n.squeeze(S("x",e,t,r),o)]}case"Reshape":return[n.reshape(S("x",e,t,r),S("shape",e,t,r))];case"EnsureShape":return[n.ensureShape(S("x",e,t,r),S("shape",e,t,r))];case"MirrorPad":return[n.mirrorPad(S("x",e,t,r),S("padding",e,t,r),S("mode",e,t,r))];case"PadV2":case"Pad":return[n.pad(S("x",e,t,r),S("padding",e,t,r),S("constantValue",e,t,r))];case"SpaceToBatchND":{let o=S("blockShape",e,t,r),s=S("paddings",e,t,r);return[n.spaceToBatchND(S("x",e,t,r),o,s)]}case"BatchToSpaceND":{let o=S("blockShape",e,t,r),s=S("crops",e,t,r);return[n.batchToSpaceND(S("x",e,t,r),o,s)]}case"DepthToSpace":{let o=S("blockSize",e,t,r),s=S("dataFormat",e,t,r).toUpperCase();return[n.depthToSpace(S("x",e,t,r),o,s)]}case"BroadcastTo":return[n.broadcastTo(S("x",e,t,r),S("shape",e,t,r))];case"BroadcastArgs":return[n.broadcastArgs(S("s0",e,t,r),S("s1",e,t,r))];default:throw TypeError(`Node type ${e.op} is not implemented`)}};function BS(e,t,r,n,o=Ue){let s=((i,a,u)=>{switch(i.category){case"arithmetic":return o(()=>LO(i,a,u));case"basic_math":return o(()=>BO(i,a,u));case"control":return zO(i,a,u);case"convolution":return o(()=>KO(i,a,u));case"creation":return o(()=>qO(i,a,u));case"dynamic":return jO(i,a,u);case"evaluation":return o(()=>XO(i,a,u));case"image":return o(()=>QO(i,a,u));case"graph":return o(()=>YO(i,a,u));case"logical":return o(()=>JO(i,a,u));case"matrices":return o(()=>eD(i,a,u));case"normalization":return o(()=>tD(i,a,u));case"ragged":return o(()=>rD(i,a,u));case"reduction":return o(()=>nD(i,a,u));case"slice_join":return o(()=>oD(i,a,u));case"sparse":return o(()=>sD(i,a,u));case"spectral":return o(()=>iD(i,a,u));case"string":return o(()=>aD(i,a,u));case"transformation":return o(()=>uD(i,a,u));case"hash_table":return ZO(i,a,u,n);case"custom":let c=sy(i.op);if(c&&c.customExecutor)return c.customExecutor(new xy(i,a,u));throw TypeError(`Custom op ${i.op} is not registered.`);default:throw TypeError(`Unknown op '${i.op}'. File an issue at https://github.com/tensorflow/tfjs/issues so we can add it, or register a custom execution with tf.registerOp()`)}})(e,t,r);return A.isPromise(s)?s.then(i=>[].concat(i)):[].concat(s)}var rh=class{constructor(t={},r={},n={},o={},s){this.weightMap=t,this.tensorArrayMap=r,this.tensorListMap=n,this.functionMap=o,this.parseNodeNameCache=s,this.rootContext={id:0,frameName:"",iterationId:0},this.contexts=[this.rootContext],this.lastId=0,this.generateCurrentContextIds()}newFrame(t,r){return{id:t,frameName:r,iterationId:0}}set currentContext(t){this.contexts!==t&&(this.contexts=t,this.generateCurrentContextIds())}get currentContext(){return this.contexts}get currentContextId(){return this._currentContextIds[0]}get currentContextIds(){return this._currentContextIds}generateCurrentContextIds(){let t=[];for(let r=0;r<this.contexts.length-1;r++){let n=this.contexts.slice(0,this.contexts.length-r);t.push(this.contextIdforContexts(n))}t.push(""),this._currentContextIds=t}contextIdforContexts(t){return t?t.map(r=>r.id===0&&r.iterationId===0?"":`${r.frameName}-${r.iterationId}`).join("/"):""}enterFrame(t){this.contexts&&(this.lastId++,this.contexts=this.contexts.slice(),this.contexts.push(this.newFrame(this.lastId,t)),this._currentContextIds.unshift(this.contextIdforContexts(this.contexts)))}exitFrame(){if(this.contexts&&this.contexts.length>1)this.contexts=this.contexts.slice(),this.contexts.splice(-1),this.currentContextIds.shift();else throw new Error("Cannot exit frame, the context is empty")}nextIteration(){if(this.contexts&&this.contexts.length>0){this.contexts=this.contexts.slice(),this.lastId++;let t=Object.assign({},this.contexts[this.contexts.length-1]);t.iterationId+=1,t.id=this.lastId,this.contexts.splice(-1,1,t),this._currentContextIds.splice(0,1,this.contextIdforContexts(this.contexts))}else throw new Error("Cannot increase frame iteration, the context is empty")}getWeight(t){return this.weightMap[t]}addTensorArray(t){this.tensorArrayMap[t.id]=t}getTensorArray(t){return this.tensorArrayMap[t]}addTensorList(t){this.tensorListMap[t.id]=t}getTensorList(t){return this.tensorListMap[t]}dispose(t){for(let r in this.tensorArrayMap)this.tensorArrayMap[r].clearAndClose(t);for(let r in this.tensorListMap)this.tensorListMap[r].clearAndClose(t)}};function MS(e,t,r,n){let o=new Set,s=[],i=null,a=null,u=new Set,c=new Set(Object.keys(e).map(h=>$n(h)[0]));n=n||[];let p=new Set(n.map(h=>$n(h.name)[0])),m=[...t];for(;m.length>0;){let h=m.pop();if((nu(h)||uQ(h)||lQ(h))&&i==null&&(i=h,a=i.children.map(x=>x.name).filter(x=>o.has(x))),o.add(h.name),r[h.name]==null&&!c.has(h.name)&&!p.has(h.name)){if(h.inputs.length===0){s.push(h.name);continue}h.inputs.forEach(x=>{u.has(x.name)||(u.add(x.name),m.push(x))})}}return{inputs:e,outputs:t,usedNodes:o,missingInputs:s,dynamicNode:i,syncInputs:a}}function lD(e,t){let{usedNodes:r,inputs:n}=t,o=Object.keys(n).map(w=>$n(w)[0]).map(w=>e.nodes[w]),s=e.initNodes||[],i=w=>r.has(typeof w=="string"?w:w.name);function a(w){return[...new Map(w.map(C=>[C.name,C])).values()]}let u=a([...o,...e.weights,...s]).filter(i),c=a([...u,...Object.values(e.nodes)]).filter(i),p=new Map(c.map(w=>[w.name,w])),m={};for(let w of c){m[w.name]=m[w.name]||0;for(let C of w.children)i(C)||(m[C.name]=Number.POSITIVE_INFINITY),m[C.name]=(m[C.name]||0)+1}let h=Object.entries(m).filter(([,w])=>w===0).map(([w])=>w),x=[...h];for(;h.length>0;){let w=h.pop(),C=p.get(w);for(let I of C.children.filter(i))--m[I.name]===0&&(x.push(I.name),h.push(I.name))}let y=x.map(w=>p.get(w)),v=nQ(y,u);return oQ(v,u),v}function nQ(e,t){let r=new Map(e.map(i=>[i.name,i])),n=t.map(i=>i.name),o=new Set(n);for(;n.length>0;){let i=n.pop(),a=r.get(i);for(let u of a.children)!r.has(u.name)||o.has(u.name)||(o.add(u.name),n.push(u.name))}return e.filter(i=>o.has(i.name))}var Np=class extends Error{constructor(t){super(`NodesExecutionOrderError: ${t}`)}};function oQ(e,t){let r=new Map(e.map((a,u)=>[a.name,u])),n=new Set(t.map(a=>a.name)),o=a=>n.has(typeof a=="string"?a:a.name),s=new Set(e.map(a=>a.name)),i=a=>s.has(typeof a=="string"?a:a.name);for(let a of e){for(let u of a.children.filter(i)){if(!r.has(u.name))throw new Np(`Child ${u.name} of node ${a.name} is unreachable.`);if(r.get(a.name)>r.get(u.name))throw new Np(`Node ${a.name} is scheduled to run after its child ${u.name}.`)}if(!o(a))for(let u of a.inputs){if(!r.has(u.name))throw new Np(`Input ${u.name} of node ${a.name} is unreachable.`);if(r.get(u.name)>r.get(a.name))throw new Np(`Node ${a.name} is scheduled to run before its input ${u.name}.`)}}}function cD(e){let t=new Map(e.map((a,u)=>[a.name,u])),r=Number.MAX_SAFE_INTEGER,n=e.map((a,u)=>nu(a)?r:u),o=a=>{let u=n[t.get(a.name)];return u??-1},s=e.map((a,u)=>a.children.map(o).reduce((c,p)=>Math.max(c,p),n[u])),i=new Map;for(let a=0;a<e.length;++a){let u=s[a];if(u===r)continue;let c=e[a],p=e[u];i.has(p.name)||i.set(p.name,[]),i.get(p.name).push(c)}return i}var sQ=new Set(["Switch","Merge","Enter","Exit","NextIteration","StatelessIf","StatelessWhile","if","While"]),iQ=new Set(["NonMaxSuppressionV2","NonMaxSuppressionV3","NonMaxSuppressionV5","Where"]),aQ=new Set(["HashTable","HashTableV2","LookupTableImport","LookupTableImportV2","LookupTableFind","LookupTableFindV2","LookupTableSize","LookupTableSizeV2"]);function nu(e){return sQ.has(e.op)}function uQ(e){return iQ.has(e.op)}function lQ(e){return aQ.has(e.op)}var nh=class e{get weightIds(){return this.parent?this.parent.weightIds:this._weightIds}get functionExecutorMap(){return this.parent?this.parent.functionExecutorMap:this._functionExecutorMap}get weightMap(){return this.parent?this.parent.weightMap:this._weightMap}set weightMap(t){let r=Object.keys(t).map(n=>t[n].map(o=>o.id));this._weightIds=[].concat(...r),this._weightMap=t}set resourceManager(t){this._resourceManager=t}get inputs(){return this._inputs.map(t=>({name:t.name,shape:t.attrParams.shape?t.attrParams.shape.value:void 0,dtype:t.attrParams.dtype?t.attrParams.dtype.value:void 0}))}get outputs(){return this._outputs.map(t=>({name:t.name,shape:t.attrParams.shape?t.attrParams.shape.value:void 0,dtype:t.attrParams.dtype?t.attrParams.dtype.value:void 0}))}get inputNodes(){return this._inputs.map(t=>t.signatureKey||t.name)}get outputNodes(){return this._outputs.map(t=>{let r=t.signatureKey||t.name;return t.defaultOutput?`${r}:${t.defaultOutput}`:r})}get functions(){return Object.keys(this._functions).reduce((t,r)=>(t[r]=this._functions[r].signature,t),{})}constructor(t,r){this.graph=t,this.parent=r,this.compiledMap=new Map,this.parseNodeNameCache=new Map,this._weightMap={},this.SEPARATOR=",",this._functions={},this._functionExecutorMap={},this.keepIntermediateTensors=!1,this._outputs=t.outputs,this._inputs=t.inputs,this._initNodes=t.initNodes,this._signature=t.signature,this._functions=t.functions,t.functions!=null&&Object.keys(t.functions).forEach(n=>{this._functionExecutorMap[n]=new e(t.functions[n],this)})}getCompilationKey(t,r){let n=t.map(s=>s.name).sort(),o=r.map(s=>s.name).sort();return n.join(this.SEPARATOR)+"--"+o.join(this.SEPARATOR)}compile(t,r){let n=MS(t,r,this.weightMap,this._initNodes),{missingInputs:o,dynamicNode:s,syncInputs:i}=n;if(s!=null)throw new Error(`This execution contains the node '${s.name}', which has the dynamic op '${s.op}'. Please use model.executeAsync() instead. Alternatively, to avoid the dynamic ops, specify the inputs [${i}]`);if(o.length>0){let c=r.map(m=>m.name),p=Object.keys(t);throw new Error(`Cannot compute the outputs [${c}] from the provided inputs [${p}]. Missing the following inputs: [${o}]`)}let a=lD(this.graph,n),u=cD(a);return{orderedNodes:a,nodeLiveUntilMap:u}}cloneAndKeepTensor(t){if(t==null)return null;let r=t.clone();return Kn(r),r}cloneTensorList(t){return t?t.map(n=>this.cloneAndKeepTensor(n)):null}cloneTensorMap(t){return Object.fromEntries(Object.entries(t).map(([r,n])=>[r,this.cloneTensorList(n)]))}execute(t,r){this.disposeIntermediateTensors(),t=this.mapInputs(t);let n=Object.keys(t).sort();this.checkInputs(t),this.checkInputShapeAndType(t),r=this.mapOutputs(r),this.checkOutputs(r);let o=n.map(h=>this.graph.nodes[$n(h)[0]]),s=r.map(h=>$n(h)[0]),i=new Set(s),a=s.map(h=>this.graph.nodes[h]);a.length===0&&(a=this._outputs);let u=this.getCompilationKey(o,a),c=this.compiledMap.get(u);c==null&&(c=this.compile(t,a),this.compiledMap.set(u,c));try{this.keepIntermediateTensors=z().getBool("KEEP_INTERMEDIATE_TENSORS")}catch(h){this.keepIntermediateTensors=!1,console.warn(h.message)}let p={},m={};return Ue(()=>{let h=new rh(this.weightMap,p,m,this.functionExecutorMap,this.parseNodeNameCache),x=Object.assign({},this.weightMap);this.keepIntermediateTensors&&(this.clonedTensorsMap=this.cloneTensorMap(this.weightMap)),Object.keys(t).forEach(C=>{let[I,D]=$n(C,h),P=[];P[D]=t[C],x[I]=P,this.keepIntermediateTensors&&(this.clonedTensorsMap[I]=this.cloneTensorList(P))});let y=this.getFrozenTensorIds(x),{orderedNodes:v,nodeLiveUntilMap:w}=c;for(let C of v){if(x[C.name])continue;let I=BS(C,x,h,this._resourceManager);if(A.isPromise(I))throw new Error(`The execution of the op '${C.op}' returned a promise. Please use model.executeAsync() instead.`);x[C.name]=I,this.keepIntermediateTensors&&(this.clonedTensorsMap[C.name]=this.cloneTensorList(I)),this.checkTensorForDisposalWithNodeLiveUntilInfo(C,x,h,y,i,w.get(C.name))}return this.parent==null&&h.dispose(y),r.map(C=>Tr(C,x,h))})}getFrozenTensorIds(t){let r=[].concat.apply([],Object.keys(t).map(n=>t[n]).map(n=>n.map(o=>o.id)));return new Set(r)}checkTensorForDisposal(t,r,n,o,s,i,a){if(!(nu(r)||i.has(t))){for(let u of n[t])u!=null&&(a[u.id]=(a[u.id]||0)+r.children.length);for(let u of r.inputs){if(nu(u))continue;let c=gS(u.name,n,o);if(c!=null)for(let p of c){if(!p||p.kept||s.has(p.id))continue;let m=a[p.id];m===1?(p.dispose(),delete a[p.id]):m!=null&&a[p.id]--}}}}checkTensorForDisposalWithNodeLiveUntilInfo(t,r,n,o,s,i){function a(u){return nu(u)||s.has(u.name)}if(!(nu(t)||i==null))for(let u of i){if(a(u))continue;let c=gS(u.name,r,n);for(let p of c)!p||p.kept||o.has(p.id)||p.dispose()}}executeAsync(t,r){return ne(this,null,function*(){return this._executeAsync(t,r)})}disposeIntermediateTensors(){this.clonedTensorsMap&&(Object.values(this.clonedTensorsMap).forEach(t=>{for(let r of t)r&&!r.isDisposed&&r.dispose()}),this.clonedTensorsMap=null)}getIntermediateTensors(){return this.clonedTensorsMap}_executeAsync(i,a){return ne(this,arguments,function*(t,r,n=!1,o={},s={}){this.disposeIntermediateTensors(),n||(t=this.mapInputs(t),this.checkInputs(t),this.checkInputShapeAndType(t),r=this.mapOutputs(r),this.checkOutputs(r));try{this.keepIntermediateTensors=z().getBool("KEEP_INTERMEDIATE_TENSORS")}catch(y){this.keepIntermediateTensors=!1,console.warn(y.message)}let u=new rh(this.weightMap,o,s,this.functionExecutorMap,this.parseNodeNameCache);this.keepIntermediateTensors&&(this.clonedTensorsMap=this.cloneTensorMap(this.weightMap));let c=yield this.executeWithControlFlow(t,u,r,n),p=r.map(y=>Tr(y,c,u)),m=p.map(y=>y.id),h=Object.keys(t).map(y=>t[y].id),x=new Set([...m,...h,...this.weightIds]);return Object.values(c).forEach(y=>{y.forEach(v=>{v&&!v.isDisposed&&!x.has(v.id)&&v.dispose()})}),this.parent==null&&u.dispose(x),p})}executeFunctionAsync(t,r,n){return ne(this,null,function*(){let o=t.reduce((s,i,a)=>(s[this.inputs[a].name]=i,s),{});return this._executeAsync(o,this.outputNodes,!0,r,n)})}executeWithControlFlow(t,r,n,o){return ne(this,null,function*(){let s=Object.keys(t),i=s.map(P=>this.graph.nodes[$n(P)[0]]),a=n.map(P=>$n(P)[0]),u=new Set(a),c=a.map(P=>this.graph.nodes[P]);c.length===0&&(c=this._outputs);let{usedNodes:p,missingInputs:m,dynamicNode:h,syncInputs:x}=MS(t,c,this.weightMap,this._initNodes),y=[...i,...this.graph.weights,...this._initNodes||[]].map(P=>({node:P,contexts:r.currentContext})),v=Object.assign({},this.weightMap);Object.keys(t).forEach(P=>{let[G,q]=$n(P),Z=[];Z[q]=t[P],v[G]=Z});let w={},C=this.getFrozenTensorIds(v),I={};for(;y.length>0;){let P=this.processStack(i,y,r,v,I,C,u,w,p);yield Promise.all(P)}h==null&&!o&&console.warn("This model execution did not contain any nodes with control flow or dynamic output shapes. You can use model.execute() instead.");let D=c.filter(P=>!nu(P)&&!Tr(P.name,v,r)).map(P=>P.name);if(D.length>0){let P="";throw h!=null&&(P=`Alternatively, to avoid the dynamic ops, use model.execute() and specify the inputs [${x}]`),new Error(`Cannot compute the outputs [${D}] from the provided inputs [${s}]. Consider providing the following inputs: [${m}]. ${P}`)}return v})}processStack(t,r,n,o,s,i,a,u,c){let p=[];for(;r.length>0;){let m=r.pop();n.currentContext=m.contexts;let h="";if(m.node.op==="Enter"&&S("isConstant",m.node,o,n)&&([h]=Vs(m.node.name,n)),o[m.node.name]==null){let x=BS(m.node,o,n,this._resourceManager);h||([h]=Vs(m.node.name,n));let y=n.currentContext;A.isPromise(x)?p.push(x.then(v=>(o[h]=v,this.keepIntermediateTensors&&(this.clonedTensorsMap[h]=this.cloneTensorList(v)),n.currentContext=y,this.checkTensorForDisposal(h,m.node,o,n,i,a,u),this.processChildNodes(m.node,r,n,o,s,c),v))):(o[h]=x,this.keepIntermediateTensors&&(this.clonedTensorsMap[h]=this.cloneTensorList(x)),this.checkTensorForDisposal(h,m.node,o,n,i,a,u),this.processChildNodes(m.node,r,n,o,s,c))}else this.processChildNodes(m.node,r,n,o,s,c)}return p}processChildNodes(t,r,n,o,s,i){t.children.forEach(a=>{let[u]=Vs(a.name,n);s[u]||!i.has(a.name)||(a.op==="Merge"?a.inputNames.some(c=>!!Tr(c,o,n))&&(s[u]=!0,r.push({contexts:n.currentContext,node:a})):a.inputNames.every(c=>!!Tr(c,o,n))&&(s[u]=!0,r.push({contexts:n.currentContext,node:a})))})}dispose(){Object.keys(this.weightMap).forEach(t=>this.weightMap[t].forEach(r=>r.dispose()))}checkInputShapeAndType(t){Object.keys(t).forEach(r=>{let n=t[r],[o]=$n(r),s=this.graph.nodes[o];if(s.attrParams.shape&&s.attrParams.shape.value){let i=s.attrParams.shape.value,a=i.length===n.shape.length&&n.shape.every((u,c)=>i[c]===-1||i[c]===u);A.assert(a,()=>`The shape of dict['${s.name}'] provided in model.execute(dict) must be [${i}], but was [${n.shape}]`)}s.attrParams.dtype&&s.attrParams.dtype.value&&A.assert(n.dtype===s.attrParams.dtype.value,()=>`The dtype of dict['${s.name}'] provided in model.execute(dict) must be ${s.attrParams.dtype.value}, but was ${n.dtype}`)})}mapInputs(t){var r,n;let o={};for(let s in t){let i=(n=(r=this._signature)===null||r===void 0?void 0:r.inputs)===null||n===void 0?void 0:n[s];i!=null?o[i.name]=t[s]:o[s]=t[s]}return o}checkInputs(t){let r=Object.keys(t).filter(n=>{let[o]=$n(n);return this.graph.nodes[o]==null});if(r.length>0)throw new Error(`The dict provided in model.execute(dict) has keys: [${r}] that are not part of graph`)}mapOutputs(t){return t.map(r=>{var n,o;let s=(o=(n=this._signature)===null||n===void 0?void 0:n.outputs)===null||o===void 0?void 0:o[r];return s!=null?s.name:r},{})}checkOutputs(t){t.forEach(r=>{let[n]=$n(r);if(!this.graph.nodes[n])throw new Error(`The output '${r}' is not found in the graph`)})}};var wy=class{constructor(t={},r={}){this.hashTableNameToHandle=t,this.hashTableMap=r}addHashTable(t,r){this.hashTableNameToHandle[t]=r.handle,this.hashTableMap[r.id]=r}getHashTableHandleByName(t){return this.hashTableNameToHandle[t]}getHashTableById(t){return this.hashTableMap[t]}dispose(){for(let t in this.hashTableMap)this.hashTableMap[t].clearAndClose(),delete this.hashTableMap[t];for(let t in this.hashTableNameToHandle)this.hashTableNameToHandle[t].dispose(),delete this.hashTableNameToHandle[t]}};var cQ="?tfjs-format=file",pQ="model.json",Ty=class{get modelVersion(){return this.version}get inputNodes(){return this.executor.inputNodes}get outputNodes(){return this.executor.outputNodes}get inputs(){return this.executor.inputs}get outputs(){return this.executor.outputs}get weights(){return this.executor.weightMap}get metadata(){return this.artifacts.userDefinedMetadata}get modelSignature(){return this.signature}get modelStructuredOutputKeys(){return this.structuredOutputKeys}constructor(t,r={},n=Qm){this.modelUrl=t,this.loadOptions=r,this.version="n/a",this.io=n,r==null&&(this.loadOptions={}),this.resourceManager=new wy}findIOHandler(){let t=this.modelUrl;if(t.load!=null)this.handler=t;else if(this.loadOptions.requestInit!=null)this.handler=this.io.browserHTTPRequest(t,this.loadOptions);else{let r=this.io.getLoadHandlers(t,this.loadOptions);if(r.length===0)r.push(this.io.browserHTTPRequest(t,this.loadOptions));else if(r.length>1)throw new Error(`Found more than one (${r.length}) load handlers for URL '${[t]}'`);this.handler=r[0]}}load(){if(this.findIOHandler(),this.handler.load==null)throw new Error("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");let t=this.handler.load();return A.isPromise(t)?t.then(r=>r.getWeightStream==null?this.loadSync(r):this.loadStreaming(r)):this.loadSync(t)}loadSync(t){let r=this.io.decodeWeights(t.weightData,t.weightSpecs);return this.loadWithWeightMap(t,r)}loadStreaming(t){return ne(this,null,function*(){if(t.getWeightStream==null)throw new Error("Model artifacts missing streamWeights function");let r=yield Q1(t.getWeightStream(),t.weightSpecs);return this.loadWithWeightMap(t,r)})}loadWithWeightMap(t,r){this.artifacts=t;let n=this.artifacts.modelTopology,o=this.artifacts.signature;if(this.artifacts.userDefinedMetadata!=null){let s=this.artifacts.userDefinedMetadata;s.signature!=null&&(o=s.signature),s.structuredOutputKeys!=null&&(this.structuredOutputKeys=s.structuredOutputKeys)}if(this.signature=o,this.version=`${n.versions.producer}.${n.versions.minConsumer}`,this.executor=new nh(th.Instance.transformGraph(n,this.signature)),this.executor.weightMap=this.convertTensorMapToTensorsMap(r),this.executor.resourceManager=this.resourceManager,t.modelInitializer!=null&&t.modelInitializer.node!=null){let s=th.Instance.transformGraph(t.modelInitializer);this.initializer=new nh(s),this.initializer.weightMap=this.executor.weightMap,this.initializer.resourceManager=this.resourceManager,this.initializerSignature=t.initializerSignature}return!0}save(t,r){return ne(this,null,function*(){if(typeof t=="string"){let n=this.io.getSaveHandlers(t);if(n.length===0)throw new Error(`Cannot find any save handlers for URL '${t}'`);if(n.length>1)throw new Error(`Found more than one (${n.length}) save handlers for URL '${t}'`);t=n[0]}if(t.save==null)throw new Error("GraphModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");return t.save(this.artifacts)})}addStructuredOutputNames(t){if(this.structuredOutputKeys){let r=t instanceof It?[t]:t,n={};return r.forEach((o,s)=>n[this.structuredOutputKeys[s]]=o),n}return t}predict(t,r){let n=this.execute(t,this.outputNodes);return this.addStructuredOutputNames(n)}predictAsync(t,r){return ne(this,null,function*(){let n=yield this.executeAsync(t,this.outputNodes);return this.addStructuredOutputNames(n)})}normalizeInputs(t){var r;if(!(t instanceof It)&&!Array.isArray(t)){let s=(r=this.signature)===null||r===void 0?void 0:r.inputs;if(s!=null)for(let i in s){let a=s[i];a.resourceId!=null&&(t[i]=this.resourceIdToCapturedInput[a.resourceId])}return t}t=Array.isArray(t)?t:[t];let n=Object.keys(this.resourceIdToCapturedInput).length;if(t.length+n!==this.inputNodes.length)throw new Error(`Input tensor count mismatch, the graph model has ${this.inputNodes.length-n} non-resource placeholders, while there are ${t.length} input tensors provided.`);let o=0;return this.inputNodes.reduce((s,i)=>{var a,u,c;let p=(c=(u=(a=this.signature)===null||a===void 0?void 0:a.inputs)===null||u===void 0?void 0:u[i])===null||c===void 0?void 0:c.resourceId;return p!=null?s[i]=this.resourceIdToCapturedInput[p]:s[i]=t[o++],s},{})}normalizeOutputs(t){return t=t||this.outputNodes,Array.isArray(t)?t:[t]}executeInitializerGraph(){return this.initializer==null?[]:this.initializerSignature==null?this.initializer.execute({},[]):this.initializer.execute({},Object.keys(this.initializerSignature.outputs))}executeInitializerGraphAsync(){return ne(this,null,function*(){return this.initializer==null?[]:this.initializerSignature==null?this.initializer.executeAsync({},[]):this.initializer.executeAsync({},Object.keys(this.initializerSignature.outputs))})}setResourceIdToCapturedInput(t){if(this.resourceIdToCapturedInput={},this.initializerSignature){let r=this.initializerSignature.outputs,n=Object.keys(r);for(let o=0;o<n.length;o++){let s=n[o],i=r[s];this.resourceIdToCapturedInput[i.resourceId]=t[o]}}}execute(t,r){this.resourceIdToCapturedInput==null&&this.setResourceIdToCapturedInput(this.executeInitializerGraph()),t=this.normalizeInputs(t),r=this.normalizeOutputs(r);let n=this.executor.execute(t,r);return n.length>1?n:n[0]}executeAsync(t,r){return ne(this,null,function*(){this.resourceIdToCapturedInput==null&&this.setResourceIdToCapturedInput(yield this.executeInitializerGraphAsync()),t=this.normalizeInputs(t),r=this.normalizeOutputs(r);let n=yield this.executor.executeAsync(t,r);return n.length>1?n:n[0]})}getIntermediateTensors(){return this.executor.getIntermediateTensors()}disposeIntermediateTensors(){this.executor.disposeIntermediateTensors()}convertTensorMapToTensorsMap(t){return Object.keys(t).reduce((r,n)=>(r[n]=[t[n]],r),{})}dispose(){this.executor.dispose(),this.initializer&&(this.initializer.dispose(),this.resourceIdToCapturedInput&&St(this.resourceIdToCapturedInput)),this.resourceManager.dispose()}};function Sy(n){return ne(this,arguments,function*(e,t={},r=Qm){if(e==null)throw new Error("modelUrl in loadGraphModel() cannot be null. Please provide a url or an IOHandler that loads the model");t==null&&(t={}),t.fromTFHub&&typeof e=="string"&&(e=fQ(e));let o=new Ty(e,t,r);return yield o.load(),o})}function fQ(e){return e.endsWith("/")||(e=e+"/"),`${e}${pQ}${cQ}`}var Rn=function(){return Rn=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},Rn.apply(this,arguments)};function Ws(e,t,r,n){return new(r||(r=Promise))(function(o,s){function i(c){try{u(n.next(c))}catch(p){s(p)}}function a(c){try{u(n.throw(c))}catch(p){s(p)}}function u(c){var p;c.done?o(c.value):(p=c.value,p instanceof r?p:new r(function(m){m(p)})).then(i,a)}u((n=n.apply(e,t||[])).next())})}function zs(e,t){var r,n,o,s,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function a(u){return function(c){return function(p){if(r)throw new TypeError("Generator is already executing.");for(;s&&(s=0,p[0]&&(i=0)),i;)try{if(r=1,n&&(o=2&p[0]?n.return:p[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,p[1])).done)return o;switch(n=0,o&&(p=[2&p[0],o.value]),p[0]){case 0:case 1:o=p;break;case 4:return i.label++,{value:p[1],done:!1};case 5:i.label++,n=p[1],p=[0];continue;case 7:p=i.ops.pop(),i.trys.pop();continue;default:if(o=i.trys,!((o=o.length>0&&o[o.length-1])||p[0]!==6&&p[0]!==2)){i=0;continue}if(p[0]===3&&(!o||p[1]>o[0]&&p[1]<o[3])){i.label=p[1];break}if(p[0]===6&&i.label<o[1]){i.label=o[1],o=p;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(p);break}o[2]&&i.ops.pop(),i.trys.pop();continue}p=t.call(e,i)}catch(m){p=[6,m],n=0}finally{r=o=0}if(5&p[0])throw p[1];return{value:p[0]?p[1]:void 0,done:!0}}([u,c])}}}var Cy=["wrist","thumb_cmc","thumb_mcp","thumb_ip","thumb_tip","index_finger_mcp","index_finger_pip","index_finger_dip","index_finger_tip","middle_finger_mcp","middle_finger_pip","middle_finger_dip","middle_finger_tip","ring_finger_mcp","ring_finger_pip","ring_finger_dip","ring_finger_tip","pinky_finger_mcp","pinky_finger_pip","pinky_finger_dip","pinky_finger_tip"],US={runtime:"mediapipe",maxHands:2,modelType:"full"},mQ=function(){function e(t){var r,n=this;this.width=0,this.height=0,this.selfieMode=!1,this.handsSolution=new yD.Hands({locateFile:function(o,s){return t.solutionPath?t.solutionPath.replace(/\/+$/,"")+"/"+o:s+"/"+o}}),t.modelType==="lite"?r=0:r=1,this.handsSolution.setOptions({modelComplexity:r,selfieMode:this.selfieMode,maxNumHands:t.maxHands}),this.handsSolution.onResults(function(o){if(n.height=o.image.height,n.width=o.image.width,n.hands=[],o.multiHandLandmarks!==null)for(var s=o.multiHandedness,i=o.multiHandLandmarks,a=o.multiHandWorldLandmarks,u=0;u<s.length;u++)n.hands.push(Rn(Rn({},n.translateOutput(i[u],a[u])),{score:s[u].score,handedness:s[u].label}))})}return e.prototype.translateOutput=function(t,r){var n=this;return{keypoints:t.map(function(o,s){return{x:o.x*n.width,y:o.y*n.height,score:o.visibility,name:Cy[s]}}),keypoints3D:r.map(function(o,s){return{x:o.x,y:o.y,z:o.z,score:o.visibility,name:Cy[s]}})}},e.prototype.estimateHands=function(t,r){return Ws(this,void 0,void 0,function(){var n,o;return zs(this,function(s){switch(s.label){case 0:return r&&r.flipHorizontal&&r.flipHorizontal!==this.selfieMode&&(this.selfieMode=r.flipHorizontal,this.handsSolution.setOptions({selfieMode:this.selfieMode})),t instanceof It?(o=ImageData.bind,[4,Jm.toPixels(t)]):[3,2];case 1:return n=new(o.apply(ImageData,[void 0,s.sent(),t.shape[1],t.shape[0]])),[3,3];case 2:n=t,s.label=3;case 3:return t=n,[4,this.handsSolution.send({image:t})];case 4:return s.sent(),[2,this.hands]}})})},e.prototype.dispose=function(){this.handsSolution.close()},e.prototype.reset=function(){this.handsSolution.reset(),this.width=0,this.height=0,this.hands=null,this.selfieMode=!1},e.prototype.initialize=function(){return this.handsSolution.initialize()},e}();function hQ(e){return Ws(this,void 0,void 0,function(){var t,r;return zs(this,function(n){switch(n.label){case 0:return t=function(o){if(o==null)return Rn({},US);var s=Rn({},o);return s.runtime="mediapipe",s.maxHands==null&&(s.maxHands=US.maxHands),s.modelType==null&&(s.modelType=US.modelType),s}(e),[4,(r=new mQ(t)).initialize()];case 1:return n.sent(),[2,r]}})})}function VS(e){return e.width*e.height}function pD(e){var t=e.xCenter-e.width/2,r=t+e.width,n=e.yCenter-e.height/2;return{xMin:t,xMax:r,yMin:n,yMax:n+e.height,width:e.width,height:e.height}}function dQ(e,t){var r=pD(e),n=pD(t);if(!function(i,a){return!(i.xMax<a.xMin||a.xMax<i.xMin||i.yMax<a.yMin||a.yMax<i.yMin)}(r,n))return 0;var o=VS(function(i,a){var u=Math.max(i.xMin,a.xMin),c=Math.min(i.xMax,a.xMax),p=Math.max(i.yMin,a.yMin),m=Math.min(i.yMax,a.yMax);return{xMin:u,xMax:c,yMin:p,yMax:m,width:Math.max(c-u,0),height:Math.max(m-p,0)}}(r,n)),s=VS(r)+VS(n)-o;return s>0?o/s:0}function gQ(e,t,r,n){var o=e.width,s=e.height,i=n?-1:1,a=Math.cos(e.rotation),u=Math.sin(e.rotation),c=e.xCenter,p=e.yCenter,m=1/t,h=1/r,x=new Array(16);return x[0]=o*a*i*m,x[1]=-s*u*m,x[2]=0,x[3]=(-.5*o*a*i+.5*s*u+c)*m,x[4]=o*u*i*h,x[5]=s*a*h,x[6]=0,x[7]=(-.5*s*a-.5*o*u*i+p)*h,x[8]=0,x[9]=0,x[10]=o*m,x[11]=0,x[12]=0,x[13]=0,x[14]=0,x[15]=1,function(y){if(y.length!==16)throw new Error("Array length must be 16 but got "+y.length);return[[y[0],y[1],y[2],y[3]],[y[4],y[5],y[6],y[7]],[y[8],y[9],y[10],y[11]],[y[12],y[13],y[14],y[15]]]}(x)}function bD(e){return e instanceof It?{height:e.shape[0],width:e.shape[1]}:{height:e.height,width:e.width}}function Ey(e){return e-2*Math.PI*Math.floor((e+Math.PI)/(2*Math.PI))}function vD(e){return e instanceof It?e:Jm.fromPixels(e)}function GS(e,t){A.assert(e.width!==0,function(){return t+" width cannot be 0."}),A.assert(e.height!==0,function(){return t+" height cannot be 0."})}function xQ(e,t){var r=function(n,o,s,i){var a=o-n,u=i-s;if(a===0)throw new Error("Original min and max are both "+n+", range cannot be 0.");var c=u/a;return{scale:c,offset:s-n*c}}(0,255,t[0],t[1]);return Ue(function(){return Se(ce(e,r.scale),r.offset)})}function fD(e,t,r){var n=t.outputTensorSize,o=t.keepAspectRatio,s=t.borderMode,i=t.outputTensorFloatRange,a=bD(e),u=function(h,x){return x?{xCenter:x.xCenter*h.width,yCenter:x.yCenter*h.height,width:x.width*h.width,height:x.height*h.height,rotation:x.rotation}:{xCenter:.5*h.width,yCenter:.5*h.height,width:h.width,height:h.height,rotation:0}}(a,r),c=function(h,x,y){if(y===void 0&&(y=!1),!y)return{top:0,left:0,right:0,bottom:0};var v=x.height,w=x.width;GS(x,"targetSize"),GS(h,"roi");var C,I,D=v/w,P=h.height/h.width,G=0,q=0;return D>P?(C=h.width,I=h.width*D,q=(1-P/D)/2):(C=h.height/D,I=h.height,G=(1-D/P)/2),h.width=C,h.height=I,{top:q,left:G,right:G,bottom:q}}(u,n,o),p=gQ(u,a.width,a.height,!1),m=Ue(function(){var h=vD(e),x=Us(function(w,C,I){return GS(I,"inputResolution"),[1/I.width*w[0][0]*C.width,1/I.height*w[0][1]*C.width,w[0][3]*C.width,1/I.width*w[1][0]*C.height,1/I.height*w[1][1]*C.height,w[1][3]*C.height,0,0]}(p,a,n),[1,8]),y=s==="zero"?"constant":"nearest",v=Ym.transform(vo(it(h,"float32")),x,"bilinear",y,0,[n.height,n.width]);return i!=null?xQ(v,i):v});return{imageTensor:m,padding:c,transformationMatrix:p}}function mD(e,t,r,n){return n===1?.5*(e+t):e+(t-e)*r/(n-1)}function hD(e){return{xCenter:e.xMin+e.width/2,yCenter:e.yMin+e.height/2,width:e.width,height:e.height}}function dD(e){var t=e.relativeKeypoints;if(t.length<=1)throw new Error("2 or more keypoints required to calculate a rect.");var r=Number.MAX_VALUE,n=Number.MAX_VALUE,o=Number.MIN_VALUE,s=Number.MIN_VALUE;return t.forEach(function(i){r=Math.min(r,i.x),o=Math.max(o,i.x),n=Math.min(n,i.y),s=Math.max(s,i.y)}),{xCenter:(r+o)/2,yCenter:(n+s)/2,width:o-r,height:s-n}}function yQ(e,t,r,n,o){var s=r==="rect"?function(i,a,u){var c,p=i.locationData;if(a==="boundingbox")c=hD(p.boundingBox);else{c=dD(p);var m=u.width,h=u.height;c.xCenter=Math.round(c.xCenter*m),c.yCenter=Math.round(c.yCenter*h),c.width=Math.round(c.width*m),c.height=Math.round(c.height*h)}return c}(e,t,n):function(i,a){var u=i.locationData;return a==="boundingbox"?hD(u.relativeBoundingBox):dD(u)}(e,t);return o&&(s.rotation=function(i,a,u){var c,p=i.locationData,m=u.rotationVectorStartKeypointIndex,h=u.rotationVectorEndKeypointIndex;c=u.rotationVectorTargetAngle?u.rotationVectorTargetAngle:Math.PI*u.rotationVectorTargetAngleDegree/180;var x=p.relativeKeypoints[m].x*a.width,y=p.relativeKeypoints[m].y*a.height,v=p.relativeKeypoints[h].x*a.width,w=p.relativeKeypoints[h].y*a.height;return Ey(c-Math.atan2(-(w-y),v-x))}(e,n,o)),s}function bQ(e){return Ue(function(){var t=function(o){return Ue(function(){return[Ve(o,[0,0,0],[1,-1,1]),Ve(o,[0,0,1],[1,-1,-1])]})}(e),r=t[0],n=t[1];return{boxes:_r(n),logits:_r(r)}})}function vQ(e,t,r,n){return Ws(this,void 0,void 0,function(){var o,s,i,a,u;return zs(this,function(c){switch(c.label){case 0:return e.sort(function(p,m){return Math.max.apply(Math,m.score)-Math.max.apply(Math,p.score)}),o=Us(e.map(function(p){return[p.locationData.relativeBoundingBox.yMin,p.locationData.relativeBoundingBox.xMin,p.locationData.relativeBoundingBox.yMax,p.locationData.relativeBoundingBox.xMax]})),s=ar(e.map(function(p){return p.score[0]})),[4,Ym.nonMaxSuppressionAsync(o,s,t,r)];case 1:return[4,(i=c.sent()).array()];case 2:return a=c.sent(),u=e.filter(function(p,m){return a.indexOf(m)>-1}),St([o,s,i]),[2,u]}})})}function wQ(e,t){return e.map(function(r){var n=Rn(Rn({},r),{x:r.x*t.width,y:r.y*t.height});return r.z!=null&&(n.z=r.z*t.width),n})}function TQ(e,t,r){return Ws(this,void 0,void 0,function(){var n,o,s,i,a;return zs(this,function(u){switch(u.label){case 0:return n=e[0],o=e[1],s=function(c,p,m){return Ue(function(){var h,x,y,v;m.reverseOutputOrder?(x=_r(Ve(c,[0,m.boxCoordOffset+0],[-1,1])),h=_r(Ve(c,[0,m.boxCoordOffset+1],[-1,1])),v=_r(Ve(c,[0,m.boxCoordOffset+2],[-1,1])),y=_r(Ve(c,[0,m.boxCoordOffset+3],[-1,1]))):(h=_r(Ve(c,[0,m.boxCoordOffset+0],[-1,1])),x=_r(Ve(c,[0,m.boxCoordOffset+1],[-1,1])),y=_r(Ve(c,[0,m.boxCoordOffset+2],[-1,1])),v=_r(Ve(c,[0,m.boxCoordOffset+3],[-1,1]))),x=Se(ce(ze(x,m.xScale),p.w),p.x),h=Se(ce(ze(h,m.yScale),p.h),p.y),m.applyExponentialOnBoxSize?(y=ce(jn(ze(y,m.hScale)),p.h),v=ce(jn(ze(v,m.wScale)),p.w)):(y=ce(ze(y,m.hScale),p.h),v=ce(ze(v,m.wScale),p.h));var w=Fe(h,ze(y,2)),C=Fe(x,ze(v,2)),I=Se(h,ze(y,2)),D=Se(x,ze(v,2)),P=Rt([Q(w,[m.numBoxes,1]),Q(C,[m.numBoxes,1]),Q(I,[m.numBoxes,1]),Q(D,[m.numBoxes,1])],1);if(m.numKeypoints)for(var G=0;G<m.numKeypoints;++G){var q=m.keypointCoordOffset+G*m.numValuesPerKeypoint,Z=void 0,Y=void 0;m.reverseOutputOrder?(Z=_r(Ve(c,[0,q],[-1,1])),Y=_r(Ve(c,[0,q+1],[-1,1]))):(Y=_r(Ve(c,[0,q],[-1,1])),Z=_r(Ve(c,[0,q+1],[-1,1])));var te=Se(ce(ze(Z,m.xScale),p.w),p.x),J=Se(ce(ze(Y,m.yScale),p.h),p.y);P=Rt([P,Q(te,[m.numBoxes,1]),Q(J,[m.numBoxes,1])],1)}return P})}(o,t,r),i=Ue(function(){var c=n;return r.sigmoidScore?(r.scoreClippingThresh!=null&&(c=u0(n,-r.scoreClippingThresh,r.scoreClippingThresh)),c=xs(c)):c}),[4,SQ(s,i,r)];case 1:return a=u.sent(),St([s,i]),[2,a]}})})}function SQ(e,t,r){return Ws(this,void 0,void 0,function(){var n,o,s,i,a,u,c,p,m,h,x,y;return zs(this,function(v){switch(v.label){case 0:return n=[],[4,e.data()];case 1:return o=v.sent(),[4,t.data()];case 2:for(s=v.sent(),i=0;i<r.numBoxes;++i)if(!(r.minScoreThresh!=null&&s[i]<r.minScoreThresh||(a=i*r.numCoords,u=CQ(o[a+0],o[a+1],o[a+2],o[a+3],s[i],r.flipVertically,i),(c=u.locationData.relativeBoundingBox).width<0||c.height<0))){if(r.numKeypoints>0)for((p=u.locationData).relativeKeypoints=[],m=r.numKeypoints*r.numValuesPerKeypoint,h=0;h<m;h+=r.numValuesPerKeypoint)x=a+r.keypointCoordOffset+h,y={x:o[x+0],y:r.flipVertically?1-o[x+1]:o[x+1]},p.relativeKeypoints.push(y);n.push(u)}return[2,n]}})})}function CQ(e,t,r,n,o,s,i){return{score:[o],ind:i,locationData:{relativeBoundingBox:{xMin:t,yMin:s?1-r:e,xMax:n,yMax:s?1-e:r,width:n-t,height:r-e}}}}function EQ(e,t){return e==="none"?t:function(r){return 1/(1+Math.exp(-r))}(t)}function gD(e,t,r,n){return Ws(this,void 0,void 0,function(){var o,s,i,a,u,c,p,m;return zs(this,function(h){switch(h.label){case 0:return r=r||t.flipHorizontally||!1,n=n||t.flipVertically||!1,o=e.size,s=o/t.numLandmarks,[4,e.data()];case 1:for(i=h.sent(),a=[],u=0;u<t.numLandmarks;++u)c=u*s,(m={x:0,y:0}).x=r?t.inputImageWidth-i[c]:i[c],s>1&&(m.y=n?t.inputImageHeight-i[c+1]:i[c+1]),s>2&&(m.z=i[c+2]),s>3&&(m.score=EQ(t.visibilityActivation,i[c+3])),a.push(m);for(p=0;p<a.length;++p)(m=a[p]).x=m.x/t.inputImageWidth,m.y=m.y/t.inputImageHeight,m.z=m.z/t.inputImageWidth/(t.normalizeZ||1);return[2,a]}})})}function xD(e,t,r){var n=e.width,o=e.height,s=e.rotation;if(r.rotation==null&&r.rotationDegree==null||(s=function(p,m){return m.rotation!=null?p+=m.rotation:m.rotationDegree!=null&&(p+=Math.PI*m.rotationDegree/180),Ey(p)}(s,r)),s===0)e.xCenter=e.xCenter+n*r.shiftX,e.yCenter=e.yCenter+o*r.shiftY;else{var i=(t.width*n*r.shiftX*Math.cos(s)-t.height*o*r.shiftY*Math.sin(s))/t.width,a=(t.width*n*r.shiftX*Math.sin(s)+t.height*o*r.shiftY*Math.cos(s))/t.height;e.xCenter=e.xCenter+i,e.yCenter=e.yCenter+a}if(r.squareLong){var u=Math.max(n*t.width,o*t.height);n=u/t.width,o=u/t.height}else if(r.squareShort){var c=Math.min(n*t.width,o*t.height);n=c/t.width,o=c/t.height}return e.width=n*r.scaleX,e.height=o*r.scaleY,e}function NQ(e,t){for(var r=function(ae,ge){var ke=ae[0].x*ge.width,We=ae[0].y*ge.height,Re=(ae[4].x+ae[8].x)/2,ct=(ae[4].y+ae[8].y)/2;return Re=(Re+ae[6].x)/2*ge.width,ct=(ct+ae[6].y)/2*ge.height,Ey(Math.PI/2-Math.atan2(-(ct-We),Re-ke))}(e,t),n=Ey(-r),o=Number.POSITIVE_INFINITY,s=Number.NEGATIVE_INFINITY,i=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY,u=0,c=e;u<c.length;u++){var p=(w=c[u]).x,m=w.y;o=Math.min(o,p),s=Math.max(s,p),i=Math.min(i,m),a=Math.max(a,m)}var h=(s+o)/2,x=(a+i)/2;o=Number.POSITIVE_INFINITY,s=Number.NEGATIVE_INFINITY,i=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY;for(var y=0,v=e;y<v.length;y++){var w,C=((w=v[y]).x-h)*t.width,I=(w.y-x)*t.height,D=C*Math.cos(n)-I*Math.sin(n),P=C*Math.sin(n)+I*Math.cos(n);o=Math.min(o,D),s=Math.max(s,D),i=Math.min(i,P),a=Math.max(a,P)}var G=(s+o)/2,q=(a+i)/2,Z=G*Math.cos(r)-q*Math.sin(r)+t.width*h,Y=G*Math.sin(r)+q*Math.cos(r)+t.height*x,te=(s-o)/t.width,J=(a-i)/t.height;return{xCenter:Z/t.width,yCenter:Y/t.height,width:te,height:J,rotation:r}}var _Q={reduceBoxesInLowestLayer:!1,interpolatedScaleAspectRatio:1,featureMapHeight:[],featureMapWidth:[],numLayers:4,minScale:.1484375,maxScale:.75,inputSizeHeight:192,inputSizeWidth:192,anchorOffsetX:.5,anchorOffsetY:.5,strides:[8,16,16,16],aspectRatios:[1],fixedAnchorSize:!0},WS={runtime:"tfjs",modelType:"full",maxHands:2,detectorModelUrl:"https://tfhub.dev/mediapipe/tfjs-model/handpose_3d/detector/full/1",landmarkModelUrl:"https://tfhub.dev/mediapipe/tfjs-model/handpose_3d/landmark/full/1"},zS={flipHorizontal:!1,staticImageMode:!1},IQ={applyExponentialOnBoxSize:!1,flipVertically:!1,ignoreClasses:[],numClasses:1,numBoxes:2016,numCoords:18,boxCoordOffset:0,keypointCoordOffset:4,numKeypoints:7,numValuesPerKeypoint:2,sigmoidScore:!0,scoreClippingThresh:100,reverseOutputOrder:!0,xScale:192,yScale:192,hScale:192,wScale:192,minScoreThresh:.5},AQ=.3,kQ={shiftX:0,shiftY:-.5,scaleX:2.6,scaleY:2.6,squareLong:!0},$Q={shiftX:0,shiftY:-.1,scaleX:2,scaleY:2,squareLong:!0},RQ={outputTensorSize:{width:192,height:192},keepAspectRatio:!0,outputTensorFloatRange:[0,1],borderMode:"zero"},OQ={outputTensorSize:{width:224,height:224},keepAspectRatio:!0,outputTensorFloatRange:[0,1],borderMode:"zero"},DQ={numLandmarks:21,inputImageWidth:224,inputImageHeight:224,normalizeZ:.4,visibilityActivation:"none",flipHorizontally:!1,flipVertically:!1},FQ={numLandmarks:21,inputImageWidth:1,inputImageHeight:1,visibilityActivation:"none",flipHorizontally:!1,flipVertically:!1},oh,PQ=function(){function e(t,r,n){this.detectorModel=t,this.landmarkModel=r,this.maxHands=n,this.prevHandRectsFromLandmarks=null,this.anchors=function(u){u.reduceBoxesInLowestLayer==null&&(u.reduceBoxesInLowestLayer=!1),u.interpolatedScaleAspectRatio==null&&(u.interpolatedScaleAspectRatio=1),u.fixedAnchorSize==null&&(u.fixedAnchorSize=!1);for(var c=[],p=0;p<u.numLayers;){for(var m=[],h=[],x=[],y=[],v=p;v<u.strides.length&&u.strides[v]===u.strides[p];){var w=mD(u.minScale,u.maxScale,v,u.strides.length);if(v===0&&u.reduceBoxesInLowestLayer)x.push(1),x.push(2),x.push(.5),y.push(.1),y.push(w),y.push(w);else{for(var C=0;C<u.aspectRatios.length;++C)x.push(u.aspectRatios[C]),y.push(w);if(u.interpolatedScaleAspectRatio>0){var I=v===u.strides.length-1?1:mD(u.minScale,u.maxScale,v+1,u.strides.length);y.push(Math.sqrt(w*I)),x.push(u.interpolatedScaleAspectRatio)}}v++}for(var D=0;D<x.length;++D){var P=Math.sqrt(x[D]);m.push(y[D]/P),h.push(y[D]*P)}var G=0,q=0;if(u.featureMapHeight.length>0)G=u.featureMapHeight[p],q=u.featureMapWidth[p];else{var Z=u.strides[p];G=Math.ceil(u.inputSizeHeight/Z),q=Math.ceil(u.inputSizeWidth/Z)}for(var Y=0;Y<G;++Y)for(var te=0;te<q;++te)for(var J=0;J<m.length;++J){var ae={xCenter:(te+u.anchorOffsetX)/q,yCenter:(Y+u.anchorOffsetY)/G,width:0,height:0};u.fixedAnchorSize?(ae.width=1,ae.height=1):(ae.width=h[J],ae.height=m[J]),c.push(ae)}p=v}return c}(_Q);var o=ar(this.anchors.map(function(u){return u.width})),s=ar(this.anchors.map(function(u){return u.height})),i=ar(this.anchors.map(function(u){return u.xCenter})),a=ar(this.anchors.map(function(u){return u.yCenter}));this.anchorTensor={x:i,y:a,w:o,h:s}}return e.prototype.estimateHands=function(t,r){return Ws(this,void 0,void 0,function(){var n,o,s,i,a,u,c,p,m,h,x,y,v,w,C,I,D,P,G=this;return zs(this,function(q){switch(q.label){case 0:return n=function(te){if(te==null)return Rn({},zS);var J=Rn({},te);return J.flipHorizontal==null&&(J.flipHorizontal=zS.flipHorizontal),J.staticImageMode==null&&(J.staticImageMode=zS.staticImageMode),J}(r),t==null?(this.reset(),[2,[]]):(o=bD(t),s=Ue(function(){var te=it(vD(t),"float32");return n.flipHorizontal&&(te=_r(Ym.flipLeftRight(vo(te,0)),[0])),te}),i=this.prevHandRectsFromLandmarks,n.staticImageMode||i==null||i.length<this.maxHands?[4,this.detectPalm(s)]:[3,2]);case 1:return(u=q.sent()).length===0?(this.reset(),s.dispose(),[2,[]]):(c=u.map(function(te){return G.palmDetectionToRoi(te,o)}),a=c,[3,3]);case 2:a=i,q.label=3;case 3:return Z=.5,Y=[],[a].forEach(function(te){return te.forEach(function(J){(Y=Y.filter(function(ae){return dQ(J,ae)<=Z})).push(J)})}),a=Y,[4,Promise.all(a.map(function(te){return G.handLandmarks(te,s)}))];case 4:for(p=q.sent(),m=[],this.prevHandRectsFromLandmarks=[],h=0,x=p;h<x.length;h++)(y=x[h])!=null&&(v=y.landmarks,w=y.worldLandmarks,C=y.handScore,I=y.handedness,this.prevHandRectsFromLandmarks.push(this.handLandmarksToRoi(v,o)),(D=wQ(v,o))!=null&&D.forEach(function(te,J){delete te.z,te.name=Cy[J]}),(P=w)!=null&&P.forEach(function(te,J){te.name=Cy[J]}),m.push({keypoints:D,keypoints3D:P,handedness:I,score:C}));return s.dispose(),[2,m]}var Z,Y})})},e.prototype.dispose=function(){this.detectorModel.dispose(),this.landmarkModel.dispose(),St([this.anchorTensor.x,this.anchorTensor.y,this.anchorTensor.w,this.anchorTensor.h])},e.prototype.reset=function(){this.prevHandRectsFromLandmarks=null},e.prototype.detectPalm=function(t){return Ws(this,void 0,void 0,function(){var r,n,o,s,i,a,u,c,p,m;return zs(this,function(h){switch(h.label){case 0:return r=fD(t,RQ),n=r.imageTensor,o=r.padding,s=this.detectorModel.predict(n),i=bQ(s),a=i.boxes,[4,TQ([u=i.logits,a],this.anchorTensor,IQ)];case 1:return(c=h.sent()).length===0?(St([n,s,u,a]),[2,c]):[4,vQ(c,this.maxHands,AQ)];case 2:return p=h.sent(),m=function(x,y){x===void 0&&(x=[]);for(var v=y.left,w=y.top,C=y.left+y.right,I=y.top+y.bottom,D=0;D<x.length;D++){var P=x[D],G=P.locationData.relativeBoundingBox,q=(G.xMin-v)/(1-C),Z=(G.yMin-w)/(1-I),Y=G.width/(1-C),te=G.height/(1-I);G.xMin=q,G.yMin=Z,G.width=Y,G.height=te,G.xMax=q+Y,G.yMax=Z+te;var J=P.locationData.relativeKeypoints;J&&J.forEach(function(ae){var ge=(ae.x-v)/(1-C),ke=(ae.y-w)/(1-I);ae.x=ge,ae.y=ke})}return x}(p,o),St([n,s,u,a]),[2,m]}})})},e.prototype.palmDetectionToRoi=function(t,r){return xD(yQ(t,"boundingbox","normRect",r,{rotationVectorStartKeypointIndex:0,rotationVectorEndKeypointIndex:2,rotationVectorTargetAngleDegree:90}),r,kQ)},e.prototype.handLandmarks=function(t,r){return Ws(this,void 0,void 0,function(){var n,o,s,i,a,u,c,p,m,h,x,y,v,w,C,I;return zs(this,function(D){switch(D.label){case 0:return n=fD(r,OQ,t),o=n.imageTensor,s=n.padding,i=this.landmarkModel.execute(o,["Identity_2:0","Identity_1:0","Identity:0","Identity_3:0"]),a=i[0],u=i[1],c=i[2],p=i[3],[4,u.data()];case 1:return(m=D.sent()[0])<.5?(St(i),St(o),[2,null]):[4,c.data()];case 2:return h=D.sent()[0],x=h>=.5?"Left":"Right",[4,gD(a,DQ)];case 3:return y=D.sent(),[4,gD(p,FQ)];case 4:return v=D.sent(),w=function(P,G){var q=G.left,Z=G.top,Y=G.left+G.right,te=G.top+G.bottom;return P.map(function(J){return Rn(Rn({},J),{x:(J.x-q)/(1-Y),y:(J.y-Z)/(1-te),z:J.z/(1-Y)})})}(y,s),C=function(P,G,q){q===void 0&&(q={ignoreRotation:!1});for(var Z=[],Y=0,te=P;Y<te.length;Y++){var J=te[Y],ae=J.x-.5,ge=J.y-.5,ke=q.ignoreRotation?0:G.rotation,We=Math.cos(ke)*ae-Math.sin(ke)*ge,Re=Math.sin(ke)*ae+Math.cos(ke)*ge;We=We*G.width+G.xCenter,Re=Re*G.height+G.yCenter;var ct=J.z*G.width,oe=Rn({},J);oe.x=We,oe.y=Re,oe.z=ct,Z.push(oe)}return Z}(w,t),I=function(P,G){for(var q=[],Z=0,Y=P;Z<Y.length;Z++){var te=Y[Z],J=te.x,ae=te.y,ge=G.rotation,ke=Math.cos(ge)*J-Math.sin(ge)*ae,We=Math.sin(ge)*J+Math.cos(ge)*ae,Re=Rn({},te);Re.x=ke,Re.y=We,q.push(Re)}return q}(v,t),St(i),St(o),[2,{landmarks:C,worldLandmarks:I,handScore:m,handedness:x}]}})})},e.prototype.handLandmarksToRoi=function(t,r){return xD(NQ([].concat(t.slice(0,4),t.slice(5,7),t.slice(9,11),t.slice(13,15),t.slice(17,19)),r),r,$Q)},e}();function LQ(e){return Ws(this,void 0,void 0,function(){var t,r,n,o,s,i;return zs(this,function(a){switch(a.label){case 0:return t=function(u){if(u==null)return Rn({},WS);var c=Rn({},u);if(c.runtime="tfjs",c.maxHands==null&&(c.maxHands=WS.maxHands),c.modelType==null&&(c.modelType=WS.modelType),c.modelType!=="lite"&&c.modelType!=="full")throw new Error("Model type must be one of lite or full, but got "+c.modelType);return c.detectorModelUrl==null&&(c.modelType==="lite"?c.detectorModelUrl="https://tfhub.dev/mediapipe/tfjs-model/handpose_3d/detector/lite/1":c.detectorModelUrl="https://tfhub.dev/mediapipe/tfjs-model/handpose_3d/detector/full/1"),c.landmarkModelUrl==null&&(c.modelType==="lite"?c.landmarkModelUrl="https://tfhub.dev/mediapipe/tfjs-model/handpose_3d/landmark/lite/1":c.landmarkModelUrl="https://tfhub.dev/mediapipe/tfjs-model/handpose_3d/landmark/full/1"),c}(e),r=t.detectorModelUrl.indexOf("https://tfhub.dev")>-1,n=t.landmarkModelUrl.indexOf("https://tfhub.dev")>-1,[4,Promise.all([Sy(t.detectorModelUrl,{fromTFHub:r}),Sy(t.landmarkModelUrl,{fromTFHub:n})])];case 1:return o=a.sent(),s=o[0],i=o[1],[2,new PQ(s,i,t.maxHands)]}})})}function wD(e,t){return Ws(this,void 0,void 0,function(){var r,n;return zs(this,function(o){if(e===oh.MediaPipeHands){if(n=void 0,(r=t)!=null){if(r.runtime==="tfjs")return[2,LQ(r)];if(r.runtime==="mediapipe")return[2,hQ(r)];n=r.runtime}throw new Error("Expect modelConfig.runtime to be either 'tfjs' or 'mediapipe', but got "+n)}throw new Error(e+" is not a supported model name.")})})}(function(e){e.MediaPipeHands="MediaPipeHands"})(oh||(oh={}));var yl={},Ny={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function TD(e,t){yl[e]=t}function So(e,t){if(!(e in yl)||t!=null){let n=UQ(e,t);if(n!==null)yl[e]=n;else return console.log("Could not get context for WebGL version",e),null}let r=yl[e];return r==null||r.isContextLost()?(delete yl[e],So(e)):(r.disable(r.DEPTH_TEST),r.disable(r.STENCIL_TEST),r.disable(r.BLEND),r.disable(r.DITHER),r.disable(r.POLYGON_OFFSET_FILL),r.disable(r.SAMPLE_COVERAGE),r.enable(r.SCISSOR_TEST),r.enable(r.CULL_FACE),r.cullFace(r.BACK),yl[e])}function MQ(e){if(!z().getBool("IS_SAFARI")&&typeof OffscreenCanvas<"u"&&e===2)return new OffscreenCanvas(300,150);if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}function UQ(e,t){if(e!==1&&e!==2)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");let r=t??MQ(e);return r.addEventListener("webglcontextlost",n=>{n.preventDefault(),delete yl[e]},!1),z().getBool("SOFTWARE_WEBGL_ENABLED")&&(Ny.failIfMajorPerformanceCaveat=!1),e===1?r.getContext("webgl",Ny)||r.getContext("experimental-webgl",Ny):r.getContext("webgl2",Ny)}var bl=function(e){return e[e.DENSE=0]="DENSE",e[e.SHARED_BATCH=1]="SHARED_BATCH",e}(bl||{}),yn=function(e){return e[e.RENDER=0]="RENDER",e[e.UPLOAD=1]="UPLOAD",e[e.PIXELS=2]="PIXELS",e[e.DOWNLOAD=3]="DOWNLOAD",e}(yn||{}),an=function(e){return e[e.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",e[e.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",e[e.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",e[e.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",e[e.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16",e}(an||{});function vl(e,t){return[t,e]}function SD(e,t){return e*t}function sh(e){let t=A.sizeFromShape(e),r=Math.ceil(t/4);return A.sizeToSquarishShape(r)}function Ei(e,t){return[Math.max(1,Math.ceil(t/2)),Math.max(1,Math.ceil(e/2))]}function CD(e,t){let[r,n]=Ei(e,t);return r*n*4}function ih(e,t){let r=e,n,o,s,i,a,u,c,p,m,h;return z().getNumber("WEBGL_VERSION")===2?(n=r.R32F,o=r.R16F,s=r.RGBA16F,i=r.RGBA32F,a=r.RED,c=4,p=1,m=r.HALF_FLOAT,h=r.FLOAT,u=r.RGBA8):(n=e.RGBA,o=e.RGBA,s=e.RGBA,i=r.RGBA,a=e.RGBA,c=4,p=4,m=t!=null?t.HALF_FLOAT_OES:null,h=e.FLOAT,u=e.RGBA),{internalFormatFloat:n,internalFormatHalfFloat:o,internalFormatPackedHalfFloat:s,internalFormatPackedFloat:i,textureFormatFloat:a,downloadTextureFormat:u,downloadUnpackNumChannels:c,defaultNumChannels:p,textureTypeHalfFloat:m,textureTypeFloat:h}}function ve(e,t){let r=t();return z().getBool("DEBUG")&&VQ(e),r}function VQ(e){let t=e.getError();if(t!==e.NO_ERROR)throw new Error("WebGL Error: "+zQ(e,t))}var GQ=596e-10,WQ=65504;function ED(e){return!!(z().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||e===0||GQ<Math.abs(e)&&Math.abs(e)<WQ)}function zQ(e,t){switch(t){case e.NO_ERROR:return"NO_ERROR";case e.INVALID_ENUM:return"INVALID_ENUM";case e.INVALID_VALUE:return"INVALID_VALUE";case e.INVALID_OPERATION:return"INVALID_OPERATION";case e.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case e.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case e.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return`Unknown error code ${t}`}}function ah(e,t){return sa(e,()=>e.getExtension(t),'Extension "'+t+'" not supported on this browser.')}function ND(e,t){let r=sa(e,()=>e.createShader(e.VERTEX_SHADER),"Unable to create vertex WebGLShader.");if(ve(e,()=>e.shaderSource(r,t)),ve(e,()=>e.compileShader(r)),e.getShaderParameter(r,e.COMPILE_STATUS)===!1)throw console.log(e.getShaderInfoLog(r)),new Error("Failed to compile vertex shader.");return r}function _D(e,t){let r=sa(e,()=>e.createShader(e.FRAGMENT_SHADER),"Unable to create fragment WebGLShader.");if(ve(e,()=>e.shaderSource(r,t)),ve(e,()=>e.compileShader(r)),z().get("ENGINE_COMPILE_ONLY"))return r;if(e.getShaderParameter(r,e.COMPILE_STATUS)===!1)throw XS(t,e.getShaderInfoLog(r)),new Error("Failed to compile fragment shader.");return r}var HQ=/ERROR: [0-9]+:([0-9]+):/g;function XS(e,t){let r=HQ.exec(t);if(r==null){console.log(`Couldn't parse line number in error: ${t}`),console.log(e);return}let n=+r[1],o=e.split(`
`),s=o.length.toString().length+2,i=o.map((m,h)=>A.rightPad((h+1).toString(),s)+m),a=0;for(let m=0;m<i.length;m++)a=Math.max(i[m].length,a);let u=i.slice(0,n-1),c=i.slice(n-1,n),p=i.slice(n);console.log(u.join(`
`)),console.log(t.split(`
`)[0]),console.log(`%c ${A.rightPad(c[0],a)}`,"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(p.join(`
`))}function ID(e){return sa(e,()=>e.createProgram(),"Unable to create WebGLProgram.")}function AD(e,t){if(ve(e,()=>e.linkProgram(t)),!z().get("ENGINE_COMPILE_ONLY")&&e.getProgramParameter(t,e.LINK_STATUS)===!1)throw console.log(e.getProgramInfoLog(t)),new Error("Failed to link vertex and fragment shaders.")}function Iy(e,t){if(ve(e,()=>e.validateProgram(t)),e.getProgramParameter(t,e.VALIDATE_STATUS)===!1)throw console.log(e.getProgramInfoLog(t)),new Error("Shader program validation failed.")}function kD(e,t){let r=sa(e,()=>e.createBuffer(),"Unable to create WebGLBuffer");return ve(e,()=>e.bindBuffer(e.ARRAY_BUFFER,r)),ve(e,()=>e.bufferData(e.ARRAY_BUFFER,t,e.STATIC_DRAW)),r}function $D(e,t){let r=sa(e,()=>e.createBuffer(),"Unable to create WebGLBuffer");return ve(e,()=>e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,r)),ve(e,()=>e.bufferData(e.ELEMENT_ARRAY_BUFFER,t,e.STATIC_DRAW)),r}function RD(e){return sa(e,()=>e.createTexture(),"Unable to create WebGLTexture.")}function OD(e,t){let r=z().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(e<=0||t<=0){let n=`[${e}x${t}]`;throw new Error("Requested texture size "+n+" is invalid.")}if(e>r||t>r){let n=`[${e}x${t}]`,o=`[${r}x${r}]`;throw new Error("Requested texture size "+n+" greater than WebGL maximum on this browser / GPU "+o+".")}}function DD(e){return sa(e,()=>e.createFramebuffer(),"Unable to create WebGLFramebuffer.")}function YS(e,t,r,n,o,s,i){let a=e.getAttribLocation(t,r);return a===-1?!1:(ve(e,()=>e.bindBuffer(e.ARRAY_BUFFER,n)),ve(e,()=>e.vertexAttribPointer(a,o,e.FLOAT,!1,s,i)),ve(e,()=>e.enableVertexAttribArray(a)),!0)}function KQ(e,t,r){jQ(e,r),ve(e,()=>e.activeTexture(e.TEXTURE0+r)),ve(e,()=>e.bindTexture(e.TEXTURE_2D,t))}function FD(e,t,r){return sa(e,()=>e.getUniformLocation(t,r),'uniform "'+r+'" not present in program.')}function PD(e,t,r){return e.getUniformLocation(t,r)}function LD(e,t,r,n){ve(e,()=>KQ(e,t,n)),ve(e,()=>e.uniform1i(r,n))}function Ay(e,t,r){ve(e,()=>e.bindFramebuffer(e.FRAMEBUFFER,r)),ve(e,()=>e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0))}function ZS(e,t){ve(e,()=>e.bindFramebuffer(e.FRAMEBUFFER,t)),ve(e,()=>e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,null,0))}function uh(e){let t=e.checkFramebufferStatus(e.FRAMEBUFFER);if(t!==e.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+qQ(e,t))}function qQ(e,t){switch(t){case e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case e.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return`unknown error ${t}`}}function sa(e,t,r){let n=ve(e,()=>t());if(n==null)throw new Error(r);return n}function jQ(e,t){let r=e.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,n=t+e.TEXTURE0;if(n<e.TEXTURE0||n>r){let o=`[gl.TEXTURE0, gl.TEXTURE${r}]`;throw new Error(`textureUnit must be in ${o}.`)}}function ou(e,t=2){return A.sizeFromShape(e.slice(0,e.length-t))}function su(e){if(e.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[e.length>1?e[e.length-2]:1,e[e.length-1]]}function lh(e){let t=[1,1,1];return e.length===0||e.length===1&&e[0]===1||(t=[ou(e),...su(e)]),t}function BD(e,t=!1){let r=z().getNumber("WEBGL_MAX_TEXTURE_SIZE"),n=z().getNumber("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE");n===1/0&&z().getBool("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE")&&(n=r/2),t&&(r=r*2,n=n*2,e=e.map((a,u)=>u>=e.length-2?A.nearestLargerEven(e[u]):e[u]),e.length===1&&(e=[2,e[0]])),e.length!==2&&(e=A.squeezeShape(e).newShape);let o=A.sizeFromShape(e),s=null;e.length<=1&&o<=r?s=[1,o]:e.length===2&&e[0]<=r&&e[1]<=r?s=e:e.length===3&&e[0]*e[1]<=r&&e[2]<=r?s=[e[0]*e[1],e[2]]:e.length===3&&e[0]<=r&&e[1]*e[2]<=r?s=[e[0],e[1]*e[2]]:e.length===4&&e[0]*e[1]*e[2]<=r&&e[3]<=r?s=[e[0]*e[1]*e[2],e[3]]:e.length===4&&e[0]<=r&&e[1]*e[2]*e[3]<=r&&(s=[e[0],e[1]*e[2]*e[3]]);let i=s!=null&&Math.max(...s)>n&&Math.min(...s)<=(t?2:1)&&Math.min(...s)>0;if(s==null||i)if(t){let a=ou(e),u=2,c=2;e.length&&([u,c]=su(e)),o=a*(u/2)*(c/2),s=A.sizeToSquarishShape(o).map(p=>p*2)}else s=A.sizeToSquarishShape(o);return s}function _y(e){return e%2===0}function wl(e,t){if(e=e.slice(-2),t=t.slice(-2),A.arraysEqual(e,t)||!e.length||!t.length||e[0]===0||e[1]===0||t[0]===0||t[1]===0)return!0;if(e.length!==t.length){let r=e[e.length-1],n=t[t.length-1];if(r===n||_y(r)&&_y(n)&&(e[0]===1||t[0]===1))return!0}return e[1]===t[1]&&_y(e[0])&&_y(t[0])}var KS,qS;function MD(e){if(KS==null){let t=So(e);KS=t.getParameter(t.MAX_TEXTURE_SIZE)}return KS}function UD(e){if(qS==null){let t=So(e);qS=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,qS)}function VD(e){if(e===0)return 0;let t,r=So(e);return jo(r,"EXT_disjoint_timer_query_webgl2")&&e===2?t=2:jo(r,"EXT_disjoint_timer_query")?t=1:t=0,t}function jo(e,t){return e.getExtension(t)!=null}function QS(e){try{if(So(e)!=null)return!0}catch(t){return console.log("Error when getting WebGL context: ",t),!1}return!1}function GD(e){if(e===0)return!1;let t=So(e);if(e===1){if(!jo(t,"OES_texture_float"))return!1}else if(!jo(t,"EXT_color_buffer_float"))return!1;return jS(t)}function WD(e){if(e===0)return!1;let t=So(e);if(e===1){if(!jo(t,"OES_texture_float")||!jo(t,"WEBGL_color_buffer_float"))return!1}else{if(jo(t,"EXT_color_buffer_float"))return jS(t);let n="EXT_color_buffer_half_float";if(jo(t,n)){let o=t.getExtension(n);return XQ(t,o)}return!1}return jS(t)}function jS(e){let t=ih(e),r=e.createTexture();e.bindTexture(e.TEXTURE_2D,r),e.texImage2D(e.TEXTURE_2D,0,t.internalFormatFloat,1,1,0,t.textureFormatFloat,t.textureTypeFloat,null);let s=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,s),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,r,0);let i=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(r),e.deleteFramebuffer(s),i}function XQ(e,t){let r=ih(e,t),n=e.createTexture();e.bindTexture(e.TEXTURE_2D,n),e.texImage2D(e.TEXTURE_2D,0,r.internalFormatHalfFloat,1,1,0,r.textureFormatFloat,r.textureTypeHalfFloat,null);let i=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,i),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,n,0);let a=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(n),e.deleteFramebuffer(i),a}function zD(e){return e!==2?!1:So(e).fenceSync!=null}function Ni(e,t){Array.isArray(e)||(e=[e]),e.forEach(r=>{r!=null&&A.assert(r.dtype!=="complex64",()=>`${t} does not support complex64 tensors in the WebGL backend.`)})}var $e=z();$e.registerFlag("HAS_WEBGL",()=>$e.getNumber("WEBGL_VERSION")>0);$e.registerFlag("WEBGL_VERSION",()=>QS(2)?2:QS(1)?1:0);$e.registerFlag("WEBGL_CHECK_NUMERICAL_PROBLEMS",()=>!1);$e.registerFlag("WEBGL_BUFFER_SUPPORTED",()=>$e.get("WEBGL_VERSION")===2);$e.registerFlag("WEBGL_CPU_FORWARD",()=>!0);$e.registerFlag("WEBGL_FORCE_F16_TEXTURES",()=>!1);$e.registerFlag("WEBGL_PACK",()=>$e.getBool("HAS_WEBGL"));$e.registerFlag("WEBGL_PACK_NORMALIZATION",()=>$e.getBool("WEBGL_PACK"));$e.registerFlag("WEBGL_PACK_CLIP",()=>$e.getBool("WEBGL_PACK"));$e.registerFlag("WEBGL_PACK_DEPTHWISECONV",()=>$e.getBool("WEBGL_PACK"));$e.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",()=>$e.getBool("WEBGL_PACK"));$e.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",()=>$e.getBool("WEBGL_PACK"));$e.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",()=>$e.getBool("WEBGL_PACK"));$e.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",()=>$e.getBool("WEBGL_PACK"));$e.registerFlag("WEBGL_PACK_REDUCE",()=>$e.getBool("WEBGL_PACK"));$e.registerFlag("WEBGL_LAZILY_UNPACK",()=>$e.getBool("WEBGL_PACK"));$e.registerFlag("WEBGL_CONV_IM2COL",()=>$e.getBool("WEBGL_PACK"));$e.registerFlag("WEBGL_PACK_CONV2DTRANSPOSE",()=>$e.getBool("WEBGL_PACK"));$e.registerFlag("WEBGL_MAX_TEXTURE_SIZE",()=>MD($e.getNumber("WEBGL_VERSION")));$e.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",()=>UD($e.getNumber("WEBGL_VERSION")));$e.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",()=>{let e=$e.getNumber("WEBGL_VERSION");return e===0?0:VD(e)});$e.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",()=>$e.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!Ha.isMobile());$e.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",()=>GD($e.getNumber("WEBGL_VERSION")));$e.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",()=>$e.getBool("WEBGL_FORCE_F16_TEXTURES")?!1:$e.getBool("WEBGL_RENDER_FLOAT32_CAPABLE"));$e.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",()=>WD($e.getNumber("WEBGL_VERSION")));$e.registerFlag("WEBGL_FENCE_API_ENABLED",()=>zD($e.getNumber("WEBGL_VERSION")));$e.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",()=>$e.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0);$e.registerFlag("WEBGL_DELETE_TEXTURE_THRESHOLD",()=>-1,e=>{if(typeof e!="number")throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be a number but got ${e}.`);if(e<0&&e!==-1)throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be -1 (indicating never delete) or at least 0, but got ${e}.`)});$e.registerFlag("WEBGL_FLUSH_THRESHOLD",()=>Ha.isMobile()?1:-1,e=>{if(typeof e!="number")throw new Error(`WEBGL_FLUSH_THRESHOLD must be a number but got ${e}.`);if(e<0&&e!==-1)throw new Error(`WEBGL_FLUSH_THRESHOLD must be -1 (indicating never manual flush) or at least 0, but got ${e}.`)});$e.registerFlag("CPU_HANDOFF_SIZE_THRESHOLD",()=>128);$e.registerFlag("WEBGL_USE_SHAPES_UNIFORMS",()=>!1);$e.registerFlag("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD",()=>1e5);$e.registerFlag("TOPK_K_CPU_HANDOFF_THRESHOLD",()=>128);$e.registerFlag("WEBGL_EXP_CONV",()=>!1);$e.registerFlag("SOFTWARE_WEBGL_ENABLED",()=>$e.getBool("IS_TEST"));$e.registerFlag("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE",()=>1/0);$e.registerFlag("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE",()=>!1);$e.registerFlag("WEBGL2_ISNAN_CUSTOM",()=>!1);$e.registerFlag("ENGINE_COMPILE_ONLY",()=>!1);function Jt(){let e,t,r,n,o,s,i,a,u,c;return z().getNumber("WEBGL_VERSION")===2?(e="#version 300 es",t="in",r="out",n="in",o="texture",s="outputColor",i="out vec4 outputColor;",a=z().getBool("WEBGL2_ISNAN_CUSTOM")?`
      bool isnan_custom(float val) {
        uint floatToUint = floatBitsToUint(val);
        return (floatToUint & 0x7fffffffu) > 0x7f800000u;
      }

      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan_custom(val.x),
          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));
      }

      #define isnan(value) isnan_custom(value)
    `:"",u="",c=`
      #define round(value) newRound(value)
      int newRound(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 newRound(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `):(e="",t="attribute",r="varying",n="varying",o="texture2D",s="gl_FragColor",i="",a=`
      #define isnan(value) isnan_custom(value)
      bool isnan_custom(float val) {
        return (val > 0. || val < 1. || val == 0.) ? false : true;
      }
      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));
      }
    `,u=`
      uniform float INFINITY;

      bool isinf(float val) {
        return abs(val) == INFINITY;
      }
      bvec4 isinf(vec4 val) {
        return equal(abs(val), vec4(INFINITY));
      }
    `,c=`
      int round(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 round(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `),{version:e,attribute:t,varyingVs:r,varyingFs:n,texture2D:o,output:s,defineOutput:i,defineSpecialNaN:a,defineSpecialInf:u,defineRound:c}}function Hs(e,t,r="index"){let n=A.computeStrides(t);return n.map((o,s)=>{let i=`int ${e[s]} = ${r} / ${o}`,a=s===n.length-1?`int ${e[s+1]} = ${r} - ${e[s]} * ${o}`:`index -= ${e[s]} * ${o}`;return`${i}; ${a};`}).join("")}function Tl(e,t,r="index"){let n=A.computeStrides(t);return n.map((o,s)=>{let i=`int ${e[s]} = ${r} / outShapeStrides[${s}]`,a=s===n.length-1?`int ${e[s+1]} = ${r} - ${e[s]} * outShapeStrides[${s}]`:`index -= ${e[s]} * outShapeStrides[${s}]`;return`${i}; ${a};`}).join("")}function YQ(e,t){let r=e.length,n=e.map(s=>`${t}[${s}]`),o=new Array(r-1);o[r-2]=n[r-1];for(let s=r-3;s>=0;--s)o[s]=`(${o[s+1]} * ${n[s+1]})`;return o}function HD(e,t,r="index"){let n=e.map((s,i)=>i),o=YQ(n,t);return o.map((s,i)=>{let a=`int ${e[i]} = ${r} / ${o[i]}`,u=i===o.length-1?`int ${e[i+1]} = ${r} - ${e[i]} * ${o[i]}`:`index -= ${e[i]} * ${o[i]}`;return`${a}; ${u};`}).join("")}function _p(e){let t=A.computeStrides(e).map(r=>r.toString());return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * ${t[0]} + coords.y * ${t[1]} + coords.z;
  }
`}function Ip(){return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;
  }
`}var $y=`
  const float FLOAT_MAX = 1.70141184e38;
  const float FLOAT_MIN = 1.17549435e-38;

  lowp vec4 encode_float(highp float v) {
    if (isnan(v)) {
      return vec4(255, 255, 255, 255);
    }

    highp float av = abs(v);

    if(av < FLOAT_MIN) {
      return vec4(0.0, 0.0, 0.0, 0.0);
    } else if(v > FLOAT_MAX) {
      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
    } else if(v < -FLOAT_MAX) {
      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
    }

    highp vec4 c = vec4(0,0,0,0);

    highp float e = floor(log2(av));
    highp float m = exp2(fract(log2(av))) - 1.0;

    c[2] = floor(128.0 * m);
    m -= c[2] / 128.0;
    c[1] = floor(32768.0 * m);
    m -= c[1] / 32768.0;
    c[0] = floor(8388608.0 * m);

    highp float ebias = e + 127.0;
    c[3] = floor(ebias / 2.0);
    ebias -= c[3] * 2.0;
    c[2] += floor(ebias) * 128.0;

    c[3] += 128.0 * step(0.0, -v);

    return c / 255.0;
  }
`;var{getBroadcastDims:KD}=U;function qD(e,t,r){let n=[];if(e.forEach(x=>{let y=A.sizeFromShape(x.shapeInfo.logicalShape);if(x.shapeInfo.isUniform?n.push(`uniform float ${x.name}${y>1?`[${y}]`:""};`):(n.push(`uniform sampler2D ${x.name};`),n.push(`uniform int offset${x.name};`)),r.enableShapeUniforms){let{uniformShape:v}=Ry(r.packedInputs,x.shapeInfo.logicalShape,x.shapeInfo.texShape);switch(v.length){case 1:n.push(`uniform int ${x.name}Shape;`);break;case 2:n.push(`uniform ivec2 ${x.name}Shape;`);break;case 3:n.push(`uniform ivec3 ${x.name}Shape;`);break;case 4:n.push(`uniform ivec4 ${x.name}Shape;`);break;default:break}n.push(`uniform ivec2 ${x.name}TexShape;`)}}),r.enableShapeUniforms){switch(t.logicalShape.length){case 1:n.push("uniform int outShape;");break;case 2:n.push("uniform ivec2 outShape;"),n.push("uniform int outShapeStrides;");break;case 3:n.push("uniform ivec3 outShape;"),n.push("uniform ivec2 outShapeStrides;");break;case 4:n.push("uniform ivec4 outShape;"),n.push("uniform ivec3 outShapeStrides;");break;default:break}n.push("uniform ivec2 outTexShape;")}r.customUniforms&&r.customUniforms.forEach(x=>{n.push(`uniform ${x.type} ${x.name}${x.arrayIndex?`[${x.arrayIndex}]`:""};`)});let o=n.join(`
`),s=e.map(x=>ZQ(x,t,r.packedInputs,r.enableShapeUniforms)).join(`
`),i=t.texShape,a=Jt(),u=eJ(a),c,p,m=nJ(a);return t.isPacked?(c=QQ(t.logicalShape,i,r.enableShapeUniforms),p=rJ(a)):(c=JQ(t.logicalShape,i,r.enableShapeUniforms),p=tJ(a)),r.packedInputs&&(m+=aJ),[m,u,p,o,c,s,r.userCode].join(`
`)}function kp(e,t=!1){let r=e.shapeInfo.logicalShape;switch(r.length){case 0:return bJ(e,t);case 1:return wJ(e,t);case 2:return SJ(e,t);case 3:return EJ(e,t);case 4:return _J(e,t);case 5:return IJ(e);case 6:return AJ(e);default:throw new Error(`${r.length}-D input sampling is not yet supported`)}}function jD(e,t){switch(e.shapeInfo.logicalShape.length){case 0:return yJ(e);case 1:return vJ(e,t);case 2:return TJ(e,t);case 3:return CJ(e,t);default:return NJ(e,t)}}function ZQ(e,t,r=!1,n){let o="";r?o+=jD(e,n):o+=kp(e,n);let s=e.shapeInfo.logicalShape,i=t.logicalShape;return s.length<=i.length&&(r?o+=kJ(e,t):o+=$J(e,t)),o}function QQ(e,t,r){switch(e.length){case 0:return XD();case 1:return uJ(e,t,r);case 2:return gJ(e,t,r);case 3:return cJ(e,t,r);default:return fJ(e,t,r)}}function JQ(e,t,r){switch(e.length){case 0:return XD();case 1:return lJ(e,t,r);case 2:return xJ(e,t,r);case 3:return pJ(e,t,r);case 4:return mJ(e,t,r);case 5:return hJ(e,t);case 6:return dJ(e,t);default:throw new Error(`${e.length}-D output sampling is not yet supported`)}}function eJ(e){return`
    float sampleTexture(sampler2D textureSampler, vec2 uv) {
      return ${e.texture2D}(textureSampler, uv).r;
    }
  `}function tJ(e){return`
    void setOutput(float val) {
      ${e.output} = vec4(val, 0, 0, 0);
    }
  `}function rJ(e){return`
    void setOutput(vec4 val) {
      ${e.output} = val;
    }
  `}function nJ(e){return`${e.version}
    precision highp float;
    precision highp int;
    precision highp sampler2D;
    ${e.varyingFs} vec2 resultUV;
    ${e.defineOutput}
    const vec2 halfCR = vec2(0.5, 0.5);

    struct ivec5
    {
      int x;
      int y;
      int z;
      int w;
      int u;
    };

    struct ivec6
    {
      int x;
      int y;
      int z;
      int w;
      int u;
      int v;
    };

    uniform float NAN;
    ${e.defineSpecialNaN}
    ${e.defineSpecialInf}
    ${e.defineRound}

    int imod(int x, int y) {
      return x - y * (x / y);
    }

    int idiv(int a, int b, float sign) {
      int res = a / b;
      int mod = imod(a, b);
      if (sign < 0. && mod != 0) {
        res -= 1;
      }
      return res;
    }

    //Based on the work of Dave Hoskins
    //https://www.shadertoy.com/view/4djSRW
    #define HASHSCALE1 443.8975
    float random(float seed){
      vec2 p = resultUV * seed;
      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);
      p3 += dot(p3, p3.yzx + 19.19);
      return fract((p3.x + p3.y) * p3.z);
    }

    ${oJ}
    ${sJ}
    ${iJ}
  `}var oJ=`
vec2 uvFromFlat(int texNumR, int texNumC, int index) {
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
  int texelIndex = index / 2;
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,sJ=`
vec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,
  int texNumC, int row, int col) {
  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,iJ=`
vec2 packedUVfrom3D(int texNumR, int texNumC,
    int texelsInBatch, int texelsInLogicalRow, int b,
    int row, int col) {
  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,aJ=`
  float getChannel(vec4 frag, vec2 innerDims) {
    vec2 modCoord = mod(innerDims, 2.);
    return modCoord.x == 0. ?
      (modCoord.y == 0. ? frag.r : frag.g) :
      (modCoord.y == 0. ? frag.b : frag.a);
  }
  float getChannel(vec4 frag, int dim) {
    float modCoord = mod(float(dim), 2.);
    return modCoord == 0. ? frag.r : frag.g;
  }
`;function XD(){return`
    int getOutputCoords() {
      return 0;
    }
  `}function uJ(e,t,r){let n=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];return n[0]===1?r?`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ceil(float(outTexShape[1]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ${n[1]}.0);
      }
    `:n[1]===1?r?`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ceil(float(outTexShape[0]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ${n[0]}.0);
      }
    `:r?`
    int getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      return 2 * (resTexRC.x * packedTexShape[1] + resTexRC.y);
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${n[0]}, ${n[1]}));
      return 2 * (resTexRC.x * ${n[1]} + resTexRC.y);
    }
  `}function lJ(e,t,r){return t[0]===1?r?`
      int getOutputCoords() {
        return int(resultUV.x * float(outTexShape[1]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.x * ${t[1]}.0);
      }
    `:t[1]===1?r?`
      int getOutputCoords() {
        return int(resultUV.y * float(outTexShape[0]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.y * ${t[0]}.0);
      }
    `:r?`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      return resTexRC.x * outTexShape[1] + resTexRC.y;
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${t[0]}, ${t[1]}));
      return resTexRC.x * ${t[1]} + resTexRC.y;
    }
  `}function cJ(e,t,r){if(r)return`
    ivec3 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec3(b, r, c);
    }
  `;let n=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)],o=Math.ceil(e[2]/2),s=o*Math.ceil(e[1]/2);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${n[0]}, ${n[1]}));
      int index = resTexRC.x * ${n[1]} + resTexRC.y;

      int b = index / ${s};
      index -= b * ${s};

      int r = 2 * (index / ${o});
      int c = imod(index, ${o}) * 2;

      return ivec3(b, r, c);
    }
  `}function pJ(e,t,r){if(r)return`
  ivec3 getOutputCoords() {
    ivec2 resTexRC = ivec2(resultUV.yx *
                           vec2(outTexShape[0], outTexShape[1]));
    int index = resTexRC.x * outTexShape[1] + resTexRC.y;
    ${Tl(["r","c","d"],e)}
    return ivec3(r, c, d);
  }
`;let n=Hs(["r","c","d"],e);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${t[0]}, ${t[1]}));
      int index = resTexRC.x * ${t[1]} + resTexRC.y;
      ${n}
      return ivec3(r, c, d);
    }
  `}function fJ(e,t,r){if(r)return`
    ivec4 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int texelsInLogicalRow = int(ceil(float(outShape[3]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatchN = texelsInBatch * outShape[1];

      int b2 = index / texelsInBatchN;
      index -= b2 * texelsInBatchN;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec4(b2, b, r, c);
    }
  `;let n=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)],o=Math.ceil(e[e.length-1]/2),s=o*Math.ceil(e[e.length-2]/2),i=s,a="",u="b, r, c";for(let c=2;c<e.length-1;c++)i*=e[e.length-c-1],a=`
      int b${c} = index / ${i};
      index -= b${c} * ${i};
    `+a,u=`b${c}, `+u;return`
    ivec${e.length} getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${n[0]}, ${n[1]}));
      int index = resTexRC.x * ${n[1]} + resTexRC.y;

      ${a}

      int b = index / ${s};
      index -= b * ${s};

      int r = 2 * (index / ${o});
      int c = imod(index, ${o}) * 2;

      return ivec${e.length}(${u});
    }
  `}function mJ(e,t,r){if(r)return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      ${Tl(["r","c","d","d2"],e)}
      return ivec4(r, c, d, d2);
    }
  `;let n=Hs(["r","c","d","d2"],e);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${t[0]}, ${t[1]}));
      int index = resTexRC.x * ${t[1]} + resTexRC.y;
      ${n}
      return ivec4(r, c, d, d2);
    }
  `}function hJ(e,t){let r=Hs(["r","c","d","d2","d3"],e);return`
    ivec5 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx * vec2(${t[0]},
                             ${t[1]}));

      int index = resTexRC.x * ${t[1]} + resTexRC.y;

      ${r}

      ivec5 outShape = ivec5(r, c, d, d2, d3);
      return outShape;
    }
  `}function dJ(e,t){let r=Hs(["r","c","d","d2","d3","d4"],e);return`
    ivec6 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${t[0]}, ${t[1]}));
      int index = resTexRC.x * ${t[1]} + resTexRC.y;

      ${r}

      ivec6 result = ivec6(r, c, d, d2, d3, d4);
      return result;
    }
  `}function gJ(e,t,r){let n=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];if(A.arraysEqual(e,t))return r?`
      ivec2 getOutputCoords() {
        ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
        return 2 * ivec2(resultUV.yx * vec2(packedTexShape[0], packedTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return 2 * ivec2(resultUV.yx * vec2(${n[0]}, ${n[1]}));
      }
    `;let o=Math.ceil(e[1]/2);return r?`
    ivec2 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));

      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;
      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${n[0]}, ${n[1]}));

      int index = resTexRC.x * ${n[1]} + resTexRC.y;
      int r = 2 * (index / ${o});
      int c = imod(index, ${o}) * 2;

      return ivec2(r, c);
    }
  `}function xJ(e,t,r){return A.arraysEqual(e,t)?r?`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(outTexShape[0], outTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(${t[0]}, ${t[1]}));
      }
    `:e[1]===1?r?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(index, 0);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${t[0]}, ${t[1]}));
        int index = resTexRC.x * ${t[1]} + resTexRC.y;
        return ivec2(index, 0);
      }
    `:e[0]===1?r?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(0, index);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${t[0]}, ${t[1]}));
        int index = resTexRC.x * ${t[1]} + resTexRC.y;
        return ivec2(0, index);
      }
    `:r?`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      int r = index / outShape[1];
      int c = index - r * outShape[1];
      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${t[0]}, ${t[1]}));
      int index = resTexRC.x * ${t[1]} + resTexRC.y;
      int r = index / ${e[1]};
      int c = index - r * ${e[1]};
      return ivec2(r, c);
    }
  `}function Sl(e){return`offset${e}`}function yJ(e){let t=e.name,r="get"+t.charAt(0).toUpperCase()+t.slice(1),n=Jt();return`
    vec4 ${r}() {
      return ${n.texture2D}(${t}, halfCR);
    }
  `}function bJ(e,t){let r=e.name,n="get"+r.charAt(0).toUpperCase()+r.slice(1);if(e.shapeInfo.isUniform)return`float ${n}() {return ${r};}`;let[o,s]=e.shapeInfo.texShape;if(o===1&&s===1)return`
      float ${n}() {
        return sampleTexture(${r}, halfCR);
      }
    `;let i=Sl(r);if(t)return`
    float ${n}() {
      vec2 uv = uvFromFlat(${r}TexShape[0], ${r}TexShape[1], ${i});
      return sampleTexture(${r}, uv);
    }
  `;let[a,u]=e.shapeInfo.texShape;return`
    float ${n}() {
      vec2 uv = uvFromFlat(${a}, ${u}, ${i});
      return sampleTexture(${r}, uv);
    }
  `}function vJ(e,t){let r=e.name,n="get"+r.charAt(0).toUpperCase()+r.slice(1),o=e.shapeInfo.texShape,s=Jt();if(t)return`
    vec4 ${n}(int index) {
      ivec2 packedTexShape = ivec2(ceil(float(${r}TexShape[0]) / 2.0), ceil(float(${r}TexShape[1]) / 2.0));
      vec2 uv = packedUVfrom1D(
        packedTexShape[0], packedTexShape[1], index);
      return ${s.texture2D}(${r}, uv);
    }
  `;let i=[Math.ceil(o[0]/2),Math.ceil(o[1]/2)];return`
    vec4 ${n}(int index) {
      vec2 uv = packedUVfrom1D(
        ${i[0]}, ${i[1]}, index);
      return ${s.texture2D}(${r}, uv);
    }
  `}function wJ(e,t){let r=e.name,n="get"+r.charAt(0).toUpperCase()+r.slice(1);if(e.shapeInfo.isUniform)return`
      float ${n}(int index) {
        ${$p(e)}
      }
    `;let o=e.shapeInfo.texShape,s=o[0],i=o[1];if(i===1&&s===1)return`
      float ${n}(int index) {
        return sampleTexture(${r}, halfCR);
      }
    `;let a=Sl(r);return i===1?t?`
      float ${n}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${a}) + 0.5) / float(${r}TexShape[0]));
        return sampleTexture(${r}, uv);
      }
    `:`
      float ${n}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${a}) + 0.5) / ${s}.0);
        return sampleTexture(${r}, uv);
      }
    `:s===1?t?`
      float ${n}(int index) {
        vec2 uv = vec2((float(index + ${a}) + 0.5) / float(${r}TexShape[1]), 0.5);
        return sampleTexture(${r}, uv);
      }
    `:`
      float ${n}(int index) {
        vec2 uv = vec2((float(index + ${a}) + 0.5) / ${i}.0, 0.5);
        return sampleTexture(${r}, uv);
      }
    `:t?`
    float ${n}(int index) {
      vec2 uv = uvFromFlat(${r}TexShape[0], ${r}TexShape[1], index + ${a});
      return sampleTexture(${r}, uv);
    }
  `:`
    float ${n}(int index) {
      vec2 uv = uvFromFlat(${s}, ${i}, index + ${a});
      return sampleTexture(${r}, uv);
    }
  `}function TJ(e,t){let r=e.shapeInfo.logicalShape,n=e.name,o="get"+n.charAt(0).toUpperCase()+n.slice(1),s=e.shapeInfo.texShape,i=s[0],a=s[1],u=Jt();if(s!=null&&A.arraysEqual(r,s))return t?`
      vec4 ${o}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${n}TexShape[1], ${n}TexShape[0]);

        return ${u.texture2D}(${n}, uv);
      }
    `:`
      vec4 ${o}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${a}.0, ${i}.0);

        return ${u.texture2D}(${n}, uv);
      }
    `;if(t)return`
    vec4 ${o}(int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(${n}TexShape[0]) / 2.0), ceil(float(${n}TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(${n}Shape[1]) / 2.0));
      vec2 uv = packedUVfrom2D(valuesPerRow, packedTexShape[0], packedTexShape[1], row, col);
      return ${u.texture2D}(${n}, uv);
    }
  `;let c=[Math.ceil(s[0]/2),Math.ceil(s[1]/2)],p=Math.ceil(r[1]/2);return`
    vec4 ${o}(int row, int col) {
      vec2 uv = packedUVfrom2D(${p}, ${c[0]}, ${c[1]}, row, col);
      return ${u.texture2D}(${n}, uv);
    }
  `}function SJ(e,t){let r=e.shapeInfo.logicalShape,n=e.name,o="get"+n.charAt(0).toUpperCase()+n.slice(1),s=e.shapeInfo.texShape;if(s!=null&&A.arraysEqual(r,s)){if(t)return`
      float ${o}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${n}TexShape[1], ${n}TexShape[0]);
        return sampleTexture(${n}, uv);
      }
    `;let h=s[0],x=s[1];return`
    float ${o}(int row, int col) {
      vec2 uv = (vec2(col, row) + halfCR) / vec2(${x}.0, ${h}.0);
      return sampleTexture(${n}, uv);
    }
  `}let{newShape:i,keptDims:a}=A.squeezeShape(r),u=i;if(u.length<r.length){let h=Rp(e,u),x=["row","col"];return`
      ${kp(h,t)}
      float ${o}(int row, int col) {
        return ${o}(${Op(x,a)});
      }
    `}if(e.shapeInfo.isUniform)return`
      float ${o}(int row, int col) {
        int index = round(dot(vec2(row, col), vec2(${r[1]}, 1)));
        ${$p(e)}
      }
    `;let c=s[0],p=s[1],m=Sl(n);return p===1?t?`
      float ${o}(int row, int col) {
        float index = dot(vec3(row, col, ${m}), vec3(${n}Shape[1], 1, 1));
        vec2 uv = vec2(0.5, (index + 0.5) / float(${n}TexShape[0]));
        return sampleTexture(${n}, uv);
      }
    `:`
    float ${o}(int row, int col) {
      float index = dot(vec3(row, col, ${m}), vec3(${r[1]}, 1, 1));
      vec2 uv = vec2(0.5, (index + 0.5) / ${c}.0);
      return sampleTexture(${n}, uv);
    }
  `:c===1?t?`
      float ${o}(int row, int col) {
        float index = dot(vec3(row, col, ${m}), vec3(${n}Shape[1], 1, 1));
        vec2 uv = vec2((index + 0.5) / float(${n}TexShape[1]), 0.5);
        return sampleTexture(${n}, uv);
      }
    `:`
    float ${o}(int row, int col) {
      float index = dot(vec3(row, col, ${m}), vec3(${r[1]}, 1, 1));
      vec2 uv = vec2((index + 0.5) / ${p}.0, 0.5);
      return sampleTexture(${n}, uv);
    }
  `:t?`
      float ${o}(int row, int col) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${n}Shape[1] + col + ${m};
        vec2 uv = uvFromFlat(${n}TexShape[0], ${n}TexShape[1], index);
        return sampleTexture(${n}, uv);
      }
    `:`
  float ${o}(int row, int col) {
    // Explicitly use integer operations as dot() only works on floats.
    int index = row * ${r[1]} + col + ${m};
    vec2 uv = uvFromFlat(${c}, ${p}, index);
    return sampleTexture(${n}, uv);
  }
`}function CJ(e,t){let r=e.shapeInfo.logicalShape,n=e.name,o="get"+n.charAt(0).toUpperCase()+n.slice(1),s=e.shapeInfo.texShape,i=[Math.ceil(s[0]/2),Math.ceil(s[1]/2)];if(r[0]===1){let h=r.slice(1),x=[1,2],y=Rp(e,h),v=["b","row","col"];return`
        ${jD(y,t)}
        vec4 ${o}(int b, int row, int col) {
          return ${o}(${Op(v,x)});
        }
      `}let a=Jt();if(t)return`
    vec4 ${o}(int b, int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(${n}TexShape[0]) / 2.0), ceil(float(${n}TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(${n}Shape[2]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(${n}Shape[1]) / 2.0));
      vec2 uv = packedUVfrom3D(
        packedTexShape[0], packedTexShape[1], texelsInBatch, valuesPerRow, b, row, col);
      return ${a.texture2D}(${n}, uv);
    }
  `;let u=i[0],c=i[1],p=Math.ceil(r[2]/2),m=p*Math.ceil(r[1]/2);return`
    vec4 ${o}(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        ${u}, ${c}, ${m}, ${p}, b, row, col);
      return ${a.texture2D}(${n}, uv);
    }
  `}function EJ(e,t){let r=e.shapeInfo.logicalShape,n=e.name,o="get"+n.charAt(0).toUpperCase()+n.slice(1),s=r[1]*r[2],i=r[2],{newShape:a,keptDims:u}=A.squeezeShape(r),c=a;if(c.length<r.length){let v=Rp(e,c),w=["row","col","depth"];return`
        ${kp(v,t)}
        float ${o}(int row, int col, int depth) {
          return ${o}(${Op(w,u)});
        }
      `}if(e.shapeInfo.isUniform)return`
      float ${o}(int row, int col, int depth) {
        int index = round(dot(vec3(row, col, depth),
                          vec3(${s}, ${i}, 1)));
        ${$p(e)}
      }
    `;let p=e.shapeInfo.texShape,m=p[0],h=p[1],x=e.shapeInfo.flatOffset;if(h===s&&x==null)return t?`
      float ${o}(int row, int col, int depth) {
        int stride1 = ${n}Shape[2];
        float texR = float(row);
        float texC = dot(vec2(col, depth), vec2(stride1, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${n}TexShape[1], ${n}TexShape[0]);
        return sampleTexture(${n}, uv);
      }
    `:`
        float ${o}(int row, int col, int depth) {
          float texR = float(row);
          float texC = dot(vec2(col, depth), vec2(${i}, 1));
          vec2 uv = (vec2(texC, texR) + halfCR) /
                     vec2(${h}.0, ${m}.0);
          return sampleTexture(${n}, uv);
        }
      `;if(h===i&&x==null)return t?`
      float ${o}(int row, int col, int depth) {
        float texR = dot(vec2(row, col), vec2(${n}Shape[1], 1));
        float texC = float(depth);
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${n}TexShape[1], ${n}TexShape[0]);
        return sampleTexture(${n}, uv);
      }
    `:`
    float ${o}(int row, int col, int depth) {
      float texR = dot(vec2(row, col), vec2(${r[1]}, 1));
      float texC = float(depth);
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${h}.0, ${m}.0);
      return sampleTexture(${n}, uv);
    }
  `;let y=Sl(n);return t?`
    float ${o}(int row, int col, int depth) {
      // Explicitly use integer operations as dot() only works on floats.
      int stride0 = ${n}Shape[1] * ${n}Shape[2];
      int stride1 = ${n}Shape[2];
      int index = row * stride0 + col * stride1 + depth + ${y};
      vec2 uv = uvFromFlat(${n}TexShape[0], ${n}TexShape[1], index);
      return sampleTexture(${n}, uv);
    }
    `:`
      float ${o}(int row, int col, int depth) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${s} + col * ${i} + depth + ${y};
        vec2 uv = uvFromFlat(${m}, ${h}, index);
        return sampleTexture(${n}, uv);
      }
  `}function NJ(e,t){let r=e.name,n="get"+r.charAt(0).toUpperCase()+r.slice(1),o=Jt();if(t)return`
    vec4 ${n}(int b2, int b, int row, int col) {
      int valuesPerRow = int(ceil(float(${r}Shape[3]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(${r}Shape[2]) / 2.0));
      int index = b * texelsInBatch + (row / 2) * valuesPerRow + (col / 2);
      texelsInBatch *= ${r}Shape[1];
      index = b2 * texelsInBatch + index;
      ivec2 packedTexShape = ivec2(ceil(float(${r}TexShape[0]) / 2.0), ceil(float(${r}TexShape[1]) / 2.0));
      int texR = index / packedTexShape[1];
      int texC = index - texR * packedTexShape[1];
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(packedTexShape[1], packedTexShape[0]); return ${o.texture2D}(${r}, uv);
    }
  `;let s=e.shapeInfo.logicalShape,i=s.length,a=e.shapeInfo.texShape,u=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)],c=u[0],p=u[1],m=Math.ceil(s[i-1]/2),h=m*Math.ceil(s[i-2]/2),x="int b, int row, int col",y=`b * ${h} + (row / 2) * ${m} + (col / 2)`;for(let v=2;v<i-1;v++)x=`int b${v}, `+x,h*=s[i-v-1],y=`b${v} * ${h} + `+y;return`
    vec4 ${n}(${x}) {
      int index = ${y};
      int texR = index / ${p};
      int texC = index - texR * ${p};
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${p}, ${c});
      return ${o.texture2D}(${r}, uv);
    }
  `}function _J(e,t){let r=e.shapeInfo.logicalShape,n=e.name,o="get"+n.charAt(0).toUpperCase()+n.slice(1),s=r[3],i=r[2]*s,a=r[1]*i,{newShape:u,keptDims:c}=A.squeezeShape(r);if(u.length<r.length){let I=Rp(e,u),D=["row","col","depth","depth2"];return`
      ${kp(I,t)}
      float ${o}(int row, int col, int depth, int depth2) {
        return ${o}(${Op(D,c)});
      }
    `}if(e.shapeInfo.isUniform)return`
      float ${o}(int row, int col, int depth, int depth2) {
        int index = round(dot(vec4(row, col, depth, depth2),
                          vec4(${a}, ${i}, ${s}, 1)));
        ${$p(e)}
      }
    `;let p=e.shapeInfo.flatOffset,m=e.shapeInfo.texShape,h=m[0],x=m[1],y=`int stride2 = ${n}Shape[3];`,v=`int stride1 = ${n}Shape[2] * stride2;`,w=`int stride0 = ${n}Shape[1] * stride1;`;if(x===a&&p==null)return t?`
      float ${o}(int row, int col, int depth, int depth2) {
        ${y}
        ${v}
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(stride1, stride2, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${n}TexShape[1], ${n}TexShape[0]);
        return sampleTexture(${n}, uv);
      }
    `:`
      float ${o}(int row, int col, int depth, int depth2) {
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(${i}, ${s}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${x}.0, ${h}.0);
        return sampleTexture(${n}, uv);
      }
    `;if(x===s&&p==null)return t?`
      float ${o}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${n}Shape[1] * ${n}Shape[2], ${n}Shape[2], 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${n}TexShape[1], ${n}TexShape[0]);
        return sampleTexture(${n}, uv);
      }
    `:`
      float ${o}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${r[1]*r[2]}, ${r[2]}, 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${x}.0, ${h}.0);
        return sampleTexture(${n}, uv);
      }
    `;let C=Sl(n);return t?`
    float ${o}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      ${y}
      ${v}
      ${w}
      int index = row * stride0 + col * stride1 +
          depth * stride2 + depth2;
      vec2 uv = uvFromFlat(${n}TexShape[0], ${n}TexShape[1], index + ${C});
      return sampleTexture(${n}, uv);
    }
  `:`
    float ${o}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${a} + col * ${i} +
          depth * ${s} + depth2;
      vec2 uv = uvFromFlat(${h}, ${x}, index + ${C});
      return sampleTexture(${n}, uv);
    }
  `}function IJ(e){let t=e.shapeInfo.logicalShape,r=e.name,n="get"+r.charAt(0).toUpperCase()+r.slice(1),o=t[4],s=t[3]*o,i=t[2]*s,a=t[1]*i,{newShape:u,keptDims:c}=A.squeezeShape(t);if(u.length<t.length){let v=Rp(e,u),w=["row","col","depth","depth2","depth3"];return`
      ${kp(v)}
      float ${n}(int row, int col, int depth, int depth2, int depth3) {
        return ${n}(${Op(w,c)});
      }
    `}if(e.shapeInfo.isUniform)return`
      float ${n}(int row, int col, int depth, int depth2, int depth3) {
        float index = dot(
          vec4(row, col, depth, depth2),
          vec4(${a}, ${i}, ${s}, ${o})) +
          depth3;
        ${$p(e)}
      }
    `;let p=e.shapeInfo.flatOffset,m=e.shapeInfo.texShape,h=m[0],x=m[1];if(x===a&&p==null)return`
      float ${n}(int row, int col, int depth, int depth2, int depth3) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
                         vec4(${i}, ${s}, ${o}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${x}.0, ${h}.0);
        return sampleTexture(${r}, uv);
      }
    `;if(x===o&&p==null)return`
      float ${n}(int row, int col, int depth, int depth2, int depth3) {
        float texR = dot(
          vec4(row, col, depth, depth2),
          vec4(${t[1]*t[2]*t[3]},
               ${t[2]*t[3]}, ${t[3]}, 1));
        int texC = depth3;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${x}.0, ${h}.0);
        return sampleTexture(${r}, uv);
      }
    `;let y=Sl(r);return`
    float ${n}(int row, int col, int depth, int depth2, int depth3) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${a} + col * ${i} + depth * ${s} +
          depth2 * ${o} + depth3 + ${y};
      vec2 uv = uvFromFlat(${h}, ${x}, index);
      return sampleTexture(${r}, uv);
    }
  `}function AJ(e){let t=e.shapeInfo.logicalShape,r=e.name,n="get"+r.charAt(0).toUpperCase()+r.slice(1),{newShape:o,keptDims:s}=A.squeezeShape(t);if(o.length<t.length){let w=Rp(e,o),C=["row","col","depth","depth2","depth3","depth4"];return`
      ${kp(w)}
      float ${n}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        return ${n}(${Op(C,s)});
      }
    `}let i=t[5],a=t[4]*i,u=t[3]*a,c=t[2]*u,p=t[1]*c;if(e.shapeInfo.isUniform)return`
      float ${n}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
        int index = round(dot(
          vec4(row, col, depth, depth2),
          vec4(${p}, ${c}, ${u}, ${a})) +
          dot(
            vec2(depth3, depth4),
            vec2(${i}, 1)));
        ${$p(e)}
      }
    `;let m=e.shapeInfo.flatOffset,h=e.shapeInfo.texShape,x=h[0],y=h[1];if(y===p&&m==null)return`
      float ${n}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
          vec4(${c}, ${u}, ${a}, ${i})) +
               float(depth4);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${y}.0, ${x}.0);
        return sampleTexture(${r}, uv);
      }
    `;if(y===i&&m==null)return`
      float ${n}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        float texR = dot(vec4(row, col, depth, depth2),
          vec4(${t[1]*t[2]*t[3]*t[4]},
               ${t[2]*t[3]*t[4]},
               ${t[3]*t[4]},
               ${t[4]})) + float(depth3);
        int texC = depth4;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${y}.0, ${x}.0);
        return sampleTexture(${r}, uv);
      }
    `;let v=Sl(r);return`
    float ${n}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${p} + col * ${c} + depth * ${u} +
          depth2 * ${a} + depth3 * ${i} + depth4 + ${v};
      vec2 uv = uvFromFlat(${x}, ${y}, index);
      return sampleTexture(${r}, uv);
    }
  `}function $p(e){let t=e.name,r=A.sizeFromShape(e.shapeInfo.logicalShape);return r<2?`return ${t};`:`
    for (int i = 0; i < ${r}; i++) {
      if (i == index) {
        return ${t}[i];
      }
    }
  `}function kJ(e,t){let r=e.name,n=r.charAt(0).toUpperCase()+r.slice(1),o="get"+n+"AtOutCoords",s=e.shapeInfo.logicalShape.length,i=t.logicalShape.length,a=KD(e.shapeInfo.logicalShape,t.logicalShape),u=Ke(i),c=i-s,p,m=["x","y","z","w","u","v"];s===0?p="":i<2&&a.length>=1?p="coords = 0;":p=a.map(I=>`coords.${m[I+c]} = 0;`).join(`
`);let h="";i<2&&s>0?h="coords":h=e.shapeInfo.logicalShape.map((I,D)=>`coords.${m[D+c]}`).join(", ");let x="return outputValue;",v=A.sizeFromShape(e.shapeInfo.logicalShape)===1,C=A.sizeFromShape(t.logicalShape)===1;if(s===1&&!v&&!C)x=`
      return vec4(outputValue.xy, outputValue.xy);
    `;else if(v&&!C)i===1?x=`
        return vec4(outputValue.x, outputValue.x, 0., 0.);
      `:x=`
        return vec4(outputValue.x);
      `;else if(a.length){let I=s-2,D=s-1;a.indexOf(I)>-1&&a.indexOf(D)>-1?x="return vec4(outputValue.x);":a.indexOf(I)>-1?x="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":a.indexOf(D)>-1&&(x="return vec4(outputValue.xx, outputValue.zz);")}return`
    vec4 ${o}() {
      ${u} coords = getOutputCoords();
      ${p}
      vec4 outputValue = get${n}(${h});
      ${x}
    }
  `}function $J(e,t){let r=e.name,n=r.charAt(0).toUpperCase()+r.slice(1),o="get"+n+"AtOutCoords",s=t.texShape,i=e.shapeInfo.texShape,a=e.shapeInfo.logicalShape.length,u=t.logicalShape.length;if(!e.shapeInfo.isUniform&&a===u&&e.shapeInfo.flatOffset==null&&A.arraysEqual(i,s))return`
      float ${o}() {
        return sampleTexture(${r}, resultUV);
      }
    `;let c=Ke(u),p=KD(e.shapeInfo.logicalShape,t.logicalShape),m=u-a,h,x=["x","y","z","w","u","v"];a===0?h="":u<2&&p.length>=1?h="coords = 0;":h=p.map(v=>`coords.${x[v+m]} = 0;`).join(`
`);let y="";return u<2&&a>0?y="coords":y=e.shapeInfo.logicalShape.map((v,w)=>`coords.${x[w+m]}`).join(", "),`
    float ${o}() {
      ${c} coords = getOutputCoords();
      ${h}
      return get${n}(${y});
    }
  `}function Ke(e){if(e<=1)return"int";if(e===2)return"ivec2";if(e===3)return"ivec3";if(e===4)return"ivec4";if(e===5)return"ivec5";if(e===6)return"ivec6";throw Error(`GPU for rank ${e} is not yet supported`)}function Ry(e,t,r){let{newShape:n,keptDims:o}=A.squeezeShape(t),s=t.length,i=e&&s===3&&t[0]===1,a=i?t.slice(1):n,u=!e&&s>1&&!A.arraysEqual(t,r)&&n.length<s||i;return{useSqueezeShape:u,uniformShape:u?a:t,keptDims:o}}function Rp(e,t){let r=JSON.parse(JSON.stringify(e));return r.shapeInfo.logicalShape=t,r}function Op(e,t){return t.map(r=>e[r]).join(", ")}function ZD(e,t,r,n){let o=r.map((p,m)=>{let h={logicalShape:p.shape,texShape:p.isUniform?null:p.texData.texShape,isUniform:p.isUniform,isPacked:p.isUniform?!1:p.texData.isPacked,flatOffset:null};return p.texData!=null&&p.texData.slice!=null&&p.texData.slice.flatOffset>0&&(h.flatOffset=p.texData.slice.flatOffset),{name:t.variableNames[m],shapeInfo:h}}),s=o.map(p=>p.shapeInfo),i={logicalShape:n.shape,texShape:n.texData.texShape,isUniform:!1,isPacked:n.texData.isPacked,flatOffset:null},a=qD(o,i,t),u=_D(e.gl,a),c=e.createProgram(u);return z().get("ENGINE_COMPILE_ONLY")?{program:t,fragmentShader:u,source:a,webGLProgram:c,inShapeInfos:s,outShapeInfo:i,variablesLocations:null,customUniformLocations:null,infLoc:null,nanLoc:null,outShapeLocation:null,outShapeStridesLocation:null,outTexShapeLocation:null}:(e.buildVao(c),Object.assign({program:t,fragmentShader:u,source:a,webGLProgram:c,inShapeInfos:s,outShapeInfo:i},JS(e,t,c)))}function JS(e,t,r){let n=[],o=[],s,i,a,u=null,c=null;c=e.getUniformLocation(r,"NAN",!1),z().getNumber("WEBGL_VERSION")===1&&(u=e.getUniformLocation(r,"INFINITY",!1));let p=!1;for(let m of t.variableNames){let h={name:m,uniform:e.getUniformLocation(r,m,p),offset:e.getUniformLocation(r,`offset${m}`,p)};t.enableShapeUniforms&&(h.shape=e.getUniformLocation(r,`${m}Shape`,p),h.texShape=e.getUniformLocation(r,`${m}TexShape`,p)),n.push(h)}if(t.enableShapeUniforms&&(s=e.getUniformLocation(r,"outShape",p),a=e.getUniformLocation(r,"outShapeStrides",p),i=e.getUniformLocation(r,"outTexShape",p)),t.customUniforms)for(let m of t.customUniforms)o.push(e.getUniformLocation(r,m.name,p));return{variablesLocations:n,customUniformLocations:o,infLoc:u,nanLoc:c,outShapeLocation:s,outShapeStridesLocation:a,outTexShapeLocation:i}}function YD(e,t){if(e.length!==t.length)throw Error(`Binary was compiled with ${e.length} inputs, but was executed with ${t.length} inputs`);e.forEach((r,n)=>{let o=r.logicalShape,s=t[n],i=s.shape;if(!A.arraysEqual(o,i))throw Error(`Binary was compiled with different shapes than the current args. Shapes ${o} and ${i} must match`);if(r.isUniform&&s.isUniform)return;let a=r.texShape,u=s.isUniform?null:s.texData.texShape;if(!A.arraysEqual(a,u))throw Error(`Binary was compiled with different texture shapes than the current args. Shape ${a} and ${u} must match`)})}function QD(e,t,r,n,o){t.program.enableShapeUniforms||(YD(t.inShapeInfos,r),YD([t.outShapeInfo],[n]));let s=n.texData.texture,i=n.texData.texShape;n.texData.isPacked?e.setOutputPackedMatrixTexture(s.texture,i[0],i[1]):e.setOutputMatrixTexture(s.texture,i[0],i[1]),e.setProgram(t.webGLProgram),e.bindVertexArray(t.webGLProgram.vao),z().getNumber("WEBGL_VERSION")===1&&t.infLoc!==null&&e.gl.uniform1f(t.infLoc,1/0),t.nanLoc!==null&&e.gl.uniform1f(t.nanLoc,NaN);for(let u=0;u<r.length;++u){let c=r[u],{uniform:p,offset:m,shape:h,texShape:x}=t.variablesLocations[u];if(h){let{uniformShape:y}=Ry(t.program.packedInputs,c.shape,c.texData.texShape);switch(y.length){case 1:e.gl.uniform1iv(h,new Int32Array(y));break;case 2:e.gl.uniform2iv(h,new Int32Array(y));break;case 3:e.gl.uniform3iv(h,new Int32Array(y));break;case 4:e.gl.uniform4iv(h,new Int32Array(y));break;default:break}}if(x&&e.gl.uniform2i(x,c.texData.texShape[0],c.texData.texShape[1]),p!=null){if(c.isUniform){if(A.sizeFromShape(c.shape)<2)e.gl.uniform1f(p,c.uniformValues[0]);else{let y=c.uniformValues;y instanceof Float32Array||(y=new Float32Array(y)),e.gl.uniform1fv(p,y)}continue}c.texData.slice!=null&&m!=null&&e.gl.uniform1i(m,c.texData.slice.flatOffset),e.setInputMatrixTexture(c.texData.texture.texture,p,u)}}let a=t.outShapeLocation;if(a)switch(n.shape.length){case 1:e.gl.uniform1iv(a,new Int32Array(n.shape));break;case 2:e.gl.uniform2iv(a,new Int32Array(n.shape));break;case 3:e.gl.uniform3iv(a,new Int32Array(n.shape));break;case 4:e.gl.uniform4iv(a,new Int32Array(n.shape));break;default:break}if(t.outShapeStridesLocation){let u=A.computeStrides(n.shape);switch(n.shape.length){case 2:e.gl.uniform1iv(t.outShapeStridesLocation,new Int32Array(u));break;case 3:e.gl.uniform2iv(t.outShapeStridesLocation,new Int32Array(u));break;case 4:e.gl.uniform3iv(t.outShapeStridesLocation,new Int32Array(u));break;default:break}}if(t.outTexShapeLocation&&e.gl.uniform2i(t.outTexShapeLocation,n.texData.texShape[0],n.texData.texShape[1]),t.program.customUniforms&&o)for(let u=0;u<t.program.customUniforms.length;++u){let c=t.program.customUniforms[u],p=t.customUniformLocations[u],m=o[u];if(c.type==="float")e.gl.uniform1fv(p,m);else if(c.type==="vec2")e.gl.uniform2fv(p,m);else if(c.type==="vec3")e.gl.uniform3fv(p,m);else if(c.type==="vec4")e.gl.uniform4fv(p,m);else if(c.type==="int")e.gl.uniform1iv(p,m);else if(c.type==="ivec2")e.gl.uniform2iv(p,m);else if(c.type==="ivec3")e.gl.uniform3iv(p,m);else if(c.type==="ivec4")e.gl.uniform4iv(p,m);else throw Error(`uniform type ${c.type} is not supported yet.`)}e.executeProgram()}function JD(e,t,r){let n="";t.concat(r).forEach(i=>{let a=i.texData!=null&&i.texData.slice!=null&&i.texData.slice.flatOffset>0;if(e.enableShapeUniforms&&!i.isUniform){let u=i.texData.texShape,{useSqueezeShape:c,uniformShape:p,keptDims:m}=Ry(e.packedInputs,i.shape,u),h="",x="",y="";if(p.length===1&&e.packedInputs){let G=[Math.ceil(u[0]/2),Math.ceil(u[1]/2)];h=`${G[0]>1}_${G[1]>1}`}else if(p.length===2&&!e.packedInputs)x=`${p[0]>1}_${p[1]>1}`;else if(p.length>2&&!e.packedInputs){let G=A.computeStrides(p);y=`${G[0]===u[1]}_${G[G.length-1]===u[1]}`}let v=i.shape.length,w=p.length===2&&A.arraysEqual(i.shape,u),C=A.sizeFromShape(i.shape)===1,I=U.getBroadcastDims(i.shape,r.shape),D=!e.packedInputs&&v===r.shape.length&&A.arraysEqual(u,r.texData.texShape),P=e.packedInputs||p.length>2?"":`${u[0]>1}_${u[1]>1}`;n+=`${v}_${D}_${c?m:""}_${p.length}_${C}_${I}_${w}_${h}_${x}_${y}_${P}_${a}`}else{let u=i.isUniform?"uniform":i.texData.texShape;n+=`${i.shape}_${u}_${a}`}});let o=e.userCode,s=e.constructor.name;return s+="_"+n+"_"+o+`${z().getNumber("WEBGL_VERSION")}`,s}function Ct(e){return z().getBool("WEBGL_USE_SHAPES_UNIFORMS")&&e<=4}var Oy=class{constructor(t){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=bl.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];let r=Jt();this.outputShape=t,this.enableShapeUniforms=Ct(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${this.enableShapeUniforms?Tl(["r","c","d"],t):Hs(["r","c","d"],t)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getA(rc.x, rc.y, rc.z);
        }

        ${r.output} = result;
      }
    `}};var Dy=class{constructor(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=bl.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];let r=Jt();this.outputShape=t,this.enableShapeUniforms=Ct(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${this.enableShapeUniforms?Tl(["r","c","d"],t):Hs(["r","c","d"],t)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));
        }

        ${r.output} = result;
      }
    `}};var Fy=class{constructor(t){this.variableNames=["A"],this.outTexUsage=yn.DOWNLOAD;let r=Jt();this.outputShape=t,this.userCode=`
      ${$y}

      void main() {
        float x = getAAtOutCoords();
        ${r.output} = encode_float(x);
      }
    `}};var Py=class{constructor(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=yn.DOWNLOAD;let r=Jt();this.outputShape=t,this.userCode=`
      ${$y}

      void main() {
        ivec3 coords = getOutputCoords();
        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));
        ${r.output} = encode_float(x);
      }
    `}};var DJ={R:0,G:1,B:2,A:3},ch=class{constructor(t,r=!1,n="RGBA"){this.variableNames=["A"],this.customUniforms=[{name:"texShape",type:"ivec2"}];let o=Jt();this.outputShape=t,this.enableShapeUniforms=Ct(this.outputShape.length);let s="result";r&&(s="floor(result * 255. + 0.5)");let i="";for(let a=0;a<n.length;a++){let u=n[a];i+=`
          if(offset == ${a}) {
            result = values[${DJ[u]}];
          }`}this.userCode=`
      ${this.enableShapeUniforms?Ip():_p(t)}

      void main() {
        ivec3 coords = getOutputCoords();
        int flatIndex = getFlatIndex(coords);
        float result = 0.;
        int offset = imod(flatIndex, ${n.length});

        flatIndex = idiv(flatIndex, ${n.length}, 1.);

        int r = flatIndex / texShape[1];
        if (r < texShape[0]) {
          int c = imod(flatIndex, texShape[1]);
          vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
          vec4 values = ${o.texture2D}(A, uv);
          ${i}
        }
        ${o.output} = vec4(${s}, 0., 0., 0.);
      }
    `}};var Ly=class{constructor(t,r=!1){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.customUniforms=[{name:"texShape",type:"ivec2"}];let n=Jt();this.outputShape=t,this.enableShapeUniforms=Ct(this.outputShape.length);let o="",s="result";r&&(s="floor(result * 255. + 0.5)");for(let i=0;i<=1;i++)for(let a=0;a<=1;a++){let u=i*2+a;o+=`
          localCoords = coords;
          if(localCoords[2] + ${a} < ${this.enableShapeUniforms?"outShape[2]":`${t[2]}`}) {
          localCoords[2] += ${a};
          if (localCoords[1] + ${i} < ${this.enableShapeUniforms?"outShape[1]":`${t[1]}`}) {
            localCoords[1] += ${i};

            flatIndex = getFlatIndex(localCoords);
            offset = imod(flatIndex, 4);

            flatIndex = idiv(flatIndex, 4, 1.);

            int r = flatIndex / texShape[1];
            int c = imod(flatIndex, texShape[1]);
            vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
            values = ${n.texture2D}(A, uv);

            if (offset == 0) {
              result[${u}] = values[0];
            } else if (offset == 1) {
              result[${u}] = values[1];
            } else if (offset == 2) {
              result[${u}] = values[2];
            } else {
              result[${u}] = values[3];
            }
          }
        }
        `}this.userCode=`
        ${this.enableShapeUniforms?Ip():_p(t)}

        void main() {
          ivec3 coords = getOutputCoords();

          vec4 result = vec4(0.);
          int flatIndex, r, c, offset;
          ivec3 localCoords;
          vec2 uv;
          vec4 values;

          ${o}

          ${n.output} = ${s};
        }
    `}};function eF(e){let t=Jt(),r=`${t.version}
    precision highp float;
    ${t.attribute} vec3 clipSpacePos;
    ${t.attribute} vec2 uv;
    ${t.varyingVs} vec2 resultUV;

    void main() {
      gl_Position = vec4(clipSpacePos, 1);
      resultUV = uv;
    }`;return ND(e,r)}function tF(e){let t=new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]);return kD(e,t)}function rF(e){let t=new Uint16Array([0,1,2,2,1,3]);return $D(e,t)}function ph(e,t,r,n,o,s){OD(t,r);let i=RD(e),a=e.TEXTURE_2D;return ve(e,()=>e.bindTexture(a,i)),ve(e,()=>e.texParameteri(a,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE)),ve(e,()=>e.texParameteri(a,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE)),ve(e,()=>e.texParameteri(a,e.TEXTURE_MIN_FILTER,e.NEAREST)),ve(e,()=>e.texParameteri(a,e.TEXTURE_MAG_FILTER,e.NEAREST)),z().getNumber("WEBGL_VERSION")===1?ve(e,()=>e.texImage2D(a,0,n,t,r,0,o,s,null)):ve(e,()=>e.texStorage2D(a,1,n,t,r)),ve(e,()=>e.bindTexture(e.TEXTURE_2D,null)),{texture:i,texShape:[r,t]}}function eC(e){return e.internalFormatFloat}function nF(e,t,r,n){let[o,s]=vl(t,r);return ph(e,o,s,eC(n),n.textureFormatFloat,e.FLOAT)}function tC(e){return e.internalFormatHalfFloat}function oF(e,t,r,n){let[o,s]=vl(t,r);return ph(e,o,s,tC(n),n.textureFormatFloat,n.textureTypeHalfFloat)}function rC(e){return e.downloadTextureFormat}function sF(e,t,r,n){let[o,s]=vl(t,r);return ph(e,o,s,rC(n),e.RGBA,e.UNSIGNED_BYTE)}function nC(e){return e.internalFormatPackedFloat}function iF(e,t,r,n){let[o,s]=Ei(t,r);return ph(e,o,s,nC(n),e.RGBA,e.FLOAT)}function oC(e){return e.internalFormatPackedHalfFloat}function aF(e,t,r,n){let[o,s]=Ei(t,r);return ph(e,o,s,oC(n),e.RGBA,n.textureTypeHalfFloat)}function uF(e,t,r){return ve(e,()=>e.bindBuffer(e.ARRAY_BUFFER,r)),YS(e,t,"clipSpacePos",r,3,20,0)&&YS(e,t,"uv",r,2,20,12)}function lF(e,t,r,n,o,s){ve(e,()=>e.bindTexture(e.TEXTURE_2D,t));let i,a,u;o instanceof Uint8Array?(i=new Uint8Array(r*n*4),a=e.UNSIGNED_BYTE,u=e.RGBA):(i=new Float32Array(r*n*4),a=e.FLOAT,u=s.internalFormatPackedFloat),i.set(o),z().getNumber("WEBGL_VERSION")===2?ve(e,()=>e.texSubImage2D(e.TEXTURE_2D,0,0,0,r,n,e.RGBA,a,i)):ve(e,()=>e.texImage2D(e.TEXTURE_2D,0,u,r,n,0,e.RGBA,a,i)),ve(e,()=>e.bindTexture(e.TEXTURE_2D,null))}function cF(e,t,r){ve(e,()=>e.bindTexture(e.TEXTURE_2D,t)),r.data instanceof Uint8Array?z().getNumber("WEBGL_VERSION")===2?ve(e,()=>e.texSubImage2D(e.TEXTURE_2D,0,0,0,r.width,r.height,e.RGBA,e.UNSIGNED_BYTE,r.data)):ve(e,()=>e.texImage2D(e.TEXTURE_2D,0,e.RGBA,r.width,r.height,0,e.RGBA,e.UNSIGNED_BYTE,r.data)):z().getNumber("WEBGL_VERSION")===2?ve(e,()=>e.texSubImage2D(e.TEXTURE_2D,0,0,0,e.RGBA,e.UNSIGNED_BYTE,r)):ve(e,()=>e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,r)),ve(e,()=>e.bindTexture(e.TEXTURE_2D,null))}function pF(e,t,r,n){let o=e.createBuffer();ve(e,()=>e.bindBuffer(e.PIXEL_PACK_BUFFER,o));let a=4*4*t*r;return ve(e,()=>e.bufferData(e.PIXEL_PACK_BUFFER,a,e.STREAM_READ)),ve(e,()=>e.readPixels(0,0,r,t,e.RGBA,e.FLOAT,0)),ve(e,()=>e.bindBuffer(e.PIXEL_PACK_BUFFER,null)),o}function fF(e,t,r){let n=e,o=new Float32Array(r);return n.bindBuffer(n.PIXEL_PACK_BUFFER,t),n.getBufferSubData(n.PIXEL_PACK_BUFFER,0,o),n.bindBuffer(n.PIXEL_PACK_BUFFER,null),o}function mF(e,t,r,n){let[o,s]=vl(t,r),i=4,a=new Uint8Array(SD(t*r,i));return ve(e,()=>e.readPixels(0,0,o,s,n.downloadTextureFormat,e.UNSIGNED_BYTE,a)),new Float32Array(a.buffer)}function hF(e,t,r,n,o,s,i,a){let u=e,c=new Float32Array(CD(s,i));return u.bindBuffer(u.PIXEL_PACK_BUFFER,t),u.getBufferSubData(u.PIXEL_PACK_BUFFER,0,c),u.bindBuffer(u.PIXEL_PACK_BUFFER,null),c}function dF(e,t,r){let n=new Float32Array(t*r*4);return ve(e,()=>e.readPixels(0,0,r,t,e.RGBA,e.FLOAT,n)),n}var Dp=class{constructor(t){this.outputTexture=null,this.program=null,this.disposed=!1,this.itemsToPoll=[];let r=z().getNumber("WEBGL_VERSION");if(t!=null?(this.gl=t,TD(r,t)):this.gl=So(r),t=this.gl,z().getNumber("WEBGL_VERSION")===2){let s=t;this.createVertexArray=()=>ve(s,()=>s.createVertexArray()),this.bindVertexArray=i=>ve(s,()=>s.bindVertexArray(i)),this.deleteVertexArray=i=>ve(s,()=>s.deleteVertexArray(i)),this.getVertexArray=()=>ve(s,()=>s.getParameter(s.VERTEX_ARRAY_BINDING))}else if(t!=null){let s=t.getExtension("OES_vertex_array_object");if(s==null)throw new Error("All WebGL1 implementations are expected to offer OES_vertex_array_object.");this.createVertexArray=()=>ve(t,()=>s.createVertexArrayOES()),this.bindVertexArray=i=>ve(t,()=>s.bindVertexArrayOES(i)),this.deleteVertexArray=i=>ve(t,()=>s.deleteVertexArrayOES(i)),this.getVertexArray=()=>ve(t,()=>t.getParameter(s.VERTEX_ARRAY_BINDING_OES))}let n="WEBGL_color_buffer_float",o="EXT_color_buffer_half_float";if(this.parallelCompilationExtension=this.gl.getExtension("KHR_parallel_shader_compile"),z().getNumber("WEBGL_VERSION")===1){let s="OES_texture_float",i="OES_texture_half_float";if(this.textureFloatExtension=ah(this.gl,s),jo(this.gl,i))this.textureHalfFloatExtension=ah(this.gl,i);else if(z().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(n),jo(this.gl,o))this.colorBufferHalfFloatExtension=ah(this.gl,o);else if(z().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(n="EXT_color_buffer_float",jo(this.gl,n))this.colorBufferFloatExtension=this.gl.getExtension(n);else if(jo(this.gl,o))this.colorBufferHalfFloatExtension=this.gl.getExtension(o);else throw new Error("GL context does not support color renderable floats");this.vertexBuffer=tF(this.gl),this.indexBuffer=rF(this.gl),this.framebuffer=DD(this.gl),this.textureConfig=ih(this.gl,this.textureHalfFloatExtension)}get debug(){return z().getBool("DEBUG")}dispose(){if(this.disposed)return;this.program!=null&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),this.outputTexture!=null&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");let t=this.gl;ve(t,()=>t.finish()),ve(t,()=>t.bindFramebuffer(t.FRAMEBUFFER,null)),ve(t,()=>t.deleteFramebuffer(this.framebuffer)),ve(t,()=>t.bindBuffer(t.ARRAY_BUFFER,null)),ve(t,()=>t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)),ve(t,()=>t.deleteBuffer(this.indexBuffer)),this.disposed=!0}createFloat32MatrixTexture(t,r){return this.throwIfDisposed(),nF(this.gl,t,r,this.textureConfig)}createFloat16MatrixTexture(t,r){return this.throwIfDisposed(),oF(this.gl,t,r,this.textureConfig)}createUnsignedBytesMatrixTexture(t,r){return this.throwIfDisposed(),sF(this.gl,t,r,this.textureConfig)}uploadPixelDataToTexture(t,r){this.throwIfDisposed(),cF(this.gl,t,r)}uploadDenseMatrixToTexture(t,r,n,o){this.throwIfDisposed(),lF(this.gl,t,r,n,o,this.textureConfig)}createFloat16PackedMatrixTexture(t,r){return this.throwIfDisposed(),aF(this.gl,t,r,this.textureConfig)}createPackedMatrixTexture(t,r){return this.throwIfDisposed(),iF(this.gl,t,r,this.textureConfig)}deleteMatrixTexture(t){this.throwIfDisposed(),this.outputTexture===t&&(ZS(this.gl,this.framebuffer),this.outputTexture=null),ve(this.gl,()=>this.gl.deleteTexture(t))}downloadByteEncodedFloatMatrixFromOutputTexture(t,r,n){return this.downloadMatrixDriver(t,()=>mF(this.gl,r,n,this.textureConfig))}downloadPackedMatrixFromBuffer(t,r,n,o,s,i){return hF(this.gl,t,r,n,o,s,i,this.textureConfig)}downloadFloat32MatrixFromBuffer(t,r){return fF(this.gl,t,r)}createBufferFromTexture(t,r,n){this.bindTextureToFrameBuffer(t);let o=pF(this.gl,r,n,this.textureConfig);return this.unbindTextureToFrameBuffer(),o}createAndWaitForFence(){let t=this.createFence(this.gl);return this.pollFence(t)}createFence(t){let r,n;if(z().getBool("WEBGL_FENCE_API_ENABLED")){let o=t,s=o.fenceSync(o.SYNC_GPU_COMMANDS_COMPLETE,0);t.flush(),n=()=>{let i=o.clientWaitSync(s,0,0);return i===o.ALREADY_SIGNALED||i===o.CONDITION_SATISFIED},r=s}else z().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(r=this.beginQuery(),this.endQuery(),n=()=>this.isQueryAvailable(r,z().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))):n=()=>!0;return{query:r,isFencePassed:n}}downloadMatrixFromPackedTexture(t,r,n){return this.downloadMatrixDriver(t,()=>dF(this.gl,r,n))}createProgram(t){this.throwIfDisposed();let r=this.gl;this.vertexShader==null&&(this.vertexShader=eF(r));let n=ID(r);ve(r,()=>r.attachShader(n,this.vertexShader)),ve(r,()=>r.attachShader(n,t)),AD(r,n);let o=Object.assign(n,{vao:this.createVertexArray()});return this.debug&&Iy(r,o),o}buildVao(t){this.setProgram(t),this.bindVertexArray(t.vao);let r=this.gl;ve(r,()=>r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,this.indexBuffer)),uF(r,t,this.vertexBuffer)}deleteProgram(t){this.throwIfDisposed(),t===this.program&&(this.program=null),t!=null&&(ve(this.gl,()=>this.gl.deleteProgram(t)),this.deleteVertexArray(t.vao))}setProgram(t){this.throwIfDisposed(),this.program=t,this.program!=null&&this.debug&&Iy(this.gl,this.program),ve(this.gl,()=>this.gl.useProgram(t))}getUniformLocation(t,r,n=!0){return this.throwIfDisposed(),n?FD(this.gl,t,r):PD(this.gl,t,r)}getAttributeLocation(t,r){return this.throwIfDisposed(),ve(this.gl,()=>this.gl.getAttribLocation(t,r))}getUniformLocationNoThrow(t,r){return this.throwIfDisposed(),this.gl.getUniformLocation(t,r)}setInputMatrixTexture(t,r,n){this.throwIfDisposed(),this.throwIfNoProgram(),LD(this.gl,t,r,n)}setOutputMatrixTexture(t,r,n){this.setOutputMatrixTextureDriver(t,n,r)}setOutputPackedMatrixTexture(t,r,n){this.throwIfDisposed();let[o,s]=Ei(r,n);this.setOutputMatrixTextureDriver(t,o,s)}setOutputMatrixWriteRegion(t,r,n,o){this.setOutputMatrixWriteRegionDriver(n,t,o,r)}setOutputPackedMatrixWriteRegion(t,r,n,o){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")}debugValidate(){this.program!=null&&Iy(this.gl,this.program),uh(this.gl)}executeProgram(){this.throwIfDisposed(),this.throwIfNoProgram();let t=this.gl;if(this.debug){let r=this.getVertexArray();console.assert(r===this.program.vao,"VAO changed between setProgram and executeProgram!"),this.debugValidate()}ve(t,()=>t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0))}blockUntilAllProgramsCompleted(){this.throwIfDisposed(),ve(this.gl,()=>this.gl.finish())}getQueryTimerExtension(){return this.disjointQueryTimerExtension==null&&(this.disjointQueryTimerExtension=ah(this.gl,z().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension}getQueryTimerExtensionWebGL2(){return this.getQueryTimerExtension()}getQueryTimerExtensionWebGL1(){return this.getQueryTimerExtension()}beginQuery(){if(z().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){let n=this.gl,o=this.getQueryTimerExtensionWebGL2(),s=n.createQuery();return n.beginQuery(o.TIME_ELAPSED_EXT,s),s}let t=this.getQueryTimerExtensionWebGL1(),r=t.createQueryEXT();return t.beginQueryEXT(t.TIME_ELAPSED_EXT,r),r}endQuery(){if(z().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){let r=this.gl,n=this.getQueryTimerExtensionWebGL2();r.endQuery(n.TIME_ELAPSED_EXT);return}let t=this.getQueryTimerExtensionWebGL1();t.endQueryEXT(t.TIME_ELAPSED_EXT)}waitForQueryAndGetTime(t){return ne(this,null,function*(){return yield A.repeatedTry(()=>this.disposed||this.isQueryAvailable(t,z().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))),this.getQueryTime(t,z().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))})}getQueryTime(t,r){if(r===0)return null;if(r===2){let n=this.gl;return n.getQueryParameter(t,n.QUERY_RESULT)/1e6}else{let n=this.getQueryTimerExtensionWebGL1();return n.getQueryObjectEXT(t,n.QUERY_RESULT_EXT)/1e6}}isQueryAvailable(t,r){if(r===0)return!0;if(r===2){let n=this.gl,o=this.getQueryTimerExtensionWebGL2(),s=n.getQueryParameter(t,n.QUERY_RESULT_AVAILABLE);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(o.GPU_DISJOINT_EXT)),s&&!this.disjoint}else{let n=this.getQueryTimerExtensionWebGL1(),o=n.getQueryObjectEXT(t,n.QUERY_RESULT_AVAILABLE_EXT);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(n.GPU_DISJOINT_EXT)),o&&!this.disjoint}}pollFence(t){return new Promise(r=>{this.addItemToPoll(()=>t.isFencePassed(),()=>r())})}pollItems(){let t=PJ(this.itemsToPoll.map(r=>r.isDoneFn));for(let r=0;r<=t;++r){let{resolveFn:n}=this.itemsToPoll[r];n()}this.itemsToPoll=this.itemsToPoll.slice(t+1)}addItemToPoll(t,r){if(this.itemsToPoll.push({isDoneFn:t,resolveFn:r}),this.itemsToPoll.length>1)return;let n;"setTimeoutCustom"in z().platform&&(n=z().platform.setTimeoutCustom.bind(z().platform)),A.repeatedTry(()=>(this.pollItems(),this.itemsToPoll.length===0),()=>0,null,n)}bindTextureToFrameBuffer(t){this.throwIfDisposed(),Ay(this.gl,t,this.framebuffer),this.debug&&uh(this.gl)}unbindTextureToFrameBuffer(){this.outputTexture!=null?(Ay(this.gl,this.outputTexture,this.framebuffer),this.debug&&uh(this.gl)):ZS(this.gl,this.framebuffer)}downloadMatrixDriver(t,r){this.bindTextureToFrameBuffer(t);let n=r();return this.unbindTextureToFrameBuffer(),n}setOutputMatrixTextureDriver(t,r,n){this.throwIfDisposed();let o=this.gl;Ay(o,t,this.framebuffer),this.debug&&uh(o),this.outputTexture=t,ve(o,()=>o.viewport(0,0,r,n)),ve(o,()=>o.scissor(0,0,r,n))}setOutputMatrixWriteRegionDriver(t,r,n,o){this.throwIfDisposed(),ve(this.gl,()=>this.gl.scissor(t,r,n,o))}throwIfDisposed(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")}throwIfNoProgram(){if(this.program==null)throw new Error("No GPU program is currently set.")}};function PJ(e){let t=0;for(;t<e.length&&e[t]();++t);return t-1}var AC={};$t(AC,{addImpl:()=>aC,bincountImpl:()=>yF,bincountReduceImpl:()=>bF,bitwiseAndImpl:()=>uC,castImpl:()=>iC,ceilImpl:()=>lC,concatImpl:()=>vF,equalImpl:()=>cC,expImpl:()=>pC,expm1Impl:()=>fC,floorDivImpl:()=>hC,floorImpl:()=>mC,gatherNdImpl:()=>wF,gatherV2Impl:()=>TF,greaterEqualImpl:()=>gC,greaterImpl:()=>dC,lessEqualImpl:()=>yC,lessImpl:()=>xC,linSpaceImpl:()=>SF,logImpl:()=>bC,maxImpl:()=>CF,maximumImpl:()=>vC,minimumImpl:()=>wC,multiplyImpl:()=>mh,negImpl:()=>EF,notEqualImpl:()=>TC,prodImpl:()=>_F,raggedGatherImpl:()=>AF,raggedRangeImpl:()=>$F,raggedTensorToTensorImpl:()=>DF,rangeImpl:()=>FF,rsqrtImpl:()=>CC,scatterImpl:()=>PF,sigmoidImpl:()=>LF,simpleAbsImpl:()=>gF,sliceImpl:()=>BF,sparseFillEmptyRowsImpl:()=>MF,sparseReshapeImpl:()=>UF,sparseSegmentReductionImpl:()=>VF,sqrtImpl:()=>GF,squaredDifferenceImpl:()=>EC,staticRegexReplaceImpl:()=>NC,stridedSliceImpl:()=>WF,stringNGramsImpl:()=>zF,stringSplitImpl:()=>HF,stringToHashBucketFastImpl:()=>KF,subImpl:()=>IC,tileImpl:()=>qF,topKImpl:()=>XF,transposeImpl:()=>NF,uniqueImpl:()=>YF});function By(e,t){Array.isArray(e)||(e=[e]),e.forEach(r=>{r!=null&&A.assert(r.dtype!=="complex64",()=>`${t} does not support complex64 tensors in the CPU backend.`)})}function gF(e){let t=new Float32Array(e.length);for(let r=0;r<e.length;++r)t[r]=Math.abs(e[r]);return t}function Dt(e){return(t,r,n,o,s)=>{let i=U.assertAndGetBroadcastShape(t,r),a=i.length,u=A.computeStrides(i),c=A.sizeFromShape(i),p=A.getTypedArrayFromDType(s,c),m=t.length,h=r.length,x=A.computeStrides(t),y=A.computeStrides(r),v=U.getBroadcastDims(t,i),w=U.getBroadcastDims(r,i);if(v.length+w.length===0)for(let C=0;C<p.length;++C)p[C]=e(n[C%n.length],o[C%o.length]);else for(let C=0;C<p.length;++C){let I=A.indexToLoc(C,a,u),D=I.slice(-m);v.forEach(Z=>D[Z]=0);let P=A.locToIndex(D,m,x),G=I.slice(-h);w.forEach(Z=>G[Z]=0);let q=A.locToIndex(G,h,y);p[C]=e(n[P],o[q])}return[p,i]}}function Fp(e){let{inputs:t,backend:r}=e,{real:n,imag:o}=t,s=r.data.get(n.dataId).values,i=r.data.get(o.dataId).values,a=r.makeTensorInfo(n.shape,"complex64"),u=r.data.get(a.dataId);return u.complexTensorInfos={real:r.makeTensorInfo(n.shape,"float32",s),imag:r.makeTensorInfo(o.shape,"float32",i)},a}function My(e,t,r="float32"){if(r==="complex64"){let o=My(e,t,"float32"),s=My(e,t,"float32");return Fp({inputs:{real:o,imag:s},backend:e})}let n=A.makeZerosTypedArray(A.sizeFromShape(t),r);return e.makeTensorInfo(t,r,n)}function sC(e){let{inputs:t,backend:r}=e,{x:n}=t;return r.incRef(n.dataId),{dataId:n.dataId,shape:n.shape,dtype:n.dtype}}function xF(e){let{inputs:t,backend:r}=e,{input:n}=t,o=r.data.get(n.dataId).complexTensorInfos.real,s=r.data.get(o.dataId).values;return r.makeTensorInfo(o.shape,o.dtype,s)}function iC(e,t,r,n){if(n==="int32"){let o=Int32Array.from(e);return[t,"int32",o]}if(n==="bool"){let o=A.toTypedArray([0],r),[s,i]=Dt((a,u)=>a!==u?1:0)(t,[],e,o,"bool");return[i,"bool",s]}throw new Error(`Error in Cast: failed to cast ${r} to ${n}`)}function fh(e){let{inputs:t,backend:r,attrs:n}=e,{x:o}=t,{dtype:s}=n;if(s==="complex64"){if(o.dtype==="complex64")return sC({inputs:{x:o},backend:r});let p=My(r,o.shape,o.dtype),m=fh({inputs:{x:o},backend:r,attrs:{dtype:"float32"}}),h=Fp({inputs:{real:m,imag:p},backend:r});return r.disposeIntermediateTensorInfo(p),r.disposeIntermediateTensorInfo(m),h}if(o.dtype==="complex64"){let p=xF({inputs:{input:o},backend:r}),m=fh({inputs:{x:p},backend:r,attrs:{dtype:s}});return r.disposeIntermediateTensorInfo(p),m}if(!A.hasEncodingLoss(o.dtype,s)){let p=sC({inputs:{x:o},backend:r});return{dataId:p.dataId,shape:p.shape,dtype:s}}let i=r.data.get(o.dataId).values,[a,u,c]=iC(i,o.shape,o.dtype,s);return r.makeTensorInfo(a,u,c)}function zt(e,t,r,n){return r==null?({inputs:o,backend:s})=>{let{a:i,b:a}=o,u=s;By([i,a],e);let c=u.data.get(i.dataId).values,p=u.data.get(a.dataId).values,m=i.dtype==="string"?U.fromUint8ToStringArray(c):c,h=i.dtype==="string"?U.fromUint8ToStringArray(p):p,x=n||i.dtype,[y,v]=t(i.shape,a.shape,m,h,x);return u.makeTensorInfo(v,x,y)}:({inputs:o,backend:s})=>{let{a:i,b:a}=o,u=s;if(i.dtype==="complex64"||a.dtype==="complex64"){let c=fh({inputs:{x:i},backend:u,attrs:{dtype:"complex64"}}),p=u.data.get(c.dataId),m=p.complexTensorInfos.real,h=p.complexTensorInfos.imag,x=u.data.get(m.dataId).values,y=u.data.get(h.dataId).values,v=fh({inputs:{x:a},backend:u,attrs:{dtype:"complex64"}}),w=u.data.get(v.dataId),C=w.complexTensorInfos.real,I=w.complexTensorInfos.imag,D=u.data.get(C.dataId).values,P=u.data.get(I.dataId).values,[G,q,Z]=r(i.shape,a.shape,x,y,D,P),Y=u.makeTensorInfo(Z,"float32",G),te=u.makeTensorInfo(Z,"float32",q),J=Fp({inputs:{real:Y,imag:te},backend:u});return u.disposeIntermediateTensorInfo(c),u.disposeIntermediateTensorInfo(v),u.disposeIntermediateTensorInfo(Y),u.disposeIntermediateTensorInfo(te),J}else{let c=u.data.get(i.dataId).values,p=u.data.get(a.dataId).values,m=n||i.dtype,[h,x]=t(i.shape,a.shape,c,p,m);return u.makeTensorInfo(x,m,h)}}}function Pp(e){return(t,r,n,o,s,i)=>{let a=U.assertAndGetBroadcastShape(t,r),u=A.sizeFromShape(a),c=a.length,p=A.computeStrides(a),m=A.getTypedArrayFromDType("float32",u),h=A.getTypedArrayFromDType("float32",u),x=U.getBroadcastDims(t,a),y=U.getBroadcastDims(r,a),v=U.mergeRealAndImagArrays(n,o),w=U.mergeRealAndImagArrays(s,i),C=t.length,I=A.computeStrides(t),D=r.length,P=A.computeStrides(r);if(x.length+y.length===0)for(let G=0;G<m.length;G++){let q=G%v.length,Z=G%w.length,Y=e(v[q*2],v[q*2+1],w[Z*2],w[Z*2+1]);m[G]=Y.real,h[G]=Y.imag}else for(let G=0;G<m.length;G++){let q=A.indexToLoc(G,c,p),Z=q.slice(-C);x.forEach(ge=>Z[ge]=0);let Y=A.locToIndex(Z,C,I),te=q.slice(-D);y.forEach(ge=>te[ge]=0);let J=A.locToIndex(te,D,P),ae=e(v[Y*2],v[Y*2+1],w[J*2],w[J*2+1]);m[G]=ae.real,h[G]=ae.imag}return[m,h,a]}}var aC=Dt((e,t)=>e+t),LJ=Pp((e,t,r,n)=>({real:e+r,imag:t+n})),u8e=zt(Ga,aC,LJ);function yF(e,t,r,n,o){let s=A.sizeFromShape(n),i=A.makeZerosTypedArray(o,r);for(let a=0;a<e.length;a++){let u=e[a];if(u<0)throw new Error("Input x must be non-negative!");u>=o||(s>0?i[u]+=t[a]:i[u]+=1)}return i}function bF(e,t,r,n=!1){let o=e.shape[0],s=e.shape[1],i=st([o,r],t.dtype);for(let a=0;a<o;a++)for(let u=0;u<s;u++){let c=e.get(a,u);if(c<0)throw new Error("Input x must be non-negative!");c>=r||(n?i.set(1,a,c):t.size>0?i.set(i.get(a,c)+t.get(a,u),a,c):i.set(i.get(a,c)+1,a,c))}return i}var uC=Dt((e,t)=>e&t),d8e=zt(Pc,uC);function Ur(e){return(t,r,n)=>{let o=A.getArrayFromDType(r,t.length);for(let s=0;s<t.length;++s)o[s]=e(t[s],n);return o}}function Uy(e,t,r){let n=Ur(t);return Qn(e,n,r)}function Qn(e,t,r){return({inputs:n,attrs:o,backend:s})=>{let{x:i}=n;By(i,e);let a=s,u=a.data.get(i.dataId).values,c;if(i.dtype==="string"){if(!Array.isArray(u))throw new Error("String tensor's value was not an instance of Array");c=U.fromUint8ToStringArray(u)}else c=u;let p=r||i.dtype,m=t(c,p,o);return a.makeTensorInfo(i.shape,p,m)}}var lC=Ur(e=>Math.ceil(e)),N8e=Qn(Lc,lC);function vF(e,t,r,n){let o=A.getArrayFromDType(r,A.sizeFromShape(t));if(n&&r!=="string"){let s=0;e.forEach(i=>{let a=A.sizeFromShape(i.shape);o.set(i.vals,s),s+=a})}else{let s=0;e.forEach(i=>{let a=r==="string"?U.fromUint8ToStringArray(i.vals):i.vals,u=0;for(let c=0;c<i.shape[0];++c){let p=c*t[1]+s;for(let m=0;m<i.shape[1];++m)o[p+m]=a[u++]}s+=i.shape[1]})}return o}var cC=Dt((e,t)=>e===t?1:0),O8e=zt(Bc,cC,null,"bool");var pC=Ur(e=>Math.exp(e)),B8e=Qn(Mc,pC,"float32");var fC=Ur(e=>Math.expm1(e)),W8e=Qn(Uc,fC);var mC=Ur(e=>Math.floor(e)),j8e=Qn(Vc,mC);var hC=Dt((e,t)=>Math.floor(e/t)),J8e=zt(Gc,hC,null,"int32");function wF(e,t,r,n,o,s,i,a,u){let c=st([n,s],r);for(let p=0;p<n;p++){let m=[],h=0;for(let x=0;x<o;x++){let y=e[p*o+x];h+=y*i[x],m.push(y)}if(h<0||h>=u/s)throw new Error(`Invalid indices: ${m} does not index into ${a}`);for(let x=0;x<s;x++)c.values[p*s+x]=t.get(...t.indexToLoc(h*s+x))}return c}function TF(e,t,r){let n=st(r,e.dtype);for(let o=0;o<n.size;++o){let i=n.indexToLoc(o).slice(),a=i[0],u=i[2],c=t.locToIndex([a,u]);i[2]=t.values[c];let p=e.locToIndex(i);0<=p&&p<e.values.length&&(n.values[o]=e.values[p])}return n}var dC=Dt((e,t)=>e>t?1:0),uVe=zt(Wc,dC,null,"bool");var gC=Dt((e,t)=>e>=t?1:0),mVe=zt(zc,gC,null,"bool");var xC=Dt((e,t)=>e<t?1:0),yVe=zt(Hc,xC,null,"bool");var yC=Dt((e,t)=>e<=t?1:0),SVe=zt(Kc,yC,null,"bool");function SF(e,t,r){let n=(t-e)/(r-1),o=A.makeZerosTypedArray(r,"float32");o[0]=e;for(let s=1;s<o.length;s++)o[s]=o[s-1]+n;return o}var bC=Ur(e=>Math.log(e)),kVe=Qn(qc,bC);function CF(e,t,r,n){let o=A.getTypedArrayFromDType(n,A.sizeFromShape(r));for(let s=0;s<o.length;++s){let i=s*t,a=e[i];for(let u=0;u<t;++u){let c=e[i+u];(Number.isNaN(c)||c>a)&&(a=c)}o[s]=a}return o}var vC=Dt((e,t)=>Math.max(e,t)),LVe=zt(jc,vC);var wC=Dt((e,t)=>Math.min(e,t)),GVe=zt(Xc,wC);var mh=Dt((e,t)=>e*t),BJ=Pp((e,t,r,n)=>({real:e*r-t*n,imag:e*n+t*r})),qVe=zt(Yc,mh,BJ);function EF(e,t,r){let n=A.createScalarValue(-1,r);return mh([],t,n,e,r)}var TC=Dt((e,t)=>e!==t?1:0),tGe=zt(Zc,TC,null,"bool");function NF(e,t,r,n,o){let s=t.length,i=A.sizeFromShape(t),a=A.computeStrides(t),u=A.computeStrides(o),c=A.getTypedArrayFromDType(r,A.sizeFromShape(o));for(let p=0;p<i;++p){let m=A.indexToLoc(p,s,a),h=new Array(m.length);for(let y=0;y<h.length;y++)h[y]=m[n[y]];let x=A.locToIndex(h,s,u);c[x]=e[p]}return c}function _F(e,t,r,n){let[o,s]=U.computeOutAndReduceShapes(e,n),i=gn(t,"int32"),a=A.makeZerosTypedArray(A.sizeFromShape(o),i),u=A.sizeFromShape(s);for(let c=0;c<a.length;++c){let p=c*u,m=1;for(let h=0;h<u;++h)m*=r[p+h];a[c]=m}return{outVals:a,outShape:o,outDtype:i}}function MJ(e,t,r){e.forEach((n,o)=>{if(n<0||n>=r){let s=A.indexToLoc(o,t.length,A.computeStrides(t)).join(",");throw new Error(`indices[${s}] = ${n} is not in [0, ${r})`)}})}function UJ(e,t){for(let r=0;r<e.length;++r){let n=e[r],o=r===e.length-1?t:e[r+1].length;if(n.length===0)throw new Error("Ragged splits may not be empty");if(n[0]<0)throw new Error("Ragged splits must be non-negative");if(n[n.length-1]>o)throw new Error("Ragged splits must not point past values");for(let s=1;s<n.length;++s)if(n[s-1]>n[s])throw new Error("Ragged splits must be sorted in ascending order")}}function VJ(e,t,r,n){let o=[],s=0,i=t.length-1+r.length,a=new Array(i).fill(null).map(()=>[0]);UJ(r,n);let u=1;for(let c=0;c<t.length-1;++c){u*=t[c];let p=t[c+1];for(let m=1;m<u+1;++m)a[c].push(m*p)}for(let c=0;c<e.length;++c){let p=e[c],m=e[c]+1;for(let h=0;h<r.length;++h){let x=r[h],y=h+t.length-1;if(y>=0){let v=a[y],w=v[v.length-1]-x[p];for(let C=p;C<m;++C)a[y].push(x[C+1]+w)}p=x[p],m=x[m]}m!==p&&(o.push([p,m]),s+=m-p)}return{outSplits:a,valueSlices:o,numValues:s}}function GJ(e){let t=[];for(let r=0;r<e.length;++r){let n=e[r].length,o=A.getArrayFromDType("int32",n);t.push(o),e[r].forEach((s,i)=>o[i]=s)}return t}function IF(e,t){let r=e.slice(0,t);for(;r.length<t;)r.push(1);for(let n=t;n<e.length;n++)r[t-1]*=e[n];return r}function WJ(e,t,r,n,o,s){let i=IF(t,2)[1],a=IF(s,2)[1],u=0;for(let c of r)for(let p=c[0];p<c[1];++p){for(let m=0;m<n;++m)o[u*a+m]=e[p*i+m];++u}}function zJ(e,t,r,n,o){let s=t.slice();s[0]=o;let i=A.getArrayFromDType(r,A.sizeFromShape(s)),a=e.length,u=a===0?0:a/t[0];return WJ(e,t,n,u,i,s),[i,s]}function AF(e,t,r,n,o,s,i,a){if(e.length===0)throw new Error("paramsNestedSplits must be non empty");if(t[0].length===0)throw new Error("Split tensors must not be scalars");let u=t[0][0]-1;if(MJ(s,i,u),n.length===0)throw new Error("params.rank must be nonzero");let c=n[0],{outSplits:p,valueSlices:m,numValues:h}=VJ(s,i,e,c),x=GJ(p),y=zJ(r,n,o,m,h);return[x,y[0],y[1]]}var kF=2147483647;function $F(e,t,r,n,o,s,i){if(t.length>1)throw new Error("starts must be a scalar or vector");if(o.length>1)throw new Error("limits must be a scalar or vector");if(i.length>1)throw new Error("deltas must be a scalar or vector");let a=t.length===0,u=o.length===0,c=i.length===0,p=[];a||p.push(t[0]),u||p.push(o[0]),c||p.push(i[0]);for(let w=1;w<p.length;++w)if(p[w]!==p[w-1])throw new Error("starts, limits, and deltas must have the same shape");let m=p.length===0?1:p[0],h=A.getArrayFromDType("int32",m+1);h[0]=0;for(let w=0;w<m;++w){let C=a?e[0]:e[w],I=u?n[0]:n[w],D=c?s[0]:s[w];if(D===0)throw new Error("Requires delta != 0");let P;if(D>0&&I<C||D<0&&I>C)P=0;else if(P=Math.ceil(Math.abs((I-C)/D)),P>kF)throw new Error(`Requires ((limit - start) / delta) <= ${kF}`);h[w+1]=h[w]+P}let x=h[m],y=A.getArrayFromDType(r,x),v=0;for(let w=0;w<m;++w){let C=h[w+1]-h[w],I=a?e[0]:e[w],D=c?s[0]:s[w];for(let P=0;P<C;++P)y[v++]=I,I+=D}return[h,y]}var vs=U.RowPartitionType,SC=class e{constructor(t,r,n,o,s,i,a,u,c,p){this.shape=t,this.shapeShape=r,this.values=n,this.valuesShape=o,this.valuesDType=s,this.defaultValue=i,this.defaultValueShape=a,this.rowPartitionValues=u,this.rowPartitionValuesShapes=c,this.rowPartitionTypes=U.getRowPartitionTypesHelper(p),this.raggedRank=U.getRaggedRank(this.rowPartitionTypes)}getRowPartitionTypeByDimension(t){return this.rowPartitionTypes[0]===vs.FIRST_DIM_SIZE?this.rowPartitionTypes[t+1]:this.rowPartitionTypes[t]}getRowPartitionTensor(t){return this.rowPartitionTypes[0]===vs.FIRST_DIM_SIZE?this.rowPartitionValues[t+1]:this.rowPartitionValues[t]}getMaxWidth(t){let r=this.getRowPartitionTensor(t-1);switch(this.getRowPartitionTypeByDimension(t-1)){case vs.VALUE_ROWIDS:return e.getMaxWidthValueRowID(r);case vs.ROW_SPLITS:return e.getMaxWidthRowSplit(r);default:throw new Error(`Cannot handle partition type ${vs[this.getRowPartitionTypeByDimension(t-1)]}`)}}static getMaxWidthRowSplit(t){let r=t.length;if(r===0||r===1)return 0;let n=0;for(let o=0;o<r-1;++o){let s=t[o+1]-t[o];s>n&&(n=s)}return n}static getMaxWidthValueRowID(t){let r=t.length;if(r===0)return 0;let n=0,o=t[0],s=0;for(let i=1;i<r;++i){let a=t[i];a!==o&&(o=a,s=Math.max(i-n,s),n=i)}return Math.max(r-n,s)}tensorShapeFromTensor(t,r,n=!0){if(r.length===0){if(t[0]===-1)return[];throw new Error("The only valid scalar shape tensor is the fully unknown shape specified as -1.")}return OF(t,n)}calculateOutputSize(t){let r=this.valuesShape,n=this.defaultValueShape;U.validateDefaultValueShape(n,r);let o=this.tensorShapeFromTensor(this.shape,this.shapeShape),i=U.combineRaggedTensorToTensorShapes(this.raggedRank,o,r);i[0]<0&&(i[0]=t);for(let a=1;a<=this.raggedRank;++a)i[a]<0&&(i[a]=this.getMaxWidth(a));return i}calculateFirstParentOutputIndex(t,r,n){let o=Math.min(t,n),s=[],i=0;for(let a=0;a<o;++a,i+=r)s.push(i);for(let a=o;a<t;++a)s.push(-1);return A.assert(s.length===t,()=>"Final length of result must be equal to firstDimension."),s}calculateOutputIndexRowSplit(t,r,n,o){let s=t.length,i=[];for(let a=0;a<s-1;++a){let u=t[a+1]-t[a],c=Math.min(o,u),p=r[a];p===-1&&(c=0);for(let m=0;m<c;++m)i.push(p),p+=n;for(let m=0;m<u-c;++m)i.push(-1)}if(s>0&&i.length!==t[s-1])throw new Error("Invalid row split size.");return i}calculateOutputIndexValueRowID(t,r,n,o){let s=t.length,i=[];if(s===0)return[];let a=0,u=t[0];if(u>=r.length)throw new Error(`Got currentValueRowId=${u}, which is not less than ${r.length}`);let c=r[u];i.push(c);for(let p=1;p<s;++p){let m=t[p];if(m===u)c>=0&&(++a,a<o?c+=n:c=-1);else{if(a=0,u=m,m>=r.length)throw new Error(`Got nextValueRowId=${m} which is not less than ${r.length}`);c=r[m]}i.push(c)}if(i.length!==t.length)throw new Error("Invalid row ids.");return i}calculateOutputIndex(t,r,n,o){let s=this.getRowPartitionTensor(t),i=this.getRowPartitionTypeByDimension(t);switch(i){case vs.VALUE_ROWIDS:return this.calculateOutputIndexValueRowID(s,r,n,o);case vs.ROW_SPLITS:if(s.length-1>r.length)throw new Error(`Row partition size is greater than output size: ${s.length-1} > ${r.length}`);return this.calculateOutputIndexRowSplit(s,r,n,o);default:throw new Error(`Unsupported partition type: ${vs[i]}`)}}getFirstDimensionSize(){let t=this.rowPartitionValues[0];if(this.rowPartitionTypes.length===0)throw new Error("No row_partition_types given.");let r=this.rowPartitionTypes[0];switch(r){case vs.FIRST_DIM_SIZE:return t[0];case vs.VALUE_ROWIDS:throw new Error("Cannot handle VALUE_ROWIDS in first dimension.");case vs.ROW_SPLITS:return this.rowPartitionValuesShapes[0][0]-1;default:throw new Error(`Cannot handle type ${vs[r]}`)}}compute(){if(this.rowPartitionValues[0].length<=0)throw new Error("Invalid first partition input. Tensor requires at least one element.");let r=this.getFirstDimensionSize(),n=this.calculateOutputSize(r),o=new Array(this.raggedRank+1);o[o.length-1]=1;for(let u=o.length-2;u>=0;--u)o[u]=o[u+1]*n[u+1];let s=OF(n,!1),i=A.getArrayFromDType(this.valuesDType,A.sizeFromShape(s));if(o[0]*n[0]>0){let u=this.calculateFirstParentOutputIndex(r,o[0],n[0]);for(let c=1;c<=this.raggedRank;++c)u=this.calculateOutputIndex(c-1,u,o[c],n[c]);this.setOutput(this.raggedRank,u,i,s)}return[s,i]}setOutput(t,r,n,o){if(n.length===0)return;let s=this.values,i=n,a=o.slice();a=a.slice(t+1);let u=A.sizeFromShape(a),c=r.length,p=this.defaultValue;if(p.length!==u&&p.length!==1){let y=this.defaultValueShape;Ue(()=>{let v=Q(p,y);p=Xa(v,a).dataSync()})}let m=0,h=0,x=0;for(let y=0;y<=c;++y){let v=y<c?r[y]:-1;if(v===x){++x;continue}if(h<x){let w=s.subarray(m*u),C=i.subarray(h*u),I=(x-h)*u;RF(C,w,I)}if(y>=c){let w=n.length;v=Math.floor(w/u)}if(v>x)if(this.defaultValue.length===1)i.subarray(x*u,v*u).fill(this.defaultValue[0]),x=v;else for(;v>x;){let w=i.slice(x*u);RF(w,p,u),++x}v<0?(m=y+1,h=x):(m=y,h=x,x=h+1)}}};function RF(e,t,r){for(let n=0;n<r;n++)e[n]=t[n]}function OF(e,t){let r=[];for(let n of e){if(n<0){if(!t)throw new Error(`Dimension ${n} must be >= 0`);if(n<-1)throw new Error(`Dimension ${n} must be >= -1`);n=-1}r.push(n)}return r}function DF(e,t,r,n,o,s,i,a,u,c){return new SC(e,t,r,n,o,s,i,a,u,c).compute()}function FF(e,t,r,n){let o=e===t,s=e<t&&r<0,i=t<e&&r>1;if(o||s||i)return A.makeZerosTypedArray(0,n);let a=Math.abs(Math.ceil((t-e)/r)),u=A.makeZerosTypedArray(a,n);t<e&&r===1&&(r=-1),u[0]=e;for(let c=1;c<u.length;c++)u[c]=u[c-1]+r;return u}var CC=Ur(e=>1/Math.sqrt(e)),yGe=Qn(Qc,CC);function PF(e,t,r,n,o,s,i,a,u,c){let p=[n/o,o],m=e.values,h=t.values;if(n===0)return st(r,t.dtype);let x=u instanceof zo?u:st(p,t.dtype);typeof u=="string"||typeof u=="number"?x.values.fill(u):typeof u=="boolean"&&x.values.fill(+u);for(let y=0;y<s;y++){let v=[],w=0;for(let C=0;C<i;C++){let I=m[y*i+C];v.push(I),w+=I*a[C]}if(w<0||w>=n/o)throw new Error(`Invalid indices: ${v} does not index into ${r}`);for(let C=0;C<o;C++)c?x.values[w*o+C]+=h[y*o+C]:x.values[w*o+C]=t.rank===0?h[0]:h[y*o+C]}return x}var LF=Ur(e=>1/(1+Math.exp(-e))),EGe=Uy(Jc,e=>1/(1+Math.exp(-e)));function BF(e,t,r,n,o){let s=Zn.isSliceContinous(n,t,r),i=A.sizeFromShape(r),a=A.computeStrides(n);if(s){let m=Zn.computeFlatOffset(t,a);return o==="string"?e.slice(m,m+i):e.subarray(m,m+i)}let u=o==="string"?U.fromUint8ToStringArray(e):e,c=st(n,o,u),p=st(r,o);for(let m=0;m<p.size;++m){let h=p.indexToLoc(m),x=h.map((y,v)=>y+t[v]);p.set(c.get(...x),...h)}return o==="string"?U.fromStringArrayToUint8(p.values):p.values}function MF(e,t,r,n,o,s,i){let a=t[0],u=s[0],c=new Array(u),p=new Array(a),m=t[1];if(u===0){if(a!==0)throw new Error(U.getSparseFillEmptyRowsIndicesDenseShapeMismatch(a));let w=A.getArrayFromDType(r,0),C=A.getArrayFromDType(o,0);return[w,[0,m],C,c,p]}let h=!0,x=0,y=new Array(u).fill(0);for(let w=0;w<a;++w){let C=e[w*m];if(C<0)throw new Error(U.getSparseFillEmptyRowsNegativeIndexErrorMessage(w,C));if(C>=u)throw new Error(U.getSparseFillEmptyRowsOutOfRangeIndexErrorMessage(w,C,u));++y[C],h=h&&C>=x,x=C}let v=!0;for(let w=0;w<u;++w){let C=y[w]===0;c[w]=C,v=v&&!C,y[w]=Math.max(y[w],1),w>0&&(y[w]+=y[w-1])}if(v&&h){let w=e,C=n;for(let I=0;I<a;++I)p[I]=I;return[w,[a,m],C,c,p]}else{let w=y[u-1],C=A.getArrayFromDType(r,w*m),I=A.getArrayFromDType(o,w),D=new Array(u).fill(0);for(let P=0;P<a;++P){let G=e[P*m],q=D[G],Z=(G===0?0:y[G-1])+q;D[G]++;for(let Y=0;Y<m;++Y)C[Z*m+Y]=e[P*m+Y];I[Z]=n[P],p[P]=Z}for(let P=0;P<u;++P)if(D[P]===0){let q=P===0?0:y[P-1];C[q*m+0]=P;for(let Z=1;Z<m;++Z)C[q*m+Z]=0;I[q]=i}return[C,[w,m],I,c,p]}}function UF(e,t,r,n,o){let s=A.sizeFromShape(n),i=t[0],a=o.length,u=[],c=1,p=-1;for(let w=0;w<a;++w){let C=o[w];if(C===-1){if(p!==-1)throw new Error(U.getSparseReshapeMultipleNegativeOneOutputDimErrorMessage(p,w));p=w,u.push(1)}else{if(C<0)throw new Error(U.getSparseReshapeNegativeOutputDimErrorMessage(w,C));c*=C,u.push(C)}}if(p!==-1){if(c<=0)throw new Error(U.getSparseReshapeEmptyTensorZeroOutputDimErrorMessage());let w=Math.trunc(s/c);if(c*w!==s)throw new Error(U.getSparseReshapeInputOutputMultipleErrorMessage(n,u));u[p]=w}if(A.sizeFromShape(u)!==s)throw new Error(U.getSparseReshapeInputOutputMismatchErrorMessage(n,u));let h=n.length,x=[];if(h>0){x[h-1]=1;for(let w=h-2;w>=0;--w)x[w]=x[w+1]*n[w+1]}let y=[];if(a>0){y[a-1]=1;for(let w=a-2;w>=0;--w)y[w]=y[w+1]*u[w+1]}let v=A.getArrayFromDType(r,i*a);for(let w=0;w<i;++w){let C=0;for(let I=0;I<h;++I)C+=e[w*h+I]*x[I];for(let I=0;I<a;++I)v[w*a+I]=Math.trunc(C/y[I]),C%=y[I]}return[v,[i,a],u]}function VF(e,t,r,n,o,s=!1,i=0){let a=n.length,u=[t[0],e.length/t[0]],c=u[1],m=a>0?o[a-1]+1:0;if(m<0)throw new Error(U.getSparseSegmentReductionNegativeSegmentIdsErrorMessage());let h=t.slice();h[0]=m;let x=h.reduce((D,P)=>D*P,1),y=A.getArrayFromDType(r,x);if(a===0)return m>0&&y.fill(i),[y,h];if(m<=0)throw new Error(U.getSparseSegmentReductionNegativeSegmentIdsErrorMessage());let v=0,w=1,C=0,I=o[v];for(;;){let D=0;if(w<a){if(D=o[w],I===D){++w;continue}if(I>=D)throw new Error(U.getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage())}if(I<0||I>=m)throw new Error(U.getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage(I,m));I>C&&y.fill(i,C*c,I*c);for(let P=v;P<w;++P){let G=n[P];if(G<0||G>=u[0])throw new Error(U.getSparseSegmentReductionIndicesOutOfRangeErrorMessage(P,n[P],u[0]));for(let q=0;q<c;q++)y[I*c+q]+=e[G*c+q]}if(s)for(let P=0;P<c;P++)y[I*c+P]/=w-v;if(v=w,++w,C=I+1,I=D,w>a)break}return C<m&&y.fill(i,C*c,m*c),[y,h]}var GF=Ur(e=>Math.sqrt(e)),BGe=Uy(ep,e=>Math.sqrt(e));var EC=Dt((e,t)=>{let r=e-t;return r*r}),WGe=zt(tp,EC);var NC=Ur((e,t)=>{let{pattern:r,replaceGlobal:n,rewrite:o}=t;return e.replace(new RegExp(r,n?"g":""),o)}),jGe=Qn(rp,NC);function WF(e,t,r,n){let o=st(e,t.dtype);for(let s=0;s<o.size;s++){let i=o.indexToLoc(s),a=new Array(i.length);for(let u=0;u<a.length;u++)a[u]=i[u]*r[u]+n[u];o.set(t.get(...a),...i)}return o}var _C=class{constructor(t,r,n,o,s,i){this.separator=A.encodeString(t),this.nGramWidths=r,this.leftPad=A.encodeString(n),this.rightPad=A.encodeString(o),this.padWidth=s,this.preserveShort=i}getPadWidth(t){return Math.min(this.padWidth<0?t-1:this.padWidth,t-1)}getNumNGrams(t,r){let n=this.getPadWidth(r);return Math.max(0,t+2*n-r+1)}createNGrams(t,r,n,o,s,i){for(let a=0;a<s;++a){let u=this.getPadWidth(i),c=Math.max(0,u-a),p=Math.max(0,u-(s-(a+1))),m=i-(c+p),h=r+(c>0?0:a-u),x=0;x+=c*this.leftPad.length;for(let I=0;I<m;++I)x+=t[h+I].length;x+=p*this.rightPad.length;let y=c+p+m-1;x+=y*this.separator.length,n[o+a]=new Uint8Array(x);let v=n[o+a],w=0,C=I=>I.forEach(D=>v[w++]=D);for(let I=0;I<c;++I)C(this.leftPad),C(this.separator);for(let I=0;I<m-1;++I)C(t[h+I]),C(this.separator);if(m>0){C(t[h+m-1]);for(let I=0;I<p;++I)C(this.separator),C(this.rightPad)}else{for(let I=0;I<p-1;++I)C(this.rightPad),C(this.separator);C(this.rightPad)}}}compute(t,r){let n=t.length,o=r.length;if(o>0){let u=r[0];if(u!==0)throw new Error(`First split value must be 0, got ${u}`);for(let c=1;c<o;++c){let p=r[c]>=u;if(p=p&&r[c]<=n,!p)throw new Error(`Invalid split value ${r[c]}, must be in [${u}, ${n}]`);u=r[c]}if(u!==n)throw new Error(`Last split value must be data size. Expected ${n}, got ${u}`)}let s=o-1,i=A.getArrayFromDType("int32",o);if(n===0||o===0){let u=new Array(n);for(let c=0;c<=s;++c)i[c]=0;return[u,i]}i[0]=0;for(let u=1;u<=s;++u){let c=r[u]-r[u-1],p=0;this.nGramWidths.forEach(m=>{p+=this.getNumNGrams(c,m)}),this.preserveShort&&c>0&&p===0&&(p=1),i[u]=i[u-1]+p}let a=new Array(i[s]);for(let u=0;u<s;++u){let c=r[u],p=i[u];if(this.nGramWidths.forEach(m=>{let h=r[u+1]-r[u],x=this.getNumNGrams(h,m);this.createNGrams(t,c,a,p,x,m),p+=x}),this.preserveShort&&p===i[u]){let m=r[u+1]-r[u];if(m===0)continue;let h=m+2*this.padWidth;this.createNGrams(t,c,a,p,1,h)}}return[a,i]}};function zF(e,t,r,n,o,s,i,a){return new _C(r,n,o,s,i,a).compute(e,t)}function HJ(e,t,r,n){if(!e.length)return;if(t.length===0){for(let s=0;s<e.length;++s)n.push(e.subarray(s,s+1));return}if(t.length===1){let s=t[0],i=e.indexOf(s);for(;i!==-1;){let a=e.subarray(0,i);(!r||a.length!==0)&&n.push(a),e=e.subarray(i+1),i=e.indexOf(s)}(!r||e.length!==0)&&n.push(e);return}let o=0;for(let s=0;s<e.length+1;s++)if(s===e.length||t.indexOf(e[s])!==-1){let i=e.subarray(o,s);(!r||i.length!==0)&&n.push(i),o=s+1}}function HF(e,t,r){let n=e.length,o=[],s=0,i=0,a=new Array(n);for(let h=0;h<n;++h){let x=o.length;HJ(e[h],t,r,o);let y=o.length-x;a[h]=y,s+=y,i=Math.max(i,y)}let u=A.getArrayFromDType("int32",s*2),c=new Array(s),p=[n,i],m=0;for(let h=0;h<n;++h)for(let x=0;x<a[h];++x)u[m*2]=h,u[m*2+1]=x,c[m]=o[m],++m;return[u,c,p]}function KF(e,t){let r=A.getArrayFromDType("int32",e.length);for(let n=0;n<e.length;++n)r[n]=A.fingerPrint64(e[n]).modulo(t).getLowBitsUnsigned();return r}var IC=Dt((e,t)=>e-t),KJ=Pp((e,t,r,n)=>({real:e-r,imag:t-n})),a7e=zt(np,IC,KJ);function qF(e,t){let r=new Array(e.rank);for(let o=0;o<r.length;o++)r[o]=e.shape[o]*t[o];let n=st(r,e.dtype);for(let o=0;o<n.values.length;++o){let s=n.indexToLoc(o),i=new Array(e.rank);for(let u=0;u<i.length;u++)i[u]=s[u]%e.shape[u];let a=e.locToIndex(i);n.values[o]=e.values[a]}return n}var hh=(e,t)=>{let r=t.value-e.value;return r===0?e.index-t.index:r};function jF(e,t,r=0,n=e.length-1){for(;n>r;){if(n-r>600){let a=n-r+1,u=t-r+1,c=Math.log(a),p=.5*Math.exp(2*c/3),m=.5*Math.sqrt(c*p*(a-p)/a)*Math.sign(u-a/2),h=Math.max(r,Math.floor(t-u*p/a+m)),x=Math.min(n,Math.floor(t+(a-u)*p/a+m));jF(e,t,h,x)}let o=e[t],s=r,i=n;for(A.swap(e,r,t),hh(e[n],o)>0&&A.swap(e,r,n);s<i;){for(A.swap(e,s,i),s++,i--;hh(e[s],o)<0;)s=s+1;for(;hh(e[i],o)>0;)i=i-1}hh(e[r],o)===0?A.swap(e,r,i):(i=i+1,A.swap(e,i,n)),i<=t&&(r=i+1),t<=i&&(n=i-1)}}function XF(e,t,r,n,o){let s=t[t.length-1],[i,a]=[e.length/s,s],u=A.getTypedArrayFromDType(r,i*n),c=A.getTypedArrayFromDType("int32",i*n);for(let m=0;m<i;m++){let h=m*a,x=e.subarray(h,h+a),y=new Array(x.length);x.forEach((I,D)=>y[D]={value:I,index:D}),n<y.length&&(jF(y,n),y=y.slice(0,n)),o&&y.sort(hh);let v=m*n,w=u.subarray(v,v+n),C=c.subarray(v,v+n);for(let I=0;I<n;I++)w[I]=y[I].value,C[I]=y[I].index}let p=t.slice();return p[p.length-1]=n,[st(p,r,u),st(p,"int32",c)]}function YF(e,t,r,n){let o=A.parseAxisParam(t,r)[0],s=[1,r[0],1];for(let y=0;y<o;y++)s[0]*=r[y];s[1]=r[o];for(let y=o+1;y<r.length;y++)s[2]*=r[y];let i=new Map,a=new Int32Array(r[o]),u=new zo(s,n,e),c=[],p=s[0]===1&&s[2]===1;for(let y=0;y<r[o];y++){let v;if(p)v=e[y].toString();else{let C=[];for(let I=0;I<s[0];I++)for(let D=0;D<s[2];D++)C.push(u.get(I,y,D));v=C.join(",")}let w=i.get(v);if(w!=null)a[y]=w;else{let C=i.size;i.set(v,C),a[y]=C,c.push(y)}}let m=s.slice();m[1]=i.size;let h=new zo(m,n);c.forEach((y,v)=>{for(let w=0;w<s[0];w++)for(let C=0;C<s[2];C++)h.set(u.get(w,y,C),w,v,C)});let x=r.slice();return x[o]=m[1],{outputValues:h.values,outputShape:x,indices:a}}var{addImpl:ZF,bincountImpl:Vy,bincountReduceImpl:QF,bitwiseAndImpl:JF,castImpl:eP,ceilImpl:tP,concatImpl:rP,equalImpl:nP,expImpl:oP,expm1Impl:sP,floorImpl:iP,gatherNdImpl:aP,gatherV2Impl:uP,greaterImpl:lP,greaterEqualImpl:cP,lessImpl:pP,lessEqualImpl:fP,linSpaceImpl:mP,logImpl:hP,maxImpl:dP,maximumImpl:gP,minimumImpl:xP,multiplyImpl:yP,negImpl:bP,notEqualImpl:vP,prodImpl:wP,raggedGatherImpl:TP,raggedRangeImpl:SP,raggedTensorToTensorImpl:CP,rangeImpl:EP,rsqrtImpl:NP,scatterImpl:_P,sigmoidImpl:IP,simpleAbsImpl:Gy,sliceImpl:AP,sparseFillEmptyRowsImpl:kP,sparseReshapeImpl:$P,sparseSegmentReductionImpl:Wy,sqrtImpl:RP,staticRegexReplaceImpl:OP,stridedSliceImpl:DP,stringNGramsImpl:FP,stringSplitImpl:PP,stringToHashBucketFastImpl:LP,subImpl:BP,tileImpl:MP,topKImpl:UP,transposeImpl:Cl,uniqueImpl:VP}=AC;function kC(e,t){return["x","y","z","w","u","v"].slice(0,t).map(r=>`${e}.${r}`)}function ur(e,t){return t===1?[e]:kC(e,t)}function GP(e,t){if(e===1)return"rc";let r="";for(let n=0;n<e;n++)r+=t[n],n<e-1&&(r+=",");return r}var zy=class{constructor(t){if(this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=t,this.rank=t.length,this.enableShapeUniforms=Ct(this.outputShape.length),this.rank===0)this.userCode=`
        void main() {
          setOutput(vec4(getA(), 0., 0., 0.));
        }
      `;else{let r=ur("rc",this.rank),n=Ke(this.rank),o=this.getOutOfBoundsCondition(r),s=this.getSetup(r),i=this.getOutput(r);this.userCode=`
        void main() {
          ${n} rc = getOutputCoords();

          if(${o}) {
            setOutput(vec4(0));
          } else {
            ${s}

            setOutput(vec4(${i}));
          }
        }
      `}}getSourceCoordsArr(t){let r=[];for(let n=0;n<=1;n++)for(let o=0;o<=1;o++){let s=`${n===0?"r":"rp1"}, ${o===0?"c":"cp1"}`;for(let i=2;i<this.rank;i++)s=`${t[t.length-1-i]},`+s;r.push(s)}return r}getOutOfBoundsCondition(t){if(this.rank===1)return`rc > ${this.enableShapeUniforms?"outShape":this.outputShape[0]}`;let r="";for(let n=this.rank-2;n<this.rank;n++)r+=`${t[n]} >= ${this.enableShapeUniforms?`outShape[${n}]`:this.outputShape[n]}`,n<this.rank-1&&(r+="||");return r}getSetup(t){if(this.rank===1)return"";let r=t.slice(-2),n=this.enableShapeUniforms?`outShape[${this.rank} - 1]`:this.outputShape[this.rank-1],o=this.enableShapeUniforms?`outShape[${this.rank} - 2]`:this.outputShape[this.rank-2];return`
      int r = ${r[0]};
      int c = ${r[1]};
      int rp1 = r + 1;
      int cp1 = c + 1;

      bool cEdge = cp1 >= ${n};
      bool rEdge = rp1 >= ${o};
    `}getOutput(t){let r=this.getSourceCoordsArr(t);return this.rank===1?`getA(rc), (rc + 1 >= ${this.enableShapeUniforms?"outShape":this.outputShape[0]} ? 0. : getA(rc + 1)), 0, 0`:`getA(${r[0]}),
            cEdge ? 0. : getA(${r[1]}),
            rEdge ? 0. : getA(${r[2]}),
            rEdge || cEdge ? 0. : getA(${r[3]})`}};var Lp=class{constructor(t,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec3"}],this.outputShape=t,this.enableShapeUniforms=Ct(this.outputShape.length);let n="";for(let o=0;o<4;o++){let s="thisRC = rc;";o%2===1&&(s+="thisRC.z += 1;"),o>1&&(s+="thisRC.y += 1;"),n+=`
        ${s}
        ${o>0?"if(thisRC.y < rows && thisRC.z < cols){":""}
          int flatIndex = getFlatIndex(thisRC);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);
          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[${o}] =
            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);
        ${o>0?"}":""}
      `}this.userCode=`
      ${qJ(r,this.enableShapeUniforms)}
      ${this.enableShapeUniforms?Ip():_p(t)}

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.);

        ivec3 thisRC;
        int rows = ${this.enableShapeUniforms?"outShape[1]":t[1]};
        int cols = ${this.enableShapeUniforms?"outShape[2]":t[2]};

        ${n}

        setOutput(result);
      }
    `}};function qJ(e,t){return`
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      ${t?HD(["r","c","d"],"inputShape"):Hs(["r","c","d"],e)}
      return ivec3(r, c, d);
    }
  `}var Hy=class{constructor(t){this.gpgpu=t,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0,this.freeTextures={},this.usedTextures={},this.logEnabled=!1}acquireTexture(t,r,n){let o=zP(r,n),s=HP(t,o,n);s in this.freeTextures||(this.freeTextures[s]=[]),s in this.usedTextures||(this.usedTextures[s]=[]);let i=WP(t,o,this.gpgpu.gl,this.gpgpu.textureConfig,n);if(this.freeTextures[s].length>0){this.numFreeTextures--,this.numUsedTextures++,this._numBytesFree-=i,this.log();let u=this.freeTextures[s].pop();return this.usedTextures[s].push(u),u}let a;return o===an.PACKED_2X2_FLOAT32?a=this.gpgpu.createPackedMatrixTexture(t[0],t[1]):o===an.PACKED_2X2_FLOAT16?a=this.gpgpu.createFloat16PackedMatrixTexture(t[0],t[1]):o===an.UNPACKED_FLOAT32?a=this.gpgpu.createFloat32MatrixTexture(t[0],t[1]):o===an.UNPACKED_FLOAT16?a=this.gpgpu.createFloat16MatrixTexture(t[0],t[1]):o===an.PACKED_4X1_UNSIGNED_BYTE&&(a=this.gpgpu.createUnsignedBytesMatrixTexture(t[0],t[1])),this.usedTextures[s].push(a),this.numUsedTextures++,this._numBytesAllocated+=i,this.log(),a}releaseTexture(t,r,n,o){if(this.freeTextures==null)return;let s=zP(n,o),i=HP(r,s,o);i in this.freeTextures||(this.freeTextures[i]=[]);let a=WP(r,s,this.gpgpu.gl,this.gpgpu.textureConfig,o),u=z().getNumber("WEBGL_DELETE_TEXTURE_THRESHOLD");u!==-1&&this._numBytesAllocated>u?(this.gpgpu.deleteMatrixTexture(t.texture),this._numBytesAllocated-=a):(this.freeTextures[i].push(t),this.numFreeTextures++,this._numBytesFree+=a),this.numUsedTextures--;let c=this.usedTextures[i],p=c&&c.indexOf(t);if(p==null||p<0)throw new Error("Cannot release a texture that was never provided by this texture manager");c[p]=c[c.length-1],c.pop(),this.log()}log(){if(!this.logEnabled)return;let t=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",`${this.numFreeTextures} / ${this.numUsedTextures}`,`(${t})`);let r=this._numBytesFree/this._numBytesAllocated;console.log(`Bytes allocated: ${this._numBytesAllocated}`),console.log(`Bytes unused: ${this._numBytesFree} (${Math.round(100*r)}%)`)}get numBytesAllocated(){return this._numBytesAllocated}get numBytesFree(){return this._numBytesFree}getNumUsedTextures(){return this.numUsedTextures}getNumFreeTextures(){return this.numFreeTextures}dispose(){if(this.freeTextures!=null){for(let t in this.freeTextures)this.freeTextures[t].forEach(r=>{this.gpgpu.deleteMatrixTexture(r.texture)});for(let t in this.usedTextures)this.usedTextures[t].forEach(r=>{this.gpgpu.deleteMatrixTexture(r.texture)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0}}};function jJ(e,t){let r=e;if(t===r.R32F)return 4;if(t===r.R16F)return 2;if(t===r.RGBA32F)return 16;if(t===e.RGBA)return 16;if(t===r.RGBA16F)return 8;if(t===r.RGBA8)return 4;throw new Error(`Unknown internal format ${t}`)}function WP(e,t,r,n,o){let s=XJ(t,n),i;if(o){let[u,c]=Ei(e[0],e[1]);i=u*c}else{let[u,c]=vl(e[0],e[1]);i=u*c}let a=jJ(r,s);return i*a}function XJ(e,t){switch(e){case an.PACKED_2X2_FLOAT32:return nC(t);case an.PACKED_2X2_FLOAT16:return oC(t);case an.UNPACKED_FLOAT32:return eC(t);case an.UNPACKED_FLOAT16:return tC(t);case an.PACKED_4X1_UNSIGNED_BYTE:return rC(t);default:throw new Error(`Unknown physical texture type ${e}`)}}function YJ(e){return z().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?e?an.PACKED_2X2_FLOAT32:an.UNPACKED_FLOAT32:e?an.PACKED_2X2_FLOAT16:an.UNPACKED_FLOAT16}function zP(e,t){if(e===yn.UPLOAD)return an.PACKED_2X2_FLOAT32;if(e===yn.RENDER||e==null)return YJ(t);if(e===yn.DOWNLOAD||e===yn.PIXELS)return an.PACKED_4X1_UNSIGNED_BYTE;throw new Error(`Unknown logical texture type ${e}`)}function HP(e,t,r){return`${e[0]}_${e[1]}_${t}_${r}`}var Qr=class{constructor(t,r){this.variableNames=["A"],this.outputShape=t,this.enableShapeUniforms=Ct(this.outputShape.length),this.userCode=`
      float unaryOperation(float x) {
        ${r}
      }

      void main() {
        float x = getAAtOutCoords();
        float y = unaryOperation(x);

        setOutput(y);
      }
    `}},Ir="if (isnan(x)) return x;",KP="return x;",$C="return abs(x);";var qP="return (x >= 0.0) ? x : (exp(x) - 1.0);",jP=Ir+`
  return (x < 0.0) ? 0.0 : x;
`,XP=Ir+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,_i="return x;",YP="return 1.0 / (1.0 + exp(-1.0 * x));";var QP="return x;",JP=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,eL=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,tL=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,rL="return 1.0 / (1.0 + exp(-1.0 * x));",Jn=class{constructor(t,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.enableShapeUniforms=Ct(this.outputShape.length),this.userCode=`
      vec4 unaryOperation(vec4 x) {
        ${r}
      }

      void main() {
        vec4 x = getAAtOutCoords();
        vec4 y = unaryOperation(x);

        setOutput(y);
      }
    `}};var Ky=class{constructor(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=t,this.enableShapeUniforms=Ct(this.outputShape.length);let r=t.length,n=ur("rc",r),o=Ke(r),s=GP(r,n),i=n.slice(-2),a=r<=1?"rc":`vec2(${i.join(",")})`;this.userCode=`
      void main() {
        ${o} rc = getOutputCoords();
        vec4 packedInput = getA(${s});

        setOutput(getChannel(packedInput, ${a}));
      }
    `}};var QJ=Ci.whereImpl,JJ=1e-7,eee=1e-4,qy={};function tee(e){return e in qy||(qy[e]={}),qy[e]}var ree=z().getNumber("CPU_HANDOFF_SIZE_THRESHOLD"),nee=600;function oee(){return z().global.screen==null?1024:z().global.screen.height*z().global.screen.width*window.devicePixelRatio*nee/1024/1024}var nL=(()=>{class e extends Uu{nextDataId(){return e.nextDataId++}constructor(r){if(super(),this.pendingRead=new WeakMap,this.pendingDisposal=new WeakSet,this.dataRefCount=new WeakMap,this.numBytesInGPU=0,this.uploadWaitMs=0,this.downloadWaitMs=0,this.lastGlFlushTime=0,this.warnedAboutMemory=!1,this.pendingDeletes=0,this.disposed=!1,!z().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");let n;if(r!=null){if(r instanceof Dp)n=r;else{let o=So(z().getNumber("WEBGL_VERSION"),r);n=new Dp(o)}this.binaryCache={},this.gpgpuCreatedLocally=!1}else{let o=So(z().getNumber("WEBGL_VERSION"));n=new Dp(o),this.binaryCache=tee(z().getNumber("WEBGL_VERSION")),this.gpgpuCreatedLocally=!0}this.gpgpu=n,this.canvas=this.gpgpu.gl.canvas,this.textureManager=new Hy(this.gpgpu),this.numMBBeforeWarning=oee(),this.texData=new Sm(this,Zi())}numDataIds(){return this.texData.numDataIds()-this.pendingDeletes}writeTexture(r,n,o,s,i,a){let u=this.makeTensorInfo(n,o),c=this.texData.get(u.dataId);c.isPacked=!1,c.texture={texture:r,texShape:[s,i]},c.texShape=[s,i];let p=lh(n),m=new ch(p,!1,a),h=this.runWebGLProgram(m,[u],o,[[s,i]]);return h.shape=n,c.texture=null,this.disposeIntermediateTensorInfo(u),h.dataId}write(r,n,o){if((z().getBool("WEBGL_CHECK_NUMERICAL_PROBLEMS")||z().getBool("DEBUG"))&&this.checkNumericalProblems(r),o==="complex64"&&r!=null)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");let s={id:this.nextDataId()};return this.texData.set(s,{shape:n,dtype:o,values:r,usage:yn.UPLOAD,refCount:1}),s}refCount(r){return this.texData.has(r)?this.texData.get(r).refCount:0}incRef(r){let n=this.texData.get(r);n.refCount++}decRef(r){if(this.texData.has(r)){let n=this.texData.get(r);n.refCount--}}move(r,n,o,s,i){if(z().getBool("DEBUG")&&this.checkNumericalProblems(n),s==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(r,{shape:o,dtype:s,values:n,usage:yn.UPLOAD,refCount:i})}disposeIntermediateTensorInfo(r){this.disposeData(r.dataId)}readSync(r){let n=this.texData.get(r),{values:o,dtype:s,complexTensorInfos:i,slice:a,shape:u,isPacked:c}=n;if(a!=null){let x;c?x=new Jn(u,_i):x=new Qr(u,_i);let y=this.runWebGLProgram(x,[{dataId:r,shape:u,dtype:s}],s),v=this.readSync(y.dataId);return this.disposeIntermediateTensorInfo(y),v}if(o!=null)return this.convertAndCacheOnCPU(r);if(s==="string")return o;let p=this.activeTimers!=null,m;p&&(m=A.now());let h;if(s==="complex64"){let x=this.readSync(i.real.dataId),y=this.readSync(i.imag.dataId);h=U.mergeRealAndImagArrays(x,y)}else h=this.getValuesFromTexture(r);return p&&(this.downloadWaitMs+=A.now()-m),this.convertAndCacheOnCPU(r,h)}read(r){return ne(this,null,function*(){if(this.pendingRead.has(r)){let v=this.pendingRead.get(r);return new Promise(w=>v.push(w))}let n=this.texData.get(r),{values:o,shape:s,slice:i,dtype:a,complexTensorInfos:u,isPacked:c}=n;if(i!=null){let v;c?v=new Jn(s,_i):v=new Qr(s,_i);let w=this.runWebGLProgram(v,[{dataId:r,shape:s,dtype:a}],a),C=this.read(w.dataId);return this.disposeIntermediateTensorInfo(w),C}if(o!=null)return this.convertAndCacheOnCPU(r);if(z().getBool("DEBUG")&&!z().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&z().getNumber("WEBGL_VERSION")===2)throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");let p=null,m;if(a!=="complex64"&&z().get("WEBGL_BUFFER_SUPPORTED")){m=this.decode(r);let v=this.texData.get(m.dataId);p=this.gpgpu.createBufferFromTexture(v.texture.texture,...sh(s))}this.pendingRead.set(r,[]),a!=="complex64"&&(yield this.gpgpu.createAndWaitForFence());let h;if(a==="complex64"){let v=yield Promise.all([this.read(u.real.dataId),this.read(u.imag.dataId)]),w=v[0],C=v[1];h=U.mergeRealAndImagArrays(w,C)}else if(p==null)h=this.getValuesFromTexture(r);else{let v=A.sizeFromShape(s);h=this.gpgpu.downloadFloat32MatrixFromBuffer(p,v)}if(m!=null&&this.disposeIntermediateTensorInfo(m),p!=null){let v=this.gpgpu.gl;ve(v,()=>v.deleteBuffer(p))}let x=this.convertAndCacheOnCPU(r,h),y=this.pendingRead.get(r);return this.pendingRead.delete(r),y.forEach(v=>v(x)),this.pendingDisposal.has(r)&&(this.pendingDisposal.delete(r),this.disposeData(r)&&Zi().removeDataId(r,this),this.pendingDeletes--),x})}readToGPU(r,n={}){let o=this.texData.get(r),{values:s,shape:i,slice:a,dtype:u,isPacked:c,texture:p}=o;if(u==="complex64")throw new Error("Does not support reading texture for complex64 dtype.");if(a!=null){let y;c?y=new Jn(i,_i):y=new Qr(i,_i);let v=this.runWebGLProgram(y,[{dataId:r,shape:i,dtype:u}],u),w=this.readToGPU(v,n);return this.disposeIntermediateTensorInfo(v),w}if(p==null)throw s!=null?new Error("Data is not on GPU but on CPU."):new Error("There is no data on GPU or CPU.");let m=this.decode(r,n.customTexShape),h=Zi().makeTensorFromTensorInfo(m),x=this.texData.get(m.dataId);return Object.assign({tensorRef:h},x.texture)}bufferSync(r){let n=this.readSync(r.dataId);if(r.dtype==="string")try{let o=n.map(s=>A.decodeString(s));return st(r.shape,r.dtype,o)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return st(r.shape,r.dtype,n)}checkNumericalProblems(r){if(r!=null)for(let n=0;n<r.length;n++){let o=r[n];if(!ED(o))throw z().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error(`The value ${o} cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'`):Error(`The value ${o} cannot be represented on this device.`)}}getValuesFromTexture(r){let{shape:n,dtype:o,isPacked:s}=this.texData.get(r),i=A.sizeFromShape(n);if(z().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){let x=this.decode(r),y=this.texData.get(x.dataId),v=this.gpgpu.downloadMatrixFromPackedTexture(y.texture.texture,...sh(n)).subarray(0,i);return this.disposeIntermediateTensorInfo(x),v}let a=z().getBool("WEBGL_PACK")&&s===!0,u=a?lh(n):n,c=a?new Py(u):new Fy(u),p=this.runWebGLProgram(c,[{shape:u,dtype:o,dataId:r}],"float32"),m=this.texData.get(p.dataId),h=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(m.texture.texture,m.texShape[0],m.texShape[1]).subarray(0,i);return this.disposeIntermediateTensorInfo(p),h}timerAvailable(){return z().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0}time(r){let n=this.activeTimers,o=[],s=!1;this.programTimersStack==null?(this.programTimersStack=o,s=!0):this.activeTimers.push(o),this.activeTimers=o,r();let i=A.flatten(this.activeTimers.map(c=>c.query)).filter(c=>c!=null),a=A.flatten(this.activeTimers.map(c=>c.name)).filter(c=>c!=null);this.activeTimers=n,s&&(this.programTimersStack=null);let u={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null};return ne(this,null,function*(){if(z().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0){let c=yield Promise.all(i);u.kernelMs=A.sum(c),u.getExtraProfileInfo=()=>c.map((p,m)=>({name:a[m],ms:p})).map(p=>`${p.name}: ${p.ms}`).join(", ")}else u.kernelMs={error:"WebGL query timers are not supported in this environment."};return this.uploadWaitMs=0,this.downloadWaitMs=0,u})}memory(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU,numBytesInGPUAllocated:this.textureManager.numBytesAllocated,numBytesInGPUFree:this.textureManager.numBytesFree}}startTimer(){return z().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:A.now(),endMs:null}}endTimer(r){return z().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),r):(r.endMs=A.now(),r)}getQueryTime(r){return ne(this,null,function*(){if(z().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0)return this.gpgpu.waitForQueryAndGetTime(r);let n=r;return n.endMs-n.startMs})}disposeData(r,n=!1){if(this.pendingDisposal.has(r))return!1;if(!this.texData.has(r))return!0;if(n?this.texData.get(r).refCount=0:this.texData.get(r).refCount--,!n&&this.texData.get(r).refCount>0)return!1;if(this.pendingRead.has(r))return this.pendingDisposal.add(r),this.pendingDeletes++,!1;this.releaseGPUData(r);let{complexTensorInfos:o}=this.texData.get(r);return o!=null&&(this.disposeData(o.real.dataId,n),this.disposeData(o.imag.dataId,n)),this.texData.delete(r),!0}releaseGPUData(r){let{texture:n,dtype:o,texShape:s,usage:i,isPacked:a,slice:u}=this.texData.get(r),c=u&&u.origDataId||r,p=this.dataRefCount.get(c);p>1?this.dataRefCount.set(c,p-1):(this.dataRefCount.delete(c),n!=null&&(this.numBytesInGPU-=this.computeBytes(s,o),this.textureManager.releaseTexture(n,s,i,a)));let m=this.texData.get(r);m.texture=null,m.texShape=null,m.isPacked=!1,m.slice=null}getTexture(r){return this.uploadToGPU(r),this.texData.get(r).texture.texture}getDataInfo(r){return this.texData.get(r)}shouldExecuteOnCPU(r,n=ree){return z().getBool("WEBGL_CPU_FORWARD")&&r.every(o=>this.texData.get(o.dataId).texture==null&&A.sizeFromShape(o.shape)<n)}getGPGPUContext(){return this.gpgpu}where(r){U.warn("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");let n=r.dataSync();return QJ(r.shape,n)}packedUnaryOp(r,n,o){let s=new Jn(r.shape,n),i=this.compileAndRun(s,[r],o);return Zi().makeTensorFromTensorInfo(i)}abs(r){if(this.shouldExecuteOnCPU([r])&&r.dtype!=="complex64"){let s=Gy(this.texData.get(r.dataId).values);return this.makeOutput(r.shape,r.dtype,s)}if(z().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(r,$C,r.dtype);let n=new Qr(r.shape,$C),o=this.compileAndRun(n,[r]);return Zi().makeTensorFromTensorInfo(o)}makeTensorInfo(r,n,o){let s;if(n==="string"&&o!=null&&o.length>0&&A.isString(o[0])){let i=o.map(a=>A.encodeString(a));s=this.write(i,r,n)}else s=this.write(o,r,n);return this.texData.get(s).usage=null,{dataId:s,shape:r,dtype:n}}makeOutput(r,n,o){return Zi().makeTensorFromTensorInfo(this.makeTensorInfo(r,n,o),this)}unpackTensor(r){let n=new Ky(r.shape);return this.runWebGLProgram(n,[r],r.dtype)}packTensor(r){let n=new zy(r.shape);return this.runWebGLProgram(n,[r],r.dtype,null,!0)}packedReshape(r,n){let o=[ou(r.shape),...su(r.shape)],s={dtype:r.dtype,shape:o,dataId:r.dataId},i=[ou(n),...su(n)],a=new Lp(i,o),u=!0,c=[o],p=this.runWebGLProgram(a,[s],r.dtype,c,u);return{dataId:p.dataId,shape:n,dtype:p.dtype}}decode(r,n){let o=this.texData.get(r),{isPacked:s,shape:i,dtype:a}=o;if(n!=null){let x=A.sizeFromShape(i),y=n[0]*n[1]*4;A.assert(x<=y,()=>"customTexShape is too small. Row * Column * 4 should be equal or larger than the size of the tensor data.")}let u=lh(i),c;s?c=new Dy(u):c=new Oy(u);let p=!0,m=[n??sh(u)],h=this.runWebGLProgram(c,[{shape:u,dtype:a,dataId:r}],a,m,p,n);return{dtype:a,shape:i,dataId:h.dataId}}runWebGLProgram(r,n,o,s,i=!1,a){let u=this.makeTensorInfo(r.outputShape,o),c=this.texData.get(u.dataId);if(r.packedOutput&&(c.isPacked=!0),r.outPackingScheme===bl.DENSE){let I=a??sh(r.outputShape);c.texShape=I.map(D=>D*2)}if(r.outTexUsage!=null&&(c.usage=r.outTexUsage),A.sizeFromShape(u.shape)===0)return c.values=A.getTypedArrayFromDType(u.dtype,0),u;let p=[],m=n.map(I=>{if(I.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");let D=this.texData.get(I.dataId);if(D.texture==null){if(!r.packedInputs&&A.sizeFromShape(I.shape)<=z().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:I.shape,texData:null,isUniform:!0,uniformValues:D.values};r.packedInputs&&(D.isPacked=!0,D.shape=I.shape)}if(this.uploadToGPU(I.dataId),!!D.isPacked!=!!r.packedInputs)I=D.isPacked?this.unpackTensor(I):this.packTensor(I),p.push(I),D=this.texData.get(I.dataId);else if(D.isPacked&&!wl(D.shape,I.shape)){let P=I,G=I.shape;I.shape=D.shape,I=this.packedReshape(I,G),p.push(I),D=this.texData.get(I.dataId),P.shape=G}return{shape:I.shape,texData:D,isUniform:!1}});this.uploadToGPU(u.dataId);let h={shape:u.shape,texData:c,isUniform:!1},x=JD(r,m,h),y=this.getAndSaveBinary(x,()=>ZD(this.gpgpu,r,m,h)),v=this.activeTimers!=null,w;v&&(w=this.startTimer()),z().get("ENGINE_COMPILE_ONLY")||QD(this.gpgpu,y,m,h,s),p.forEach(I=>this.disposeIntermediateTensorInfo(I)),v&&(w=this.endTimer(w),this.activeTimers.push({name:r.constructor.name,query:this.getQueryTime(w)}));let C=z().getNumber("WEBGL_FLUSH_THRESHOLD");if(C>0){let I=A.now();I-this.lastGlFlushTime>C&&(this.gpgpu.gl.flush(),this.lastGlFlushTime=I)}if(!z().getBool("WEBGL_LAZILY_UNPACK")&&c.isPacked&&i===!1){let I=this.unpackTensor(u);return this.disposeIntermediateTensorInfo(u),I}return u}compileAndRun(r,n,o,s,i=!1){return o=o||n[0].dtype,this.runWebGLProgram(r,n,o,s,i)}getAndSaveBinary(r,n){return r in this.binaryCache||(this.binaryCache[r]=n()),this.binaryCache[r]}getTextureManager(){return this.textureManager}dispose(){this.disposed||(z().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach(n=>{this.gpgpu.deleteProgram(this.binaryCache[n].webGLProgram),delete this.binaryCache[n]}),this.textureManager.dispose(),this.canvas!=null&&typeof HTMLCanvasElement<"u"&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)}floatPrecision(){return this.floatPrecisionValue==null&&(this.floatPrecisionValue=Ue(()=>{if(!z().get("WEBGL_RENDER_FLOAT32_ENABLED")){let r=z().getBool("DEBUG");z().set("DEBUG",!1);let n=this.abs(Be(1e-8)).dataSync()[0];if(z().set("DEBUG",r),n>0)return 32}return 16})),this.floatPrecisionValue}epsilon(){return this.floatPrecision()===32?JJ:eee}uploadToGPU(r){let n=this.texData.get(r),{shape:o,dtype:s,values:i,texture:a,usage:u,isPacked:c}=n;if(a!=null)return;let p=this.activeTimers!=null,m;p&&(m=A.now());let h=n.texShape;if(h==null&&(h=BD(o,c),n.texShape=h),i!=null){let x=lh(o),y,v=h[1],w=h[0],C=i instanceof Uint8Array||i instanceof Uint8ClampedArray;(c||!C)&&([v,w]=Ei(h[0],h[1])),c?y=new Ly(x,C):y=new ch(x,C);let I=C?[w,v]:h,D=this.makeTensorInfo(I,s),P=this.texData.get(D.dataId);C?P.usage=yn.PIXELS:P.usage=yn.UPLOAD,P.texShape=I,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(D.dataId),v,w,i);let G=[[w,v]],Z=this.runWebGLProgram(y,[D],s,G,!0),Y=this.texData.get(Z.dataId);n.texShape=Y.texShape,n.isPacked=Y.isPacked,n.usage=Y.usage,z().get("ENGINE_COMPILE_ONLY")?this.disposeData(Z.dataId):(n.texture=Y.texture,n.values=null,this.texData.delete(Z.dataId)),this.disposeIntermediateTensorInfo(D),p&&(this.uploadWaitMs+=A.now()-m)}else{let x=this.acquireTexture(h,u,s,c);n.texture=x}}convertAndCacheOnCPU(r,n){let o=this.texData.get(r),{dtype:s}=o;return n!=null&&(o.values=see(n,s)),o.values}acquireTexture(r,n,o,s){if(this.numBytesInGPU+=this.computeBytes(r,o),!this.warnedAboutMemory&&this.numBytesInGPU>this.numMBBeforeWarning*1024*1024){let i=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn(`High memory usage in GPU: ${i} MB, most likely due to a memory leak`)}return this.textureManager.acquireTexture(r,n,s)}computeBytes(r,n){return r[0]*r[1]*A.bytesPerElement(n)}checkCompileCompletion(){for(let[,r]of Object.entries(this.binaryCache))this.checkCompletion_(r)}checkCompileCompletionAsync(){return ne(this,null,function*(){let r=[];if(this.gpgpu.parallelCompilationExtension){for(let[,n]of Object.entries(this.binaryCache))r.push(this.checkCompletionAsync_(n));return Promise.all(r)}else{for(let[,n]of Object.entries(this.binaryCache)){let o=new Promise(s=>{try{this.checkCompletion_(n),s(!0)}catch(i){throw i}});r.push(o)}return Promise.all(r)}})}checkCompletionAsync_(r){return ne(this,null,function*(){return this.gpgpu.gl.getProgramParameter(r.webGLProgram,this.gpgpu.parallelCompilationExtension.COMPLETION_STATUS_KHR)?this.checkCompletion_(r):(yield mS(),this.checkCompletionAsync_(r))})}checkCompletion_(r){if(this.gpgpu.gl.getProgramParameter(r.webGLProgram,this.gpgpu.gl.LINK_STATUS)===!1)throw console.log(this.gpgpu.gl.getProgramInfoLog(r.webGLProgram)),this.gpgpu.gl.getShaderParameter(r.fragmentShader,this.gpgpu.gl.COMPILE_STATUS)===!1?(XS(r.source,this.gpgpu.gl.getShaderInfoLog(r.fragmentShader)),new Error("Failed to compile fragment shader.")):new Error("Failed to link vertex and fragment shaders.");return!0}getUniformLocations(){for(let r of Object.values(this.binaryCache)){this.gpgpu.buildVao(r.webGLProgram);let{variablesLocations:n,customUniformLocations:o,infLoc:s,nanLoc:i,outShapeLocation:a,outShapeStridesLocation:u,outTexShapeLocation:c}=JS(this.gpgpu,r.program,r.webGLProgram);r.variablesLocations=n,r.customUniformLocations=o,r.infLoc=s,r.nanLoc=i,r.outShapeLocation=a,r.outShapeStridesLocation=u,r.outTexShapeLocation=c}}createTensorFromGPUData(r,n,o){r.channels=r.channels||"RGBA";let{texture:s,height:i,width:a,channels:u}=r,c=Zi().backend;if(!c.gpgpu.gl.isTexture(s))throw new Error("The texture is invalid. Also, please make sure the texture and the TFJS WebGL backend are using the same canvas. If you want to use your own custom canvas, you have to create and use the custom TFJS WebGL backend created from the canvas through 'new tf.MathBackendWebGL(customCanvas)'.");let p=c.writeTexture(s,n,o,i,a,u);return Zi().makeTensorFromDataId(p,n,o,c)}}return e.nextDataId=0,e})();function see(e,t){if(t==="float32"||t==="complex64")return e;if(t==="int32"||t==="bool"){let r=t==="int32"?new Int32Array(e.length):new Uint8Array(e.length);for(let n=0;n<r.length;++n)r[n]=Math.round(e[n]);return r}else throw new Error(`Unknown dtype ${t}`)}Ha.isBrowser()&&xA("webgl",()=>new nL,2);var Bp=`
  if (isnan(a)) return a;
  if (isnan(b)) return b;
`;var eo=class{constructor(t,r,n){this.variableNames=["A","B"],this.outputShape=U.assertAndGetBroadcastShape(r,n),this.enableShapeUniforms=Ct(this.outputShape.length),this.userCode=`
      float binaryOperation(float a, float b) {
        ${t}
      }

      void main() {
        float a = getAAtOutCoords();
        float b = getBAtOutCoords();
        setOutput(binaryOperation(a, b));
      }
    `}};var Eo=`
  result.r = isNaN.r ? NAN : result.r;
  result.g = isNaN.g ? NAN : result.g;
  result.b = isNaN.b ? NAN : result.b;
  result.a = isNaN.a ? NAN : result.a;
`;var Co=class{constructor(t,r,n,o=!1){this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=U.assertAndGetBroadcastShape(r,n);let s=this.outputShape.length;this.enableShapeUniforms=Ct(s);let i="";if(o)if(s===0||A.sizeFromShape(this.outputShape)===1)i=`
          result.y = 0.;
          result.z = 0.;
          result.w = 0.;
        `;else if(i=`
          ${Ke(s)} coords = getOutputCoords();
        `,s===1)this.enableShapeUniforms?i+=`
            result.y = (coords + 1) >= outShape ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `:i+=`
            result.y = (coords + 1) >= ${this.outputShape[0]} ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `;else{let u=ur("coords",s);this.enableShapeUniforms?i+=`
            bool nextRowOutOfBounds =
              (${u[s-2]} + 1) >= outShape[${s} - 2];
            bool nextColOutOfBounds =
              (${u[s-1]} + 1) >= outShape[${s} - 1];
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `:i+=`
            bool nextRowOutOfBounds =
              (${u[s-2]} + 1) >= ${this.outputShape[s-2]};
            bool nextColOutOfBounds =
              (${u[s-1]} + 1) >= ${this.outputShape[s-1]};
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `}this.userCode=`
      vec4 binaryOperation(vec4 a, vec4 b) {
        ${t}
      }

      void main() {
        vec4 a = getAAtOutCoords();
        vec4 b = getBAtOutCoords();

        vec4 result = binaryOperation(a, b);
        ${i}

        setOutput(result);
      }
    `}};function lr(e){let{inputs:t,backend:r}=e,{x:n}=t;return r.incRef(n.dataId),{dataId:n.dataId,shape:n.shape,dtype:n.dtype}}var oL={kernelName:Hu,backendName:"webgl",kernelFunc:lr};function to(e){let{inputs:t,backend:r}=e,{real:n,imag:o}=t,s=r.makeTensorInfo(n.shape,"complex64"),i=r.texData.get(s.dataId),a=lr({inputs:{x:n},backend:r}),u=lr({inputs:{x:o},backend:r});return i.complexTensorInfos={real:a,imag:u},s}var sL={kernelName:Im,backendName:"webgl",kernelFunc:to};var RC="return (a < 0.) ? b * a : a;",OC=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function iee(e){let{inputs:t,backend:r,attrs:n}=e,{x:o}=t,{alpha:s}=n,i=r.makeTensorInfo([],"float32",A.createScalarValue(s,"float32")),a=z().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Co(OC,o.shape,i.shape):new eo(RC,o.shape,i.shape),u=r.runWebGLProgram(a,[o,i],"float32");return r.disposeIntermediateTensorInfo(i),u}var iL={kernelName:Nx,backendName:"webgl",kernelFunc:iee};var DC="return (a < 0.) ? b * a : a;",FC=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function aee(e){let{inputs:t,backend:r}=e,{x:n,alpha:o}=t,s=z().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Co(FC,n.shape,o.shape):new eo(DC,n.shape,o.shape);return r.runWebGLProgram(s,[n,o],"float32")}var aL={kernelName:Yx,backendName:"webgl",kernelFunc:aee};var ws="if (isnan(x)) return x;";function _e({opSnippet:e,packedOpSnippet:t,cpuKernelImpl:r,dtype:n}){return({inputs:o,backend:s})=>{let{x:i}=o,a=s,u=n||i.dtype;if(a.shouldExecuteOnCPU([i])&&r!=null){let m=a.texData.get(i.dataId),h=r(m.values,u);return a.makeTensorInfo(i.shape,u,h)}let c=z().getBool("WEBGL_PACK_UNARY_OPERATIONS")&&t!=null,p;return c?p=new Jn(i.shape,t):p=new Qr(i.shape,e),a.runWebGLProgram(p,[i],u)}}function bt({opSnippet:e,packedOpSnippet:t,checkOutOfBounds:r=!1,supportsComplex:n=!1,cpuKernelImpl:o,dtype:s}){return({inputs:i,backend:a})=>{let{a:u,b:c}=i,p=a;if(n&&u.dtype==="complex64"){let y=p.texData.get(u.dataId),v=p.texData.get(c.dataId),[w,C]=[[y.complexTensorInfos.real,v.complexTensorInfos.real],[y.complexTensorInfos.imag,v.complexTensorInfos.imag]].map(D=>{let[P,G]=D,q={dataId:P.dataId,dtype:P.dtype,shape:u.shape},Z={dataId:G.dataId,dtype:G.dtype,shape:c.shape},Y=new eo(e,u.shape,c.shape);return p.runWebGLProgram(Y,[q,Z],gn(P.dtype,G.dtype))}),I=to({inputs:{real:w,imag:C},backend:p});return p.disposeIntermediateTensorInfo(w),p.disposeIntermediateTensorInfo(C),I}let m=s||gn(u.dtype,c.dtype);if((u.dtype==="string"||c.dtype==="string"||p.shouldExecuteOnCPU([u,c]))&&o!=null){let y=p.texData.get(u.dataId).values,v=p.texData.get(c.dataId).values,w=u.dtype==="string"?U.fromUint8ToStringArray(y):y,C=u.dtype==="string"?U.fromUint8ToStringArray(v):v,[I,D]=o(u.shape,c.shape,w,C,m),P=p.makeTensorInfo(D,m),G=p.texData.get(P.dataId);return G.values=I,P}let h=z().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&t!=null,x;return h?x=new Co(t,u.shape,c.shape,r):x=new eo(e,u.shape,c.shape),p.runWebGLProgram(x,[u,c],m)}}function ia(e,t=!1){if(e==="linear")return t?QP:KP;if(e==="relu")return t?eL:jP;if(e==="elu")return t?JP:qP;if(e==="relu6")return t?tL:XP;if(e==="prelu")return t?FC:DC;if(e==="leakyrelu")return t?OC:RC;if(e==="sigmoid")return t?rL:YP;throw new Error(`Activation ${e} has not been implemented for the WebGL backend.`)}var Mp=class{constructor(t,r,n,o=!1,s=!1,i=!1,a=null,u=!1,c=!1){this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n,this.enableShapeUniforms=Ct(this.outputShape.length);let p=o?t[1]:t[2],m=Math.ceil(p/2),h=o?"i * 2, rc.y":"rc.y, i * 2",x=s?"rc.z, i * 2":"i * 2, rc.z",y=o?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],v=s?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],w="",C="";a&&(u?w=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${a}
        }`:c?w=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${a}
        }`:w=`vec4 activation(vec4 x) {
          ${a}
        }`,C="result = activation(result);");let I=i?"result += getBiasAtOutCoords();":"";i&&this.variableNames.push("bias"),u&&this.variableNames.push("preluActivationWeights"),c&&this.variableNames.push("leakyreluAlpha");let D="rc.x",P="rc.x";t[0]<r[0]?D=`imod(rc.x, ${t[0]})`:r[0]<t[0]&&(P=`imod(rc.x, ${r[0]})`),this.userCode=`
      ${w}
      // Don't use uniform for sharedDimensionPacked for performance.
      const float sharedDimension = ${m}.0;

      vec4 dot2x2ARowBCol(ivec3 rc) {
        vec4 result = vec4(0);
        int batchA = ${D};
        int batchB = ${P};
        for (int i = 0; i < ${m}; i++) {
          vec4 a = getMatrixA(batchA, ${h});
          vec4 b = getMatrixB(batchB, ${x});

          // These swizzled products need to be separately added.
          // See: https://github.com/tensorflow/tfjs/issues/1735
          result += (${y[0]} * ${v[0]});
          result += (${y[1]} * ${v[1]});
        }
        return result;
      }

      void main() {
        ivec3 rc = getOutputCoords();
        vec4 result = dot2x2ARowBCol(rc);

        ${I}

        ${C}

        setOutput(result);
      }
    `}};var PC={REAL:"return areal * breal - aimag * bimag;",IMAG:"return areal * bimag + aimag * breal;"},dh=class{constructor(t,r,n){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=U.assertAndGetBroadcastShape(r,n),this.userCode=`
      float binaryOpComplex(
          float areal, float aimag, float breal, float bimag) {
        ${t}
      }

      void main() {
        float areal = getARealAtOutCoords();
        float aimag = getAImagAtOutCoords();
        float breal = getBRealAtOutCoords();
        float bimag = getBImagAtOutCoords();
        setOutput(binaryOpComplex(areal, aimag, breal, bimag));
      }
    `}};var uL="return a * b;";function gh(e){let{inputs:t,backend:r}=e,{a:n,b:o}=t,s=U.upcastType(n.dtype,o.dtype);if(n.dtype==="complex64"){let a=r.texData.get(n.dataId),u=r.texData.get(o.dataId),c=new dh(PC.REAL,n.shape,o.shape),p=new dh(PC.IMAG,n.shape,o.shape),m=[{dataId:a.complexTensorInfos.real.dataId,dtype:a.complexTensorInfos.real.dtype,shape:n.shape},{dataId:a.complexTensorInfos.imag.dataId,dtype:a.complexTensorInfos.imag.dtype,shape:n.shape},{dataId:u.complexTensorInfos.real.dataId,dtype:u.complexTensorInfos.real.dtype,shape:o.shape},{dataId:u.complexTensorInfos.imag.dataId,dtype:u.complexTensorInfos.imag.dtype,shape:o.shape}],h=r.runWebGLProgram(c,m,"float32"),x=r.runWebGLProgram(p,m,"float32"),y=to({inputs:{real:h,imag:x},backend:r});return r.disposeIntermediateTensorInfo(h),r.disposeIntermediateTensorInfo(x),y}if(r.shouldExecuteOnCPU([n,o])){let a=r.texData.get(n.dataId),u=r.texData.get(o.dataId),[c,p]=yP(n.shape,o.shape,a.values,u.values,s),m=r.makeTensorInfo(p,s),h=r.texData.get(m.dataId);return h.values=c,m}let i;return z().getBool("WEBGL_PACK_BINARY_OPERATIONS")?i=new Co(uL,n.shape,o.shape):i=new eo(uL,n.shape,o.shape),r.runWebGLProgram(i,[n,o],s)}var lL={kernelName:Yc,backendName:"webgl",kernelFunc:gh};function cL(e,t,r){let n=[ou(e.shape),...su(e.shape)],o={dtype:e.dtype,shape:n,dataId:e.dataId},s=[ou(t),...su(t)],i=new Lp(s,n),a=!0,u=[n],c=r.runWebGLProgram(i,[o],e.dtype,u,a);return{dataId:c.dataId,shape:t,dtype:c.dtype}}function pe(e){let{inputs:t,backend:r,attrs:n}=e,{x:o}=t,{shape:s}=n,i=r,a=A.sizeFromShape(o.shape),u=A.inferFromImplicitShape(s,a),c=A.sizeFromShape(u);A.assert(a===c,()=>`The new shape (${u}) has ${c} elements and the old shape (${o.shape}) has ${a} elements. The new shape and old shape must have the same number of elements.`);let p=i.texData.get(o.dataId);return p.isPacked&&!wl(o.shape,u)&&!(p.texture!==null&&wl(p.shape,u))?cL(o,u,i):(i.incRef(o.dataId),{dataId:o.dataId,shape:u,dtype:o.dtype})}var pL={kernelName:n1,backendName:"webgl",kernelFunc:pe};var xh=class{constructor(t,r){this.variableNames=["x"];let{windowSize:n,batchSize:o,inSize:s,outSize:i}=t;this.outputShape=[o,i];let a=Math.floor(n/4)*4,u=n%4,c="sumValue += dot(values, ones);";if(r!=null){let m=1/r;c=`sumValue += dot(values * ${A.isInt(m)?m.toPrecision(2):m}, ones);`}let p="";s%n>0&&(p=`
        if (inIdx < 0 || inIdx >= ${s}) {
          return 0.0;
        }
      `),this.userCode=`
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${p}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${n};

        float sumValue = 0.0;

        for (int i = 0; i < ${a}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${c}
        }

        int inIdx = inOffset + ${a};
        if (${u===1}) {
          vec4 values = vec4(getValue(batch, inIdx), 0.0, 0.0, 0.0);

          ${c}
        } else if (${u===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1), 0.0, 0.0);

          ${c}
        } else if (${u===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2), 0.0);

          ${c}
        }
        setOutput(sumValue);
      }
    `}};var jy=class{constructor(t,r){this.variableNames=["x"];let{windowSize:n,batchSize:o,inSize:s,outSize:i}=t;this.outputShape=[o,i];let a="0.0",u="";r==="prod"?a="1.0":r==="min"?(a="1.0 / 1e-20",u="min"):r==="max"&&(a="-1.0 / 1e-20",u="max");let c=`${r}(${r}(${r}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;r==="sum"?c="sumValue":r==="prod"?c="prodValue":r==="all"?c="allValue":r==="any"&&(c="anyValue");let p=Math.floor(n/4)*4,m=n%4,h=`
      if (${r==="sum"}) {
        sumValue += dot(values, ones);
      } else if (${r==="prod"}) {
        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);
        prodValue *= tmp[0] * tmp[1];
      } else {
        minMaxValue = ${u}(values, minMaxValue);
        if (${r==="min"} || ${r==="max"}) {
          minMaxValue = ${u}(values, minMaxValue);
          bvec4 isNaN = isnan(values);
          if (isNaN.r || isNaN.g || isNaN.b || isNaN.a) {
            minMaxValue = vec4(NAN);
          }
        }
      }
    `,x="vec4";r==="all"?(a="1.0",h=`
        bool reducedAllValue = all(values);
        float floatedReducedAllValue = float(reducedAllValue);
        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);
      `,x="bvec4"):r==="any"&&(a="0.0",h=`
        bool reducedAnyValue = any(values);
        float floatedReducedAnyValue = float(reducedAnyValue);
        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);
      `,x="bvec4");let y="";s%n>0&&(y=`
        if (inIdx < 0 || inIdx >= ${s}) {
          return initializationValue;
        }
      `),this.userCode=`
      const float initializationValue = ${a};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${y}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${n};

        vec4 minMaxValue = vec4(${a});
        float prodValue = 1.0;
        float sumValue = 0.0;
        float allValue = 1.0;
        float anyValue = 0.0;

        for (int i = 0; i < ${p}; i += 4) {
          int inIdx = inOffset + i;
          ${x} values = ${x}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${h}
        }

        int inIdx = inOffset + ${p};
        if (${m===1}) {
          ${x} values = ${x}(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          ${h}
        } else if (${m===2}) {
          ${x} values = ${x}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          ${h}
        } else if (${m===3}) {
          ${x} values = ${x}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          ${h}
        }
        setOutput(${c});
      }
    `}};function lee(e){let t=[];for(;t.length===0||t[t.length-1].outSize!==1;){let r=t.length?t[t.length-1].outSize:e[1],n=U.computeOptimalWindowSize(r);t.push({inSize:r,windowSize:n,outSize:Math.ceil(r/n)})}return t}function No(e,t,r,n){let o=lee(e.shape),s=e;for(let i=0;i<o.length;i++){let{inSize:a,windowSize:u,outSize:c}=o[i],p,m;r==="mean"?p=i===0?new xh({windowSize:u,inSize:a,batchSize:e.shape[0],outSize:c},a):new xh({windowSize:u,inSize:a,batchSize:e.shape[0],outSize:c}):p=new jy({windowSize:u,inSize:a,batchSize:e.shape[0],outSize:c},r),m=s,s=n.runWebGLProgram(p,[s],t),m.dataId!==e.dataId&&n.disposeIntermediateTensorInfo(m)}return s}var Xy=class{constructor(t,r){this.variableNames=["A"];let n=new Array(t.length);for(let i=0;i<n.length;i++)n[i]=t[r[i]];this.outputShape=n,this.rank=n.length;let o=Ke(this.rank),s=cee(r);this.userCode=`
    void main() {
      ${o} resRC = getOutputCoords();
      setOutput(getA(${s}));
    }
    `}};function cee(e){let t=e.length;if(t>6)throw Error(`Transpose for rank ${t} is not yet supported`);let r=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],n=new Array(t);for(let o=0;o<e.length;o++)n[e[o]]=r[o];return n.join()}var Yy=class{constructor(t,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;let n=new Array(t.length);for(let p=0;p<n.length;p++)n[p]=t[r[p]];if(this.outputShape=n,this.rank=n.length,this.rank>6)throw Error(`Packed transpose for rank ${this.rank} is not yet supported.`);let o=Ke(this.rank),s=kC("rc",this.rank),i=new Array(this.rank);for(let p=0;p<r.length;p++)i[r[p]]=s[p];let a=`vec2(${i.slice(-2).join()})`,u=`++${s[this.rank-1]} < ${n[this.rank-1]}`,c=`getChannel(getA(${i.join()}), ${a})`;this.userCode=`
    void main() {
      ${o} rc = getOutputCoords();
      vec4 result = vec4(0.);
      result[0] = ${c};
      if(${u}) {
        result[1] = ${c};
      }
      --${s[this.rank-1]};
      if(++${s[this.rank-2]} < ${n[this.rank-2]}) {
        result[2] = ${c};
        if(${u}) {
          result[3] = ${c};
        }
      }
      setOutput(result);
    }
    `}};function iu(e,t,r){let n=z().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Yy(e.shape,t):new Xy(e.shape,t);return r.runWebGLProgram(n,[e],e.dtype)}function fL(e,t,r,n){let o=t,s=e.shape.length,i=A.parseAxisParam(o,e.shape),a=i,u=U.getAxesPermutation(a,s),c=u!=null,p=e;c&&(p=iu(e,u,n),a=U.getInnerMostAxes(a.length,s)),U.assertAxesAreInnerMostDims("sum",a,s);let[m,h]=U.computeOutAndReduceShapes(p.shape,a),x=m;r&&(x=U.expandShapeToKeepDim(m,i));let y=A.sizeFromShape(h),w=A.sizeFromShape(e.shape)/y,C=pe({inputs:{x:p},attrs:{shape:[w,y]},backend:n}),I=Zu(e.dtype),D=No(C,I,"sum",n),P=pe({inputs:{x:D},attrs:{shape:x},backend:n});return n.disposeIntermediateTensorInfo(C),n.disposeIntermediateTensorInfo(D),c&&n.disposeIntermediateTensorInfo(p),P}function El(e){let{inputs:t,backend:r,attrs:n}=e,{x:o}=t,{axis:s,keepDims:i}=n;return fL(o,s,i,r)}var mL={kernelName:y1,backendName:"webgl",kernelFunc:El};function Ht(e){let{inputs:t,backend:r,attrs:n}=e,{x:o}=t,{perm:s}=n,i=r,a=o.shape.length,u=new Array(a);for(let p=0;p<u.length;p++)u[p]=o.shape[s[p]];let c;if(i.shouldExecuteOnCPU([o])){let m=i.texData.get(o.dataId).values,h=Cl(m,o.shape,o.dtype,s,u);c=i.makeTensorInfo(u,o.dtype);let x=i.texData.get(c.dataId);x.values=h}else c=iu(o,s,i);return c}var hL={kernelName:sp,backendName:"webgl",kernelFunc:Ht};var LC=1e3;function Nl({a:e,b:t,transposeA:r,transposeB:n,backend:o,bias:s=null,preluActivationWeights:i=null,leakyreluAlpha:a=0,activation:u=null}){let c=e.shape.length,p=t.shape.length,m=r?e.shape[c-2]:e.shape[c-1],h=n?t.shape[p-1]:t.shape[p-2],x=r?e.shape[c-1]:e.shape[c-2],y=n?t.shape[p-2]:t.shape[p-1],v=e.shape.slice(0,-2),w=t.shape.slice(0,-2),C=A.sizeFromShape(v),I=A.sizeFromShape(w),P=Za.assertAndGetBroadcastShape(e.shape.slice(0,-2),t.shape.slice(0,-2)).concat([x,y]);A.assert(m===h,()=>`Error in matMul: inner shapes (${m}) and (${h}) of Tensors with shapes ${e.shape} and ${t.shape} and transposeA=${r} and transposeB=${n} must match.`);let G=r?[C,m,x]:[C,x,m],q=n?[I,y,h]:[I,h,y],Z=pe({inputs:{x:e},backend:o,attrs:{shape:G}}),Y=pe({inputs:{x:t},backend:o,attrs:{shape:q}}),te=[Z,Y],J=Math.max(C,I),ae=r?Z.shape[1]:Z.shape[2],ge=s!=null,ke=i!=null,We=u==="leakyrelu",Re=u!=null?ia(u,!0):null,ct=ge||ke||We||Re!=null,oe;if((x===1||y===1)&&ae>LC&&ct===!1){let se=Z,we=Y;r&&(se=Ht({inputs:{x:Z},backend:o,attrs:{perm:[0,2,1]}}),te.push(se)),n&&(we=Ht({inputs:{x:Y},backend:o,attrs:{perm:[0,2,1]}}),te.push(we));let xe=y!==1,Ne=y===1,Te=se;xe&&(Te=pe({inputs:{x:se},backend:o,attrs:{shape:[J,ae,1]}}),te.push(Te));let Ze=y===1?2:1,ye=we;Ne&&(ye=pe({inputs:{x:we},backend:o,attrs:{shape:[J,1,ae]}}),te.push(ye));let Qe=gh({inputs:{a:Te,b:ye},backend:o});oe=El({inputs:{x:Qe},backend:o,attrs:{axis:Ze,keepDims:!0}}),te.push(Qe)}else{let se=gn(e.dtype,t.dtype),we=new Mp(G,q,[J,x,y],r,n,ge,Re,ke,We),xe=[Z,Y];if(s!=null&&xe.push(s),ke&&xe.push(i),We){let Ne=o.makeTensorInfo([],"float32",A.createScalarValue(a,"float32"));xe.push(Ne),te.push(Ne)}oe=o.runWebGLProgram(we,xe,se)}let fe=pe({inputs:{x:oe},backend:o,attrs:{shape:P}});te.push(oe);for(let se of te)o.disposeIntermediateTensorInfo(se);return fe}function pee(e){let{inputs:t,backend:r,attrs:n}=e,{a:o,b:s,bias:i,preluActivationWeights:a}=t,{transposeA:u,transposeB:c,activation:p,leakyreluAlpha:m}=n;return Nl({a:o,b:s,transposeA:u,transposeB:c,backend:r,bias:i,preluActivationWeights:a,leakyreluAlpha:m,activation:p})}var dL={kernelName:Dm,backendName:"webgl",kernelFunc:pee};var gL="return abs(x);";function fee(e){let{inputs:t,backend:r}=e,{x:n}=t;if(r.shouldExecuteOnCPU([n])&&n.dtype!=="complex64"){let s=r.texData.get(n.dataId),i=Gy(s.values);return r.makeTensorInfo(n.shape,n.dtype,i)}let o;return z().getBool("WEBGL_PACK_UNARY_OPERATIONS")?o=new Jn(n.shape,gL):o=new Qr(n.shape,gL),r.runWebGLProgram(o,[n],n.dtype)}var xL={kernelName:_m,backendName:"webgl",kernelFunc:fee};var mee=Ir+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return acos(x);
`,hee=_e({opSnippet:mee}),yL={kernelName:Ng,backendName:"webgl",kernelFunc:hee};var dee=Ir+`
  if (x < 1.0) return NAN;
return log(x + sqrt(x * x - 1.0));`,gee=_e({opSnippet:dee}),bL={kernelName:_g,backendName:"webgl",kernelFunc:gee};var vL="return a + b;",xee=bt({opSnippet:vL,packedOpSnippet:vL,supportsComplex:!0,cpuKernelImpl:ZF}),wL={kernelName:Ga,backendName:"webgl",kernelFunc:xee};var Zy=class{constructor(t,r){this.outputShape=[],this.outputShape=t,this.variableNames=r.map((s,i)=>`T${i}`);let n=[];this.variableNames.forEach(s=>{n.push(`float v${s} = get${s}AtOutCoords();`)});let o=this.variableNames.map(s=>`v${s}`).join(" + ");this.userCode=`
      void main() {
        ${n.join(`
        `)}

        float result = ${o};
        setOutput(result);
      }
    `}};var Qy=class{constructor(t,r){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.variableNames=r.map((s,i)=>`T${i}`);let n=[];this.variableNames.forEach(s=>{n.push(`vec4 v${s} = get${s}AtOutCoords();`)});let o=this.variableNames.map(s=>`v${s}`).join(" + ");this.userCode=`
      void main() {
        ${n.join(`
        `)}

        vec4 result = ${o};
        setOutput(result);
      }
    `}};function Jy(e){let{inputs:t,backend:r}=e,n=t;if(n.length===1)return lr({inputs:{x:n[0]},backend:r});if(n.length>z().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){let u=Math.floor(n.length/2),c=Jy({inputs:n.slice(0,u),backend:r}),p=Jy({inputs:n.slice(u),backend:r});return Jy({inputs:[c,p],backend:r})}let o=n.map(u=>u.dtype).reduce((u,c)=>gn(u,c)),s=n.map(u=>u.shape),a=z().getBool("WEBGL_PACK")?new Qy(n[0].shape,s):new Zy(n[0].shape,s);return r.runWebGLProgram(a,n,o)}var TL={kernelName:Ig,backendName:"webgl",kernelFunc:Jy};function yee(e){let{inputs:t,backend:r,attrs:n}=e,{x:o}=t,{axis:s,keepDims:i}=n,a=o.shape.length,u=A.parseAxisParam(s,o.shape),c=u,p=U.getAxesPermutation(c,a),m=o;p!=null&&(m=Ht({inputs:{x:o},backend:r,attrs:{perm:p}}),c=U.getInnerMostAxes(c.length,a)),U.assertAxesAreInnerMostDims("all",c,a);let[h,x]=U.computeOutAndReduceShapes(m.shape,c),y=A.sizeFromShape(x),v=pe({inputs:{x:m},backend:r,attrs:{shape:[-1,y]}}),w=No(v,v.dtype,"all",r),C;if(i){let I=U.expandShapeToKeepDim(h,u);C=pe({inputs:{x:w},backend:r,attrs:{shape:I}})}else C=pe({inputs:{x:w},backend:r,attrs:{shape:h}});return r.disposeIntermediateTensorInfo(v),r.disposeIntermediateTensorInfo(w),p!=null&&r.disposeIntermediateTensorInfo(m),C}var SL={kernelName:Ag,backendName:"webgl",kernelFunc:yee};function bee(e){let{inputs:t,backend:r,attrs:n}=e,{x:o}=t,{axis:s,keepDims:i}=n,a=o.shape.length,u=A.parseAxisParam(s,o.shape),c=u,p=U.getAxesPermutation(c,a),m=o;p!=null&&(m=Ht({inputs:{x:o},backend:r,attrs:{perm:p}}),c=U.getInnerMostAxes(c.length,a)),U.assertAxesAreInnerMostDims("any",c,a);let[h,x]=U.computeOutAndReduceShapes(m.shape,c),y=A.sizeFromShape(x),v=pe({inputs:{x:m},backend:r,attrs:{shape:[-1,y]}}),w=No(v,v.dtype,"any",r),C;if(i){let I=U.expandShapeToKeepDim(h,u);C=pe({inputs:{x:w},backend:r,attrs:{shape:I}})}else C=pe({inputs:{x:w},backend:r,attrs:{shape:h}});return r.disposeIntermediateTensorInfo(v),r.disposeIntermediateTensorInfo(w),p!=null&&r.disposeIntermediateTensorInfo(m),C}var CL={kernelName:kg,backendName:"webgl",kernelFunc:bee};var e2=class{constructor(t,r,n){this.variableNames=["A"];let{windowSize:o,batchSize:s,outSize:i}=t;n||this.variableNames.push("bestIndicesA"),this.outputShape=[s,i];let a=r==="max"?">":"<",u=n?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${o};

        int bestIndex = inOffset;
        float bestValue = getA(batch, bestIndex);

        for (int i = 0; i < ${o}; i++) {
          int inIdx = ${u};
          float candidate = getA(batch, inIdx);
          if (candidate ${a} bestValue) {
            bestValue = candidate;
            bestIndex = inIdx;
          }
        }
        setOutput(float(bestIndex));
      }
    `}};var t2=class{constructor(t,r,n,o){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,A.assert(t.length>2,()=>`Packed arg${n.charAt(0).toUpperCase()+n.slice(1)} supports only inputs with rank above 2.`);let s=t[t.length-1],i=Math.ceil(s/r);this.outputShape=t.slice(0,-1),i>1&&this.outputShape.push(i),o||this.variableNames.push("bestIndicesA");let a=this.outputShape,u=a.length,c=Ke(u),p=ur("coords",u),m,h;if(i===1){h=u+1;let Y=Ke(h);m=`
        ${Y} sourceLocR = ${Y}(${p.join()}, 0);
        ++${p[u-1]};
        ${Y} sourceLocG = ${Y}(${p.join()}, 0);
        ++${p[u-2]};
        ${Y} sourceLocA = ${Y}(${p.join()}, 0);
        --${p[u-1]};
        ${Y} sourceLocB = ${Y}(${p.join()}, 0);
        --${p[u-2]};`}else h=u,m=`
        ${c} sourceLocR = coords;
        ++${p[u-1]};
        ${c} sourceLocG = coords;
        ++${p[u-2]};
        ${c} sourceLocA = coords;
        --${p[u-1]};
        ${c} sourceLocB = coords;
        --${p[u-2]};`;let x=["x","y","z","w","u","v"].slice(0,h),y="."+x[h-1],v=x.map(Y=>"int "+Y),w=ur("sourceLocR",h-1).concat("inIdx.r"),C=ur("sourceLocG",h-1).concat("inIdx.g"),I=ur("sourceLocB",h-1).concat("inIdx.b"),D=ur("sourceLocA",h-1).concat("inIdx.a"),P=n==="max"?"greaterThan":"lessThan",G=o?"":`
          inIdx = round(vec4(getBestIndicesAChannel(${w.join()}),
                             getBestIndicesAChannel(${C.join()}),
                             getBestIndicesAChannel(${I.join()}),
                             getBestIndicesAChannel(${D.join()})));`,q=`vec4(
            getAChannel(${w.join()}),
            hasNextCol ? getAChannel(${C.join()}) : 0.,
            hasNextRow ? getAChannel(${I.join()}) : 0.,
            hasNextRow && hasNextCol ? getAChannel(${D.join()}) : 0.)`,Z=o?"":`
      float getBestIndicesAChannel(${v.join()}) {
        return getChannel(getBestIndicesA(${x.join()}),
                                          vec2(${x.slice(-2).join()}));
      }`;this.userCode=`
      float getAChannel(${v.join()}) {
        return getChannel(getA(${x.join()}),
                               vec2(${x.slice(-2).join()}));
      }
      ${Z}
      void main() {
        ${c} coords = getOutputCoords();
        bool hasNextCol = ${p[u-1]} < ${a[u-1]-1};
        bool hasNextRow = ${p[u-2]} < ${a[u-2]-1};
        ${m}
        ivec4 srcIdx = ivec4(sourceLocR${y}, sourceLocG${y},
          sourceLocB${y}, sourceLocA${y}) * ${r};
        ivec4 inIdx = srcIdx;
        vec4 bestIndex = vec4(inIdx);
        vec4 bestValue = ${q};

        for (int i = 0; i < ${r}; i++) {
          inIdx = srcIdx;
          ${G}
          vec4 candidate = ${q};
          bvec4 nan = isnan(candidate);
          bvec4 replace = bvec4(
            vec4(${P}(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));

          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,
                           replace.y  ? candidate.y : bestValue.y,
                           replace.z  ? candidate.z : bestValue.z,
                           replace.w  ? candidate.w : bestValue.w);
          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));
          srcIdx++;
        }
        setOutput(bestIndex);
      }
    `}};function EL(e,t,r,n=null){let o=t.shape[0],s=t.shape[1];n!=null&&(o=n.shape[0],s=n.shape[1]);let i=U.computeOptimalWindowSize(s),a={windowSize:i,inSize:s,batchSize:o,outSize:Math.ceil(s/i)},u=new e2(a,r,n==null),c=[t];n!=null&&c.push(n);let p=e.runWebGLProgram(u,c,"int32");if(p.shape[1]===1)return p;let m=EL(e,t,r,p);return e.disposeIntermediateTensorInfo(p),m}function NL(e,t,r,n=null){let o=n!=null?n.shape:t.shape,s=o[o.length-1],i=U.computeOptimalWindowSize(s),a=new t2(o,i,r,n==null),u=n==null?[t]:[t,n],c=e.runWebGLProgram(a,u,"int32");if(c.shape.length===t.shape.length){let p=NL(e,t,r,c);return e.disposeIntermediateTensorInfo(c),p}return c}function r2(e,t,r,n){let o=[r];if(U.assertAxesAreInnerMostDims("arg"+n.charAt(0).toUpperCase()+n.slice(1),o,t.shape.length),!z().getBool("WEBGL_PACK_REDUCE")||t.shape.length<=2){let s=[],i=e.texData.get(t.dataId),a=i!==null&&i.isPacked,u=t;a&&(u=e.unpackTensor(t),s.push(u));let[c,p]=U.computeOutAndReduceShapes(u.shape,o),m=A.sizeFromShape(p),h=pe({inputs:{x:u},backend:e,attrs:{shape:[-1,m]}});s.push(h);let x=EL(e,h,n);s.push(x);let y=pe({inputs:{x},backend:e,attrs:{shape:c}});return s.forEach(v=>e.disposeIntermediateTensorInfo(v)),y}return NL(e,t,n)}function vee(e){let{inputs:t,backend:r,attrs:n}=e,{x:o}=t,{axis:s}=n,i=A.parseAxisParam(s,o.shape),a=U.getAxesPermutation(i,o.shape.length),u=o,c=[];a!=null&&(u=Ht({inputs:{x:o},backend:r,attrs:{perm:a}}),c.push(u),i=U.getInnerMostAxes(i.length,u.shape.length)),U.assertAxesAreInnerMostDims("argMax",[i[0]],u.shape.length);let p=r2(r,u,i[0],"max");return c.forEach(m=>r.disposeIntermediateTensorInfo(m)),p}var _L={kernelName:$g,backendName:"webgl",kernelFunc:vee};function wee(e){let{inputs:t,backend:r,attrs:n}=e,{x:o}=t,{axis:s}=n,i=A.parseAxisParam(s,o.shape),a=U.getAxesPermutation(i,o.shape.length),u=o,c=[];a!=null&&(u=Ht({inputs:{x:o},backend:r,attrs:{perm:a}}),c.push(u),i=U.getInnerMostAxes(i.length,u.shape.length)),U.assertAxesAreInnerMostDims("argMin",[i[0]],u.shape.length);let p=r2(r,u,i[0],"min");return c.forEach(m=>r.disposeIntermediateTensorInfo(m)),p}var IL={kernelName:Rg,backendName:"webgl",kernelFunc:wee};var Tee=Ir+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return asin(x);
`,See=_e({opSnippet:Tee}),AL={kernelName:Og,backendName:"webgl",kernelFunc:See};var Cee=Ir+"return log(x + sqrt(x * x + 1.0));",Eee=_e({opSnippet:Cee}),kL={kernelName:Dg,backendName:"webgl",kernelFunc:Eee};var Nee=Ir+`
  return atan(x);
`,_ee=_e({opSnippet:Nee}),$L={kernelName:Fg,backendName:"webgl",kernelFunc:_ee};var Iee=Bp+`
  return atan(a, b);
`,Aee=`
  vec4 result = atan(a, b);
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+Eo+`
  return result;
`,kee=bt({opSnippet:Iee,packedOpSnippet:Aee}),RL={kernelName:Lg,backendName:"webgl",kernelFunc:kee};var $ee=Ir+`
  if ((x < -1.0) || (x > 1.0)) return NAN;
return (log(1.0 + x) - log(1.0 - x)) / 2.0;`,Ree=_e({opSnippet:$ee}),OL={kernelName:Pg,backendName:"webgl",kernelFunc:Ree};var Ks=class{constructor(t,r,n,o=!1,s=!1){if(this.variableNames=["x"],r==="avg"&&n)throw new Error("Cannot compute positions for average pool.");let i=t.filterWidth,a=t.strideHeight,u=t.strideWidth,c=t.dilationHeight,p=t.dilationWidth,m=t.effectiveFilterHeight,h=t.effectiveFilterWidth,x=t.padInfo.top,y=t.padInfo.left;this.outputShape=t.outShape;let v=r==="avg",w=`((batch  * ${t.inHeight} + xR) * ${t.inWidth} + xC) * ${t.inChannels} + d`,C=`(xR * ${t.inWidth} + xC) * ${t.inChannels} + d`,I="0.0";if(v||(I="-1.0 / 1e-20"),n){let Y=">=";this.userCode=`
        const ivec2 strides = ivec2(${a}, ${u});
        const ivec2 pads = ivec2(${x}, ${y});

        void main() {
          ivec4 coords = getOutputCoords();
          int batch = coords[0];
          int d = coords[3];

          ivec2 xRCCorner = coords.yz * strides - pads;
          int xRCorner = xRCCorner.x;
          int xCCorner = xRCCorner.y;

          // max/min x(?, ?, d) to get y(yR, yC, d).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;
          float avgValue = 0.0;

          for (int wR = 0; wR < ${m};
              wR += ${c}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${t.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${h};
                wC += ${p}) {
              int xC = xCCorner + wC;

              if (xC < 0 || xC >= ${t.inWidth}) {
                continue;
              }

              float value = getX(batch, xR, xC, d);

              // If a min / max value has already been found, use it. If not,
              // use the current value.
              float currMinMaxValue = mix(
                  value, minMaxValue, minMaxValueFound);
              if (value ${Y} currMinMaxValue) {
                minMaxValue = value;
                minMaxValueFound = 1.0;
                minMaxPosition = ${o?s?w:C:`wR * ${h} + wC`};
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}let D="max",P=`${r}(${r}(${r}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;r==="avg"&&(P="avgValue / max(count, 1.0)");let G=Math.floor(i/4)*4,q=i%4,Z=`
      if (${v}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${D}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec2 strides = ivec2(${a}, ${u});
      const ivec2 pads = ivec2(${x}, ${y});
      const float initializationValue = ${I};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xR, int xC, int d) {
        if (xC < 0 || xC >= ${t.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xR, xC, d);
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // max/min x(?, ?, d) to get y(yR, yC, d).
        // ? = to be determined
        vec4 minMaxValue = vec4(${I});
        float avgValue = 0.0;
        count = 0.0;

        for (int wR = 0; wR < ${m};
            wR += ${c}) {
          int xR = xRCorner + wR;

          if (xR < 0 || xR >= ${t.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${G}; wC += 4) {
            int xC = xCCorner + wC * ${p};

            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${p}, d),
              getValue(batch, xR, xC + 2 * ${p}, d),
              getValue(batch, xR, xC + 3 * ${p}, d)
            );

            ${Z}
          }

          int xC = xCCorner + ${G};
          if (${q===1}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              initializationValue,
              initializationValue,
              initializationValue
            );

            ${Z}
          } else if (${q===2}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${p}, d),
              initializationValue,
              initializationValue
            );

            ${Z}
          } else if (${q===3}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${p}, d),
              getValue(batch, xR, xC + 2 * ${p}, d),
              initializationValue
            );

            ${Z}
          }
        }
        setOutput(${P});
      }
    `}},au=class{constructor(t,r,n,o=!1,s=!1){if(this.variableNames=["x"],r==="avg"&&n)throw new Error("Cannot compute positions for average pool.");let i=t.filterWidth,a=t.strideDepth,u=t.strideHeight,c=t.strideWidth,p=t.dilationDepth,m=t.dilationHeight,h=t.dilationWidth,x=t.effectiveFilterDepth,y=t.effectiveFilterHeight,v=t.effectiveFilterWidth,w=t.padInfo.front,C=t.padInfo.top,I=t.padInfo.left;this.outputShape=t.outShape;let D=r==="avg",P="0.0";if(D||(P="-1.0 / 1e-20"),n){let J=">=";this.userCode=`
        const ivec3 strides =
            ivec3(${a}, ${u}, ${c});
        const ivec3 pads = ivec3(${w}, ${C}, ${I});

        void main() {
          ivec5 coords = getOutputCoords();
          int batch = coords.x;
          int ch = coords.u;

          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
          int xDCorner = xCorner.x;
          int xRCorner = xCorner.y;
          int xCCorner = xCorner.z;

          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;

          for (int wD = 0; wD < ${x};
              wD += ${p}) {
            int xD = xDCorner + wD;

            if (xD < 0 || xD >= ${t.inDepth}) {
              continue;
            }

            for (int wR = 0; wR < ${y};
                wR += ${m}) {
              int xR = xRCorner + wR;

              if (xR < 0 || xR >= ${t.inHeight}) {
                continue;
              }

              for (int wC = 0; wC < ${v};
                  wC += ${h}) {
                int xC = xCCorner + wC;

                if (xC < 0 || xC >= ${t.inWidth}) {
                  continue;
                }

                float value = getX(batch, xD, xR, xC, ch);

                // If a min / max value has already been found, use it. If not,
                // use the current value.
                float currMinMaxValue = mix(
                    value, minMaxValue, minMaxValueFound);
                if (value ${J} currMinMaxValue) {
                  minMaxValue = value;
                  minMaxValueFound = 1.0;
                  minMaxPosition = ${o?s?`(((batch * ${t.inDepth} + xD) * ${t.inHeight} + xR) * ${t.inWidth} + xC) * ${t.inChannels} + ch`:`((xD * ${t.inHeight} + xR) * ${t.inWidth} + xC) * ${t.inChannels} + ch`:`wD * ${y} * ${v} +
                      wR * ${v} + wC`};
                }
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}let G="max",q=`${r}(${r}(${r}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;r==="avg"&&(q="avgValue / max(count, 1.0)");let Z=Math.floor(i/4)*4,Y=i%4,te=`
      if (${D}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${G}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec3 strides =
        ivec3(${a}, ${u}, ${c});
      const ivec3 pads = ivec3(${w}, ${C}, ${I});
      const float initializationValue = ${P};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xD, int xR, int xC, int ch) {
        if (xC < 0 || xC >= ${t.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xD, xR, xC, ch);
      }

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xDCorner = xCorner.x;
        int xRCorner = xCorner.y;
        int xCCorner = xCorner.z;

        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).
        // ? = to be determined
        vec4 minMaxValue = vec4(${P});
        float avgValue = 0.0;
        count = 0.0;

        for (int wD = 0; wD < ${x};
            wD += ${p}) {
          int xD = xDCorner + wD;

          if (xD < 0 || xD >= ${t.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${y};
            wR += ${m}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${t.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${Z}; wC += 4) {
              int xC = xCCorner + wC * ${h};

              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${h}, ch),
                getValue(batch, xD, xR, xC + 2 * ${h}, ch),
                getValue(batch, xD, xR, xC + 3 * ${h}, ch)
              );

              ${te}
            }

            int xC = xCCorner + ${Z};
            if (${Y===1}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                initializationValue,
                initializationValue,
                initializationValue
              );

              ${te}
            } else if (${Y===2}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${h}, ch),
                initializationValue,
                initializationValue
              );

              ${te}
            } else if (${Y===3}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${h}, ch),
                getValue(batch, xD, xR, xC + 2 * ${h}, ch),
                initializationValue
              );

              ${te}
            }
          }
        }
        setOutput(${q});
      }
    `}};function Oee(e){let{inputs:t,backend:r,attrs:n}=e,{x:o}=t;Ni(o,"avgPool");let{filterSize:s,strides:i,pad:a,dimRoundingMode:u}=n,c=1;A.assert(U.eitherStridesOrDilationsAreOne(i,c),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${i} and dilations '${c}'`);let p=U.computePool2DInfo(o.shape,s,i,c,a,u);if(p.filterWidth===1&&p.filterHeight===1&&A.arraysEqual(p.inShape,p.outShape))return lr({inputs:{x:o},backend:r});let m=new Ks(p,"avg",!1);return r.runWebGLProgram(m,[o],"float32")}var DL={kernelName:Bg,backendName:"webgl",kernelFunc:Oee};function Dee(e){let{inputs:t,backend:r,attrs:n}=e,{x:o}=t,{filterSize:s,strides:i,pad:a,dimRoundingMode:u,dataFormat:c}=n,p=[1,1,1],m=U.computePool3DInfo(o.shape,s,i,p,a,u,c),h=new au(m,"avg",!1);return r.runWebGLProgram(h,[o],"float32")}var FL={kernelName:Mg,backendName:"webgl",kernelFunc:Dee};var n2=class{constructor(t){this.variableNames=["dy"],this.outputShape=t.inShape;let r=t.filterHeight,n=t.filterWidth,o=t.strideHeight,s=t.strideWidth,i=t.dilationHeight,a=t.dilationWidth,u=t.effectiveFilterHeight,c=t.effectiveFilterWidth,p=u-1-t.padInfo.top,m=c-1-t.padInfo.left,h=1/(r*n);this.userCode=`
      const ivec2 pads = ivec2(${p}, ${m});
      const float avgMultiplier = float(${h});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${u};
            wR += ${i}) {
          float dyR = float(dyRCorner + wR) / ${o}.0;

          if (dyR < 0.0 || dyR >= ${t.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${c};
            wC+= ${a}) {
            float dyC = float(dyCCorner + wC) / ${s}.0;

            if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);

            dotProd += dyValue * avgMultiplier;
          }
        }
        setOutput(dotProd);
      }
    `}},o2=class{constructor(t){this.variableNames=["dy"],this.outputShape=t.inShape;let r=t.filterDepth,n=t.filterHeight,o=t.filterWidth,s=t.strideDepth,i=t.strideHeight,a=t.strideWidth,u=t.dilationDepth,c=t.dilationHeight,p=t.dilationWidth,m=t.effectiveFilterDepth,h=t.effectiveFilterHeight,x=t.effectiveFilterWidth,y=m-1-t.padInfo.front,v=h-1-t.padInfo.top,w=x-1-t.padInfo.left,C=1/(r*n*o);this.userCode=`
      const ivec3 pads = ivec3(${y}, ${v}, ${w});
      const float avgMultiplier = float(${C});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${m};
            wD += ${u}) {
          float dyD = float(dyDCorner + wD) / ${s}.0;

          if (dyD < 0.0 || dyD >= ${t.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${h};
              wR += ${c}) {
            float dyR = float(dyRCorner + wR) / ${i}.0;

            if (dyR < 0.0 || dyR >= ${t.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${x};
                wC += ${p}) {
              float dyC = float(dyCCorner + wC) / ${a}.0;

              if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);

              dotProd += dyValue * avgMultiplier;
            }
          }
        }
        setOutput(dotProd);
      }
    `}};function Fee(e){let{inputs:t,backend:r,attrs:n}=e,{dy:o,input:s}=t,i=s,{filterSize:a,strides:u,pad:c,dimRoundingMode:p}=n,m=[1,1,1],h=U.computePool3DInfo(i.shape,a,u,m,c,p),x=new o2(h);return r.runWebGLProgram(x,[o],i.dtype)}var PL={kernelName:I4,backendName:"webgl",kernelFunc:Fee};function Pee(e){let{inputs:t,backend:r,attrs:n}=e,{dy:o,input:s}=t,i=s;Ni([o,s],"avgPoolGrad");let{filterSize:a,strides:u,pad:c}=n,p=U.computePool2DInfo(i.shape,a,u,1,c),m=new n2(p);return r.runWebGLProgram(m,[o],i.dtype)}var LL={kernelName:_4,backendName:"webgl",kernelFunc:Pee};function Lee(e){let{inputs:t,backend:r,attrs:n}=e,{a:o,b:s}=t,{transposeA:i,transposeB:a}=n;return Nl({a:o,b:s,transposeA:i,transposeB:a,backend:r})}var BL={kernelName:Ug,backendName:"webgl",kernelFunc:Lee};var s2=class{constructor(t,r,n,o,s,i){this.outputShape=[],this.variableNames=["x","mean","variance"],U.assertAndGetBroadcastShape(t,r),U.assertAndGetBroadcastShape(t,n);let a="0.0";o!=null&&(U.assertAndGetBroadcastShape(t,o),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");let u="1.0";s!=null&&(U.assertAndGetBroadcastShape(t,s),this.variableNames.push("scale"),u="getScaleAtOutCoords()"),this.outputShape=t,this.userCode=`
      void main() {
        float x = getXAtOutCoords();
        float mean = getMeanAtOutCoords();
        float variance = getVarianceAtOutCoords();
        float offset = ${a};
        float scale = ${u};
        float inv = scale * inversesqrt(variance + float(${i}));
        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));
      }
    `}};var i2=class{constructor(t,r,n,o,s,i){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],U.assertAndGetBroadcastShape(t,r),U.assertAndGetBroadcastShape(t,n);let a="vec4(0.0)";o!=null&&(U.assertAndGetBroadcastShape(t,o),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");let u="vec4(1.0)";s!=null&&(U.assertAndGetBroadcastShape(t,s),this.variableNames.push("scale"),u="getScaleAtOutCoords()"),this.outputShape=t,this.userCode=`
      void main() {
        vec4 offset = ${a};
        vec4 scale = ${u};

        vec4 x = getXAtOutCoords();
        vec4 mean = getMeanAtOutCoords();
        vec4 variance = getVarianceAtOutCoords();

        vec4 inv = scale * inversesqrt(variance + vec4(${i}));

        setOutput((x - mean) * inv + offset);
      }
    `}};var Bee=({inputs:e,backend:t,attrs:r})=>{let{x:n,mean:o,variance:s,offset:i,scale:a}=e;A.assert(o.shape.length===s.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),A.assert(i==null||o.shape.length===i.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),A.assert(a==null||o.shape.length===a.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");let{varianceEpsilon:u}=r;u==null&&(u=.001);let c=[n,o,s],p=null;i!=null&&(p=i.shape,c.push(i));let m=null;a!=null&&(m=a.shape,c.push(a));let h=z().getBool("WEBGL_PACK_NORMALIZATION")?new i2(n.shape,o.shape,s.shape,p,m,u):new s2(n.shape,o.shape,s.shape,p,m,u);return t.runWebGLProgram(h,c,c[0].dtype)},ML={kernelName:yx,backendName:"webgl",kernelFunc:Bee};var a2=class{constructor(t){this.variableNames=["source"],this.outputShape=t,this.rank=t.length;let r=Ke(this.rank);this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];let n=Mee(this.rank),o,s=t.map((i,a)=>`sourceLoc.${BC[a]} = start[${a}] + coords.${BC[a]};`);o=`
        ${r} sourceLoc;
        ${r} coords = getOutputCoords();
        ${s.join(`
`)}
      `,this.userCode=`
      void main() {
        ${o}
        setOutput(getSource(${n}));
      }
    `}},BC=["x","y","z","w","u","v"];function Mee(e){if(e===1)return"sourceLoc";if(e<=6)return BC.slice(0,e).map(t=>"sourceLoc."+t).join(",");throw Error(`Slicing for rank ${e} is not yet supported`)}var u2=class{constructor(t){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.rank=t.length,this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];let r=Ke(this.rank),n=ur("coords",this.rank),o=ur("sourceLoc",this.rank),s=this.rank===1?"sourceLoc":`vec2(${o.slice(-2).join()})`,i=`getChannel(getSource(${o.join()}), ${s})`,a=`
      result.x = ${i};
      if (++${n[this.rank-1]} < ${t[this.rank-1]}) {
        ++${o[this.rank-1]};
        result.y = ${i};
        --${o[this.rank-1]};
      }
    `,u=this.rank===1?"":`
      --${n[this.rank-1]};
      if (++${n[this.rank-2]} < ${t[this.rank-2]}) {
        ++${o[this.rank-2]};
        result.z = ${i};
        if (++${n[this.rank-1]} < ${t[this.rank-1]}) {
          ++${o[this.rank-1]};
          result.w = ${i};
        }
      }
    `,c=this.rank<=4?`sourceLoc = coords +
            ${r}(${t.map((p,m)=>`start[${m}]`).join()});`:t.map((p,m)=>`${o[m]} = ${n[m]} + start[${m}];`).join(`
`);this.userCode=`
      void main() {
        ${r} coords = getOutputCoords();
        ${r} sourceLoc;
        ${c}
        vec4 result = vec4(0.);
        ${a}
        ${u}
        setOutput(result);
      }
    `}};function Uee(e,t,r,n){let o=n.texData.get(e.dataId),s=n.makeTensorInfo(r,e.dtype),i=n.texData.get(s.dataId);Object.assign(i,o),i.refCount=1,i.shape=r,i.dtype=e.dtype;let a=Zn.computeFlatOffset(t,A.computeStrides(e.shape));o.slice&&(a+=o.slice.flatOffset),i.slice={flatOffset:a,origDataId:o.slice&&o.slice.origDataId||e.dataId};let u=n.dataRefCount.get(i.slice.origDataId)||1;return n.dataRefCount.set(i.slice.origDataId,u+1),s}function qs(e){let{inputs:t,backend:r,attrs:n}=e,{x:o}=t,{begin:s,size:i}=n,[a,u]=Zn.parseSliceParams(o,s,i);if(Zn.assertParamsValid(o,a,u),A.sizeFromShape(u)===0)return r.makeTensorInfo(u,o.dtype,[]);if(r.shouldExecuteOnCPU([o])||o.dtype==="string"){let m=r.texData.get(o.dataId),h=AP(m.values,a,u,o.shape,o.dtype);return r.makeTensorInfo(u,o.dtype,h)}let{isPacked:c}=r.texData.get(o.dataId),p=Zn.isSliceContinous(o.shape,a,u);if(c||!p){let m=z().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new u2(u):new a2(u),h=[a];return r.runWebGLProgram(m,[o],o.dtype,h)}return r.uploadToGPU(o.dataId),Uee(o,a,u,r)}var UL={kernelName:Rm,backendName:"webgl",kernelFunc:qs};var Vee=e=>{let{inputs:t,backend:r,attrs:n}=e,{x:o}=t,{blockShape:s,crops:i}=n;A.assert(o.shape.length<=4,()=>"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet");let a=s.reduce((I,D)=>I*D),u=U.getReshaped(o.shape,s,a),c=U.getPermuted(u.length,s.length),p=U.getReshapedPermuted(o.shape,s,a),m=U.getSliceBeginCoords(i,s.length),h=U.getSliceSize(p,i,s.length),x=[],y=pe({inputs:{x:o},backend:r,attrs:{shape:u}}),v=Ht({inputs:{x:y},backend:r,attrs:{perm:c}}),w=pe({inputs:{x:v},backend:r,attrs:{shape:p}}),C=qs({inputs:{x:w},backend:r,attrs:{begin:m,size:h}});return x.push(y),x.push(v),x.push(w),x.forEach(I=>r.disposeIntermediateTensorInfo(I)),C},VL={kernelName:Vg,backendName:"webgl",kernelFunc:Vee};function Gee(e){let{inputs:t,backend:r,attrs:n}=e,{x:o,weights:s}=t,{size:i}=n,a=r.readSync(o.dataId),u=r.readSync(s.dataId),c=Vy(a,u,s.dtype,s.shape,i);return r.makeTensorInfo([i],s.dtype,c)}var GL={kernelName:Gg,backendName:"webgl",kernelFunc:Gee};var Wee=`
  int r = int(a.r) & int(b.r);
  int g = int(a.g) & int(b.g);
  int rb = int(a.b) & int(b.b);
  int ra = int(a.a) & int(b.a);
  return vec4(r, g, rb, ra);
`,zee=`
  return float(int(a.r) & int(b.r));
`;function Hee(e){let{inputs:t,backend:r}=e,{a:n,b:o}=t,s=z().getBool("WEBGL_PACK_BINARY_OPERATIONS"),i=z().getNumber("WEBGL_VERSION");if(r.shouldExecuteOnCPU([n,o])||i===1){let u=r.texData.get(n.dataId).values,c=r.texData.get(o.dataId).values,[p,m]=JF(n.shape,o.shape,u,c,n.dtype),h=r.makeTensorInfo(m,n.dtype),x=r.texData.get(h.dataId);return x.values=p,h}let a;return s?a=new Co(Wee,n.shape,o.shape,!1):a=new eo(zee,n.shape,o.shape),r.runWebGLProgram(a,[n,o],n.dtype)}var WL={kernelName:Pc,backendName:"webgl",kernelFunc:Hee};function Kee(e){let{inputs:t,backend:r}=e,{s0:n,s1:o}=t,s=r.readSync(n.dataId),i=r.readSync(o.dataId),a=U.assertAndGetBroadcastShape(Array.from(s),Array.from(i));return r.makeTensorInfo([a.length],"int32",Int32Array.from(a))}var zL={kernelName:Wg,backendName:"webgl",kernelFunc:Kee};var qee="return float(a != b);",MC=bt({opSnippet:qee,cpuKernelImpl:vP,dtype:"bool"}),HL={kernelName:Zc,backendName:"webgl",kernelFunc:MC};function aa(e){let{inputs:t,backend:r}=e,{input:n}=t,o=r.texData.get(n.dataId);return lr({inputs:{x:o.complexTensorInfos.real},backend:r})}var KL={kernelName:$m,backendName:"webgl",kernelFunc:aa};var jee="return float(int(x));";function qL(e,t){let r=new Qr(e.shape,jee),n=t.runWebGLProgram(r,[e],"int32");return{dataId:n.dataId,shape:n.shape,dtype:n.dtype}}function UC(e){let{inputs:t,backend:r,attrs:n}=e,{x:o}=t,{dtype:s}=n;if(s==="complex64"){if(o.dtype==="complex64")return lr({inputs:{x:o},backend:r});let i=ys(o.shape),a=UC({inputs:{x:o},backend:r,attrs:{dtype:"float32"}}),u=to({inputs:{real:a,imag:i},backend:r});return i.dispose(),r.disposeIntermediateTensorInfo(a),u}if(o.dtype==="complex64"){let i=aa({inputs:{input:o},backend:r}),a=UC({inputs:{x:i},backend:r,attrs:{dtype:s}});return r.disposeIntermediateTensorInfo(i),a}if(!A.hasEncodingLoss(o.dtype,s)){let i=lr({inputs:{x:o},backend:r});return{dataId:i.dataId,shape:i.shape,dtype:s}}if(r.shouldExecuteOnCPU([o])){let i=r.texData.get(o.dataId).values,[a,u,c]=eP(i,o.shape,o.dtype,s);return r.makeTensorInfo(a,u,c)}if(s==="int32")return qL(o,r);if(s==="bool"){let i=r.makeTensorInfo([],"bool",A.getTypedArrayFromDType("bool",1)),u=MC({inputs:{a:o,b:i},backend:r});return r.disposeIntermediateTensorInfo(i),u}throw new Error(`Error in Cast: failed to cast ${o.dtype} to ${s}`)}var jL={kernelName:zu,backendName:"webgl",kernelFunc:UC};var XL="return ceil(x);",Xee=_e({opSnippet:XL,packedOpSnippet:XL,cpuKernelImpl:tP}),YL={kernelName:Lc,backendName:"webgl",kernelFunc:Xee};var l2=class{constructor(t){this.variableNames=["A"],this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=t,this.userCode=`

      void main() {
        float value = getAAtOutCoords();
        if (isnan(value)) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, minVal, maxVal));
      }
    `}};var c2=class{constructor(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=t,this.userCode=`
      void main() {
        vec4 value = getAAtOutCoords();

        if (any(isnan(value))) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));
      }
    `}};function Yee(e){let{inputs:t,backend:r,attrs:n}=e,{x:o}=t,{clipValueMin:s,clipValueMax:i}=n,a;z().getBool("WEBGL_PACK_CLIP")?a=new c2(o.shape):a=new l2(o.shape);let u=[[s],[i]];return r.runWebGLProgram(a,[o],o.dtype,u)}var ZL={kernelName:zg,backendName:"webgl",kernelFunc:Yee};var p2=class{constructor(t){this.variableNames=["real","imag"],this.outputShape=t,this.userCode=`
      void main() {
        float re = abs(getRealAtOutCoords());
        float im = abs(getImagAtOutCoords());
        float mx = max(re, im);

        // sadly the length function in glsl is not underflow-safe
        // (at least not on Intel GPUs). So the safe solution is
        // to ensure underflow-safety in all cases.
        setOutput(
          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))
        );
      }
    `}};function QL(e,t){return{dataId:t.dataId,dtype:t.dtype,shape:e.shape}}function Zee(e){let{inputs:t,backend:r}=e,{x:n}=t,o=r.texData.get(n.dataId),s=new p2(n.shape),i=[QL(n,o.complexTensorInfos.real),QL(n,o.complexTensorInfos.imag)];return r.runWebGLProgram(s,i,i[0].dtype)}var JL={kernelName:Hg,backendName:"webgl",kernelFunc:Zee};var f2=class{constructor(t){this.outputShape=[],this.outputShape=U.computeOutShape(t,1),this.variableNames=t.map((i,a)=>`T${a}`);let r=new Array(t.length-1);r[0]=t[0][1];for(let i=1;i<r.length;i++)r[i]=r[i-1]+t[i][1];let n=[`if (yC < ${r[0]}) setOutput(getT0(yR, yC));`];for(let i=1;i<r.length;i++){let a=r[i-1];n.push(`else if (yC < ${r[i]}) setOutput(getT${i}(yR, yC-${a}));`)}let o=r.length,s=r[r.length-1];n.push(`else setOutput(getT${o}(yR, yC-${s}));`),this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int yR = coords.x;
        int yC = coords.y;

        ${n.join(`
        `)}
      }
    `}};var h2=class{constructor(t,r){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=U.computeOutShape(t,r);let n=this.outputShape,o=n.length,s=Ke(o),i=ur("coords",o),a=["x","y","z","w","u","v"].slice(0,o);this.variableNames=t.map((v,w)=>`T${w}`);let u=new Array(t.length-1);u[0]=t[0][r];for(let v=1;v<u.length;v++)u[v]=u[v-1]+t[v][r];let c=a[r],p=a.slice(-2),m=a.join(),h=`if (${c} < ${u[0]}) {
        return getChannel(
            getT0(${m}), vec2(${p.join()}));
        }`;for(let v=1;v<u.length;v++){let w=u[v-1];h+=`
        if (${c} < ${u[v]}  && ${c} >= ${u[v-1]}) {
          return getChannel(
            getT${v}(${m2(a,c,w)}),
            vec2(${m2(p,c,w)}));
        }`}let x=u.length,y=u[u.length-1];h+=`
        return getChannel(
          getT${x}(${m2(a,c,y)}),
          vec2(${m2(p,c,y)}));`,this.userCode=`
      float getValue(${a.map(v=>"int "+v)}) {
        ${h}
      }

      void main() {
        ${s} coords = getOutputCoords();
        vec4 result = vec4(getValue(${i}), 0., 0., 0.);

        ${i[o-1]} = ${i[o-1]} + 1;
        if (${i[o-1]} < ${n[o-1]}) {
          result.g = getValue(${i});
        }

        ${i[o-2]} = ${i[o-2]} + 1;
        if (${i[o-2]} < ${n[o-2]}) {
          result.a = getValue(${i});
        }

        ${i[o-1]} = ${i[o-1]} - 1;
        if (${i[o-2]} < ${n[o-2]} &&
            ${i[o-1]} < ${n[o-1]}) {
          result.b = getValue(${i});
        }
        setOutput(result);
      }
    `}};function m2(e,t,r){let n=e.indexOf(t);return e.map((s,i)=>i===n?`${s} - ${r}`:s).join()}function _l(e){let{inputs:t,backend:r}=e,{input:n}=t,o=r.texData.get(n.dataId);return lr({inputs:{x:o.complexTensorInfos.imag},backend:r})}var e6={kernelName:Tx,backendName:"webgl",kernelFunc:_l};function Up(e,t,r){let n=e[0].dtype;if(n==="complex64"){let x=e.map(I=>aa({inputs:{input:I},backend:r})),y=e.map(I=>_l({inputs:{input:I},backend:r})),v=Up(x,t,r),w=Up(y,t,r),C=to({inputs:{real:v,imag:w},backend:r});return x.forEach(I=>r.disposeIntermediateTensorInfo(I)),y.forEach(I=>r.disposeIntermediateTensorInfo(I)),r.disposeIntermediateTensorInfo(v),r.disposeIntermediateTensorInfo(w),C}let o=r.shouldExecuteOnCPU(e);if(n==="string"&&(o=!0),o){let x=e.map(P=>{let q=[-1,A.sizeFromShape(P.shape.slice(t))];return pe({inputs:{x:P},backend:r,attrs:{shape:q}})}),y=x.map(P=>({vals:r.readSync(P.dataId),shape:P.shape})),v=U.computeOutShape(x.map(P=>P.shape),1),w=x[0].shape[0]===1,C=rP(y,v,n,w),I=U.computeOutShape(e.map(P=>P.shape),t),D=r.makeTensorInfo(I,n,C);return x.forEach(P=>r.disposeIntermediateTensorInfo(P)),D}let s=e.filter(x=>A.sizeFromShape(x.shape)>0),i=z().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&s[0].shape.length>1;if(s.length===1){let x=i?new Qr(e[0].shape,_i):new Jn(e[0].shape,_i);return r.runWebGLProgram(x,e,n)}let a=z().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER");if(s.length>a){let x=[];for(let v=0;v<s.length;v+=a){let w=s.slice(v,v+a);x.push(Up(w,t,r))}let y=Up(x,t,r);for(let v of x)r.disposeIntermediateTensorInfo(v);return y}if(i){let x=new h2(s.map(y=>y.shape),t);return r.runWebGLProgram(x,s,n)}let{tensors2D:u,outShape:c}=Qee(s,t,r),p=new f2(u.map(x=>x.shape)),m=r.runWebGLProgram(p,u,n);u.forEach(x=>r.disposeIntermediateTensorInfo(x));let h=pe({inputs:{x:m},attrs:{shape:c},backend:r});return r.disposeIntermediateTensorInfo(m),h}function Qee(e,t,r){let n=U.computeOutShape(e.map(s=>s.shape),t);return{tensors2D:e.map(s=>pe({inputs:{x:s},attrs:{shape:[-1,A.sizeFromShape(s.shape.slice(t))]},backend:r})),outShape:n}}function VC(e){let{inputs:t,backend:r,attrs:n}=e,{axis:o}=n,s=A.parseAxisParam(o,t[0].shape)[0],i=t.map(c=>c.shape);U.assertParamsConsistent(i,s);let a=U.computeOutShape(t.map(c=>c.shape),s);if(A.sizeFromShape(a)===0)return r.makeTensorInfo(a,t[0].dtype,[]);let u=t.filter(c=>A.sizeFromShape(c.shape)>0);return u.length===1?lr({inputs:{x:u[0]},backend:r}):Up(u,s,r)}var t6={kernelName:Kg,backendName:"webgl",kernelFunc:VC};var Vp=class{constructor(t,r=!1,n=null,o=!1,s=!1){this.variableNames=["x","W"],this.outputShape=t.outShape;let i=t.padInfo.top,a=t.padInfo.left,u=t.strideHeight,c=t.strideWidth,p=t.dilationHeight,m=t.dilationWidth,h=t.filterHeight,x=t.filterWidth,y=Math.floor(t.inChannels/4)*4,v=t.inChannels%4,w=t.dataFormat==="channelsLast",C=w?1:2,I=w?2:3,D=w?3:1,P="",G="";n&&(o?P=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${n}
        }`:s?P=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${n}
        }`:P=`
          float activation(float x) {
            ${n}
          }
        `,G="result = activation(result);");let q=r?"result += getBiasAtOutCoords();":"";r&&this.variableNames.push("bias"),o&&this.variableNames.push("preluActivationWeights"),s&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${P}

      const ivec2 strides = ivec2(${u}, ${c});
      const ivec2 pads = ivec2(${i}, ${a});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d2 = coords[${D}];

        ivec2 xRCCorner =
            ivec2(coords[${C}], coords[${I}]) * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${h}; wR++) {
          int xR = xRCorner + wR * ${p};

          if (xR < 0 || xR >= ${t.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${x}; wC++) {
            int xC = xCCorner + wC * ${m};

            if (xC < 0 || xC >= ${t.inWidth}) {
              continue;
            }

            for (int d1 = 0; d1 < ${y}; d1 += 4) {
              vec4 wValues = vec4(
                getW(wR, wC, d1, d2),
                getW(wR, wC, d1 + 1, d2),
                getW(wR, wC, d1 + 2, d2),
                getW(wR, wC, d1 + 3, d2)
              );

              if (${w}) {
                vec4 xValues = vec4(
                  getX(batch, xR, xC, d1),
                  getX(batch, xR, xC, d1 + 1),
                  getX(batch, xR, xC, d1 + 2),
                  getX(batch, xR, xC, d1 + 3)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec4 xValues = vec4(
                  getX(batch, d1, xR, xC),
                  getX(batch, d1 + 1, xR, xC),
                  getX(batch, d1 + 2, xR, xC),
                  getX(batch, d1 + 3, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }
            }

            if (${v===1}) {

              if (${w}) {
                dotProd +=
                    getX(batch, xR, xC, ${y}) *
                    getW(wR, wC, ${y}, d2);
              } else {
                dotProd +=
                    getX(batch, ${y}, xR, xC) *
                    getW(wR, wC, ${y}, d2);
              }

            } else if (${v===2}) {
              vec2 wValues = vec2(
                getW(wR, wC, ${y}, d2),
                getW(wR, wC, ${y} + 1, d2)
              );

              if (${w}) {
                vec2 xValues = vec2(
                  getX(batch, xR, xC, ${y}),
                  getX(batch, xR, xC, ${y} + 1)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec2 xValues = vec2(
                  getX(batch, ${y}, xR, xC),
                  getX(batch, ${y} + 1, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            } else if (${v===3}) {
              vec3 wValues = vec3(
                getW(wR, wC, ${y}, d2),
                getW(wR, wC, ${y} + 1, d2),
                getW(wR, wC, ${y} + 2, d2)
              );

              if (${w}) {
                vec3 xValues = vec3(
                  getX(batch, xR, xC, ${y}),
                  getX(batch, xR, xC, ${y} + 1),
                  getX(batch, xR, xC, ${y} + 2)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec3 xValues = vec3(
                  getX(batch, ${y}, xR, xC),
                  getX(batch, ${y} + 1, xR, xC),
                  getX(batch, ${y} + 2, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            }
          }
        }

        float result = dotProd;
        ${q}
        ${G}
        setOutput(result);
      }
    `}},d2=class{constructor(t){this.variableNames=["x","W"],this.outputShape=t.outShape;let r=t.padInfo.front,n=t.padInfo.top,o=t.padInfo.left,s=t.strideDepth,i=t.strideHeight,a=t.strideWidth,u=t.dilationDepth,c=t.dilationHeight,p=t.dilationWidth,m=t.filterDepth,h=t.filterHeight,x=t.filterWidth,y=Math.floor(t.inChannels/4)*4,v=t.inChannels%4;this.userCode=`
      const ivec3 strides = ivec3(${s}, ${i}, ${a});
      const ivec3 pads = ivec3(${r}, ${n}, ${o});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d2 = coords.u;

        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xFCorner = xFRCCorner.x;
        int xRCorner = xFRCCorner.y;
        int xCCorner = xFRCCorner.z;

        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get
        // y(yF, yR, yC, d2). ? = to be determined. : = across all
        // values in that axis.
        float dotProd = 0.0;
        for (int wF = 0; wF < ${m}; wF++) {
          int xF = xFCorner + wF * ${u};

          if (xF < 0 || xF >= ${t.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${h}; wR++) {
            int xR = xRCorner + wR * ${c};

            if (xR < 0 || xR >= ${t.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${x}; wC++) {
              int xC = xCCorner + wC * ${p};

              if (xC < 0 || xC >= ${t.inWidth}) {
                continue;
              }

              for (int d1 = 0; d1 < ${y}; d1 += 4) {
                vec4 xValues = vec4(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                vec4 wValues = vec4(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (${v===1}) {
                dotProd +=
                  getX(batch, xF, xR, xC, ${y}) *
                  getW(wF, wR, wC, ${y}, d2);
              } else if (${v===2}) {
                vec2 xValues = vec2(
                  getX(batch, xF, xR, xC, ${y}),
                  getX(batch, xF, xR, xC, ${y} + 1)
                );
                vec2 wValues = vec2(
                  getW(wF, wR, wC, ${y}, d2),
                  getW(wF, wR, wC, ${y} + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (${v===3}) {
                vec3 xValues = vec3(
                  getX(batch, xF, xR, xC, ${y}),
                  getX(batch, xF, xR, xC, ${y} + 1),
                  getX(batch, xF, xR, xC, ${y} + 2)
                );
                vec3 wValues = vec3(
                  getW(wF, wR, wC, ${y}, d2),
                  getW(wF, wR, wC, ${y} + 1, d2),
                  getW(wF, wR, wC, ${y} + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}};var Gp=class{constructor(t,r=!1,n=null,o=!1,s=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=t.outShape,this.enableShapeUniforms=Ct(this.outputShape.length);let i=t.padInfo.left,a=t.strideWidth,u=t.dilationWidth,c=t.filterHeight,p=t.filterWidth,m=p,h=`
       int xR; int xC; int xCOffset;
       vec4 wTexel; vec4 previous; vec4 final;`;for(let w=0;w<p;w++)h+=`
           vec4 xTexelC${w*2};
           int xTexelC${w*2}Ready;
           vec4 xTexelC${w*2+1};
           int xTexelC${w*2+1}Ready;
           vec4 xC${w};`;h+=`
     for (int r = 0; r < ${c}; r++) {
      for (int d1 = 0; d1 < ${t.inChannels}; d1 += 2) {
       `;for(let w=0;w<p;w++)h+=`
           xTexelC${w*2} = vec4(0.0);
           xTexelC${w*2}Ready = 0;
           xTexelC${w*2+1} = vec4(0.0);
           xTexelC${w*2+1}Ready = 0;
           xC${w} = vec4(0.0);`;h+=`
         xR = xRCorner + r * dilations[0];
         if (xR >=0 && xR < inDims[0]) {
       `;for(let w=0;w<(m+1)/2;w++){let C=w*2;if(h+=`
           xC = xCCorner + ${C*u};
           `,a===1){if(C<p&&(i%2===1?(h+=`
                 xCOffset = xC + 1;
                 if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${C}Ready == 0) {
                   xTexelC${C} = getX(batch, xR, xCOffset, d1);

                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${C}.zw = vec2(0.0);
                   }
                   xTexelC${C}Ready = 1;
                 }
               `,u===1&&C>0?h+=`
                 xC${C} = vec4(xTexelC${C-2}.zw, xTexelC${C}.xy);
                 `:h+=`
                   xCOffset = xC + 1 - 2;

                   if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       previous.zw = vec2(0.0);
                     }

                     xC${C} = vec4(previous.zw, xTexelC${C}.xy);
                   } else {
                     xC${C} = vec4(0.0, 0.0, xTexelC${C}.xy);
                   }
                   `):h+=`
                 if (xC >= 0 && xC < inDims[1] && xTexelC${C}Ready == 0) {
                   xTexelC${C} = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC${C}.zw = vec2(0.0);
                   }
                   xTexelC${C}Ready = 1;
                 }

                 xC${C} = xTexelC${C};
                 `,C+1<p)){let I=i%2===0?A.nearestLargerEven(u):u;u%2===0&&i%2===1||u%2!==0&&i%2!==1?(h+=`
                   xCOffset = xC + imod(pads[1], 2) + ${I};

                   if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${C+1}Ready == 0) {
                     xTexelC${C+1} = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       xTexelC${C+1}.zw = vec2(0.0);
                     }
                     xTexelC${C+1}Ready = 1;
                   }
                   `,u>1?h+=`
                     xCOffset -= 2;
                     if (xCOffset >= 0 && xCOffset < inDims[1]) {
                      previous = getX(batch, xR, xCOffset, d1);
                      xC${C+1} = vec4(previous.zw, xTexelC${C+1}.xy);
                     } else {
                      xC${C+1} = vec4(0.0, 0.0, xTexelC${C+1}.xy);
                     }
                     `:h+=`
                     xC${C+1} = vec4(xTexelC${C}.zw, xTexelC${C+1}.xy);
                     `):I===1?h+=`
                     xC${C+1} = xTexelC${C};
                     `:h+=`
                     xCOffset = xC + ${I};

                     if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${C+1}Ready == 0) {
                       xTexelC${C+1} = getX(batch, xR, xCOffset, d1);
                       if (xCOffset + 1 >= inDims[1]) {
                         xTexelC${C+1}.zw = vec2(0.0);
                       }
                       xTexelC${C+1}Ready = 1;
                     }

                     xC${C+1} = xTexelC${C+1};
                     `}}else C<p&&(i%2===1?(h+=`
                 xCOffset = xC + 1 - strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${C}Ready == 0) {
                   xTexelC${C} = getX(batch, xR, xCOffset, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${C}.zw = vec2(0.0);
                   }
                   xTexelC${C}Ready = 1;
                 }

                 if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${C+1}Ready == 0) {
                   xTexelC${C+1} = getX(batch, xR, xC + 1, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xC + 2 >= inDims[1]) {
                     xTexelC${C+1}.zw = vec2(0.0);
                   }
                   xTexelC${C+1}Ready = 1;
                 }

                 xC${C} = vec4(xTexelC${C}.zw, xTexelC${C+1}.zw);
               `,C+1<p&&(h+=`
                   final = vec4(0.0);
                   xCOffset = xC + 1 + strides[1];
                   if(xCOffset >= 0 && xCOffset < inDims[1]) {
                     final = getX(batch, xR, xCOffset, d1);
                   }
                   xC${C+1} = vec4(xTexelC${C+1}.xy, final.xy);
                 `)):(h+=`
                 if(xC >= 0 && xC < inDims[1] && xTexelC${C}Ready == 0) {
                   xTexelC${C} = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC${C}.zw = vec2(0.0);
                   }
                   xTexelC${C}Ready = 1;
                 }

                 xCOffset = xC + strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${C+1}Ready == 0) {
                   xTexelC${C+1} = getX(batch, xR, xCOffset, d1);
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${C+1}.zw = vec2(0.);
                   }
                   xTexelC${C+1}Ready = 1;
                 }

                 xC${C} = vec4(
                   xTexelC${C}.xy, xTexelC${C+1}.xy);
               `,C+1<p&&(h+=`
                   xC${C+1} = vec4(xTexelC${C}.zw, xTexelC${C+1}.zw);
                 `)));C<p&&(h+=`
             wTexel = getW(r, ${C}, d1, d2);
             dotProd += xC${C}.xxzz * vec4(wTexel.xy, wTexel.xy);
             if(d1 + 1 < ${t.inChannels}) {
               dotProd += xC${C}.yyww * vec4(wTexel.zw, wTexel.zw);
             }
           `,C+1<p&&(h+=`
               wTexel = getW(r, ${C+1}, d1, d2);
               dotProd += xC${C+1}.xxzz * vec4(wTexel.xy, wTexel.xy);
               if(d1 + 1 < ${t.inChannels}) {
                 dotProd += xC${C+1}.yyww * vec4(wTexel.zw, wTexel.zw);
               }
             `))}h+=`
     }
   `,h+=`
     }
   `,h+=`
     }
   `;let x="",y="";n&&(o?x=`vec4 activation(vec4 a) {
           vec4 b = getPreluActivationWeightsAtOutCoords();
           ${n}
         }`:s?x=`vec4 activation(vec4 a) {
           vec4 b = getLeakyreluAlphaAtOutCoords();
           ${n}
         }`:x=`vec4 activation(vec4 x) {
           ${n}
         }`,y="result = activation(result);");let v=r?"result += getBiasAtOutCoords();":"";r&&this.variableNames.push("bias"),o&&this.variableNames.push("preluActivationWeights"),s&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
       ${x}

       void main() {
         ivec4 coords = getOutputCoords();
         int batch = coords.x;
         ivec2 xRCCorner = coords.yz * strides - pads;
         int d2 = coords.w;
         int xRCorner = xRCCorner.x;
         int xCCorner = xRCCorner.y;

         //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
         vec4 dotProd = vec4(0.000000000000001);

         ${h}

         vec4 result = dotProd - vec4(0.000000000000001);
         ${v}
         ${y}
         setOutput(result);
       }
     `}};var g2=class{constructor(t,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec4"},{name:"pad",type:"ivec2"},{name:"stride",type:"ivec2"},{name:"dilation",type:"ivec2"},{name:"inChannels",type:"int"},{name:"itemsPerBlockRow",type:"int"},{name:"outWidth",type:"int"}],this.outputShape=t,this.enableShapeUniforms=Ct(this.outputShape.length);let{dataFormat:n}=r,o=Jt(),s=n==="channelsLast",i=s?1:2,a=s?2:3,u=this.enableShapeUniforms?"if(blockIndex < outShape[2] && pos < outShape[1]) {":`if(blockIndex < ${t[2]} && pos < ${t[1]}) {`,c="";for(let p=0;p<=1;p++)for(let m=0;m<=1;m++)c+=`
          blockIndex = rc.z + ${m};
          pos = rc.y + ${p};

          ${u}
            offsetY = int(blockIndex / outWidth) * stride[0] - pad[0];
            d0 = offsetY + dilation[0] * (pos / itemsPerBlockRow);

            if(d0 < inputShape[${i}] && d0 >= 0) {
              // Use custom imod instead mod. On Intel GPU, mod may generate
              // unexpected value.
              // https://github.com/tensorflow/tfjs/issues/5447
              offsetX = imod(blockIndex, outWidth) * stride[1] - pad[1];
              d1 = offsetX + dilation[1] * (imod(pos, itemsPerBlockRow) /
                  inChannels);

              if(d1 < inputShape[${a}] && d1 >= 0) {

                ch = imod(pos, inChannels);

                if (${s}) {
                  innerDims = vec2(d1, ch);
                  result[${p*2+m}] = getChannel(
                    getA(rc.x, d0, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                } else {
                  innerDims = vec2(d0, d1);
                  result[${p*2+m}] = getChannel(
                    getA(rc.x, ch, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                }
              }
            }
          }
        `;this.userCode=`
      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0);

        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;
        vec2 innerDims;

        ${c}

        ${o.output} = result;
      }
    `}};function x2(e,t){let r=e.length;return r>=3?t?[...e.slice(0,-3),e[r-3]*e[r-2],e[r-1]]:[...e.slice(0,-3),e[r-3],e[r-2]*e[r-1]]:!t&&r===1&&e[0]>1?[e[0],1]:null}function y2({x:e,filter:t,convInfo:r,backend:n,bias:o=null,preluActivationWeights:s=null,leakyreluAlpha:i=0,activation:a=null}){let u=e.shape,c=n.texData.get(e.dataId),p=r.inChannels,m=u[0]*u[1]*u[2],h=r.outChannels,x=r.dataFormat==="channelsLast",y=!1,v=!1,w,C=[];if(s!=null){let P=x2(s.shape,x);P!=null&&(s=pe({inputs:{x:s},backend:n,attrs:{shape:P}}),C.push(s))}if(o!=null){let P=x2(o.shape,x);P!=null&&(o=pe({inputs:{x:o},backend:n,attrs:{shape:P}}),C.push(o))}if(!((m===1||h===1)&&p>LC)&&c.isPacked&&x&&c.texture!=null&&u[2]%2!==0&&A.arraysEqual(c.shape.slice(-3),u.slice(-3))){let P=u[0]*u[1]*(u[2]+1),G={dataId:e.dataId,shape:[1,P,r.inChannels],dtype:e.dtype},q=c.shape;c.shape=c.shape.slice(),c.shape[c.shape.length-2]++,A.assert(wl(c.shape,G.shape),()=>`packed reshape ${c.shape} to ${G.shape} isn't free`);let Z=pe({inputs:{x:t},backend:n,attrs:{shape:[1,r.inChannels,r.outChannels]}});C.push(Z);let Y=Nl({a:G,b:Z,backend:n,transposeA:y,transposeB:v,bias:o,activation:a,preluActivationWeights:s,leakyreluAlpha:i}),te=n.texData.get(Y.dataId);A.assert(te.isPacked,()=>"batchMatMul result is expected to be packed"),c.shape=q,te.shape=r.outShape,w=lr({inputs:{x:Y},backend:n}),w.shape=r.outShape,C.push(Y)}else{let P=r.outHeight*r.outWidth,G=pe({inputs:{x:e},backend:n,attrs:{shape:x?[r.batchSize,P,r.inChannels]:[r.batchSize,r.inChannels,P]}}),q=pe({inputs:{x:t},backend:n,attrs:{shape:[1,r.inChannels,r.outChannels]}}),Z=Nl({a:x?G:q,b:x?q:G,transposeA:!x,transposeB:v,backend:n,bias:o,activation:a,preluActivationWeights:s,leakyreluAlpha:i});w=pe({inputs:{x:Z},backend:n,attrs:{shape:r.outShape}}),C.push(G),C.push(q),C.push(Z)}for(let P of C)n.disposeIntermediateTensorInfo(P);return w}function b2({x:e,filter:t,convInfo:r,backend:n,bias:o=null,preluActivationWeights:s=null,leakyreluAlpha:i=0,activation:a=null}){let{filterWidth:u,filterHeight:c,inChannels:p,outWidth:m,outHeight:h,dataFormat:x}=r,y=x==="channelsLast",v=u*c*p,w=h*m,C=[r.batchSize,v,w],I=!0,D=!1,P=[];if(s!=null){let fe=x2(s.shape,y);fe!=null&&(s=pe({inputs:{x:s},backend:n,attrs:{shape:fe}}),P.push(s))}if(o!=null){let fe=x2(o.shape,y);fe!=null&&(o=pe({inputs:{x:o},backend:n,attrs:{shape:fe}}),P.push(o))}let G=pe({inputs:{x:t},backend:n,attrs:{shape:[1,v,A.sizeFromShape(t.shape)/v]}});P.push(G);let q=new g2(C,r),Z=[e.shape,[r.padInfo.top,r.padInfo.left],[r.strideHeight,r.strideWidth],[r.dilationHeight,r.dilationWidth],[r.inChannels],[r.filterWidth*r.inChannels],[r.outWidth]],Y=n.runWebGLProgram(q,[e],"float32",Z),te=pe({inputs:{x:Y},backend:n,attrs:{shape:C}});P.push(Y),P.push(te);let J=o!=null,ae=s!=null,ge=a==="leakyrelu",ke=a?ia(a,!0):null,We=new Mp(y?te.shape:G.shape,y?G.shape:te.shape,y?[r.batchSize,w,r.outChannels]:[r.batchSize,r.outChannels,w],I,D,J,ke,ae,ge),Re=y?[te,G]:[G,te];if(o&&Re.push(o),ae&&Re.push(s),ge){let fe=n.makeTensorInfo([],"float32",A.createScalarValue(i,"float32"));Re.push(fe),P.push(fe)}let ct=n.runWebGLProgram(We,Re,"float32"),oe=pe({inputs:{x:ct},backend:n,attrs:{shape:r.outShape}});P.push(ct);for(let fe of P)n.disposeIntermediateTensorInfo(fe);return oe}function Jee(e){let{inputs:t,backend:r,attrs:n}=e,{x:o,filter:s}=t,{strides:i,pad:a,dataFormat:u,dilations:c,dimRoundingMode:p}=n,m=U.convertConv2DDataFormat(u),h=U.computeConv2DInfo(o.shape,s.shape,i,c,a,p,!1,m),x;if(h.filterHeight===1&&h.filterWidth===1&&h.dilationHeight===1&&h.dilationWidth===1&&h.strideHeight===1&&h.strideWidth===1&&(h.padInfo.type==="SAME"||h.padInfo.type==="VALID"))x=y2({x:o,filter:s,convInfo:h,backend:r});else if(h.strideWidth<=2&&m==="channelsLast"&&z().getBool("WEBGL_EXP_CONV")){let v=new Gp(h),w=[[h.padInfo.top,h.padInfo.left],[h.strideHeight,h.strideWidth],[h.dilationHeight,h.dilationWidth],[h.inHeight,h.inWidth]];x=r.runWebGLProgram(v,[o,s],"float32",w)}else if(z().getBool("WEBGL_CONV_IM2COL"))x=b2({x:o,filter:s,convInfo:h,backend:r});else{let v=new Vp(h);x=r.runWebGLProgram(v,[o,s],"float32")}let y=pe({inputs:{x},backend:r,attrs:{shape:h.outShape}});return r.disposeIntermediateTensorInfo(x),y}var r6={kernelName:qg,backendName:"webgl",kernelFunc:Jee};var v2=class{constructor(t){this.variableNames=["x","dy"],this.outputShape=t.filterShape;let r=t.strideHeight,n=t.strideWidth,o=t.padInfo.top,s=t.padInfo.left,i=t.dataFormat==="channelsLast";this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int d2 = coords.w;

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int b = 0; b < ${t.batchSize}; b++) {
          for (int yR = 0; yR < ${t.outHeight}; yR++) {
            int xR = wR + yR * ${r} - ${o};

            if (xR < 0 || xR >= ${t.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${t.outWidth}; yC++) {
              int xC = wC + yC * ${n} - ${s};

              if (xC < 0 || xC >= ${t.inWidth}) {
                continue;
              }

              ${i?`float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);`:`float dyValue = getDy(b, d2, yR, yC);
              float xValue = getX(b, d1, xR, xC);
              dotProd += (xValue * dyValue);`}
            }
          }
        }
        setOutput(dotProd);
      }
    `}},w2=class{constructor(t){this.variableNames=["dy","W"],this.outputShape=t.inShape;let r=t.filterHeight,n=t.filterWidth,o=t.strideHeight,s=t.strideWidth,i=t.dataFormat==="channelsLast",a=r-1-t.padInfo.top,u=n-1-t.padInfo.left,c=i?1:2,p=i?2:3,m=i?3:1;this.userCode=`
      const ivec2 pads = ivec2(${a}, ${u});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[${m}];

        ivec2 dyCorner = ivec2(coords[${c}], coords[${p}]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${r}; wR++) {
          float dyR = float(dyRCorner + wR) / ${o}.0;

          if (dyR < 0.0 || dyR >= ${t.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${r} - 1 - wR;

          for (int wC = 0; wC < ${n}; wC++) {
            float dyC = float(dyCCorner + wC) / ${s}.0;

            if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${n} - 1 - wC;

            for (int d2 = 0; d2 < ${t.outChannels}; d2++) {

              if (${i}) {
                float xValue = getDy(batch, idyR, idyC, d2);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              } else {
                float xValue = getDy(batch, d2, idyR, idyC);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `}},T2=class{constructor(t){this.variableNames=["x","dy"],this.outputShape=t.filterShape;let r=t.strideDepth,n=t.strideHeight,o=t.strideWidth,s=t.padInfo.front,i=t.padInfo.top,a=t.padInfo.left;this.userCode=`
      void main() {
        ivec5 coords = getOutputCoords();
        int wF = coords.x;
        int wR = coords.y;
        int wC = coords.z;
        int d1 = coords.w;
        int d2 = coords.u;

        float dotProd = 0.0;

        for (int b = 0; b < ${t.batchSize}; b++) {
          for (int yF = 0; yF < ${t.outDepth}; yF++) {
            int xF = wF + yF * ${r} - ${s};

            if (xF < 0 || xF >= ${t.inDepth}) {
              continue;
            }

            for (int yR = 0; yR < ${t.outHeight}; yR++) {
              int xR = wR + yR * ${n} - ${i};

              if (xR < 0 || xR >= ${t.inHeight}) {
                continue;
              }

              for (int yC = 0; yC < ${t.outWidth}; yC++) {
                int xC = wC + yC * ${o} - ${a};

                if (xC < 0 || xC >= ${t.inWidth}) {
                  continue;
                }

                float dyValue = getDy(b, yF, yR, yC, d2);
                float xValue = getX(b, xF, xR, xC, d1);
                dotProd += (xValue * dyValue);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}},S2=class{constructor(t){this.variableNames=["dy","W"],this.outputShape=t.inShape;let r=t.filterDepth,n=t.filterHeight,o=t.filterWidth,s=t.strideDepth,i=t.strideHeight,a=t.strideWidth,u=r-1-t.padInfo.front,c=n-1-t.padInfo.top,p=o-1-t.padInfo.left;this.userCode=`
      const ivec3 pads = ivec3(${u}, ${c}, ${p});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.u;


        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyFCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        float dotProd = 0.0;
        for (int wF = 0; wF < ${r}; wF++) {
          float dyF = float(dyFCorner + wF) / ${s}.0;

          if (dyF < 0.0 || dyF >= ${t.outDepth}.0 || fract(dyF) > 0.0) {
            continue;
          }
          int idyF = int(dyF);

          int wFPerm = ${r} - 1 - wF;

          for (int wR = 0; wR < ${n}; wR++) {
            float dyR = float(dyRCorner + wR) / ${i}.0;

            if (dyR < 0.0 || dyR >= ${t.outHeight}.0 ||
              fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            int wRPerm = ${n} - 1 - wR;

            for (int wC = 0; wC < ${o}; wC++) {
              float dyC = float(dyCCorner + wC) / ${a}.0;

              if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              int wCPerm = ${o} - 1 - wC;

              for (int d2 = 0; d2 < ${t.outChannels}; d2++) {
                float xValue = getDy(batch, idyF, idyR, idyC, d2);
                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}};function ete(e){let{inputs:t,backend:r,attrs:n}=e,{x:o,dy:s}=t,{strides:i,pad:a,dataFormat:u,dimRoundingMode:c,filterShape:p}=n,m=U.convertConv2DDataFormat(u),h=U.computeConv2DInfo(o.shape,p,i,1,a,c,!1,m),x=new v2(h);return r.runWebGLProgram(x,[o,s],"float32")}var n6={kernelName:jg,backendName:"webgl",kernelFunc:ete};var C2=class{constructor(t){this.variableNames=["dy","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"strides",type:"vec2"}],this.outputShape=t.inShape,this.enableShapeUniforms=Ct(this.outputShape.length);let r=t.filterHeight,n=t.filterWidth,o=r-1-t.padInfo.top,s=n-1-t.padInfo.left;this.userCode=`
      const ivec2 pads = ivec2(${o}, ${s});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];

        ivec2 dyCorner = ivec2(coords[1], coords[2]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        vec4 result = vec4(0.);
        for (int wR = 0; wR < ${r}; wR++) {
          float dyR = float(dyRCorner + wR) / strides[0];
          if (dyR < 0.0 || dyR >= ${t.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);
          int wRPerm = ${r} - 1 - wR;

          for (int wC = 0; wC < ${n}; wC++) {
            int wCPerm = ${n} - 1 - wC;

            float dyC = float(dyCCorner + wC) / strides[1];
            bool idyCVal = (dyC >= 0.0) && (dyC < ${t.outWidth}.0)
              && (fract(dyC) == 0.0);
            int idyC = int(dyC);

            float dyC2 = float(dyCCorner + wC + 1) / strides[1];
            bool idyCVal2 = (dyC2 >= 0.0) && (dyC2 < ${t.outWidth}.0)
              && (fract(dyC2) == 0.0);
            int idyC2 = int(dyC2);

            if (idyCVal && idyCVal2) {
              for (int d2 = 0; d2 < ${t.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC, d2);
                vec4 dySample2 = (idyC / 2 == idyC2 / 2) ?
                  dySample : getDy(batch, idyR, idyC2, d2);

                vec2 dyValue = mod(float(idyC), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.xy += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));

                dyValue = mod(float(idyC2), 2.) == 0. ?
                  dySample2.xy : dySample2.zw;
                result.zw += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            } else if (idyCVal) {
              for (int d2 = 0; d2 < ${t.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC, d2);
                vec2 dyValue = mod(float(idyC), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.xy += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            } else if (idyCVal2) {
              for (int d2 = 0; d2 < ${t.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC2, d2);
                vec2 dyValue = mod(float(idyC2), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.zw += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            }
          }
        }
        setOutput(result);
      }
    `}};function tte(e){let{inputs:t,backend:r,attrs:n}=e,{dy:o,filter:s}=t,{inputShape:i,strides:a,pad:u,dataFormat:c,dimRoundingMode:p}=n,m=U.convertConv2DDataFormat(c),h=U.computeConv2DInfo(i,s.shape,a,1,u,p,!1,m);if(z().getBool("WEBGL_PACK_CONV2DTRANSPOSE")&&m==="channelsLast"){let x=[[h.strideHeight,h.strideWidth]],y=new C2(h);return r.runWebGLProgram(y,[o,s],"float32",x)}else{let x=new w2(h);return r.runWebGLProgram(x,[o,s],"float32")}}var o6={kernelName:Xg,backendName:"webgl",kernelFunc:tte};function rte(e){let{inputs:t,backend:r,attrs:n}=e,{x:o,filter:s}=t,{strides:i,pad:a,dilations:u}=n,c=U.computeConv3DInfo(o.shape,s.shape,i,u,a),p=new d2(c);return r.runWebGLProgram(p,[o,s],"float32")}var s6={kernelName:Yg,backendName:"webgl",kernelFunc:rte};function nte(e){let{inputs:t,backend:r,attrs:n}=e,{x:o,dy:s}=t,{strides:i,pad:a,filterShape:u}=n,c=U.computeConv3DInfo(o.shape,u,i,1,a),p=new T2(c);return r.runWebGLProgram(p,[o,s],"float32")}var i6={kernelName:A4,backendName:"webgl",kernelFunc:nte};function ote(e){let{inputs:t,backend:r,attrs:n}=e,{dy:o,filter:s}=t,{pad:i,strides:a,inputShape:u}=n,c=U.computeConv3DInfo(u,s.shape,a,1,i),p=new S2(c);return r.runWebGLProgram(p,[o,s],"float32")}var a6={kernelName:Zg,backendName:"webgl",kernelFunc:ote};var ste=ws+`
  return cos(x);
`,ite=`
  vec4 result = cos(x);
  bvec4 isNaN = isnan(x);
  ${Eo}
  return result;
`,ate=_e({opSnippet:ste,packedOpSnippet:ite}),u6={kernelName:Qg,backendName:"webgl",kernelFunc:ate};var ute=`
  float e2x = exp(-x);
  return (e2x + 1.0 / e2x) / 2.0;
`,lte=_e({opSnippet:ute}),l6={kernelName:Jg,backendName:"webgl",kernelFunc:lte};var E2=class{constructor(t,r,n,o,s){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];let[i,a,u,c]=t,[p]=r,[m,h]=n;this.outputShape=[p,m,h,c];let x=o==="bilinear"?1:0,[y,v]=[`${a-1}.0`,`${u-1}.0`],[w,C,I]=m>1?[`${(a-1)/(m-1)}`,"(y2-y1) * height_ratio",`y1*${y} + float(y)*(height_scale)`]:["0.0","0.0",`0.5 * (y1+y2) * ${y}`],[D,P,G]=h>1?[`${(u-1)/(h-1)}`,"(x2-x1) * width_ratio",`x1*${v} + float(x)*(width_scale)`]:["0.0","0.0",`0.5 * (x1+x2) * ${v}`];this.userCode=`
      const float height_ratio = float(${w});
      const float width_ratio = float(${D});
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int y = coords[1];
        int x = coords[2];
        int d = coords[3];

        // get box vals
        float y1 = getBoxes(b,0);
        float x1 = getBoxes(b,1);
        float y2 = getBoxes(b,2);
        float x2 = getBoxes(b,3);

        // get image in batch index
        int bInd = round(getBoxInd(b));
        if(bInd < 0 || bInd >= ${i}) {
          return;
        }

        float height_scale = ${C};
        float width_scale = ${P};

        float in_y = ${I};
        if( in_y < 0.0 || in_y > ${y} ) {
          setOutput(float(${s}));
          return;
        }
        float in_x = ${G};
        if( in_x < 0.0 || in_x > ${v} ) {
          setOutput(float(${s}));
          return;
        }

        vec2 sourceFracIndexCR = vec2(in_x,in_y);
        if(${x} == 1) {
          // Compute the four integer indices.
          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);
          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));

          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);
          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);
          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);
          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);

          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);

          float top = topLeft + (topRight - topLeft) * fracCR.x;
          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;
          float newValue = top + (bottom - top) * fracCR.y;
          setOutput(newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          ivec2 sourceNearestCR = ivec2(floor(
            sourceFracIndexCR + vec2(0.5,0.5)));
          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);
          setOutput(newValue);
        }
      }
    `}};var cte=e=>{let{inputs:t,backend:r,attrs:n}=e,{image:o,boxes:s,boxInd:i}=t,{cropSize:a,method:u,extrapolationValue:c}=n,p=new E2(o.shape,s.shape,a,u,c);return r.runWebGLProgram(p,[o,s,i],"float32")},c6={kernelName:rx,backendName:"webgl",kernelFunc:cte};var Wp=function(e){return e.Prod="*",e.Sum="+",e}(Wp||{}),yh=class{constructor(t,r,n,o){this.op=t,this.outputShape=r,this.variableNames=["x"],this.customUniforms=[{name:"index",type:"float"}];let s=this.outputShape.length,i=this.op===Wp.Prod?"1.0":"0.0",a=n?i:`getX(${p6(s,"coords",this.op)})`,u=this.outputShape[this.outputShape.length-1],c="",p="";n?(c=o?`end != ${u-1}`:"end != 0",p=o?"end + 1":"end - 1"):(c=o?`end + pow2 < ${u}`:"end >= pow2",p=o?"end + pow2":"end - pow2"),this.userCode=`
      void main() {
        ${Ke(s)} coords = getOutputCoords();
        int end = ${f6(s,"coords",this.op)};
        float val = ${a};
        int pow2 = int(pow(2.0, index));
        if (${c}) {
          int idx = ${p};
          ${f6(s,"coords",this.op)} = idx;
          val ${this.op}= getX(${p6(s,"coords",this.op)});
        }
        setOutput(val);
      }
    `}};function p6(e,t,r){if(e===1)return`${t}`;if(e===2)return`${t}.x, ${t}.y`;if(e===3)return`${t}.x, ${t}.y, ${t}.z`;if(e===4)return`${t}.x, ${t}.y, ${t}.z, ${t}.w`;throw new Error(`Cumulative ${r} for rank ${e} is not yet supported`)}function f6(e,t,r){if(e===1)return`${t}`;if(e===2)return`${t}.y`;if(e===3)return`${t}.z`;if(e===4)return`${t}.w`;throw new Error(`Cumulative ${r} for rank ${e} is not yet supported`)}function N2(e,t,r,n,o,s){let i=t.shape.length,a=U.getAxesPermutation([n],i),u=t;a!=null&&(u=Ht({inputs:{x:t},backend:r,attrs:{perm:a}}));let c=U.getInnerMostAxes(1,i)[0];if(c!==i-1)throw new Error(`WebGL cumprod shader expects an inner-most axis=${t.shape.length-1} but got axis=${n}`);let p=u.shape[c],m=lr({inputs:{x:u},backend:r});for(let h=0;h<=Math.ceil(Math.log2(p))-1;h++){let x=new yh(e,u.shape,!1,s),y=[[h]],v=m;m=r.runWebGLProgram(x,[m],m.dtype,y),r.disposeIntermediateTensorInfo(v)}if(o){let h=new yh(e,u.shape,o,s),x=m;m=r.runWebGLProgram(h,[m],m.dtype),r.disposeIntermediateTensorInfo(x)}if(a!=null){let h=U.getUndoAxesPermutation(a),x=Ht({inputs:{x:m},backend:r,attrs:{perm:h}});return r.disposeIntermediateTensorInfo(m),r.disposeIntermediateTensorInfo(u),x}return m}function pte(e){let{inputs:t,backend:r,attrs:n}=e,{x:o}=t,{axis:s,exclusive:i,reverse:a}=n;return N2(Wp.Prod,o,r,s,i,a)}var m6={kernelName:ex,backendName:"webgl",kernelFunc:pte};function fte(e){let{inputs:t,backend:r,attrs:n}=e,{x:o}=t,{axis:s,exclusive:i,reverse:a}=n;return N2(Wp.Sum,o,r,s,i,a)}var h6={kernelName:tx,backendName:"webgl",kernelFunc:fte};function mte(e){let{inputs:t,backend:r,attrs:n}=e,{x:o,weights:s}=t,{size:i,binaryOutput:a}=n;if(o.shape.length===1){let u=r.readSync(o.dataId),c=r.readSync(s.dataId),p=Vy(u,c,s.dtype,s.shape,i);return r.makeTensorInfo([i],s.dtype,p)}else if(o.shape.length===2){let u=r.bufferSync(o),c=r.bufferSync(s),p=QF(u,c,i,a);return r.makeTensorInfo(p.shape,s.dtype,p.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${o.shape.length}.`)}var d6={kernelName:nx,backendName:"webgl",kernelFunc:mte};var _2=class{constructor(t,r,n){this.variableNames=["x"],this.outputShape=[],this.outputShape=t,this.blockSize=r,this.dataFormat=n,this.userCode=`
    void main() {
      ivec4 coords = getOutputCoords();
      int b = coords[0];
      int h = ${this.getHeightCoordString()};
      int w = ${this.getWidthCoordString()};
      int d = ${this.getDepthCoordString()};

      int in_h = h / ${r};
      int offset_h = imod(h, ${r});
      int in_w = w / ${r};
      int offset_w = imod(w, ${r});
      int offset_d = (offset_h * ${r} + offset_w) *
        ${this.getOutputDepthSize()};
      int in_d = d + offset_d;

      float result = ${this.getInputSamplingString()};
      setOutput(result);
    }
  `}getHeightCoordString(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"}getWidthCoordString(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"}getDepthCoordString(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"}getOutputDepthSize(){return this.dataFormat==="NHWC"?this.outputShape[3]:this.outputShape[1]}getInputSamplingString(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"}};function hte(e){let{inputs:t,backend:r,attrs:n}=e,{x:o}=t,{blockSize:s,dataFormat:i}=n,a=o.shape[0],u=i==="NHWC"?o.shape[1]:o.shape[2],c=i==="NHWC"?o.shape[2]:o.shape[3],p=i==="NHWC"?o.shape[3]:o.shape[1],m=u*s,h=c*s,x=p/(s*s),y=i==="NHWC"?[a,m,h,x]:[a,x,m,h],v=new _2(y,s,i);return r.runWebGLProgram(v,[o],o.dtype)}var g6={kernelName:ox,backendName:"webgl",kernelFunc:hte};var zp=class{constructor(t,r=!1,n=null,o=!1,s=!1){this.variableNames=["x","W"],this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=t.outShape,this.enableShapeUniforms=Ct(this.outputShape.length);let i=t.filterHeight,a=t.filterWidth,u=t.outChannels/t.inChannels,c="",p="";n&&(o?c=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${n}
        }`:s?c=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${n}
        }`:c=`
          float activation(float x) {
            ${n}
          }
        `,p="result = activation(result);");let m=r?"result += getBiasAtOutCoords();":"";r&&this.variableNames.push("bias"),o&&this.variableNames.push("preluActivationWeights"),s&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${c}

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${u};
        int q = d2 - d1 * ${u};

        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.
        for (int wR = 0; wR < ${i}; wR++) {
          int xR = xRCorner + wR * dilations[0];

          if (xR < 0 || xR >= inDims[0]) {
            continue;
          }

          for (int wC = 0; wC < ${a}; wC++) {
            int xC = xCCorner + wC * dilations[1];

            if (xC < 0 || xC >= inDims[1]) {
              continue;
            }

            float xVal = getX(batch, xR, xC, d1);
            float wVal = getW(wR, wC, d1, q);
            dotProd += xVal * wVal;
          }
        }

        float result = dotProd;
        ${m}
        ${p}
        setOutput(result);
      }
    `}};var Hp=class{constructor(t,r=!1,n=null,o=!1,s=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=t.outShape,this.enableShapeUniforms=Ct(this.outputShape.length);let i=t.outChannels/t.inChannels,a=t.padInfo.left,u=t.strideWidth,c=t.dilationWidth,p=t.filterHeight,m=t.filterWidth,h=m,x=`
      int xR; int xC; int xCOffset;
      vec4 wTexel; vec4 previous; vec4 final;`;for(let C=0;C<m;C++)x+=`
          vec4 xTexelC${C*2};
          int xTexelC${C*2}Ready;
          vec4 xTexelC${C*2+1};
          int xTexelC${C*2+1}Ready;
          vec4 xC${C};`;x+=`
    for (int r = 0; r < ${p}; r++) {
      `;for(let C=0;C<m;C++)x+=`
          xTexelC${C*2} = vec4(0.0);
          xTexelC${C*2}Ready = 0;
          xTexelC${C*2+1} = vec4(0.0);
          xTexelC${C*2+1}Ready = 0;
          xC${C} = vec4(0.0);`;x+=`
        xR = xRCorner + r * dilations[0];
        if (xR >=0 && xR < inDims[0]) {
      `;for(let C=0;C<(h+1)/2;C++){let I=C*2;if(x+=`
          xC = xCCorner + ${I*c};
          `,u===1){if(I<m&&(a%2===1?(x+=`
                xCOffset = xC + 1;
                if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${I}Ready == 0) {
                  xTexelC${I} = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${I}.zw = vec2(0.0);
                  }
                  xTexelC${I}Ready = 1;
                }
              `,c===1&&I>0?x+=`
                xC${I} = vec4(xTexelC${I-2}.zw, xTexelC${I}.xy);
                `:x+=`
                  xCOffset = xC + 1 - 2;

                  if (xCOffset >= 0 && xCOffset < inDims[1]) {
                    previous = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      previous.zw = vec2(0.0);
                    }

                    xC${I} = vec4(previous.zw, xTexelC${I}.xy);
                  } else {
                    xC${I} = vec4(0.0, 0.0, xTexelC${I}.xy);
                  }
                  `):x+=`
                if (xC >= 0 && xC < inDims[1] && xTexelC${I}Ready == 0) {
                  xTexelC${I} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC${I}.zw = vec2(0.0);
                  }
                  xTexelC${I}Ready = 1;
                }

                xC${I} = xTexelC${I};
                `,I+1<m)){let D=a%2===0?A.nearestLargerEven(c):c;c%2===0&&a%2===1||c%2!==0&&a%2!==1?(x+=`
                  xCOffset = xC + imod(pads[1], 2) + ${D};

                  if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${I+1}Ready == 0) {
                    xTexelC${I+1} = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      xTexelC${I+1}.zw = vec2(0.0);
                    }
                    xTexelC${I+1}Ready = 1;
                  }
                  `,c>1?x+=`
                    xCOffset -= 2;
                    if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);
                     xC${I+1} = vec4(previous.zw, xTexelC${I+1}.xy);
                    } else {
                     xC${I+1} = vec4(0.0, 0.0, xTexelC${I+1}.xy);
                    }
                    `:x+=`
                    xC${I+1} = vec4(xTexelC${I}.zw, xTexelC${I+1}.xy);
                    `):D===1?x+=`
                    xC${I+1} = xTexelC${I};
                    `:x+=`
                    xCOffset = xC + ${D};

                    if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${I+1}Ready == 0) {
                      xTexelC${I+1} = getX(batch, xR, xCOffset, d1);
                      if (xCOffset + 1 >= inDims[1]) {
                        xTexelC${I+1}.zw = vec2(0.0);
                      }
                      xTexelC${I+1}Ready = 1;
                    }

                    xC${I+1} = xTexelC${I+1};
                    `}}else I<m&&(a%2===1?(x+=`
                xCOffset = xC + 1 - strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${I}Ready == 0) {
                  xTexelC${I} = getX(batch, xR, xCOffset, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${I}.zw = vec2(0.0);
                  }
                  xTexelC${I}Ready = 1;
                }

                if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${I+1}Ready == 0) {
                  xTexelC${I+1} = getX(batch, xR, xC + 1, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xC + 2 >= inDims[1]) {
                    xTexelC${I+1}.zw = vec2(0.0);
                  }
                  xTexelC${I+1}Ready = 1;
                }

                xC${I} = vec4(xTexelC${I}.zw, xTexelC${I+1}.zw);
              `,I+1<m&&(x+=`
                  final = vec4(0.0);
                  xCOffset = xC + 1 + strides[1];
                  if(xCOffset >= 0 && xCOffset < inDims[1]) {
                    final = getX(batch, xR, xCOffset, d1);
                  }
                  xC${I+1} = vec4(xTexelC${I+1}.xy, final.xy);
                `)):(x+=`
                if(xC >= 0 && xC < inDims[1] && xTexelC${I}Ready == 0) {
                  xTexelC${I} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC${I}.zw = vec2(0.0);
                  }
                  xTexelC${I}Ready = 1;
                }

                xCOffset = xC + strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${I+1}Ready == 0) {
                  xTexelC${I+1} = getX(batch, xR, xCOffset, d1);
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${I+1}.zw = vec2(0.);
                  }
                  xTexelC${I+1}Ready = 1;
                }

                xC${I} = vec4(
                  xTexelC${I}.xy, xTexelC${I+1}.xy);
              `,I+1<m&&(x+=`
                  xC${I+1} = vec4(xTexelC${I}.zw, xTexelC${I+1}.zw);
                `)));I<m&&(x+=`
            wTexel = getW(r, ${I}, d1, q);
            dotProd += xC${I} * vec4(wTexel.xz, wTexel.xz);
          `,I+1<m&&(x+=`
              wTexel = getW(r, ${I+1}, d1, q);
              dotProd += xC${I+1} * vec4(wTexel.xz, wTexel.xz);
            `))}x+=`
    }
  `,x+=`
      }
    `;let y="",v="";n&&(o?y=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${n}
        }`:s?y=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${n}
        }`:y=`vec4 activation(vec4 x) {
          ${n}
        }`,v="result = activation(result);");let w=r?"result += getBiasAtOutCoords();":"";r&&this.variableNames.push("bias"),o&&this.variableNames.push("preluActivationWeights"),s&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${y}

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${i};
        int q = d2 - d1 * ${i};
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
        vec4 dotProd = vec4(0.000000000000001);

        ${x}

        vec4 result = dotProd - vec4(0.000000000000001);
        ${w}
        ${v}
        setOutput(result);
      }
    `}};function dte(e){let{inputs:t,backend:r,attrs:n}=e,{x:o,filter:s}=t,{strides:i,pad:a,dilations:u,dimRoundingMode:c}=n,p=u;p==null&&(p=[1,1]),A.assert(U.eitherStridesOrDilationsAreOne(i,p),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${i} and dilations '${p}'`);let m=U.computeConv2DInfo(o.shape,s.shape,i,p,a,c,!0),h;z().getBool("WEBGL_PACK_DEPTHWISECONV")&&m.strideWidth<=2&&m.outChannels/m.inChannels===1?h=new Hp(m):h=new zp(m);let x=[[m.padInfo.top,m.padInfo.left],[m.strideHeight,m.strideWidth],[m.dilationHeight,m.dilationWidth],[m.inHeight,m.inWidth]];return r.runWebGLProgram(h,[o,s],"float32",x)}var x6={kernelName:sx,backendName:"webgl",kernelFunc:dte};var I2=class{constructor(t){this.variableNames=["x","dy"],this.outputShape=t.filterShape;let r=t.strideHeight,n=t.strideWidth,o=t.padInfo.top,s=t.padInfo.left,i=t.outChannels/t.inChannels;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int dm = coords.w;
        int d2 = d1 * ${i} + dm;

        float dotProd = 0.0;

        // TO DO: Vec4 over the batch size
        for (int b = 0; b < ${t.batchSize}; b++) {
          for (int yR = 0; yR < ${t.outHeight}; yR++) {
            int xR = wR + yR * ${r} - ${o};

            if (xR < 0 || xR >= ${t.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${t.outWidth}; yC++) {
              int xC = wC + yC * ${n} - ${s};

              if (xC < 0 || xC >= ${t.inWidth}) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `}},A2=class{constructor(t){this.variableNames=["dy","W"],this.outputShape=t.inShape;let r=t.filterHeight,n=t.filterWidth,o=t.strideHeight,s=t.strideWidth,i=r-1-t.padInfo.top,a=n-1-t.padInfo.left,u=t.outChannels/t.inChannels;this.userCode=`
      const ivec2 pads = ivec2(${i}, ${a});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];
        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        float dotProd = 0.0;

        for (int wR = 0; wR < ${r}; wR++) {
          float dyR = float(dyRCorner + wR) / ${o}.0;

          if (dyR < 0.0 || dyR >= ${t.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${r} - 1 - wR;

          for (int wC = 0; wC < ${n}; wC++) {
            float dyC = float(dyCCorner + wC) / ${s}.0;

            if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${n} - 1 - wC;

            // TO DO: Vec4 over the channelMul
            for (int dm = 0; dm < ${u}; dm++) {
              int d2 = d1 * ${u} + dm;
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `}};function gte(e){let{inputs:t,backend:r,attrs:n}=e,{x:o,dy:s}=t,{strides:i,dilations:a,pad:u,dimRoundingMode:c,filterShape:p}=n,m=U.computeConv2DInfo(o.shape,p,i,a,u,c,!0),h=new I2(m);return r.runWebGLProgram(h,[o,s],"float32")}var y6={kernelName:ix,backendName:"webgl",kernelFunc:gte};function xte(e){let{inputs:t,backend:r,attrs:n}=e,{dy:o,filter:s}=t,{strides:i,dilations:a,pad:u,dimRoundingMode:c,inputShape:p}=n,m=U.computeConv2DInfo(p,s.shape,i,a,u,c,!0),h=new A2(m);return r.runWebGLProgram(h,[o,s],"float32")}var b6={kernelName:ax,backendName:"webgl",kernelFunc:xte};var k2=class{constructor(t){this.variableNames=["X"],this.outputShape=[t,t],this.userCode=`
      void main() {
          ivec2 coords = getOutputCoords();
          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;
          setOutput(val);
      }
    `}};function yte(e){let{inputs:t,backend:r}=e,{x:n}=t,o=[...n.shape,...n.shape],s=A.sizeFromShape(n.shape),i=pe({inputs:{x:n},backend:r,attrs:{shape:[s]}}),a=new k2(s),u=r.runWebGLProgram(a,[i],i.dtype),c=pe({inputs:{x:u},backend:r,attrs:{shape:o}});return r.disposeIntermediateTensorInfo(i),r.disposeIntermediateTensorInfo(u),c}var v6={kernelName:ux,backendName:"webgl",kernelFunc:yte};var $2=class{constructor(t){this.variableNames=["x","W"],this.outputShape=t.outShape;let{inHeight:r,inWidth:n,padInfo:o,strideHeight:s,strideWidth:i,filterHeight:a,filterWidth:u,dilationHeight:c,dilationWidth:p}=t,{top:m,left:h}=o;this.userCode=`
      const ivec2 strides = ivec2(${s}, ${i});
      const ivec2 pads = ivec2(${m}, ${h});
      const float neg_infinity = -3.4e38;

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.w;
        ivec2 outTopLeftCorner =
            coords.yz * strides - pads;
        int hBeg = outTopLeftCorner.x;
        int wBeg = outTopLeftCorner.y;

        float curVal = neg_infinity;
        for (int h = 0; h < ${a}; h++) {
          int hIn = hBeg + h * ${c};

          if (hIn >= 0 && hIn < ${r}) {
            for (int w = 0; w < ${u}; w++) {
              int wIn = wBeg + w * ${p};

              if (wIn >= 0 && wIn < ${n}) {
                float xVal = getX(batch, hIn, wIn, d1);
                float wVal = getW(h, w, d1);

                float val = xVal + wVal;
                if (val > curVal) {
                  curVal = val;
                }
              }
            }
          }
        }

        float result = curVal;
        setOutput(result);
      }
    `}};function bte(e){let{inputs:t,backend:r,attrs:n}=e,{x:o,filter:s}=t,{strides:i,pad:a,dilations:u}=n,c=U.computeDilation2DInfo(o.shape,s.shape,i,a,"NHWC",u),p,m=new $2(c);p=r.runWebGLProgram(m,[o,s],"float32");let h=pe({inputs:{x:p},backend:r,attrs:{shape:c.outShape}});return r.disposeIntermediateTensorInfo(p),h}var w6={kernelName:lx,backendName:"webgl",kernelFunc:bte};function vte(e){let{inputs:t,backend:r,attrs:n}=e,{equation:o}=n,s=t,{allDims:i,summedDims:a,idDims:u}=U.decodeEinsumEquation(o,s.length);U.checkEinsumDimSizes(i.length,u,s);let{path:c,steps:p}=U.getEinsumComputePath(a,u),m=p.length,h=null,x=i.length,y=[];for(let v=0;v<m;++v){for(let w of p[v]){let{permutationIndices:C,expandDims:I}=U.getEinsumPermutation(x,u[w]),D;U.isIdentityPermutation(C)?D=s[w]:(D=Ht({inputs:{x:s[w]},backend:r,attrs:{perm:C}}),y.push(D));let P=D.shape.slice();for(let G=0;G<I.length;++G)P.splice(I[G],0,1);A.arraysEqual(D.shape,P)||(D=pe({inputs:{x:D},backend:r,attrs:{shape:P}}),y.push(D)),h===null?h=D:(h=gh({inputs:{a:D,b:h},backend:r}),y.push(h))}v<m-1&&(c[v]>=0&&(h=El({inputs:{x:h},backend:r,attrs:{axis:c[v]-(i.length-x),keepDims:!1}}),y.push(h)),x--)}for(let v of y)v!==h&&r.disposeIntermediateTensorInfo(v);return h}var T6={kernelName:px,backendName:"webgl",kernelFunc:vte};var wte="return (x >= 0.0) ? x : (exp(x) - 1.0);",Tte=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,Ste=_e({opSnippet:wte,packedOpSnippet:Tte}),S6={kernelName:fx,backendName:"webgl",kernelFunc:Ste};var Cte="return (b >= 0.0) ? a : a * (b + 1.0);",Ete=`
  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));
  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));
`,Nte=e=>{let{inputs:t,backend:r}=e,{dy:n,y:o}=t,s=z().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Co(Ete,n.shape,o.shape):new eo(Cte,n.shape,o.shape);return r.runWebGLProgram(s,[n,o],n.dtype)},C6={kernelName:k4,backendName:"webgl",kernelFunc:Nte};var _te=`
  return vec4(equal(a, b));
`,Ite="return float(a == b);",Ate=bt({opSnippet:Ite,packedOpSnippet:_te,dtype:"bool",cpuKernelImpl:nP}),E6={kernelName:Bc,backendName:"webgl",kernelFunc:Ate};var kte=`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  float p = ${U.ERF_P};
  float a1 = ${U.ERF_A1};
  float a2 = ${U.ERF_A2};
  float a3 = ${U.ERF_A3};
  float a4 = ${U.ERF_A4};
  float a5 = ${U.ERF_A5};

  float sign = sign(x);
  x = abs(x);
  float t = 1.0 / (1.0 + p * x);
  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));
`,$te=_e({opSnippet:kte}),N6={kernelName:mx,backendName:"webgl",kernelFunc:$te};var Rte=ws+`
  return exp(x);
`,Ote=`
  vec4 result = exp(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,GC=_e({opSnippet:Rte,packedOpSnippet:Ote,cpuKernelImpl:oP,dtype:"float32"}),_6={kernelName:Mc,backendName:"webgl",kernelFunc:GC};function R2(e){let{inputs:t,attrs:r,backend:n}=e,{dim:o}=r,{input:s}=t,i=s.shape.length,a=s.shape.slice(),u=o;return o<0&&(A.assert(-(i+1)<=o,()=>`Axis must be in the interval [${-(i+1)}, ${i}]`),u=i+o+1),a.splice(u,0,1),pe({inputs:{x:s},backend:n,attrs:{shape:a}})}var I6={kernelName:hx,backendName:"webgl",kernelFunc:R2};var A6="return exp(x) - 1.0;",Dte=_e({opSnippet:A6,packedOpSnippet:A6,cpuKernelImpl:sP}),k6={kernelName:Uc,backendName:"webgl",kernelFunc:Dte};var bh=class{constructor(t,r,n){this.variableNames=["real","imag"];let o=r[1];this.outputShape=r;let s=n?`2.0 * ${Math.PI}`:`-2.0 * ${Math.PI}`,i=n?`${o}.0`:"1.0",a;if(t==="real")a="return real * expR - imag * expI;";else if(t==="imag")a="return real * expI + imag * expR;";else throw new Error(`FFT component must be either "real" or "imag", got ${t}.`);this.userCode=`
      const float exponentMultiplier = ${s};

      float unaryOpComplex(float real, float expR, float imag, float expI) {
        ${a}
      }

      float mulMatDFT(int batch, int index) {
        float indexRatio = float(index) / float(${o});
        float exponentMultiplierTimesIndexRatio =
            exponentMultiplier * indexRatio;

        float result = 0.0;

        for (int i = 0; i < ${o}; i++) {
          // x = (-2|2 * PI / N) * index * i;
          float x = exponentMultiplierTimesIndexRatio * float(i);
          float expR = cos(x);
          float expI = sin(x);
          float real = getReal(batch, i);
          float imag = getImag(batch, i);

          result +=
              unaryOpComplex(real, expR, imag, expI) / ${i};
        }

        return result;
      }

      void main() {
        ivec2 coords = getOutputCoords();
        setOutput(mulMatDFT(coords[0], coords[1]));
      }
    `}};function O2(e,t,r){let n=r.texData.get(e.dataId),o=A.sizeFromShape(e.shape),s=e.shape[e.shape.length-1],i=o/s,a=pe({inputs:{x:e},backend:r,attrs:{shape:[i,s]}}),u=a.shape,c=new bh("real",u,t),p=new bh("imag",u,t),m=[{dataId:n.complexTensorInfos.real.dataId,dtype:n.complexTensorInfos.real.dtype,shape:u},{dataId:n.complexTensorInfos.imag.dataId,dtype:n.complexTensorInfos.imag.dtype,shape:u}],h=r.runWebGLProgram(c,m,"float32"),x=r.runWebGLProgram(p,m,"float32"),y=to({inputs:{real:h,imag:x},backend:r});r.disposeIntermediateTensorInfo(h),r.disposeIntermediateTensorInfo(x);let v=pe({inputs:{x:y},backend:r,attrs:{shape:e.shape}});return r.disposeIntermediateTensorInfo(a),r.disposeIntermediateTensorInfo(y),v}function Fte(e){let{inputs:t,backend:r}=e,{input:n}=t;return O2(n,!1,r)}var $6={kernelName:dx,backendName:"webgl",kernelFunc:Fte};var D2=class{constructor(t,r){this.outputShape=[],this.customUniforms=[{name:"value",type:"float"}],this.variableNames=["x"],this.outputShape=t,this.userCode=`
      void main() {
        // Input can be obtained from uniform value.
        setOutput(value);
      }
    `}};function ua(e){let{backend:t,attrs:r}=e,{shape:n,value:o}=r,{dtype:s}=r;if(s=s||A.inferDtype(o),s==="string"){let i=A.getArrayFromDType(s,A.sizeFromShape(n));return i.fill(o),t.makeTensorInfo(n,s,i)}else{let i=new D2(n,o),a=[[o]];return t.runWebGLProgram(i,[],s,a)}}var R6={kernelName:gx,backendName:"webgl",kernelFunc:ua};var F2=class{constructor(t){this.variableNames=["Image"],this.outputShape=[];let r=t[2];this.outputShape=t,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];

          int coordX = ${r} - x - 1;
          float outputValue;
          if(coordX >= 0 && coordX < ${r}) {
            outputValue = getImage(coords[0], coords[1], coordX, coords[3]);
          } else {
            outputValue = getImage(coords[0], coords[1], coords[2], coords[3]);
          }
          setOutput(outputValue);
        }
    `}};var O6={kernelName:xx,backendName:"webgl",kernelFunc:({inputs:e,backend:t})=>{let{image:r}=e,n=t,o=new F2(r.shape);return n.runWebGLProgram(o,[r],r.dtype)}};var D6="return floor(x);",Pte=_e({opSnippet:D6,packedOpSnippet:D6,cpuKernelImpl:iP}),F6={kernelName:Vc,backendName:"webgl",kernelFunc:Pte};var Lte=`
  float s = sign(a) * sign(b);
  int ia = round(a);
  int ib = round(b);
  if (ib != 0) {
    // Windows (D3D) wants guaranteed non-zero int division at compile-time.
    return float(idiv(ia, ib, s));
  } else {
    return NAN;
  }
`,Bte=`
  ivec4 ia = round(a);
  ivec4 ib = round(b);
  bvec4 cond = notEqual(ib, ivec4(0));
  ivec4 result = ivec4(0);
  vec4 s = sign(a) * sign(b);

  // Windows (D3D) wants guaranteed non-zero int division at compile-time.
  if (cond[0]) {
    result[0] = idiv(ia[0], ib[0], s[0]);
  }
  if (cond[1]) {
    result[1] = idiv(ia[1], ib[1], s[1]);
  }
  if (cond[2]) {
    result[2] = idiv(ia[2], ib[2], s[2]);
  }
  if (cond[3]) {
    result[3] = idiv(ia[3], ib[3], s[3]);
  }
  return vec4(result);
`,Mte=bt({opSnippet:Lte,packedOpSnippet:Bte,dtype:"int32"}),P6={kernelName:Gc,backendName:"webgl",kernelFunc:Mte};var P2=class{constructor(t){this.variableNames=["A"];let r=Jt(),[n,o]=t;this.outputShape=t,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${o}.0, ${n}.0);

        vec4 values = ${r.texture2D}(A, uv);
        float value;
        if (depth == 0) {
          value = values.r;
        } else if (depth == 1) {
          value = values.g;
        } else if (depth == 2) {
          value = values.b;
        } else if (depth == 3) {
          value = values.a;
        }

        setOutput(floor(value * 255.0 + 0.5));
      }
    `}};var L2=class{constructor(t){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;let r=Jt(),[n,o]=t;this.outputShape=t,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];

        vec4 result = vec4(0.);

        for(int row=0; row<=1; row++) {
          for(int col=0; col<=1; col++) {
            texC = coords[1] + row;
            depth = coords[2] + col;

            vec2 uv = (vec2(texC, texR) + halfCR) /
                       vec2(${o}.0, ${n}.0);
            vec4 values = ${r.texture2D}(A, uv);
            float value;
            if (depth == 0) {
              value = values.r;
            } else if (depth == 1) {
              value = values.g;
            } else if (depth == 2) {
              value = values.b;
            } else if (depth == 3) {
              value = values.a;
            }

            result[row * 2 + col] = floor(value * 255.0 + 0.5);
          }
        }

        ${r.output} = result;
      }
    `}};var L6={kernelName:Om,backendName:"webgl",kernelFunc:Ute},Kp,WC=z().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");function Ute(e){let{inputs:t,backend:r,attrs:n}=e,{pixels:o}=t,{numChannels:s}=n,i=typeof HTMLVideoElement<"u"&&o instanceof HTMLVideoElement,a=typeof HTMLImageElement<"u"&&o instanceof HTMLImageElement,[u,c]=i?[o.videoWidth,o.videoHeight]:[o.width,o.height],p=[c,u],m=[c,u,s];if(a||i){let v=z().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");(Kp==null||v!==WC)&&(WC=v,Kp=document.createElement("canvas").getContext("2d",{willReadFrequently:WC})),Kp.canvas.width=u,Kp.canvas.height=c,Kp.drawImage(o,0,0,u,c),o=Kp.canvas}let h=r.makeTensorInfo(p,"int32");r.texData.get(h.dataId).usage=yn.PIXELS,r.gpgpu.uploadPixelDataToTexture(r.getTexture(h.dataId),o);let x=z().getBool("WEBGL_PACK")?new L2(m):new P2(m),y=r.runWebGLProgram(x,[h],"int32");return r.disposeData(h.dataId),y}function Vte(e){let{inputs:t,backend:r,attrs:n}=e,{x:o,filter:s,bias:i,preluActivationWeights:a}=t,{strides:u,pad:c,dataFormat:p,dilations:m,dimRoundingMode:h,activation:x,leakyreluAlpha:y}=n,v=U.convertConv2DDataFormat(p),w=U.computeConv2DInfo(o.shape,s.shape,u,m,c,h,!1,v),C,I=[],D=i!=null,P=a!=null,G=x==="leakyrelu",q=()=>{let Y=[o,s],te=(J,ae)=>{if(ae==="NCHW"&&J.shape.length===1&&J.shape[0]!==1){let ge=pe({inputs:{x:J},backend:r,attrs:{shape:[J.shape[0],1,1]}});return I.push(ge),ge}return J};if(D&&Y.push(te(i,p)),P&&Y.push(te(a,p)),G){let J=r.makeTensorInfo([],"float32",A.createScalarValue(y,"float32"));Y.push(J),I.push(J)}return Y};if(w.filterHeight===1&&w.filterWidth===1&&w.dilationHeight===1&&w.dilationWidth===1&&w.strideHeight===1&&w.strideWidth===1&&(w.padInfo.type==="SAME"||w.padInfo.type==="VALID"))C=y2({x:o,filter:s,convInfo:w,backend:r,bias:i,activation:x,preluActivationWeights:a,leakyreluAlpha:y});else if(w.strideWidth<=2&&v==="channelsLast"&&z().getBool("WEBGL_EXP_CONV")){let Y=x?ia(x,!0):null,te=new Gp(w,D,Y,P,G),J=[[w.padInfo.top,w.padInfo.left],[w.strideHeight,w.strideWidth],[w.dilationHeight,w.dilationWidth],[w.inHeight,w.inWidth]],ae=q();C=r.runWebGLProgram(te,ae,"float32",J)}else if(z().getBool("WEBGL_CONV_IM2COL"))C=b2({x:o,filter:s,convInfo:w,backend:r,bias:i,activation:x,preluActivationWeights:a,leakyreluAlpha:y});else{let Y=x?ia(x,!1):null,te=new Vp(w,D,Y,P,G),J=q();C=r.runWebGLProgram(te,J,"float32")}let Z=pe({inputs:{x:C},backend:r,attrs:{shape:w.outShape}});return I.push(C),I.forEach(Y=>r.disposeIntermediateTensorInfo(Y)),Z}var B6={kernelName:Fm,backendName:"webgl",kernelFunc:Vte};function Gte(e){let{inputs:t,backend:r,attrs:n}=e,{x:o,filter:s,bias:i,preluActivationWeights:a}=t,{strides:u,pad:c,dilations:p,dimRoundingMode:m,activation:h,leakyreluAlpha:x}=n,y=[],v=p;v==null&&(v=[1,1]),A.assert(U.eitherStridesOrDilationsAreOne(u,v),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${u} and dilations '${v}'`);let w=U.computeConv2DInfo(o.shape,s.shape,u,v,c,m,!0),C=z().getBool("WEBGL_PACK_DEPTHWISECONV")&&w.strideWidth<=2&&w.outChannels/w.inChannels===1,I=h?ia(h,C):null,D=[o,s],P=i!=null,G=a!=null,q=h==="leakyrelu";if(P&&D.push(i),G&&D.push(a),q){let J=r.makeTensorInfo([],"float32",A.createScalarValue(x,"float32"));D.push(J),y.push(J)}let Z;C?Z=new Hp(w,P,I,G,q):Z=new zp(w,P,I,G,q);let Y=[[w.padInfo.top,w.padInfo.left],[w.strideHeight,w.strideWidth],[w.dilationHeight,w.dilationWidth],[w.inHeight,w.inWidth]],te=r.runWebGLProgram(Z,D,"float32",Y);return y.forEach(J=>r.disposeIntermediateTensorInfo(J)),te}var M6={kernelName:Pm,backendName:"webgl",kernelFunc:Gte};var B2=class{constructor(t,r,n,o){this.sliceDim=t,this.strides=r,this.paramsShape=o,this.variableNames=["x","indices"],this.outputShape=n;let s=Ke(n.length),i=`
    int index;`;for(let a=0;a<this.sliceDim;a++)i+=`
          index = round(getIndices(coords[0], ${a}));
          out_of_bounds = out_of_bounds || index < 0;
          out_of_bounds = out_of_bounds || index >= ${this.paramsShape[a]};
          flattenIndex += index * ${this.strides[a]};`;this.userCode=`
         void main() {
          ${s} coords = getOutputCoords();
          int flattenIndex = 0;
          bool out_of_bounds = false;

          ${i}

          setOutput(out_of_bounds ? 0.0 : getX(flattenIndex, coords[1]));
        }
      `}};function Wte(e){let{inputs:t,backend:r}=e,{params:n,indices:o}=t,s=o.shape,i=s[s.length-1],a=A.sizeFromShape(n.shape),[u,c,p,m]=U.prepareAndValidate(n,o),h=pe({inputs:{x:o},backend:r,attrs:{shape:[c,i]}}),x=pe({inputs:{x:n},backend:r,attrs:{shape:[A.sizeFromShape(n.shape)/p,p]}});if(r.shouldExecuteOnCPU([n,o])||n.dtype==="string"){let C=r.readSync(o.dataId),I=r.bufferSync(n),D=aP(C,I,n.dtype,c,i,p,m,n.shape,a);return r.makeTensorInfo(u,n.dtype,D.values)}let y=new B2(i,m,[c,p],n.shape),v=r.runWebGLProgram(y,[x,h],x.dtype),w=pe({inputs:{x:v},backend:r,attrs:{shape:u}});return r.disposeIntermediateTensorInfo(h),r.disposeIntermediateTensorInfo(x),r.disposeIntermediateTensorInfo(v),w}var U6={kernelName:vx,backendName:"webgl",kernelFunc:Wte};var M2=class{constructor(t,r){this.variableNames=["A","indices"],this.outputShape=r,this.rank=r.length;let n=Ke(this.rank),o=zte(t,2);this.userCode=`
      void main() {
        ${n} resRC = getOutputCoords();
        int index = int(getIndices(resRC.x, resRC.z));
        float inBounds = (index >= 0) && (index < ${t[2]}) ? 1.0 : 0.0;
        setOutput(inBounds * getA(${o}));
      }
    `}};function zte(e,t){let r=["resRC.x","resRC.y","resRC.z","resRC.w"],n=[];for(let o=0;o<e.length;o++)o===2?n.push("index"):n.push(`${r[o]}`);return n.join()}function zC(e){let{inputs:t,backend:r,attrs:n}=e,{x:o,indices:s}=t,{axis:i,batchDims:a}=n,u=A.parseAxisParam(i,o.shape)[0];if(z().get("DEBUG")){let I=r.readSync(s.dataId),D=o.shape[u];for(let P=0;P<I.length;++P){let G=I[P];A.assert(G<=D-1&&G>=0,()=>`GatherV2: the index value ${G} is not in [0, ${D-1}]`)}}let c=U.segment_util.collectGatherOpShapeInfo(o,s,u,a),p=A.sizeFromShape(s.shape),m=[],h=pe({inputs:{x:o},backend:r,attrs:{shape:[c.batchSize,c.outerSize,c.dimSize,c.sliceSize]}}),x=pe({inputs:{x:s},backend:r,attrs:{shape:[c.batchSize,p/c.batchSize]}});m.push(h),m.push(x);let y=[c.batchSize,c.outerSize,p/c.batchSize,c.sliceSize];if(r.shouldExecuteOnCPU([o,s])||o.dtype==="string"){let I=r.bufferSync(x),D=r.bufferSync(h),P=uP(D,I,y);return m.forEach(G=>r.disposeIntermediateTensorInfo(G)),r.makeTensorInfo(c.outputShape,P.dtype,P.values)}let v=new M2(h.shape,y),w=r.runWebGLProgram(v,[h,x],h.dtype);m.push(w);let C=pe({inputs:{x:w},backend:r,attrs:{shape:c.outputShape}});return m.forEach(I=>r.disposeIntermediateTensorInfo(I)),C}var V6={kernelName:bx,backendName:"webgl",kernelFunc:zC};var Hte="return float(a > b);",Kte=`
  return vec4(greaterThan(a, b));
`,qte=bt({opSnippet:Hte,packedOpSnippet:Kte,cpuKernelImpl:lP,dtype:"bool"}),G6={kernelName:Wc,backendName:"webgl",kernelFunc:qte};var jte="return float(a >= b);",Xte=`
  return vec4(greaterThanEqual(a, b));
`,Yte=bt({opSnippet:jte,packedOpSnippet:Xte,dtype:"bool",cpuKernelImpl:cP}),W6={kernelName:zc,backendName:"webgl",kernelFunc:Yte};function Zte(e){let{inputs:t,backend:r}=e,{input:n}=t;return O2(n,!0,r)}var z6={kernelName:wx,backendName:"webgl",kernelFunc:Zte};var Qte="return float(!isnan(x) && !isinf(x));",Jte=_e({opSnippet:Qte,dtype:"bool"}),H6={kernelName:Sx,backendName:"webgl",kernelFunc:Jte};var ere="return float(isinf(x));",tre=_e({opSnippet:ere,dtype:"bool"}),K6={kernelName:Cx,backendName:"webgl",kernelFunc:tre};var rre="return float(isnan(x));",nre=_e({opSnippet:rre,dtype:"bool"}),q6={kernelName:Ex,backendName:"webgl",kernelFunc:nre};var ore="return float(a < b);",sre=`
  return vec4(lessThan(a, b));
`,ire=bt({opSnippet:ore,packedOpSnippet:sre,cpuKernelImpl:pP,dtype:"bool"}),j6={kernelName:Hc,backendName:"webgl",kernelFunc:ire};var are="return float(a <= b);",ure=`
  return vec4(lessThanEqual(a, b));
`,lre=bt({opSnippet:are,packedOpSnippet:ure,cpuKernelImpl:fP,dtype:"bool"}),X6={kernelName:Kc,backendName:"webgl",kernelFunc:lre};function cre(e){let{backend:t,attrs:r}=e,{start:n,stop:o,num:s}=r,i=mP(n,o,s);return t.makeTensorInfo([i.length],"float32",i)}var Y6={kernelName:_x,backendName:"webgl",kernelFunc:cre};var pre=ws+`
  return x < 0.0 ? 0./0. : log(x);
`,fre=`
  vec4 result = log(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : (x.r < 0.0 ? 0./0. : result.r);
  result.g = isNaN.g ? x.g : (x.g < 0.0 ? 0./0. : result.g);
  result.b = isNaN.b ? x.b : (x.b < 0.0 ? 0./0. : result.b);
  result.a = isNaN.a ? x.a : (x.a < 0.0 ? 0./0. : result.a);
  return result;
`,mre=_e({opSnippet:pre,packedOpSnippet:fre,cpuKernelImpl:hP}),Z6={kernelName:qc,backendName:"webgl",kernelFunc:mre};var hre=ws+`
  return log(1.0 + x);
`,dre=_e({opSnippet:hre}),Q6={kernelName:Ix,backendName:"webgl",kernelFunc:dre};var gre="return float(a >= 1.0 && b >= 1.0);",xre=`
  return vec4(
    vec4(greaterThanEqual(a, vec4(1.0))) *
    vec4(greaterThanEqual(b, vec4(1.0))));
`,yre=bt({opSnippet:gre,packedOpSnippet:xre,dtype:"bool"}),J6={kernelName:Ax,backendName:"webgl",kernelFunc:yre};var bre="return float(!(x >= 1.0));",vre=_e({opSnippet:bre}),eB={kernelName:kx,backendName:"webgl",kernelFunc:vre};var wre="return float(a >= 1.0 || b >= 1.0);",Tre=`
  return min(
    vec4(greaterThanEqual(a, vec4(1.0))) +
    vec4(greaterThanEqual(b, vec4(1.0))),
    vec4(1.0));
`,Sre=bt({opSnippet:wre,packedOpSnippet:Tre,dtype:"bool"}),tB={kernelName:$x,backendName:"webgl",kernelFunc:Sre};var U2=class{constructor(t,r,n,o,s){this.variableNames=["x"],this.outputShape=[];let i=r,a=t[3]-1;this.outputShape=t;let u,c=`float(${n}) + float(${o}) * sum`;s===.5?u=`inversesqrt(${c})`:s===1?u=`1.0/(${c})`:u=`exp(log(${c}) * float(-${s}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];
        int d = coords[3];
        float x = getX(b, r, c, d);
        float sum = 0.0;
        for (int j = -${i}; j <= ${i}; j++) {
          int idx = d + j;
          if (idx >= 0 && idx <=  ${a}) {
            float z = getX(b, r, c, idx);
            sum += z * z;
          }
        }
        float val = x * ${u};
        setOutput(val);
      }
    `}};var V2=class{constructor(t,r,n,o,s){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;let i=r,a=t[3]-1;this.outputShape=t;let u,c=`float(${n}) + float(${o}) * sum`;s===.5?u=`inversesqrt(${c})`:s===1?u=`1.0/(${c})`:u=`exp(log(${c}) * float(-${s}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords.x;
        int r = coords.y;
        int c = coords.z;
        int d = coords.w;

        bool hasNextCol = d < ${this.outputShape[3]};
        bool hasNextRow = c < ${this.outputShape[2]};

        vec4 sum = vec4(0.);
        vec4 xFragAtOutputCoords = getX(b, r, c, d);

        vec4 xAtOutputCoords = vec4(
          getChannel(xFragAtOutputCoords, vec2(c, d)),
          hasNextCol ?
            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,
          hasNextRow ?
            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,
          (hasNextRow && hasNextCol) ?
            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0
        );

        int firstChannel = d - ${i};
        vec2 cache = vec2(0.);
        if(firstChannel >= 0){
          vec4 firstChannelFrag = getX(b, r, c, firstChannel);
          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));
            if(hasNextRow){
              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));
            }
        }

        ivec2 depth = ivec2(d, d + 1);
        for (int j = - ${i}; j <= ${i}; j++) {
          ivec2 idx = depth + j;
          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));
          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(${a}));

          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;
          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;

          if(depthInRange || depthPlusOneInRange){
            vec4 z = vec4(0.);
            vec4 xFragAtCurrentDepth;
            z.xz = cache.xy;
            if(depthPlusOneInRange && hasNextCol){
              xFragAtCurrentDepth = idx.y != d ?
                getX(b, r, c, idx.y) : xFragAtOutputCoords;
              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));
              if(hasNextRow){
                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));
              }
            }
            cache.xy = z.yw;
            sum += z * z;
          }
        }
        vec4 result = xAtOutputCoords * ${u};
        setOutput(result);
      }
    `}};var Cre=e=>{let{inputs:t,backend:r,attrs:n}=e,{x:o}=t,{depthRadius:s,bias:i,alpha:a,beta:u}=n,c=z().getBool("WEBGL_PACK_NORMALIZATION")?new V2(o.shape,s,i,a,u):new U2(o.shape,s,i,a,u);return r.runWebGLProgram(c,[o],o.dtype)},rB={kernelName:Rx,backendName:"webgl",kernelFunc:Cre};var G2=class{constructor(t,r,n,o,s){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=t,this.depth=t[3],this.depthRadius=r,this.bias=n,this.alpha=o,this.beta=s,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];

        float result = 0.0;
        for (int d = 0; d < ${this.depth}; ++d) {
          int depthBegin = int(max(0.0, float(d - ${r})));
          int depthEnd = int(min(float(${this.depth}),
              float(d + ${r} + 1)));

          const int MIN_DEPTH_BEGIN = 0;
          const int MAX_DEPTH_END = ${this.depth};

          float norm = 0.0;
          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            }
            else {
              break;
            }
          }

          norm = float(${o}) * norm + float(${n});

          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd){
              float dyi = -2.0 * float(${o})
                * float(${s})
                * getInputImage(b, r, c, k) * getOutputImage(b, r, c, d)
                / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * ${s});
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            }
            else {
              break;
            }
          }
      }
      setOutput(result);
      }
    `}};var Ere=e=>{let{inputs:t,backend:r,attrs:n}=e,{x:o,y:s,dy:i}=t,{depthRadius:a,bias:u,alpha:c,beta:p}=n,m=new G2(o.shape,a,u,c,p);return r.runWebGLProgram(m,[o,s,i],o.dtype)},nB={kernelName:$4,backendName:"webgl",kernelFunc:Ere};function oB(e,t,r,n){let o=A.sizeFromShape(t),i=A.sizeFromShape(e.shape)/o,a=pe({inputs:{x:e},attrs:{shape:[i,o]},backend:n}),u=No(a,e.dtype,"max",n),c=pe({inputs:{x:u},attrs:{shape:r},backend:n});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(u),c}function HC(e){let{inputs:t,backend:r,attrs:n}=e,{x:o}=t,{reductionIndices:s,keepDims:i}=n,a=o.shape.length,u=A.parseAxisParam(s,o.shape),c=u,p=U.getAxesPermutation(c,a),m=p!=null,h=r.shouldExecuteOnCPU([o]),x=o;if(m){if(h){let D=r.texData.get(x.dataId).values,P=new Array(a);for(let Z=0;Z<P.length;Z++)P[Z]=o.shape[p[Z]];let G=Cl(D,o.shape,o.dtype,p,P);x=r.makeTensorInfo(P,o.dtype);let q=r.texData.get(x.dataId);q.values=G}else x=iu(o,p,r);c=U.getInnerMostAxes(c.length,a)}U.assertAxesAreInnerMostDims("max",c,a);let[y,v]=U.computeOutAndReduceShapes(x.shape,c),w=y;i&&(w=U.expandShapeToKeepDim(y,u));let C;if(h){let D=r.texData.get(x.dataId).values,P=dP(D,A.sizeFromShape(v),w,o.dtype);C=r.makeTensorInfo(w,o.dtype);let G=r.texData.get(C.dataId);G.values=P}else C=oB(x,v,w,r);return m&&r.disposeIntermediateTensorInfo(x),C}var sB={kernelName:Ox,backendName:"webgl",kernelFunc:HC};var Nre=Bp+`
  return max(a, b);
`,_re=`
  vec4 result = vec4(max(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+Eo+`
  return result;
`,Ire=bt({opSnippet:Nre,packedOpSnippet:_re,cpuKernelImpl:gP}),iB={kernelName:jc,backendName:"webgl",kernelFunc:Ire};function Are(e){let{inputs:t,backend:r,attrs:n}=e,{x:o}=t;Ni(o,"maxPool");let{filterSize:s,strides:i,pad:a,dimRoundingMode:u}=n,c=1;A.assert(U.eitherStridesOrDilationsAreOne(i,c),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${i} and dilations '${c}'`);let p=U.computePool2DInfo(o.shape,s,i,c,a,u);if(p.filterWidth===1&&p.filterHeight===1&&A.arraysEqual(p.inShape,p.outShape))return lr({inputs:{x:o},backend:r});let m=new Ks(p,"max",!1);return r.runWebGLProgram(m,[o],o.dtype)}var aB={kernelName:Dx,backendName:"webgl",kernelFunc:Are};function kre(e){let{inputs:t,backend:r,attrs:n}=e,{x:o}=t,{filterSize:s,strides:i,pad:a,dataFormat:u,dimRoundingMode:c}=n,p=[1,1,1],m=U.computePool3DInfo(o.shape,s,i,p,a,c,u),h=new au(m,"max",!1);return r.runWebGLProgram(h,[o],o.dtype)}var uB={kernelName:Fx,backendName:"webgl",kernelFunc:kre};var W2=class{constructor(t){this.variableNames=["dy","maxPos"],this.outputShape=t.inShape;let r=t.strideHeight,n=t.strideWidth,o=t.dilationHeight,s=t.effectiveFilterHeight,i=t.effectiveFilterWidth,a=s-1-t.padInfo.top,u=i-1-t.padInfo.left,c=s*i-1;this.userCode=`
      const ivec2 pads = ivec2(${a}, ${u});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${s};
          wR += ${o}) {
          float dyR = float(dyRCorner + wR) / ${r}.0;

          if (dyR < 0.0 || dyR >= ${t.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${i}; wC++) {
            float dyC = float(dyCCorner + wC) / ${n}.0;

            if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);
            int maxPosValue = ${c} - int(getMaxPos(b, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            int curPosValue = wR * ${i} + wC;
            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

            dotProd += dyValue * mask;
          }
        }
        setOutput(dotProd);
      }
    `}},z2=class{constructor(t){this.variableNames=["dy","maxPos"],this.outputShape=t.inShape;let r=t.strideDepth,n=t.strideHeight,o=t.strideWidth,s=t.dilationDepth,i=t.dilationHeight,a=t.dilationWidth,u=t.effectiveFilterDepth,c=t.effectiveFilterHeight,p=t.effectiveFilterWidth,m=u-1-t.padInfo.front,h=c-1-t.padInfo.top,x=p-1-t.padInfo.left,y=u*c*p-1;this.userCode=`
      const ivec3 pads = ivec3(${m}, ${h}, ${x});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${u};
           wD += ${s}) {
          float dyD = float(dyDCorner + wD) / ${r}.0;

          if (dyD < 0.0 || dyD >= ${t.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${c};
              wR += ${i}) {
            float dyR = float(dyRCorner + wR) / ${n}.0;

            if (dyR < 0.0 || dyR >= ${t.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${p};
                wC += ${a}) {
              float dyC = float(dyCCorner + wC) / ${o}.0;

              if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);
              int maxPosValue = ${y} -
                  int(getMaxPos(batch, idyD, idyR, idyC, ch));

              // Get the current value, check it against the value from the
              // position matrix.
              int curPosValue =
                  wD * ${c} * ${p} +
                  wR * ${p} + wC;
              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

              dotProd += dyValue * mask;
            }
          }
        }
        setOutput(dotProd);
      }
    `}};function $re(e){let{inputs:t,backend:r,attrs:n}=e,{dy:o,input:s}=t,i=s,{filterSize:a,strides:u,pad:c,dimRoundingMode:p}=n,m=[1,1,1],h=U.computePool3DInfo(i.shape,a,u,m,c,p),x=new au(h,"max",!0),y=r.runWebGLProgram(x,[i],i.dtype),v=new z2(h),w=r.runWebGLProgram(v,[o,y],i.dtype);return r.disposeIntermediateTensorInfo(y),w}var lB={kernelName:O4,backendName:"webgl",kernelFunc:$re};function Rre(e){let{inputs:t,backend:r,attrs:n}=e,{dy:o,input:s,output:i}=t,a=s;Ni([s,i],"maxPoolGrad");let{filterSize:u,strides:c,pad:p,dimRoundingMode:m}=n,h=U.computePool2DInfo(a.shape,u,c,1,p,m),x=!0,y=new Ks(h,"max",x),v=r.runWebGLProgram(y,[a],a.dtype),w=new W2(h),C=r.runWebGLProgram(w,[o,v],a.dtype);return r.disposeIntermediateTensorInfo(v),C}var cB={kernelName:R4,backendName:"webgl",kernelFunc:Rre};function pB(e,t,r,n){let o=new Ks(r,"max",!1),s=n.runWebGLProgram(o,[e],"float32");o=new Ks(r,"max",!0,!0,t);let i=n.runWebGLProgram(o,[e],"float32");return[s,i]}var fB={kernelName:Px,backendName:"webgl",kernelFunc:({inputs:e,attrs:t,backend:r})=>{let{x:n}=e,{filterSize:o,strides:s,pad:i,includeBatchInIndex:a}=t,u=r;A.assert(n.shape.length===4,()=>`Error in maxPool: input must be rank 4 but got rank ${n.shape.length}.`);let c=[1,1];A.assert(U.eitherStridesOrDilationsAreOne(s,c),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${s} and dilations '${c}'`);let p=U.computePool2DInfo(n.shape,o,s,c,i),[m,h]=pB(n,a,p,u);return[m,h]}};function mB(e,t,r,n){let o=A.sizeFromShape(t),i=A.sizeFromShape(e.shape)/o,a=pe({inputs:{x:e},attrs:{shape:[i,o]},backend:n}),u=No(a,"float32","mean",n),c=pe({inputs:{x:u},attrs:{shape:r},backend:n});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(u),c}var hB={kernelName:Lx,backendName:"webgl",kernelFunc:({inputs:e,attrs:t,backend:r})=>{let{x:n}=e,{keepDims:o,axis:s}=t,i=r,a=n.shape.length,u=A.parseAxisParam(s,n.shape),c=u,p=U.getAxesPermutation(c,a),m=p!=null,h=i.shouldExecuteOnCPU([n]),x=[],y=n;if(m){if(h){let P=i.texData.get(y.dataId).values,G=new Array(a);for(let Y=0;Y<G.length;Y++)G[Y]=n.shape[p[Y]];let q=Cl(P,n.shape,n.dtype,p,G);y=i.makeTensorInfo(G,n.dtype);let Z=i.texData.get(y.dataId);Z.values=q}else y=iu(n,p,i);x.push(y),c=U.getInnerMostAxes(c.length,a)}U.assertAxesAreInnerMostDims("sum",c,a);let[v,w]=U.computeOutAndReduceShapes(y.shape,c),C=v;o&&(C=U.expandShapeToKeepDim(v,u));let I=mB(y,w,C,i);for(let D of x)i.disposeIntermediateTensorInfo(D);return I}};function Ore(e){let{inputs:t,backend:r,attrs:n}=e,{x:o}=t,{axis:s,keepDims:i}=n,a=o.shape.length,u=A.parseAxisParam(s,o.shape),c=u,p=U.getAxesPermutation(c,a),m=o;p!=null&&(m=Ht({inputs:{x:o},backend:r,attrs:{perm:p}}),c=U.getInnerMostAxes(c.length,o.shape.length)),U.assertAxesAreInnerMostDims("min",c,a);let[h,x]=U.computeOutAndReduceShapes(m.shape,c),y=A.sizeFromShape(x),v=pe({inputs:{x:m},backend:r,attrs:{shape:[-1,y]}}),w=No(v,v.dtype,"min",r),C;if(i){let I=U.expandShapeToKeepDim(h,u);C=pe({inputs:{x:w},backend:r,attrs:{shape:I}})}else C=pe({inputs:{x:w},backend:r,attrs:{shape:h}});return r.disposeIntermediateTensorInfo(v),r.disposeIntermediateTensorInfo(w),p!=null&&r.disposeIntermediateTensorInfo(m),C}var dB={kernelName:Bx,backendName:"webgl",kernelFunc:Ore};var Dre=Bp+`
  return min(a, b);
`,Fre=`
  vec4 result = vec4(min(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+Eo+`
  return result;
`,Pre=bt({opSnippet:Dre,packedOpSnippet:Fre,cpuKernelImpl:xP}),gB={kernelName:Xc,backendName:"webgl",kernelFunc:Pre};var H2=class{constructor(t,r,n){this.variableNames=["x"],this.outputShape=r.map((p,m)=>p[0]+t[m]+p[1]);let o=t.length,s=Ke(o),i=r.map(p=>p[0]).join(","),a=r.map((p,m)=>p[0]+t[m]).join(","),u=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,o),c=n==="reflect"?0:1;if(o===1){this.userCode=`
        int start = ${i};
        int end = ${a};

        void main() {
          int outC = getOutputCoords();
          if (outC < start) {
            outC = start * 2 - outC - ${c};
          } else if(outC >= end) {
            outC = (end - 1) * 2 - outC + ${c};
          }
          setOutput(getX(outC - start));
        }
      `;return}this.userCode=`
      ${s} start = ${s}(${i});
      ${s} end = ${s}(${a});

      void main() {
        ${s} outC = getOutputCoords();
        for (int i = 0; i < ${o}; i++) {
          if (outC[i] < start[i]) {
            outC[i] = start[i] * 2 - outC[i] - ${c};
          } else if(outC[i] >= end[i]) {
            outC[i] = (end[i] - 1) * 2 - outC[i] + ${c};
          }
        }
        ${s} coords = outC - start;
        setOutput(getX(${u}));
      }
    `}};var K2=class{constructor(t,r,n){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=r.map((y,v)=>y[0]+t[v]+y[1]);let o=t.length,s=Ke(o),i=r.map(y=>y[0]).join(","),a=r.map((y,v)=>y[0]+t[v]).join(","),u=ur("rc",o),c=ur("source",o),p=`${u[o-1]} < ${this.outputShape[o-1]}`,m=o===1?"source":`vec2(${c.slice(-2).join()})`,h=n==="reflect"?0:1,x="";if(o===1){let y=`
        ${s} source = rc;
        if (source < start) {
          source = start * 2 - source - ${h};
        } else if (source >= end) {
          source = (end - 1) * 2 - source + ${h};
        }
        source -= start;
      `;x=`
        ${s} rc = outputLoc;
        ${y}
        result[0] = getChannel(getX(${c.join()}), ${m});
        ${u[o-1]} += 1;
        if(${p}) {
          ${y}
          result[1] = getChannel(getX(${c.join()}), ${m});
        }
      `}else{let y=`
        ${s} source = rc;
        ${s} lt = ${s}(lessThan(source, start));
        ${s} gte = ${s}(greaterThanEqual(source, end));
        ${s} orig = 1 - (lt + gte);
        source = orig * source +
                lt * (start * 2 - source - ${h}) +
                gte * ((end - 1) * 2 - source + ${h});
        source -= start;
      `;x=`
        ${s} rc = outputLoc;
        ${y}
        result[0] = getChannel(getX(${c.join()}), ${m});
        ${u[o-1]} += 1;
        if(${p}) {
          ${y}
          result[1] = getChannel(getX(${c.join()}), ${m});
        }
        rc = outputLoc;
        ${u[o-2]} += 1;
        if(${u[o-2]} < ${this.outputShape[o-2]}) {
          ${y}
          result[2] = getChannel(getX(${c.join()}), ${m});
          ${u[o-1]} += 1;
          if(${p}) {
            ${y}
            result[3] = getChannel(getX(${c.join()}), ${m});
          }
        }
      `}this.userCode=`
      const ${s} start = ${s}(${i});
      const ${s} end = ${s}(${a});

      void main() {
        ${s} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${x}
        setOutput(result);
      }
    `}};var Lre=({inputs:e,backend:t,attrs:r})=>{let{x:n}=e,{paddings:o,mode:s}=r,i=z().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new K2(n.shape,o,s):new H2(n.shape,o,s);return t.runWebGLProgram(i,[n],n.dtype)},xB={kernelName:Mx,backendName:"webgl",kernelFunc:Lre};var Bre=`if (b == 0.0) return NAN;
  return mod(a, b);`,Mre=`
  vec4 result = mod(a, b);
  bvec4 isNaN = equal(b, vec4(0.0));
  `+Eo+`
  return result;
`,Ure=bt({opSnippet:Bre,packedOpSnippet:Mre}),yB={kernelName:Ux,backendName:"webgl",kernelFunc:Ure};var q2=class{constructor(t,r,n){this.variableNames=["probs"],this.customUniforms=[{name:"seed",type:"float"}],this.outputShape=[t,n],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];

        float r = random(seed);
        float cdf = 0.0;

        for (int i = 0; i < ${r-1}; i++) {
          cdf += getProbs(batch, i);

          if (r < cdf) {
            setOutput(float(i));
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutput(float(${r-1}));
      }
    `}};var Vre=`
if (a == b) {
  return 1.0;
};
return a / b;`,Gre=`
  // vec4 one = vec4(equal(a, b));
  // return one + (vec4(1.0) - one) * a / b;
  vec4 result = a / b;
  if(a.x == b.x) {
    result.x = 1.;
  }
  if(a.y == b.y) {
    result.y = 1.;
  }
  if(a.z == b.z) {
    result.z = 1.;
  }
  if(a.w == b.w) {
    result.w = 1.;
  }

  return result;
`,KC=bt({opSnippet:Vre,packedOpSnippet:Gre,checkOutOfBounds:!0}),bB={kernelName:cx,backendName:"webgl",kernelFunc:KC};var vB="return a - b;",qC=bt({opSnippet:vB,packedOpSnippet:vB,supportsComplex:!0,cpuKernelImpl:BP}),wB={kernelName:np,backendName:"webgl",kernelFunc:qC};function jC(e){let{inputs:t,backend:r,attrs:n}=e,{logits:o}=t,{dim:s}=n,i=A.parseAxisParam([s],o.shape),a=HC({inputs:{x:o},backend:r,attrs:{reductionIndices:i,keepDims:!1}}),u=U.expandShapeToKeepDim(a.shape,i),c=pe({inputs:{x:a},backend:r,attrs:{shape:u}}),p=qC({inputs:{a:o,b:c},backend:r}),m=GC({inputs:{x:p},backend:r}),h=El({inputs:{x:m},backend:r,attrs:{axis:i,keepDims:!1}}),x=pe({inputs:{x:h},backend:r,attrs:{shape:u}}),y=KC({inputs:{a:m,b:x},backend:r});return r.disposeIntermediateTensorInfo(a),r.disposeIntermediateTensorInfo(c),r.disposeIntermediateTensorInfo(p),r.disposeIntermediateTensorInfo(m),r.disposeIntermediateTensorInfo(h),r.disposeIntermediateTensorInfo(x),y}var TB={kernelName:w1,backendName:"webgl",kernelFunc:jC};function Wre(e){let{inputs:t,backend:r,attrs:n}=e,{logits:o}=t,{numSamples:s,seed:i,normalized:a}=n,u=a?o:jC({inputs:{logits:o},backend:r,attrs:{dim:o.shape.length-1}}),c=u.shape[0],p=u.shape[1],m=new q2(c,p,s),h=[[i]],x=r.runWebGLProgram(m,[u],"int32",h);return a||r.disposeIntermediateTensorInfo(u),x}var SB={kernelName:Vx,backendName:"webgl",kernelFunc:Wre};var zre=Ir+`
  return -x;
`,Hre=`
  vec4 result = -x;
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`;function Kre(e){let{inputs:t,backend:r}=e,{x:n}=t;if(r.shouldExecuteOnCPU([n])){let s=r.texData.get(n.dataId),[i,a]=bP(s.values,n.shape,n.dtype);return r.makeTensorInfo(a,n.dtype,i)}let o;return z().getBool("WEBGL_PACK_UNARY_OPERATIONS")?o=new Jn(n.shape,Hre):o=new Qr(n.shape,zre),r.runWebGLProgram(o,[n],n.dtype)}var CB={kernelName:Am,backendName:"webgl",kernelFunc:Kre};var qre=Ci.nonMaxSuppressionV3Impl;function jre(e){U.warn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");let{inputs:t,backend:r,attrs:n}=e,{boxes:o,scores:s}=t,{maxOutputSize:i,iouThreshold:a,scoreThreshold:u}=n,c=r.readSync(o.dataId),p=r.readSync(s.dataId),{selectedIndices:m}=qre(c,p,i,a,u);return r.makeTensorInfo([m.length],"int32",new Int32Array(m))}var EB={kernelName:Gx,backendName:"webgl",kernelFunc:jre};var Xre=Ci.nonMaxSuppressionV4Impl;function Yre(e){U.warn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");let{inputs:t,backend:r,attrs:n}=e,{boxes:o,scores:s}=t,{maxOutputSize:i,iouThreshold:a,scoreThreshold:u,padToMaxOutputSize:c}=n,p=r.readSync(o.dataId),m=r.readSync(s.dataId),{selectedIndices:h,validOutputs:x}=Xre(p,m,i,a,u,c);return[r.makeTensorInfo([h.length],"int32",new Int32Array(h)),r.makeTensorInfo([],"int32",new Int32Array([x]))]}var NB={kernelName:Wx,backendName:"webgl",kernelFunc:Yre};var Zre=Ci.nonMaxSuppressionV5Impl;function Qre(e){U.warn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");let{inputs:t,backend:r,attrs:n}=e,{boxes:o,scores:s}=t,{maxOutputSize:i,iouThreshold:a,scoreThreshold:u,softNmsSigma:c}=n,p=r.readSync(o.dataId),m=r.readSync(s.dataId),h=i,x=a,y=u,v=c,{selectedIndices:w,selectedScores:C}=Zre(p,m,h,x,y,v);return[r.makeTensorInfo([w.length],"int32",new Int32Array(w)),r.makeTensorInfo([C.length],"float32",new Float32Array(C))]}var _B={kernelName:zx,backendName:"webgl",kernelFunc:Qre};var j2=class{constructor(t,r,n,o){this.variableNames=["indices"],this.outputShape=[t,r],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int index = round(getIndices(coords.x));
        setOutput(mix(float(${o}), float(${n}),
                      float(index == coords.y)));
      }
    `}};var Jre=e=>{let{inputs:t,backend:r,attrs:n}=e,{indices:o}=t,{dtype:s,depth:i,onValue:a,offValue:u}=n,c=A.sizeFromShape(o.shape),p=new j2(c,i,a,u),m=pe({inputs:{x:o},backend:r,attrs:{shape:[c]}}),h=r.runWebGLProgram(p,[m],s);r.disposeIntermediateTensorInfo(m);let x=[...o.shape,i],y=pe({inputs:{x:h},backend:r,attrs:{shape:x}});return r.disposeIntermediateTensorInfo(h),y},IB={kernelName:Kx,backendName:"webgl",kernelFunc:Jre};function vh(e){let{inputs:t,backend:r}=e,{x:n}=t;if(n.dtype==="complex64"){let o=aa({inputs:{input:n},backend:r}),s=vh({inputs:{x:o},backend:r}),i=_l({inputs:{input:n},backend:r}),a=vh({inputs:{x:i},backend:r}),u=to({inputs:{real:s,imag:a},backend:r});return r.disposeIntermediateTensorInfo(o),r.disposeIntermediateTensorInfo(s),r.disposeIntermediateTensorInfo(i),r.disposeIntermediateTensorInfo(a),u}else return ua({attrs:{shape:n.shape,dtype:n.dtype,value:n.dtype==="string"?"":0},backend:r})}var AB={kernelName:B1,backendName:"webgl",kernelFunc:vh};function kB(e){let{inputs:t,backend:r}=e,{x:n}=t;if(n.dtype==="string")throw new Error("onesLike is not supported under string dtype");if(n.dtype==="complex64"){let o=aa({inputs:{input:n},backend:r}),s=kB({inputs:{x:o},backend:r}),i=_l({inputs:{input:n},backend:r}),a=vh({inputs:{x:i},backend:r}),u=to({inputs:{real:s,imag:a},backend:r});return r.disposeIntermediateTensorInfo(o),r.disposeIntermediateTensorInfo(s),r.disposeIntermediateTensorInfo(i),r.disposeIntermediateTensorInfo(a),u}else return ua({attrs:{shape:n.shape,dtype:n.dtype,value:1},backend:r})}var $B={kernelName:Hx,backendName:"webgl",kernelFunc:kB};function ene(e){let{inputs:t,backend:r,attrs:n}=e,{axis:o}=n;if(t.length===1)return R2({inputs:{input:t[0]},backend:r,attrs:{dim:o}});let s=t[0].shape,i=t[0].dtype;t.forEach(p=>{A.assertShapesMatch(s,p.shape,"All tensors passed to stack must have matching shapes"),A.assert(i===p.dtype,()=>"All tensors passed to stack must have matching dtypes")});let a=[],u=t.map(p=>{let m=R2({inputs:{input:p},backend:r,attrs:{dim:o}});return a.push(m),m}),c=VC({inputs:u,backend:r,attrs:{axis:o}});return a.forEach(p=>r.disposeIntermediateTensorInfo(p)),c}var RB={kernelName:qx,backendName:"webgl",kernelFunc:ene};var X2=class{constructor(t,r,n){this.variableNames=["x"],this.customUniforms=[{name:"value",type:"float"}],this.outputShape=r.map((c,p)=>c[0]+t[p]+c[1]);let o=t.length,s=Ke(o),i=r.map(c=>c[0]).join(","),a=r.map((c,p)=>c[0]+t[p]).join(","),u=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,o);if(o===1){this.userCode=`
        int start = ${i};
        int end = ${a};

        void main() {
          int outC = getOutputCoords();
          if (outC < start || outC >= end) {
            setOutput(value);
          } else {
            setOutput(getX(outC - start));
          }
        }
      `;return}this.userCode=`
      ${s} start = ${s}(${i});
      ${s} end = ${s}(${a});

      void main() {
        ${s} outC = getOutputCoords();
        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {
          setOutput(value);
        } else {
          ${s} coords = outC - start;
          setOutput(getX(${u}));
        }
      }
    `}};var Y2=class{constructor(t,r,n){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"value",type:"float"}],this.outputShape=r.map((v,w)=>v[0]+t[w]+v[1]);let o=t.length,s=Ke(o),i=r.map(v=>v[0]).join(","),a=r.map((v,w)=>v[0]+t[w]).join(","),u=ur("rc",o),c=ur("source",o),p=`${u[o-1]} < ${this.outputShape[o-1]}`,m=o===1?"source":`vec2(${c.slice(-2).join()})`,h=[`${s} rc = outputLoc;`,`${u[o-1]} += 1;
       if(${p}) {
      `,o===1?"":`}
       rc = outputLoc;
       ${u[o-2]} += 1;
       if(${u[o-2]} < ${this.outputShape[o-2]}) {`,o===1?"":`  ${u[o-1]} += 1;
         if(${p}) {`],x=o===1?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",y="";for(let v=0,w=o===1?2:4;v<w;v++)y+=`
        ${h[v]}
        if (${x}) {
          result[${v}] = float(value);
        } else {
          ${s} source = rc - start;
          result[${v}] = getChannel(getX(${c.join()}), ${m});
        }
      `;y+=o===1?"} ":"}}",this.userCode=`
      const ${s} start = ${s}(${i});
      const ${s} end = ${s}(${a});

      void main() {
        ${s} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${y}
        setOutput(result);
      }
    `}};var XC=e=>{let{inputs:t,backend:r,attrs:n}=e,{x:o}=t,{paddings:s,constantValue:i}=n;if(A.sizeFromShape(o.shape)===0){let c=s.map((p,m)=>p[0]+o.shape[m]+p[1]);return ua({backend:r,attrs:{shape:c,value:i,dtype:o.dtype}})}let a=z().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Y2(o.shape,s,i):new X2(o.shape,s,i),u=[[i]];return r.runWebGLProgram(a,[o],o.dtype,u)},OB={kernelName:jx,backendName:"webgl",kernelFunc:XC};var tne=`
  if(a < 0.0 && floor(b) < b){
    return NAN;
  }
  if (b == 0.0) {
    return 1.0;
  }
  return (round(mod(b, 2.0)) != 1) ?
      pow(abs(a), b) : sign(a) * pow(abs(a), b);
`,rne=`
  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.
  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));
  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);
  vec4 result = multiplier * pow(abs(a), b);

  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS
  bvec4 isExpZero = equal(b, vec4(0.0));
  result.r = isExpZero.r ? 1.0 : result.r;
  result.g = isExpZero.g ? 1.0 : result.g;
  result.b = isExpZero.b ? 1.0 : result.b;
  result.a = isExpZero.a ? 1.0 : result.a;

  bvec4 isNaN1 = lessThan(a, vec4(0.0));
  bvec4 isNaN2 = lessThan(floor(b), b);
  bvec4 isNaN = bvec4(isNaN1.x && isNaN2.x, isNaN1.y && isNaN2.y, isNaN1.z && isNaN2.z, isNaN1.w && isNaN2.w);
  `+Eo+`
  return result;
`,nne=bt({opSnippet:tne,packedOpSnippet:rne}),DB={kernelName:Xx,backendName:"webgl",kernelFunc:nne};function one(e){let{inputs:t,backend:r,attrs:n}=e,{x:o}=t,{axis:s,keepDims:i}=n,a=o.shape.length,u=[],c=A.parseAxisParam(s,o.shape),p=c,m=U.getAxesPermutation(p,a),h=o;m!=null&&(h=Ht({inputs:{x:o},backend:r,attrs:{perm:m}}),p=U.getInnerMostAxes(p.length,a),u.push(h)),U.assertAxesAreInnerMostDims("prod",p,a);let x;if(r.shouldExecuteOnCPU([h])){let y=r.texData.get(h.dataId).values,{outVals:v,outShape:w,outDtype:C}=wP(h.shape,h.dtype,y,p);x=r.makeTensorInfo(w,C,v)}else{let[y,v]=U.computeOutAndReduceShapes(h.shape,p),w=A.sizeFromShape(v),C=pe({inputs:{x:h},backend:r,attrs:{shape:[-1,w]}}),I=Zu(o.dtype),D=No(C,I,"prod",r);x=pe({inputs:{x:D},backend:r,attrs:{shape:y}}),u.push(C),u.push(D)}if(i){u.push(x);let y=U.expandShapeToKeepDim(x.shape,c);x=pe({inputs:{x},backend:r,attrs:{shape:y}})}return u.forEach(y=>r.disposeIntermediateTensorInfo(y)),x}var FB={kernelName:km,backendName:"webgl",kernelFunc:one};function sne(e){let{inputs:t,backend:r,attrs:n}=e,{paramsNestedSplits:o,paramsDenseValues:s,indices:i}=t,{outputRaggedRank:a}=n,u=o.map(C=>r.readSync(C.dataId)),c=o.map(C=>C.shape),p=r.readSync(s.dataId),m=r.readSync(i.dataId),[h,x,y]=TP(u,c,p,s.shape,s.dtype,m,i.shape,a),v=h.map(C=>r.makeTensorInfo([C.length],"int32",C)),w=r.makeTensorInfo(y,s.dtype,x);return v.concat([w])}var PB={kernelName:Zx,backendName:"webgl",kernelFunc:sne};function ine(e){let{inputs:t,backend:r}=e,{starts:n,limits:o,deltas:s}=t,i=r.readSync(n.dataId),a=r.readSync(o.dataId),u=r.readSync(s.dataId),[c,p]=SP(i,n.shape,n.dtype,a,o.shape,u,s.shape),m=r.makeTensorInfo([c.length],"int32",c),h=r.makeTensorInfo([p.length],n.dtype,p);return[m,h]}var LB={kernelName:Qx,backendName:"webgl",kernelFunc:ine};function ane(e){let{inputs:t,backend:r,attrs:n}=e,{shape:o,values:s,defaultValue:i,rowPartitionTensors:a}=t,{rowPartitionTypes:u}=n,c=r.readSync(o.dataId),p=r.readSync(s.dataId),m=r.readSync(i.dataId),h=a.map(w=>r.readSync(w.dataId)),x=a.map(w=>w.shape),[y,v]=CP(c,o.shape,p,s.shape,s.dtype,m,i.shape,h,x,u);return r.makeTensorInfo(y,s.dtype,v)}var BB={kernelName:Jx,backendName:"webgl",kernelFunc:ane};var YC=e=>{let{backend:t,attrs:r}=e,{start:n,stop:o,step:s,dtype:i}=r,a=EP(n,o,s,i);return t.makeTensorInfo([a.length],i,a)},MB={kernelName:e1,backendName:"webgl",kernelFunc:YC};var une="return 1.0 / x;",lne=_e({opSnippet:une}),UB={kernelName:t1,backendName:"webgl",kernelFunc:lne};var cne=Ir+`
  return (x < 0.0) ? 0.0 : x;
`,pne=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,fne=_e({opSnippet:cne,packedOpSnippet:pne}),VB={kernelName:r1,backendName:"webgl",kernelFunc:fne};var mne=Ir+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,hne=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,dne=_e({opSnippet:mne,packedOpSnippet:hne}),GB={kernelName:i1,backendName:"webgl",kernelFunc:dne};var Z2=class{constructor(t,r,n,o,s){this.variableNames=["A"],this.outputShape=[];let[i,a,u,c]=t;this.outputShape=[i,r,n,c];let p=[o&&r>1?a-1:a,o&&n>1?u-1:u],m=[o&&r>1?r-1:r,o&&n>1?n-1:n],h;s?h="(vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC - vec2(0.5)":h="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${p[0]/m[0]},
          ${p[1]/m[1]});
      const vec2 inputShapeRC = vec2(${a}.0, ${u}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${h};

        // Compute the four integer indices.
        ivec2 sourceFloorRC = ivec2(max(sourceFracIndexRC, vec2(0.0)));
        ivec2 sourceCeilRC = ivec2(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);
        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);
        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);
        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);

        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);

        float top = topLeft + (topRight - topLeft) * fracRC.y;
        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
        float newValue = top + (bottom - top) * fracRC.x;

        setOutput(newValue);
      }
    `}};var Q2=class{constructor(t,r,n,o,s){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];let[i,a,u,c]=t;this.outputShape=[i,r,n,c];let p=[o&&r>1?a-1:a,o&&n>1?u-1:u],m=[o&&r>1?r-1:r,o&&n>1?n-1:n],h;s?h="(vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC - vec3(0.5)":h="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${p[0]/m[0]},
          ${p[1]/m[1]},
          ${p[1]/m[1]});
      const vec3 inputShapeRC = vec3(${a}.0, ${u}.0,
                                     ${u}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${h};

        // Compute the four integer indices.
        ivec3 sourceFloorRC = ivec3(max(sourceFracIndexRC, vec3(0.0)));
        ivec3 sourceCeilRC = ivec3(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${c-1};
        bool hasNextRow = coords.z < ${n-1};

        // In parallel, construct four corners for all four components in
        // packed 2x2 cell.
        vec4 topLeft = vec4(
          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 bottomLeft = vec4(
          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 topRight = vec4(
          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec4 bottomRight = vec4(
          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);

        vec4 top = mix(topLeft, topRight, fracRC.yyzz);
        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);
        vec4 newValue = mix(top, bottom, fracRC.x);

        setOutput(newValue);
      }
    `}};function gne(e){let{inputs:t,backend:r,attrs:n}=e,{images:o}=t,{alignCorners:s,halfPixelCenters:i,size:a}=n,[u,c]=a,p=z().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new Q2(o.shape,u,c,s,i):new Z2(o.shape,u,c,s,i);return r.runWebGLProgram(p,[o],"float32")}var WB={kernelName:s1,backendName:"webgl",kernelFunc:gne};var J2=class{constructor(t,r,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=r;let[,o,s]=r,[,i,a]=t,u=[n&&i>1?o-1:o,n&&a>1?s-1:s],c=[n&&i>1?i-1:i,n&&a>1?a-1:a],p=u[0]/c[0],m=u[1]/c[1],h=1/p,x=1/m,y=Math.ceil(h)*2+2,v=Math.ceil(x)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${p});
        const float widthScale = float(${m});

        const float invHeightScale = float(${h});
        const float invWidthScale = float(${x});

        const int winHeight = int(${y});
        const int winWidth = int(${v});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(startRLerp - float(winHeight / 2));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(startCLerp - float(winWidth / 2));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${i}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${a}) {
              continue;
            }

            float dxR = float(dyR) * heightScale;
            int topDxRIndex = int(floor(dxR));
            int bottomDxRIndex = int(min(ceil(dxR), ${o-1}.0));
            float dxRLerp = dxR - float(topDxRIndex);
            float inverseDxRLerp = 1.0 - dxRLerp;

            float dxC = float(dyC) * widthScale;
            int leftDxCIndex = int(floor(dxC));
            int rightDxCIndex = int(min(ceil(dxC), ${s-1}.0));
            float dxCLerp = dxC - float(leftDxCIndex);
            float inverseDxCLerp = 1.0 - dxCLerp;

            if (r == topDxRIndex && c == leftDxCIndex) {
              // topLeft
              accumulator +=
                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
            }

            if (r == topDxRIndex && c == rightDxCIndex) {
              // topRight
              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
            }

            if (r == bottomDxRIndex && c == leftDxCIndex) {
              // bottomLeft
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
            }

            if (r == bottomDxRIndex && c == rightDxCIndex) {
              // bottomRight
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}};function xne(e){let{inputs:t,backend:r,attrs:n}=e,{images:o,dy:s}=t,{alignCorners:i}=n,a=new J2(s.shape,o.shape,i);return r.runWebGLProgram(a,[s],s.dtype)}var zB={kernelName:F4,backendName:"webgl",kernelFunc:xne};var eb=class{constructor(t,r,n,o,s){this.variableNames=["A"],this.outputShape=[];let[i,a,u,c]=t;this.outputShape=[i,r,n,c];let p=[o&&r>1?a-1:a,o&&n>1?u-1:u],m=[o&&r>1?r-1:r,o&&n>1?n-1:n],h=o?"0.5":"0.0",x;s?x="max((vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC, vec2(0.0))":x="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${p[0]/m[0]},
          ${p[1]/m[1]});
      const vec2 inputShapeRC = vec2(${a}.0, ${u}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${x};

        // Compute the coordinators of nearest neighbor point.
        ivec2 sourceNearestRC = ivec2(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${h})));
        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);

        setOutput(newValue);
      }
    `}};var tb=class{constructor(t,r,n,o,s){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];let[i,a,u,c]=t;this.outputShape=[i,r,n,c];let p=[o&&r>1?a-1:a,o&&n>1?u-1:u],m=[o&&r>1?r-1:r,o&&n>1?n-1:n],h=o?"0.5":"0.0",x;s?x="max((vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC, vec3(0.0))":x="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${p[0]/m[0]},
          ${p[1]/m[1]},
          ${p[1]/m[1]});
      const vec3 inputShapeRC = vec3(${a}.0, ${u}.0,
                                     ${u}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${x};

        // Compute the coordinators of nearest neighbor point.
        ivec3 sourceNearestRC = ivec3(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${h})));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${c-1};
        bool hasNextRow = coords.z < ${n-1};

        vec4 newValue = vec4(
          getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d),
          hasNextCol ? getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d + 1) : 0.0);

        setOutput(newValue);
      }
    `}};function yne(e){let{inputs:t,backend:r,attrs:n}=e,{images:o}=t,{alignCorners:s,halfPixelCenters:i,size:a}=n,[u,c]=a,p=z().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new tb(o.shape,u,c,s,i):new eb(o.shape,u,c,s,i);return r.runWebGLProgram(p,[o],o.dtype)}var HB={kernelName:o1,backendName:"webgl",kernelFunc:yne};var rb=class{constructor(t,r,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=r;let[,o,s]=r,[,i,a]=t,u=[n&&i>1?o-1:o,n&&a>1?s-1:s],c=[n&&i>1?i-1:i,n&&a>1?a-1:a],p=u[0]/c[0],m=u[1]/c[1],h=1/p,x=1/m,y=Math.ceil(h)*2+2,v=Math.ceil(x)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${p});
        const float widthScale = float(${m});

        const float invHeightScale = float(${h});
        const float invWidthScale = float(${x});

        const int winHeight = int(${y});
        const int winWidth = int(${v});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(floor(startRLerp - float(winHeight / 2)));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(floor(startCLerp - float(winWidth / 2)));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${i}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${a}) {
              continue;
            }

            float sourceFracRow =
              float(${u[0]}) *
                (float(dyR) / float(${c[0]}));

            float sourceFracCol =
                float(${u[1]}) *
                  (float(dyC) / float(${c[1]}));

            int sourceNearestRow = int(min(
                float(int(${o}) - 1),
                ${n} ? float(round(sourceFracRow)) :
                                  float(floor(sourceFracRow))));

            int sourceNearestCol = int(min(
                float(int(${s}) - 1),
                ${n} ? float(round(sourceFracCol)) :
                                  float(floor(sourceFracCol))));

            if (r == sourceNearestRow && c == sourceNearestCol) {
              accumulator += getDy(b, dyR, dyC, d);
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}};function bne(e){let{inputs:t,backend:r,attrs:n}=e,{images:o,dy:s}=t,{alignCorners:i}=n,a=new rb(s.shape,o.shape,i);return r.runWebGLProgram(a,[s],s.dtype)}var KB={kernelName:D4,backendName:"webgl",kernelFunc:bne};var nb=class{constructor(t,r){this.variableNames=["x"];let n=t.length;if(n>4)throw new Error(`WebGL backend: Reverse of rank-${n} tensor is not yet supported`);if(this.outputShape=t,n===1){this.userCode=`
        void main() {
          int coord = getOutputCoords();
          setOutput(getX(${t[0]} - coord - 1));
        }
      `;return}let o=a=>r.indexOf(a)!==-1&&t[a]!==1?`${t[a]} - coords[${a}] - 1`:`coords[${a}]`,s=t.map((a,u)=>o(u)).join(","),i=Ke(n);this.userCode=`
      void main() {
        ${i} coords = getOutputCoords();
        setOutput(getX(${s}));
      }
    `}};var ob=class{constructor(t,r){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;let n=t.length;if(n>4)throw new Error(`WebGL backend: Reverse of rank-${n} tensor is not yet supported`);this.outputShape=t;let o=ur("rc",n),s=`${o[n-1]} + 1 < ${this.outputShape[n-1]}`,i=`${o[n-2]} + 1 < ${this.outputShape[n-2]}`,a=Ke(n);n===1?this.userCode=`
        void main(){
          int rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = getChannel(getX(${t[0]} - rc - 1),
            ${t[0]} - rc - 1);
          if(${s}){
              result.g = getChannel(getX(${t[0]} - (rc  + 1) - 1),
                ${t[0]} - (rc  + 1) - 1);
          }
          setOutput(result);
        }
      `:this.userCode=`
        void main() {
          ${a} rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = ${u(o.slice())};
          if(${s}){
            result.g = ${c(o.slice())};
          }
          if(${i}) {
            result.b = ${p(o.slice())};
            if(${s}) {
              result.a = ${m(o.slice())};
            }
          }
          setOutput(result);
        }
    `;function u(y){return h(y)}function c(y){return y[n-1]="("+y[n-1]+" + 1)",h(y)}function p(y){return y[n-2]="("+y[n-2]+" + 1)",h(y)}function m(y){return y[n-1]="("+y[n-1]+" + 1)",y[n-2]="("+y[n-2]+" + 1)",h(y)}function h(y){let v=t.map((I,D)=>x(D,y)),w=v.join(","),C=v.slice(-2).join(",");return`getChannel(getX(${w}), vec2(${C}))`}function x(y,v){return r.indexOf(y)!==-1&&t[y]!==1?`${t[y]} - ${v[y]} - 1`:`${v[y]}`}}};function vne(e){let{inputs:t,backend:r,attrs:n}=e,{x:o}=t,{dims:s}=n,i=o.shape.length,a=A.parseAxisParam(s,o.shape);if(i===0)return lr({inputs:{x:o},backend:r});let u=z().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new ob(o.shape,a):new nb(o.shape,a);return r.runWebGLProgram(u,[o],o.dtype)}var qB={kernelName:a1,backendName:"webgl",kernelFunc:vne};var sb=class{constructor(t,r){this.variableNames=["Image"],this.outputShape=[],this.customUniforms=[{name:"params",type:"vec4"}];let n=t[1],o=t[2];this.outputShape=t;let s="";typeof r=="number"?s=`float outputValue = ${r.toFixed(2)};`:s=`
        vec3 fill = vec3(${r.join(",")});
        float outputValue = fill[coords[3]];`,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];
          int y = coords[1];
          float coordXFloat = (float(x) - params[0]) * params[3] -
            (float(y) - params[1]) * params[2];
          float coordYFloat = (float(x) - params[0]) * params[2] +
            (float(y) - params[1]) * params[3];
          int coordX = int(round(coordXFloat + params[0]));
          int coordY = int(round(coordYFloat + params[1]));
          ${s}
          if(coordX >= 0 && coordX < ${o} && coordY >= 0 && coordY < ${n}) {
            outputValue = getImage(coords[0], coordY, coordX, coords[3]);
          }
          setOutput(outputValue);
        }
    `}};var jB={kernelName:U1,backendName:"webgl",kernelFunc:({inputs:e,attrs:t,backend:r})=>{let{image:n}=e,{radians:o,fillValue:s,center:i}=t,a=r,u=new sb(n.shape,s),[c,p]=U.getImageCenter(i,n.shape[1],n.shape[2]),m=[[c,p,Math.sin(o),Math.cos(o)]];return a.runWebGLProgram(u,[n],n.dtype,m)}};var wne=`
  // OpenGL ES does not support round function.
  // The algorithm is based on banker's rounding.
  float base = floor(x);
  if ((x - base) < 0.5) {
    return floor(x);
  } else if ((x - base) > 0.5) {
    return ceil(x);
  } else {
    if (mod(base, 2.0) == 0.0) {
      return base;
    } else {
      return base + 1.0;
    }
  }
`,Tne=_e({opSnippet:wne}),XB={kernelName:u1,backendName:"webgl",kernelFunc:Tne};var Sne="return inversesqrt(x);",Cne=_e({opSnippet:Sne,cpuKernelImpl:NP}),YB={kernelName:Qc,backendName:"webgl",kernelFunc:Cne};var uu=class{constructor(t,r,n,o,s,i,a=!0,u=!1){this.variableNames=["updates","indices","defaultValue"],this.outputShape=i;let c=Ke(s.length),p=Ke(i.length),m="";n===1?m="i":n===2&&(m="i, j");let h=`getIndices(${m})`,x="";o===1?x="i":o===2&&(x="i, coords[1]");let y=`getUpdates(${x})`,v="";u&&(v="coords[0], coords[1]");let w=`getDefaultValue(${v})`,C=r>1?"strides[j]":"strides";this.userCode=`
        ${c} strides = ${c}(${s});

        void main() {
          ${p} coords = getOutputCoords();
          float sum = 0.0;
          bool found = false;
          for (int i = 0; i < ${t}; i++) {
            int flattenedIndex = 0;
            for (int j = 0; j < ${r}; j++) {
              int index = round(${h});
              flattenedIndex += index * ${C};
            }
            if (flattenedIndex == coords[0]) {
              sum += ${y};
              found = true;
            }
          }
          setOutput(mix(${w}, sum, float(found)));
        }
      `}};var ib=class{constructor(t,r,n,o,s,i,a=!0,u=!1){this.variableNames=["updates","indices","defaultValue"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=i;let c=Ke(s.length),p=Ke(i.length),m="";n===1?m="i":n===2&&(m="i, j");let h=`getIndices(${m})`,x="";o===1?x="i":o===2&&(x="i, coords[1]");let y=`getUpdates(${x})`,v="";u&&(v="coords[0], coords[1]");let w=`getDefaultValue(${v})`,C=r>1?"strides[j]":"strides",I=r>1?"strides[j + 1]":"strides";this.userCode=`
        ${c} strides = ${c}(${s});

        void main() {
          ${p} coords = getOutputCoords();
          vec4 sum = vec4(0.);
          vec4 found = vec4(0.);
          for (int i = 0; i < ${t}; i+=2) {
            ivec2 flattenedIndex = ivec2(0);
            for (int j = 0; j < ${r}; j+=2) {
              ivec4 index = round(${h});
              flattenedIndex += index.xz * ${C};
              if (j + 1 < ${r}) {
                flattenedIndex += index.yw * ${I};
              }
            }
            if (flattenedIndex[0] == coords[0] || flattenedIndex[1] == coords[0] ||
                flattenedIndex[0] == coords[0] + 1 || flattenedIndex[1] == coords[0] + 1) {
              vec4 updVals = ${y};
              if (flattenedIndex[0] == coords[0]) {
                sum.xy += updVals.xy;
                found.xy = vec2(1.);
              } else if (flattenedIndex[0] == coords[0] + 1) {
                sum.zw += updVals.xy;
                found.zw = vec2(1.);
              }
              if (flattenedIndex[1] == coords[0]) {
                sum.xy += updVals.zw;
                found.xy = vec2(1.);
              } else if (flattenedIndex[1] == coords[0] + 1) {
                sum.zw += updVals.zw;
                found.zw = vec2(1.);
              }
            }
          }
          setOutput(mix(${w}, sum, found));
        }
      `}};function Ene(e){let{inputs:t,backend:r,attrs:n}=e,{indices:o,updates:s}=t,{shape:i}=n,{sliceRank:a,numUpdates:u,sliceSize:c,strides:p,outputSize:m}=U.calculateShapes(s,o,i),h=[m/c,c];if(m===0)return r.makeTensorInfo(i,o.dtype);let x=pe({inputs:{x:o},backend:r,attrs:{shape:[u,a]}}),y=pe({inputs:{x:s},backend:r,attrs:{shape:[u,c]}}),v=r.makeTensorInfo([],"float32",new Float32Array([0])),w;z().getBool("WEBGL_PACK")?w=new ib(u,a,x.shape.length,y.shape.length,p,h):w=new uu(u,a,x.shape.length,y.shape.length,p,h);let C=r.runWebGLProgram(w,[y,x,v],y.dtype),I=pe({inputs:{x:C},backend:r,attrs:{shape:i}});return r.disposeIntermediateTensorInfo(x),r.disposeIntermediateTensorInfo(y),r.disposeIntermediateTensorInfo(C),r.disposeIntermediateTensorInfo(v),I}var ZB={kernelName:l1,backendName:"webgl",kernelFunc:Ene};var ab=class{constructor(t,r,n,o){this.variableNames=["sortedSequence","values"],this.customUniforms=[{name:"numInputs",type:"int"}],this.outputShape=[t,n];let s="while (left < right) {",i=`for (int i = 0; i < ${Math.ceil(Math.log2(r+1))}; ++i) { if (left >= right) break;`,a=z().getNumber("WEBGL_VERSION")===2?s:i,u=o==="left"?"<":"<=";this.userCode=`
       int findBound(int batch, float value) {
         int left = 0;
         int right = numInputs;
         int mid;
         ${a}
           mid = (left + right) / 2;
           if (getSortedSequence(batch, mid) ${u} value) {
             left = mid + 1;
           } else {
             right = mid;
           }
         }
         return right;
       }

       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int valueIndex = coords[1];

         float value = getValues(batch, valueIndex);

         setOutput(float(findBound(batch, value)));
       }
     `}};function Nne(e){let{inputs:t,backend:r,attrs:n}=e,{sortedSequence:o,values:s}=t,{side:i}=n,a=new ab(o.shape[0],o.shape[1],s.shape[1],i),u=[[o.shape[1]]];return r.runWebGLProgram(a,[o,s],"int32",u)}var QB={kernelName:p1,backendName:"webgl",kernelFunc:Nne};var ub=class{constructor(t,r,n){this.variableNames=["c","a","b"],this.outputShape=r;let o,s;if(n>4)throw Error(`Where for rank ${n} is not yet supported`);if(n===1)s="resRC",o="resRC";else{let a=["resRC.x","resRC.y","resRC.z","resRC.w"],u=[],c=[];for(let p=0;p<r.length;p++)c.push(`${a[p]}`),p<t&&u.push(`${a[p]}`);o=u.join(),s=c.join()}let i=Ke(n);this.userCode=`
      void main() {
        ${i} resRC = getOutputCoords();
        float cVal = getC(${o});
        if (cVal >= 1.0) {
          setOutput(getA(${s}));
        } else {
          setOutput(getB(${s}));
        }
      }
    `}};function _ne(e){let{inputs:t,backend:r}=e,{condition:n,t:o,e:s}=t,i=new ub(n.shape.length,o.shape,o.shape.length);return r.runWebGLProgram(i,[n,o,s],gn(o.dtype,s.dtype))}var JB={kernelName:f1,backendName:"webgl",kernelFunc:_ne};var Ine=`
  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.
  // see: https://arxiv.org/abs/1706.02515
  float scaleAlpha = ${U.SELU_SCALEALPHA};
  float scale = ${U.SELU_SCALE};
  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);
`,Ane=_e({opSnippet:Ine}),eM={kernelName:m1,backendName:"webgl",kernelFunc:Ane};var kne=ws+`
  return 1.0 / (1.0 + exp(-1.0 * x));
`,$ne=`
  vec4 result = 1.0 / (1.0 + exp(-1.0 * x));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,Rne=_e({opSnippet:kne,packedOpSnippet:$ne,cpuKernelImpl:IP}),tM={kernelName:Jc,backendName:"webgl",kernelFunc:Rne};var One=`
  if (isnan(x)) { return 0.0; }
  return sign(x);
`,Dne=_e({opSnippet:One}),rM={kernelName:g1,backendName:"webgl",kernelFunc:Dne};var Fne=ws+`
  return sin(x);
`,Pne=`
  vec4 result = sin(x);
  bvec4 isNaN = isnan(x);
  ${Eo}
  return result;
`,Lne=_e({opSnippet:Fne,packedOpSnippet:Pne}),nM={kernelName:h1,backendName:"webgl",kernelFunc:Lne};var Bne=`
  float e2x = exp(x);
  return (e2x - 1.0 / e2x) / 2.0;
`,Mne=_e({opSnippet:Bne}),oM={kernelName:d1,backendName:"webgl",kernelFunc:Mne};var Une=`
  float epsilon = 1.1920928955078125e-7;
  float threshold = log(epsilon) + 2.0;

  bool too_large = x > -threshold;
  bool too_small = x < threshold;

  float result;
  float exp_x = exp(x);

  if (too_large){
    result = x;
  }
  else if (too_small){
    result = exp_x;
  }
  else{
    result = log(exp_x + 1.0);
  }
  return result;
`,Vne=_e({opSnippet:Une}),sM={kernelName:x1,backendName:"webgl",kernelFunc:Vne};var Gne=e=>{let{inputs:t,backend:r,attrs:n}=e,{x:o}=t,{blockShape:s,paddings:i}=n;A.assert(o.shape.length<=4,()=>"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet");let a=s.reduce((C,I)=>C*I),u=[[0,0]];u.push(...i);for(let C=1+s.length;C<o.shape.length;++C)u.push([0,0]);let c=[],p=XC({inputs:{x:o},backend:r,attrs:{paddings:u,constantValue:0}}),m=U.getReshaped(p.shape,s,a,!1),h=U.getPermuted(m.length,s.length,!1),x=U.getReshapedPermuted(p.shape,s,a,!1),y=pe({inputs:{x:p},backend:r,attrs:{shape:m}}),v=Ht({inputs:{x:y},backend:r,attrs:{perm:h}}),w=pe({inputs:{x:v},backend:r,attrs:{shape:x}});return c.push(p),c.push(y),c.push(v),c.forEach(C=>r.disposeIntermediateTensorInfo(C)),w},iM={kernelName:b1,backendName:"webgl",kernelFunc:Gne};function Wne(e){let{inputs:t,backend:r}=e,{indices:n,values:o,denseShape:s,defaultValue:i}=t;if(s.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
         ${s.shape}`);if(n.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
         ${n.shape}`);if(o.shape.length!==1)throw new Error(`Values must be a vector, saw:
         ${o.shape}`);if(i.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        ${i.shape}`);let a=r.readSync(n.dataId),u=r.readSync(o.dataId),c=r.readSync(s.dataId),p=r.readSync(i.dataId)[0],[m,h,x,y,v]=kP(a,n.shape,n.dtype,u,o.dtype,c,p);return[r.makeTensorInfo(h,n.dtype,m),r.makeTensorInfo([h[0]],o.dtype,x),r.makeTensorInfo([y.length],"bool",new Uint8Array(y.map(w=>Number(w)))),r.makeTensorInfo([v.length],n.dtype,new Int32Array(v))]}var aM={kernelName:T1,backendName:"webgl",kernelFunc:Wne};function zne(e){let{inputs:t,backend:r}=e,{inputIndices:n,inputShape:o,newShape:s}=t;if(n.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape ${n.shape}`);if(o.shape.length!==1)throw new Error(`Input shape should be a vector but received shape ${o.shape}`);if(s.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${s.shape}`);let i=Array.from(r.readSync(o.dataId)),a=r.readSync(n.dataId),u=Array.from(r.readSync(s.dataId)),[c,p,m]=$P(a,n.shape,n.dtype,i,u);return[r.makeTensorInfo(p,n.dtype,c),r.makeTensorInfo([m.length],s.dtype,new Int32Array(m))]}var uM={kernelName:S1,backendName:"webgl",kernelFunc:zne};function Hne(e){let{inputs:t,backend:r}=e,{data:n,indices:o,segmentIds:s}=t;if(n.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(o.shape.length!==1)throw new Error(`Indices should be a vector but received shape
              ${o.shape}`);if(s.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
              ${s.shape}`);let i=r.readSync(n.dataId),a=r.readSync(o.dataId),u=r.readSync(s.dataId),[c,p]=Wy(i,n.shape,n.dtype,a,u,!0);return r.makeTensorInfo(p,n.dtype,c)}var lM={kernelName:C1,backendName:"webgl",kernelFunc:Hne};function Kne(e){let{inputs:t,backend:r}=e,{data:n,indices:o,segmentIds:s}=t;if(n.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(o.shape.length!==1)throw new Error(`Indices should be a vector but received shape
             ${o.shape}`);if(s.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
             ${s.shape}`);let i=r.readSync(n.dataId),a=r.readSync(o.dataId),u=r.readSync(s.dataId),[c,p]=Wy(i,n.shape,n.dtype,a,u);return r.makeTensorInfo(p,n.dtype,c)}var cM={kernelName:E1,backendName:"webgl",kernelFunc:Kne};function qne(e){let{inputs:t,backend:r,attrs:n}=e,{sparseIndices:o,sparseValues:s,defaultValue:i}=t,{outputShape:a}=n,{sliceRank:u,numUpdates:c,sliceSize:p,strides:m,outputSize:h}=U.calculateShapes(s,o,a),x=!1;if(s.dtype==="string"){let C=r.bufferSync(o),I=r.bufferSync(s),D=A.decodeString(r.readSync(i.dataId)[0]),P=_P(C,I,a,h,p,c,u,m,D,x);return r.makeTensorInfo(a,P.dtype,P.values)}let y=new uu(c,u,o.shape.length,s.shape.length,m,[h,1],x),v=r.runWebGLProgram(y,[s,o,i],s.dtype),w=pe({inputs:{x:v},backend:r,attrs:{shape:a}});return r.disposeIntermediateTensorInfo(v),w}var pM={kernelName:N1,backendName:"webgl",kernelFunc:qne};function jne(e){let{inputs:t,backend:r,attrs:n}=e,{x:o}=t,{numOrSizeSplits:s,axis:i}=n,a=A.parseAxisParam(i,o.shape)[0],u=U.prepareSplitSize(o,s,a),c=o.shape.length,p=new Array(c).fill(0),m=o.shape.slice();return u.map(h=>{let x=[...m];x[a]=h;let y=qs({inputs:{x:o},backend:r,attrs:{begin:p,size:x}});return p[a]+=h,y})}var fM={kernelName:v1,backendName:"webgl",kernelFunc:jne};var mM="return sqrt(x);",Xne=_e({opSnippet:mM,packedOpSnippet:mM,cpuKernelImpl:RP}),hM={kernelName:ep,backendName:"webgl",kernelFunc:Xne};var Yne="return x * x;",Zne=_e({opSnippet:Yne}),dM={kernelName:P4,backendName:"webgl",kernelFunc:Zne};var gM="return (a - b) * (a - b);",Qne=bt({opSnippet:gM,packedOpSnippet:gM}),xM={kernelName:tp,backendName:"webgl",kernelFunc:Qne};function Jne(e){let{inputs:t,backend:r,attrs:n}=e,{x:o}=t;if(o.dtype!=="string")throw new Error("Input must be of datatype string");let s=r.readSync(o.dataId),i=U.fromUint8ToStringArray(s),a=OP(i,"string",n);return r.makeTensorInfo(o.shape,"string",a)}var yM={kernelName:rp,backendName:"webgl",kernelFunc:Jne};function eoe({inputs:e,attrs:t,backend:r}){let{x:n}=e,o=Ir+`
    return x > 0.0 ? 1.0 : float(${t.alpha});
  `,s=new Qr(n.shape,o);return r.runWebGLProgram(s,[n],n.dtype)}var bM={kernelName:M1,backendName:"webgl",kernelFunc:eoe};var lb=class{constructor(t,r,n){this.variableNames=["x"],this.outputShape=n;let o=n.length,s=Ke(n.length),i=Ke(n.length),a="";if(o===1)a="coords * strides + begin";else{let u=0;a=n.map((c,p)=>(u++,n.length===1?`coords * strides[${p}] + begin[${p}]`:`coords[${u-1}] * strides[${p}] + begin[${p}]`)).join(",")}this.userCode=`
      ${s} begin = ${s}(${t});
      ${s} strides = ${s}(${r});

      void main() {
        ${i} coords = getOutputCoords();
        setOutput(getX(${a}));
      }
    `}};function toe(e){let{inputs:t,backend:r,attrs:n}=e,{x:o}=t,{begin:s,end:i,strides:a,beginMask:u,endMask:c,ellipsisMask:p,newAxisMask:m,shrinkAxisMask:h}=n,{finalShapeSparse:x,finalShape:y,isIdentity:v,sliceDim0:w,isSimpleSlice:C,begin:I,end:D,strides:P}=Zn.sliceInfo(o.shape,s,i,a,u,c,p,m,h),G;if(v)G=pe({inputs:{x:o},backend:r,attrs:{shape:y}});else if(w||C){A.assert(o.shape.length>=1,()=>`Input must have rank at least 1, got: ${o.shape.length}`);let Z=Zn.computeOutShape(I,D,P),Y=qs({inputs:{x:o},backend:r,attrs:{begin:I,size:Z}});G=pe({inputs:{x:Y},backend:r,attrs:{shape:y}}),r.disposeIntermediateTensorInfo(Y)}else if(r.shouldExecuteOnCPU([o])){let Y=r.readSync(o.dataId),te=st(o.shape,o.dtype,Y),J=DP(x,te,P,I);G=r.makeTensorInfo(y,o.dtype,J.values)}else{let Y=new lb(I,P,x);G=r.runWebGLProgram(Y,[o],o.dtype)}let q=pe({inputs:{x:G},backend:r,attrs:{shape:y}});return r.disposeIntermediateTensorInfo(G),q}var vM={kernelName:_1,backendName:"webgl",kernelFunc:toe};function roe(e){let{inputs:t,backend:r,attrs:n}=e,{separator:o,nGramWidths:s,leftPad:i,rightPad:a,padWidth:u,preserveShortSequences:c}=n,{data:p,dataSplits:m}=t,h=r.readSync(p.dataId),x=r.readSync(m.dataId),[y,v]=FP(h,x,o,s,i,a,u,c);return[r.makeTensorInfo([y.length],"string",y),r.makeTensorInfo(m.shape,"int32",v)]}var wM={kernelName:I1,backendName:"webgl",kernelFunc:roe};function noe(e){let{inputs:t,backend:r,attrs:n}=e,{skipEmpty:o}=n,{input:s,delimiter:i}=t;if(s.dtype!=="string")throw new Error("Input must be of datatype string");if(s.shape.length!==1)throw new Error(`Input must be a vector, got shape: ${s.shape}`);if(i.shape.length!==0)throw new Error(`Delimiter must be a scalar, got shape: ${i.shape}`);let a=r.readSync(s.dataId),u=r.readSync(i.dataId)[0],[c,p,m]=PP(a,u,o),h=p.length;return[r.makeTensorInfo([h,2],"int32",c),r.makeTensorInfo([h],"string",p),r.makeTensorInfo([2],"int32",new Int32Array(m))]}var TM={kernelName:A1,backendName:"webgl",kernelFunc:noe};function ooe(e){let{inputs:t,backend:r,attrs:n}=e,{numBuckets:o}=n,{input:s}=t;if(s.dtype!=="string")throw new Error("Input must be of datatype string");if(o<=0)throw new Error("Number of buckets must be at least 1");let i=r.readSync(s.dataId),a=LP(i,o);return r.makeTensorInfo(s.shape,"int32",a)}var SM={kernelName:k1,backendName:"webgl",kernelFunc:ooe};var soe="return tan(x);",ioe=_e({opSnippet:soe}),CM={kernelName:$1,backendName:"webgl",kernelFunc:ioe};var aoe=`
  float e2x = exp(-2.0 * abs(x));
  return sign(x) * (1.0 - e2x) / (1.0 + e2x);
`,uoe=_e({opSnippet:aoe}),EM={kernelName:R1,backendName:"webgl",kernelFunc:uoe};function loe(e){let{inputs:t,backend:r,attrs:n}=e,{tensor:o,indices:s,updates:i}=t,{}=n,{sliceRank:a,numUpdates:u,sliceSize:c,strides:p,outputSize:m}=U.calculateShapes(i,s,o.shape),h=[m/c,c];if(m===0)return r.makeTensorInfo(o.shape,s.dtype);let x=pe({inputs:{x:s},backend:r,attrs:{shape:[u,a]}}),y=pe({inputs:{x:i},backend:r,attrs:{shape:[u,c]}}),v=pe({inputs:{x:o},backend:r,attrs:{shape:h}}),w=new uu(u,a,x.shape.length,y.shape.length,p,h,!1,!0),C=r.runWebGLProgram(w,[y,x,v],v.dtype),I=pe({inputs:{x:C},backend:r,attrs:{shape:o.shape}});return r.disposeIntermediateTensorInfo(x),r.disposeIntermediateTensorInfo(y),r.disposeIntermediateTensorInfo(v),r.disposeIntermediateTensorInfo(C),I}var NM={kernelName:c1,backendName:"webgl",kernelFunc:loe};var cb=class{constructor(t,r){this.variableNames=["A"];let n=new Array(t.length);for(let i=0;i<n.length;i++)n[i]=t[i]*r[i];this.outputShape=n,this.rank=n.length;let o=Ke(this.rank),s=coe(t);this.userCode=`
      void main() {
        ${o} resRC = getOutputCoords();
        setOutput(getA(${s}));
      }
    `}};function coe(e){let t=e.length;if(t>5)throw Error(`Tile for rank ${t} is not yet supported`);if(t===1)return`imod(resRC, ${e[0]})`;let r=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],n=[];for(let o=0;o<e.length;o++)n.push(`imod(${r[o]}, ${e[o]})`);return n.join()}function ZC(e){let{inputs:t,backend:r,attrs:n}=e,{x:o}=t,{reps:s}=n;if(o.dtype==="string"||o.shape.length>5){let u=r.readSync(o.dataId),c=o.dtype==="string"?u.map(h=>A.decodeString(h)):u,p=st(o.shape,o.dtype,c),m=MP(p,s);return r.makeTensorInfo(m.shape,m.dtype,m.values)}let i=new cb(o.shape,s);return r.runWebGLProgram(i,[o],o.dtype)}var _M={kernelName:op,backendName:"webgl",kernelFunc:ZC};var pb=class{constructor(t){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"negativeInf",type:"float"},{name:"dir",type:"int"},{name:"inc",type:"int"}],this.outputShape=t,this.userCode=`
       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // We compare elements pair-wise within a group of size 2 * inc.
         // The comparing rule for each group alternates between ascending
         // and descending. Within each group, we compare each pair at
         // positions i and i+inc. To decide whether an element at position i
         // is x0 or x1, we mod it by 2 * inc, if the result is smaller than
         // inc, it is in the first half of the group, we denote it as x0,
         // otherwise we denote it as x1.
         // For example, as shown in the Bitonic top K paper referenced above,
         // Figure5(a) shows that element[1] is in the
         // second half of the group when group size is 2, but it is in the
         // first half of the group when group size is 4.

         bool isFirstInPair = imod(elemIdx, 2 * inc) < inc;
         int i = isFirstInPair ? elemIdx : elemIdx - inc;

         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + inc : int(getIndices(batch, i + inc));
         float x0 = i0 < n ? getX(batch, i0) : negativeInf;
         float x1 = i1 < n ? getX(batch, i1) : negativeInf;

         // Denotes which direction indices are in (ascending or descending).
         bool reverse = imod(elemIdx, 2 * dir) >= dir;
         bool isGreater = x0 > x1 || (x0 == x1 && i1 > i0);
         if (reverse == isGreater) { // Elements in opposite order of direction
           int iTemp = i0;
           i0 = i1;
           i1 = iTemp;
         }
         if (isFirstInPair) {
            setOutput(float(i0));
         } else {
            setOutput(float(i1));
         }
       }
     `}},fb=class{constructor(t){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"k",type:"int"}],this.outputShape=t,this.userCode=`
    void main() {
         // Takes max of indices (0, k), (1, k + 1), (2, k + 2) ...
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // The output size is half of the previous size.
         // If the previous sequence is | | | | _ _ _ _  | | | |  _ _ _ _ (k=4),
         // we only need to output the indices at positions |, the indices at
         // positions _ can be thrown away, see Figure5(b) After Phase 2
         // (Merge phase) in the Bitonic Top K paper referenced above.
         // For example, the paper shows we only need to output the orange bars.
         // The output sequence should look like this | | | | | | | |.
         // Because the sequence is halved, to map the output index back
         // to the previous sequence to find the corresponding value,
         // we need to double the index. When we double the index,
         // we basically interpolate a position, so 2i looks like
         // | _ | _ | _ | _ | _ | _ | _. We move the | to the first k position
         // of each 2k positions by - elemIdx % k. E.g. for output at
         // index 4,5,6,7, we want to get the corresponding element at
         // original index 8,9,10,11, for output at index 8,9,10,11,
         // we want to get the corresponding element at original index
         // 16,17,18,19, so on and so forth.

         int i = elemIdx < k ? elemIdx : (elemIdx * 2 - imod(elemIdx, k));
         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + k : int(getIndices(batch, i + k));

         float x0 = getX(batch, i0);
         float x1 = i1 < n ? getX(batch, i1) : x0;

         setOutput(x0 >= x1 ? float(i0) : float(i1));
       }
     `}};function Il(e,t){t!==null&&e.disposeIntermediateTensorInfo(t)}function IM(e){let t=1;for(;t<e;)t*=2;return t}function poe(e){let{inputs:t,backend:r,attrs:n}=e,{x:o}=t,{k:s,sorted:i}=n,a=z().getNumber("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD"),u=z().getNumber("TOPK_K_CPU_HANDOFF_THRESHOLD"),c=o.shape,p=c[c.length-1];if(r.shouldExecuteOnCPU([o])||p<a||s>u){let J=r.readSync(o.dataId),[ae,ge]=UP(J,c,o.dtype,s,i);return[r.makeTensorInfo(ae.shape,ae.dtype,ae.values),r.makeTensorInfo(ge.shape,ge.dtype,ge.values)]}if(s===0)return c[c.length-1]=0,[r.makeTensorInfo(c,o.dtype,[]),r.makeTensorInfo(c,"int32",[])];if(p===1)return[o,ua({attrs:{shape:c,dtype:"int32",value:0},backend:r})];let m=r.texData.get(o.dataId),h=m!==null&&m.isPacked,x=h?r.unpackTensor(o):o,v=A.sizeFromShape(c)/p,w=pe({inputs:{x},attrs:{shape:[v,p]},backend:r});h&&Il(r,x);let C=IM(s),I=IM(p),D=null,P=()=>D===null?[w,w]:[w,D],G=(J,ae,ge)=>{let ke=P(),We=new pb(ge),ct=[[p],[D===null?1:0],[Number.NEGATIVE_INFINITY],[J],[ae]],oe=D;D=r.runWebGLProgram(We,ke,"int32",ct),Il(r,oe)};for(let J=1;J<C;J*=2){let ae=J*2;for(let ge=J;ge>=1;ge/=2)G(ae,ge,[v,I])}for(let J=I;J>C;J/=2){let ae=P(),ge=new fb([v,J/2]),We=[[p],[D===null?1:0],[C]],Re=D;D=r.runWebGLProgram(ge,ae,"int32",We),Il(r,Re);let ct=C/2,oe=ct*2;for(let fe=ct;fe>=1;fe/=2)G(oe,fe,D.shape)}let q=D;D=qs({inputs:{x:D},backend:r,attrs:{begin:0,size:[v,s]}}),Il(r,q);let Z=zC({inputs:{x:w,indices:D},backend:r,attrs:{axis:1,batchDims:1}});Il(r,w);let Y=c.slice(0,-1);Y.push(s),q=D,D=pe({inputs:{x:D},attrs:{shape:Y},backend:r}),Il(r,q);let te=Z;return Z=pe({inputs:{x:Z},attrs:{shape:Y},backend:r}),Il(r,te),[Z,D]}var AM={kernelName:O1,backendName:"webgl",kernelFunc:poe};var mb=class{constructor(t,r,n,o,s,i){this.variableNames=["Image","Transforms"],this.outputShape=i;let a=n==="nearest"?1:2,u;switch(o){case"constant":u=1;break;case"reflect":u=2;break;case"wrap":u=3;break;case"nearest":u=4;break;default:u=1;break}this.userCode=`
            float mapCoord(float outCoord, float len) {
              float inCoord = outCoord;
              if(${u} == 2) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    if (inCoord < sz2) {
                      inCoord = sz2 * float(int(float(-inCoord / sz2))) +
                      inCoord;
                    }
                    inCoord = inCoord < -len ? inCoord + sz2 : -inCoord - 1.0;
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    inCoord -= sz2 * float(int(float(inCoord / sz2)));
                    if (inCoord >= len) {
                      inCoord = sz2 - inCoord - 1.0;
                    }
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${u} == 3) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord += len * (float(int(float(-inCoord / sz))) + 1.0);
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord -= len * float(int(float(inCoord / sz)));
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${u} == 4) {
                return clamp(outCoord, 0.0, len - 1.0);
              } else {
                return outCoord;
              }
            }

            float readWithFillValue(int batch, int coordY, int coordX,
              int channel) {
              float outputValue;
              if (0 <= coordY && coordY < ${t} && 0 <= coordX && coordX < ${r}) {
                  outputValue = getImage(batch, coordY, coordX, channel);
              } else {
                outputValue = float(${s});
              }
              return outputValue;
            }

            void main() {
              ivec4 coords = getOutputCoords();
              float outputValue;
              int batch = coords[0];
              int x = coords[2];
              int y = coords[1];
              int channel = coords[3];
              float xf = float(x);
              float yf = float(y);
              float a1 = getTransforms(batch, 0);
              float a2 = getTransforms(batch, 1);
              float a3 = getTransforms(batch, 2);
              float b1 = getTransforms(batch, 3);
              float b2 = getTransforms(batch, 4);
              float b3 = getTransforms(batch, 5);
              float c1 = getTransforms(batch, 6);
              float c2 = getTransforms(batch, 7);
              float projection = c1 * xf + c2 * yf + 1.0;
              if (projection == 0.0) {
                outputValue = float(${s});
              } else {
                float inX = (a1 * xf + a2 * yf + a3) / projection;
                float inY = (b1 * xf + b2 * yf + b3) / projection;
                float mapX = mapCoord(inX, float(${r}));
                float mapY = mapCoord(inY, float(${t}));

                if (${a} == 1) {
                  int coordY = int(round(mapY));
                  int coordX = int(round(mapX));
                  outputValue = readWithFillValue(batch, coordY, coordX,
                    channel);
                } else {
                  float yFloor = floor(mapY);
                  float xFloor = floor(mapX);
                  float yCeil = yFloor + 1.0;
                  float xCeil = xFloor + 1.0;
                  float valueYFloor = (xCeil - mapX) *
                  readWithFillValue(batch, int(yFloor), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yFloor), int(xCeil), channel);
                  float valueYCeil = (xCeil - mapX) *
                  readWithFillValue(batch, int(yCeil), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yCeil), int(xCeil), channel);
                  outputValue = (yCeil - mapY) * valueYFloor +
                  (mapY - yFloor) * valueYCeil;
                }
              }
              setOutput(outputValue);
            }
        `}};function foe(e){let{inputs:t,backend:r,attrs:n}=e,{image:o,transforms:s}=t,{interpolation:i,fillMode:a,fillValue:u,outputShape:c}=n,[p,m,h,x]=o.shape,[y,v]=c??[m,h],w=[p,y,v,x],C=new mb(m,h,i,a,u,w);return r.runWebGLProgram(C,[o,s],"float32")}var kM={kernelName:D1,backendName:"webgl",kernelFunc:foe};function moe(e){let{inputs:t,attrs:r,backend:n}=e,{axis:o}=r,{x:s}=t;Ni(s,"unique"),console.warn("WARNING: ","UI might be locked temporarily as data is being downloaded");let i=n.readSync(s.dataId),{outputValues:a,outputShape:u,indices:c}=VP(i,o,s.shape,s.dtype);return[n.makeTensorInfo(u,s.dtype,a),n.makeTensorInfo([c.length],"int32",c)]}var $M={kernelName:F1,backendName:"webgl",kernelFunc:moe};function hoe(e){let{inputs:t,backend:r,attrs:n}=e,{value:o}=t,{axis:s}=n;s<0&&(s+=o.shape.length);let i=o,a=i.shape.length,u=o.shape[s],c=new Array(a-1),p=0;for(let v=0;v<a;v++)v!==s&&(c[p++]=i.shape[v]);let m=[],h=new Array(a).fill(0),x=i.shape.slice();x[s]=1;let y=new Array(u);for(let v=0;v<y.length;v++){h[s]=v;let w=qs({inputs:{x:i},backend:r,attrs:{begin:h,size:x}}),C=pe({inputs:{x:w},backend:r,attrs:{shape:c}});y[v]=C,m.push(w)}return m.forEach(v=>r.disposeIntermediateTensorInfo(v)),y}var RM={kernelName:P1,backendName:"webgl",kernelFunc:hoe};var hb=class{constructor(t,r){this.variableNames=["x","segmentIds"];let n=t.windowSize,o=t.batchSize,s=t.inSize,i=t.numSegments,a=i*Math.ceil(s/n);this.outputShape=[o,a];let u="0.0",c="sumValue",p=Math.floor(n/4)*4,m=n%4,h=`
        sumValue += dot(values, segFilter);
    `,x="";s%n>0&&(x=`
        if (inIdx < 0 || inIdx >= ${s}) {
          return initializationValue;
        }
      `);let y="";s%n>0&&(y=`
        if (inIdx < 0 || inIdx >= ${s}) {
          return -1.0;
        }
      `),this.userCode=`
      const float initializationValue = ${u};

      float getValue(int batch, int inIdx) {
        ${x}
        return getX(batch, inIdx);
      }

      float getSegmentIdAtIndex(int inIdx) {
        ${y}
        return getSegmentIds(inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = int(floor(float(outIdx) / float(
          ${i})) * float(${n}));
        int currentSeg = int(mod(float(outIdx), float(${i})));

        float sumValue = 0.0;

        for (int i = 0; i < ${p}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0
          );

          ${h}
        }

        int inIdx = inOffset + ${p};
        if (${m===1}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            0,
            0,
            0
          );

          ${h}
        } else if (${m===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
              0,
              0
          );

          ${h}
        } else if (${m===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            0
          );

          ${h}
        }
        setOutput(${c});
      }
    `}};function doe(e){let{inputs:t,backend:r,attrs:n}=e,{x:o,segmentIds:s}=t,{numSegments:i}=n,a=o.shape.length,u=[],c=0,p=U.getAxesPermutation([c],a),m=o;p!=null&&(m=Ht({inputs:{x:o},backend:r,attrs:{perm:p}}),u.push(m),c=U.getInnerMostAxes(1,a)[0]);let h=U.segment_util.computeOutShape(m.shape,c,i),x=A.sizeFromShape([m.shape[c]]),y=pe({inputs:{x:m},backend:r,attrs:{shape:[-1,x]}});u.push(y);let v=Zu(o.dtype),w=(P,G,q,Z,Y)=>{let te=P.shape[0],J=P.shape[1],ae=U.segment_util.segOpComputeOptimalWindowSize(J,Y),ge={windowSize:ae,inSize:J,batchSize:te,numSegments:Y},ke=new hb(ge,G),We=r.compileAndRun(ke,[P,q],Z);if(u.push(We),We.shape[1]===Y)return We;let Re=YC({backend:r,attrs:{start:0,stop:Y,step:1,dtype:"float32"}}),ct=ZC({inputs:{x:Re},backend:r,attrs:{reps:[J/ae]}});return u.push(Re),u.push(ct),w(We,G,ct,Z,Y)},C=w(y,"unsortedSegmentSum",s,v,i),I=pe({inputs:{x:C},backend:r,attrs:{shape:h}}),D=I;if(p!=null){u.push(I);let P=U.getUndoAxesPermutation(p);D=Ht({inputs:{x:D},backend:r,attrs:{perm:P}})}return u.forEach(P=>r.disposeIntermediateTensorInfo(P)),D}var OM={kernelName:L1,backendName:"webgl",kernelFunc:doe};var goe=[dL,xL,yL,bL,wL,TL,SL,CL,_L,IL,AL,kL,$L,RL,OL,DL,FL,PL,LL,BL,ML,VL,GL,WL,zL,jL,YL,ZL,sL,JL,t6,r6,n6,o6,s6,i6,a6,u6,l6,c6,m6,h6,d6,g6,x6,y6,b6,v6,w6,T6,S6,C6,E6,N6,_6,I6,k6,$6,R6,O6,F6,P6,L6,B6,M6,U6,V6,G6,W6,oL,z6,e6,H6,K6,q6,iL,j6,X6,Y6,Z6,Q6,J6,eB,tB,rB,nB,sB,iB,aB,uB,lB,cB,fB,hB,dB,gB,xB,yB,SB,lL,CB,EB,NB,_B,HL,IB,$B,RB,OB,DB,aL,FB,PB,LB,BB,MB,KL,bB,UB,VB,GB,pL,WB,zB,HB,KB,qB,jB,XB,YB,ZB,QB,JB,eM,tM,rM,nM,oM,UL,TB,sM,iM,aM,uM,lM,cM,pM,fM,hM,dM,xM,yM,bM,vM,wM,TM,SM,wB,mL,CM,EM,NM,_M,AM,kM,hL,$M,RM,OM,AB];for(let e of goe)B4(e);var db=class e{detector;handLandmarker;constructor(){this.initHandposeV2()}initHandpose(){return ne(this,null,function*(){try{let t=oh.MediaPipeHands,r={runtime:"mediapipe",solutionPath:"https://cdn.jsdelivr.net/npm/@mediapipe/hands",modelType:"full",maxHands:2};this.detector=yield wD(t,r),console.log("Handpose model loaded successfully")}catch(t){console.error("Error initializing handpose model:",t)}})}initHandposeV2(){return ne(this,null,function*(){let t=yield _a.forVisionTasks("https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@0.10.18/wasm");this.handLandmarker=yield Un.createFromOptions(t,{baseOptions:{modelAssetPath:"https://storage.googleapis.com/mediapipe-models/hand_landmarker/hand_landmarker/float16/1/hand_landmarker.task",delegate:"GPU"},runningMode:"VIDEO",numHands:2,minHandDetectionConfidence:.66,minHandPresenceConfidence:.66,minTrackingConfidence:.66})})}detect(t){return ne(this,null,function*(){if(!this.detector)return null;try{return yield this.detector.estimateHands(t,{flipHorizontal:!0,staticImageMode:!1})}catch(r){return console.error("Error detecting hands:",r),null}})}setCanvasForV2(t){this.handLandmarker&&this.handLandmarker.setOptions({canvas:t})}detectV2(t){return ne(this,null,function*(){if(!this.handLandmarker)return null;try{return yield this.handLandmarker.detectForVideo(t,performance.now())}catch(r){return console.error("Error detecting hands:",r),null}})}static \u0275fac=function(r){return new(r||e)};static \u0275prov=XN({token:e,factory:e.\u0275fac,providedIn:"root"})};var boe=["video"],voe=["canvas"],wh=class e{constructor(t){this.handposeService=t}width=320;widthRatio=4;heightRatio=3;height=this.width/this.widthRatio*this.heightRatio;video;canvas;ctx=null;gestureEstimator;handposes$$=new GN([]);handpose$=this.handposes$$.asObservable();videoStream$;gestureDetected=new JN;ngOnInit(){this.gestureEstimator=new PM.GestureEstimator([ac,Ea,ai,Mi,Xf,Yf]),this.ctx=this.canvas.nativeElement.getContext("2d")}ngOnChanges(t){t.width&&(this.width=t.width.currentValue,this.height=this.width/this.widthRatio*this.heightRatio)}ngAfterViewInit(){this.initializeVideoStream()}ngOnDestroy(){this.videoStream$&&this.videoStream$.unsubscribe()}processHandsNoise(){let t=[];this.handpose$=this.handposes$$.pipe(KN(1),Ed(r=>!t[0]||!t[1]?(t[0]=r.find(n=>n.handedness==="Left"),t[1]=r.find(n=>n.handedness==="Right"),r):(["Left","Right"].forEach((n,o)=>{let s=t[o],i=r.findIndex(u=>u.handedness===n),a=r[i];!s||!a||(Au.isHandSimilar(s,a)?r[i]=s:t[o]=a)}),r)),Iv(r=>{this.drawHands(r),console.log(r)}))}initializeVideoStream(){let t={audio:!1,video:{width:this.width,height:this.height,frameRate:{ideal:30}}};navigator.mediaDevices&&navigator.mediaDevices.getUserMedia&&navigator.mediaDevices.getUserMedia(t).then(r=>{this.video.nativeElement.srcObject=r,this.video.nativeElement.play(),this.videoStream$=WN(this.video.nativeElement,"play").pipe(qN(()=>zN(100)),Iv(()=>{this.handposeService.detectV2(this.video.nativeElement).then(n=>{n?this.handleV2Result(n):console.error("No hand result detected")}).catch(n=>console.error("Error for video stream V2"))})).subscribe()}).catch(r=>{console.error("Error accessing video stream:",r)})}handleResults(t){this.drawVideo();let r=[];for(let n of t){if(n.score<.85){console.log("hand",n.score,n);return}Au.drawHandLandmarks(this.canvas.nativeElement,n.keypoints);let o=this.estimateFingerpose(n);if(!o)return;r.push(Ta({handpose:o},n))}this.handposes$$.next(r)}handleV2Result(t){if(this.drawVideo(),!t.handedness.length)return;let r=Au.convertHandLandmarkResultToHand(t,this.width,this.height);this.drawHands(r);let n=this.estimateGestures(r);n?.length&&this.handposes$$.next(n)}drawVideo(){this.ctx&&(this.ctx.clearRect(0,0,this.canvas.nativeElement.width,this.canvas.nativeElement.height),this.ctx.save(),this.ctx.scale(-1,1),this.ctx.drawImage(this.video.nativeElement,-this.width,0,this.width,this.height),this.ctx.restore())}drawHands(t){if(t?.length)for(let r of t)Au.drawHandLandmarks(this.canvas.nativeElement,r.keypoints)}estimateGestures(t){if(!t?.length)return;let r=[];for(let n of t){let o=this.estimateFingerpose(n);o&&r.push(nc(Ta({},n),{handpose:o}))}return r}estimateFingerpose(t){if(!t.keypoints3D)return;let r=t.keypoints3D.map(o=>{let{x:s,y:i,z:a,name:u}=o;return[s,i,a]}),n=this.gestureEstimator?.estimate(r,9);if(n.gestures?.length)return(0,FM.maxBy)(n.gestures,s=>s?.score)?.name}static \u0275fac=function(r){return new(r||e)(Vf(db))};static \u0275cmp=Nd({type:e,selectors:[["app-hand-gestures"]],viewQuery:function(r,n){if(r&1&&(Wf(boe,7),Wf(voe,7)),r&2){let o;zf(o=Hf())&&(n.video=o.first),zf(o=Hf())&&(n.canvas=o.first)}},inputs:{width:"width"},outputs:{gestureDetected:"gestureDetected"},features:[YN],decls:4,vars:4,consts:[["video",""],["canvas",""],["autoplay","",2,"display","none",3,"width","height"],[3,"width","height"]],template:function(r,n){r&1&&_d(0,"video",2,0)(2,"canvas",3,1),r&2&&(Sa("width",n.width)("height",n.height),ii(2),Sa("width",n.width)("height",n.height))},encapsulation:2})};function woe(e,t){if(e&1&&(oc(0,"div",8),sc(1),Iu()),e&2){let r=Gf(2);ii(),kv(' Make the "',r.gameSetting.requiredGestures[r.progress].word,'" gesture ')}}function Toe(e,t){if(e&1&&(oc(0,"div",3)(1,"div",4)(2,"div",5)(3,"span",6),sc(4),Iu()()(),Av(5,woe,2,1,"div",7),Iu()),e&2){let r=Gf();ii(2),e3("width",r.progress/r.gameSetting.requiredGestures.length*100,"%"),ii(2),n3("",r.progress," / ",r.gameSetting.requiredGestures.length,""),ii(),Sa("ngIf",r.gameSetting.requiredGestures[r.progress])}}function Soe(e,t){if(e&1){let r=t3();oc(0,"div",9)(1,"h1"),sc(2,"Congratulations"),Iu(),oc(3,"p"),sc(4),Iu(),oc(5,"button",10),r3("click",function(){ZN(r);let o=Gf();return QN(o.nextLevel())}),sc(6,"Next"),Iu()()}if(e&2){let r=Gf();ii(4),kv('You have completed "',r.gameSetting.levelTitle,'" !!!')}}var LM=class e{constructor(t,r){this.router=t;this.supportersService=r}handGesturesComponent;gameSetting;progress=0;isWon=!1;ngAfterViewInit(){this.handGesturesComponent?.handpose$?.pipe(jN(1e3),HN(),Ed(t=>t.map(r=>r.handpose))).subscribe(t=>{if(console.log(t),!this.gameSetting.requiredGestures.length||this.isWon)return;let r=this.gameSetting.requiredGestures[this.progress];t.some(n=>r.gestures.includes(n))&&(this.progress++,console.log(this.progress)),this.progress===this.gameSetting.requiredGestures.length&&(this.isWon=!0)})}nextLevel(){this.gameSetting.nextStepLink&&(this.supportersService.completeCurrentStep(),this.router.navigate([this.gameSetting.nextStepLink]))}static \u0275fac=function(r){return new(r||e)(Vf(i3),Vf(a3))};static \u0275cmp=Nd({type:e,selectors:[["app-sign-language-game"]],viewQuery:function(r,n){if(r&1&&Wf(wh,5),r&2){let o;zf(o=Hf())&&(n.handGesturesComponent=o.first)}},inputs:{gameSetting:"gameSetting"},decls:3,vars:3,consts:[[3,"width"],["class","progress-container",4,"ngIf"],["class","glass fixed-in-center won-container",4,"ngIf"],[1,"progress-container"],[1,"progress-bar"],[1,"progress-fill"],[1,"progress-text"],["class","current-gesture",4,"ngIf"],[1,"current-gesture"],[1,"glass","fixed-in-center","won-container"],[3,"click"]],template:function(r,n){r&1&&(_d(0,"app-hand-gestures",0),Av(1,Toe,6,5,"div",1)(2,Soe,7,1,"div",2)),r&2&&(Sa("width",640),ii(),Sa("ngIf",!n.isWon),ii(),Sa("ngIf",n.isWon))},dependencies:[s3,o3,wh],styles:[".fixed-in-center[_ngcontent-%COMP%]{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%)}.won-container[_ngcontent-%COMP%]{width:640px;height:480px;display:flex;flex-direction:column;justify-content:center;align-items:center;text-align:center}.progress-container[_ngcontent-%COMP%]{width:640px;margin:20px auto;text-align:center}.progress-bar[_ngcontent-%COMP%]{width:100%;height:30px;background:#ffffff1a;border-radius:15px;overflow:hidden;margin-bottom:10px}.progress-fill[_ngcontent-%COMP%]{height:100%;background:linear-gradient(90deg,#8000ff,#9154b1);transition:width .3s ease;display:flex;align-items:center;justify-content:center;min-width:60px}.progress-text[_ngcontent-%COMP%]{color:#fff;font-weight:700;text-shadow:1px 1px 2px rgba(0,0,0,.3)}.current-gesture[_ngcontent-%COMP%]{font-size:1.2em;margin-top:10px;color:#fff;text-shadow:1px 1px 2px rgba(0,0,0,.3)}"]})};export{LM as a};
